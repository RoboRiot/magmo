{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\item\\\\[id]\\\\index.js\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Form, Button, Card, Container, Row, Col, Modal, FormControl, Collapse, InputGroup, ButtonGroup } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useAuth } from \"../../../../context/AuthUserContext\";\nimport firebase from \"../../../../context/Firebase\";\nimport LoggedIn from \"../../../LoggedIn\";\nimport { useRouter } from \"next/router\";\nimport { fetchClients } from \"../../../../utils/fetchAssociations\";\nimport ClientTable from \"../../../../utils/ClientTable\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport ParentModal from \"../../AddItem/parentModal\";\nimport dynamic from \"next/dynamic\";\nimport InfoModal from \"../../InfoModal\";\nimport MachineSelectionModal from \"./MachineSelectionModal\";\nimport { addServiceItem } from \"../../../../utils/BluefolderService\";\nimport NewLocal from \"./NewLocal\";\nimport styles from \"../../AddItem/NewItem.module.css\"; //inflow API\n\nimport InflowAPI from \"../../../../utils/inflowAPI\";\nimport { buildLocalLocObject, formatLoc, updateMachineFields, buildNameTokens } from \"../../../../utils/itemFormShared\"; // Import for SSR\n\nimport { adminDb } from \"../../../../context/FirebaseAdmin\"; // This will only load the component on the client-side.\n\nconst BarcodeScannerComponent = dynamic(() => import(\"react-qr-barcode-scanner\"), {\n  ssr: false,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"react-qr-barcode-scanner\")],\n    modules: [\"NewSearch\\\\item\\\\[id]\\\\index.js -> \" + \"react-qr-barcode-scanner\"]\n  }\n}); // Simulates a network request delay.\n\nfunction simulateNetworkRequest() {\n  return new Promise(resolve => setTimeout(resolve, 2000));\n} // Custom LoadingButton component.\n\n\nfunction LoadingButton({\n  type,\n  name,\n  route\n}) {\n  const {\n    0: isLoading,\n    1: setLoading\n  } = useState(false);\n  useEffect(() => {\n    if (isLoading) {\n      let cancelled = false;\n      simulateNetworkRequest().then(() => {\n        if (!cancelled) setLoading(false);\n      });\n      return () => {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\n  const handleClick = () => setLoading(true);\n\n  return __jsx(Link, {\n    href: `/${route}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 5\n    }\n  }, __jsx(\"a\", {\n    className: `btn btn-${type}`,\n    disabled: isLoading,\n    onClick: !isLoading ? handleClick : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }\n  }, isLoading ? \"Loading…\" : name));\n}\n\nfunction isValidMachineValue(value) {\n  if (value == null) return false;\n  if (typeof value !== \"string\") return Boolean(value);\n  const trimmed = value.trim();\n  return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\n}\n\nfunction DisplayItemInner({\n  initialItem,\n  initialMachineData,\n  error\n}) {\n  var _initialItem$price, _initialItem$status, _initialItem$length, _initialItem$width, _initialItem$height, _initialItem$poNumber, _initialItem$tracking, _initialItem$visible, _descriptions$selecte3, _descriptions$selecte4, _newLocalFrom$section, _newLocalFrom$section2, _newLocalCurrent$sect, _newLocalCurrent$sect2;\n\n  // Feature flag to show/hide the 3 Slack buttons\n  const SHOW_SLACK_BUTTONS = process.env.NEXT_PUBLIC_SHOW_SLACK_BUTTONS === \"true\";\n  const router = useRouter();\n  const {\n    signOut\n  } = useAuth(); // const { id } = router.query;\n\n  const {\n    id: idFromRouter\n  } = router.query;\n  const initialId = (initialItem === null || initialItem === void 0 ? void 0 : initialItem.id) || idFromRouter; // Use a single local var everywhere in this component\n\n  const id = initialId;\n  const {\n    0: items,\n    1: setItems\n  } = useState({\n    name: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.name) || \"\",\n    pn: Array.isArray(initialItem === null || initialItem === void 0 ? void 0 : initialItem.pn) ? initialItem.pn : initialItem !== null && initialItem !== void 0 && initialItem.pn ? [initialItem.pn] : [],\n    sn: Array.isArray(initialItem === null || initialItem === void 0 ? void 0 : initialItem.sn) ? initialItem.sn : initialItem !== null && initialItem !== void 0 && initialItem.sn ? [initialItem.sn] : [],\n    // hydrate these from initialItem so SSR renders fully on deploy\n    price: (_initialItem$price = initialItem === null || initialItem === void 0 ? void 0 : initialItem.price) !== null && _initialItem$price !== void 0 ? _initialItem$price : \"\",\n    status: (_initialItem$status = initialItem === null || initialItem === void 0 ? void 0 : initialItem.status) !== null && _initialItem$status !== void 0 ? _initialItem$status : \"\",\n    length: (_initialItem$length = initialItem === null || initialItem === void 0 ? void 0 : initialItem.length) !== null && _initialItem$length !== void 0 ? _initialItem$length : \"\",\n    width: (_initialItem$width = initialItem === null || initialItem === void 0 ? void 0 : initialItem.width) !== null && _initialItem$width !== void 0 ? _initialItem$width : \"\",\n    height: (_initialItem$height = initialItem === null || initialItem === void 0 ? void 0 : initialItem.height) !== null && _initialItem$height !== void 0 ? _initialItem$height : \"\",\n    poNumber: (_initialItem$poNumber = initialItem === null || initialItem === void 0 ? void 0 : initialItem.poNumber) !== null && _initialItem$poNumber !== void 0 ? _initialItem$poNumber : \"\",\n    trackingNumber: (_initialItem$tracking = initialItem === null || initialItem === void 0 ? void 0 : initialItem.trackingNumber) !== null && _initialItem$tracking !== void 0 ? _initialItem$tracking : \"\",\n    localSN: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.localSN) || \"\",\n    arrival_date: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.arrival_date) || \"\",\n    visible: (_initialItem$visible = initialItem === null || initialItem === void 0 ? void 0 : initialItem.visible) !== null && _initialItem$visible !== void 0 ? _initialItem$visible : true\n  });\n  const {\n    0: savedName,\n    1: setSavedName\n  } = useState((initialItem === null || initialItem === void 0 ? void 0 : initialItem.name) || \"\"); // ⬇️ put this INSIDE DisplayItem, after the related useState hooks\n\n  useEffect(() => {\n    if (!initialItem) return;\n    setDescriptions(initialItem.descriptions || []);\n    setWorkOrders(initialItem.workOrders || []);\n    setDOM(initialItem.DOM || \"\");\n    setItems(prev => {\n      var _ref, _initialItem$status2, _ref2, _initialItem$price2, _ref3, _initialItem$length2, _ref4, _initialItem$width2, _ref5, _initialItem$height2, _ref6, _initialItem$poNumber2, _ref7, _initialItem$tracking2;\n\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        // only overwrite if SSR provided a value; otherwise keep what you have\n        status: (_ref = (_initialItem$status2 = initialItem.status) !== null && _initialItem$status2 !== void 0 ? _initialItem$status2 : prev.status) !== null && _ref !== void 0 ? _ref : \"\",\n        price: (_ref2 = (_initialItem$price2 = initialItem.price) !== null && _initialItem$price2 !== void 0 ? _initialItem$price2 : prev.price) !== null && _ref2 !== void 0 ? _ref2 : \"\",\n        length: (_ref3 = (_initialItem$length2 = initialItem.length) !== null && _initialItem$length2 !== void 0 ? _initialItem$length2 : prev.length) !== null && _ref3 !== void 0 ? _ref3 : \"\",\n        width: (_ref4 = (_initialItem$width2 = initialItem.width) !== null && _initialItem$width2 !== void 0 ? _initialItem$width2 : prev.width) !== null && _ref4 !== void 0 ? _ref4 : \"\",\n        height: (_ref5 = (_initialItem$height2 = initialItem.height) !== null && _initialItem$height2 !== void 0 ? _initialItem$height2 : prev.height) !== null && _ref5 !== void 0 ? _ref5 : \"\",\n        poNumber: (_ref6 = (_initialItem$poNumber2 = initialItem.poNumber) !== null && _initialItem$poNumber2 !== void 0 ? _initialItem$poNumber2 : prev.poNumber) !== null && _ref6 !== void 0 ? _ref6 : \"\",\n        trackingNumber: (_ref7 = (_initialItem$tracking2 = initialItem.trackingNumber) !== null && _initialItem$tracking2 !== void 0 ? _initialItem$tracking2 : prev.trackingNumber) !== null && _ref7 !== void 0 ? _ref7 : \"\"\n      });\n    });\n  }, [initialItem]);\n  const {\n    0: newLocalFrom,\n    1: setNewLocalFrom\n  } = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  });\n  const {\n    0: newLocalCurrent,\n    1: setNewLocalCurrent\n  } = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  }); // New states for separate client selections:\n\n  const {\n    0: selectedClientFrom,\n    1: setSelectedClientFrom\n  } = useState(null);\n  const {\n    0: selectedClientCurrent,\n    1: setSelectedClientCurrent\n  } = useState(null);\n  const {\n    0: selectedMachine,\n    1: setSelectedMachine\n  } = useState(null);\n  const {\n    0: selectedCurrentMachine,\n    1: setSelectedCurrentMachine\n  } = useState(null); // whenever you pick a new “From” client or machine, clear the old From-loc:\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientFrom, selectedMachine]);\n  // const didMountFrom = useRef(false);\n  // useEffect(() => {\n  //   if (!didMountFrom.current) {\n  //     // first time through (the data-load phase), don’t clear\n  //     didMountFrom.current = true;\n  //     return;\n  //   }\n  //   // thereafter, when the user picks a new client or machine, clear:\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  //   setLocalLocFrom(\"\");\n  // }, [selectedClientFrom, selectedMachine]);\n  // whenever you pick a new “Current” client or machine, clear the old Current-loc:\n  // useEffect(() => {\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // const [didFetch, setDidFetch] = useState(false);\n  // useEffect(() => {\n  //   if (!didFetch) {\n  //     // we’re in the data-load phase, skip clearing\n  //     setDidFetch(true);\n  //     return;\n  //   }\n  //   // only clear on subsequent user changes:\n  //   setNewLocalCurrent({ region: \"\", section: {}, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // These arrays will be populated from Firebase.\n\n  const {\n    0: pnOptions,\n    1: setPnOptions\n  } = useState([]);\n  const {\n    0: snOptions,\n    1: setSnOptions\n  } = useState([]);\n  const {\n    0: pnSnLoaded,\n    1: setPnSnLoaded\n  } = useState(false);\n  const {\n    0: pnSnLoading,\n    1: setPnSnLoading\n  } = useState(false);\n  const {\n    0: descriptions,\n    1: setDescriptions\n  } = useState([{\n    description: \"\",\n    date: \"\"\n  }]);\n  const {\n    0: workOrders,\n    1: setWorkOrders\n  } = useState([{\n    workOrder: \"\",\n    date: \"\"\n  }]);\n  const {\n    0: clients,\n    1: setClients\n  } = useState([]);\n  const {\n    0: clientsLoaded,\n    1: setClientsLoaded\n  } = useState(false);\n  const {\n    0: clientsLoading,\n    1: setClientsLoading\n  } = useState(false);\n  const {\n    0: photos,\n    1: setPhotos\n  } = useState([]);\n  const {\n    0: show,\n    1: setShow\n  } = useState(false);\n  const {\n    0: showErr,\n    1: setShowErr\n  } = useState(false);\n  const {\n    0: Err,\n    1: setErr\n  } = useState(\"N/A\");\n  const {\n    0: showDescModal,\n    1: setShowDescModal\n  } = useState(false);\n  const {\n    0: showWoModal,\n    1: setShowWoModal\n  } = useState(false);\n  const {\n    0: showClientModal,\n    1: setShowClientModal\n  } = useState(false);\n  const {\n    0: showMachineModal,\n    1: setShowMachineModal\n  } = useState(false);\n  const {\n    0: showParentModal,\n    1: setShowParentModal\n  } = useState(false);\n  const {\n    0: showCameraModal,\n    1: setShowCameraModal\n  } = useState(false);\n  const {\n    0: showSaveModal,\n    1: setShowSaveModal\n  } = useState(false);\n  const {\n    0: showPrintModal,\n    1: setShowPrintModal\n  } = useState(false);\n  const {\n    0: machineSelectionModal,\n    1: setMachineSelectionModal\n  } = useState(false);\n  const {\n    0: selectedDesc,\n    1: setSelectedDesc\n  } = useState(0);\n  const {\n    0: selectedClient,\n    1: setSelectedClient\n  } = useState(null);\n  const {\n    0: selectedParent,\n    1: setSelectedParent\n  } = useState(null);\n  const {\n    0: TheMachine,\n    1: setTheMachine\n  } = useState(null);\n  const {\n    0: machineOptions,\n    1: setMachineOptions\n  } = useState([]);\n  const {\n    0: search,\n    1: setSearch\n  } = useState(\"\");\n  const {\n    0: capturedPhoto,\n    1: setCapturedPhoto\n  } = useState(null);\n  const {\n    0: cameraFacing,\n    1: setCameraFacing\n  } = useState(\"environment\");\n  const {\n    0: addToWebsite,\n    1: setAddToWebsite\n  } = useState(false);\n  const {\n    0: machinePick,\n    1: setMachinePick\n  } = useState(false);\n  const {\n    0: freqItem,\n    1: setFreqItem\n  } = useState(0);\n  const {\n    0: usagePastYear,\n    1: setUsagePastYear\n  } = useState(0);\n  const {\n    0: machineFrequency,\n    1: setMachineFrequency\n  } = useState(0); // State for the extra (dimensions/price/DOM/PO Number) section.\n\n  const {\n    0: showExtra,\n    1: setShowExtra\n  } = useState(false); // State for the local warehouse location inputs.\n\n  const {\n    0: localLocFrom,\n    1: setLocalLocFrom\n  } = useState(\"\");\n  const {\n    0: localLocCurrent,\n    1: setLocalLocCurrent\n  } = useState(\"\"); // New state for DOM (Date of Manufacture)\n\n  const {\n    0: DOM,\n    1: setDOM\n  } = useState(\"\"); // New state for OEM, Modality, and Model.\n\n  const {\n    0: oem,\n    1: setOem\n  } = useState(\"\");\n  const {\n    0: modality,\n    1: setModality\n  } = useState(\"\");\n  const {\n    0: model,\n    1: setModel\n  } = useState(\"\");\n\n  const applyMergedMachineFields = merged => {\n    if (!merged) return;\n    setOem(prev => isValidMachineValue(merged.oem) ? merged.oem : prev);\n    setModality(prev => isValidMachineValue(merged.modality) ? merged.modality : prev);\n    setModel(prev => isValidMachineValue(merged.model) ? merged.model : prev);\n  }; // More info modal state.\n\n\n  const {\n    0: showInfoModal,\n    1: setShowInfoModal\n  } = useState(false);\n  const {\n    0: itemName,\n    1: setItemName\n  } = useState(\"\");\n  const {\n    0: machineFieldsInitialized,\n    1: setMachineFieldsInitialized\n  } = useState(false);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true); // near the top of DisplayItem()\n\n  const {\n    0: showLocalModalFrom,\n    1: setShowLocalModalFrom\n  } = useState(false);\n  const {\n    0: showLocalModalCurrent,\n    1: setShowLocalModalCurrent\n  } = useState(false);\n\n  const openLocalModalFrom = () => setShowLocalModalFrom(true);\n\n  const closeLocalModalFrom = () => setShowLocalModalFrom(false);\n\n  const openLocalModalCurrent = () => setShowLocalModalCurrent(true);\n\n  const closeLocalModalCurrent = () => setShowLocalModalCurrent(false); // at the top of DisplayItem()\n\n\n  const {\n    0: showNewLocalModalFrom,\n    1: setShowNewLocalModalFrom\n  } = useState(false);\n  const {\n    0: showNewLocalModalCurrent,\n    1: setShowNewLocalModalCurrent\n  } = useState(false); // when the From-client changes, clear any old local-loc\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientFrom]);\n  // // when the From-machine changes, clear any old local-loc\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedMachine]);\n  // same for Current:\n  // useEffect(() => {\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // const handleSendToInflow = async () => {\n  //   try {\n  //     const name = items.name;\n  //     const description = descriptions[selectedDesc]?.description || \"\";\n  //     // gather every photo URL from Firebase Storage\n  //     const imageUrls = photos.map((p) => p.url);\n  //     await InflowAPI.upsertProduct({ name, description, imageUrls });\n  //     alert(\"Sent to inFlow successfully!\");\n  //   } catch (err) {\n  //     console.error(err);\n  //     alert(\"Error sending to inFlow: \" + err.message);\n  //   }\n  // };\n\n  const handleSendToInflow = async () => {\n    try {\n      var _descriptions$selecte;\n\n      const name = (items.name || '').trim();\n\n      if (!name) {\n        alert('Item needs a name before sending to inFlow.');\n        return;\n      } // Regular description (don’t also send a custom “Description” unless you truly have one)\n\n\n      const description = (((_descriptions$selecte = descriptions[selectedDesc]) === null || _descriptions$selecte === void 0 ? void 0 : _descriptions$selecte.description) || '').trim(); // Photos already fetched from storage\n\n      const imageUrls = photos.map(p => p.url).filter(Boolean); // SKU = your item id\n\n      const sku = (id !== null && id !== void 0 ? id : '').toString(); // Basic normalizers\n\n      const toCSV = arr => Array.isArray(arr) ? arr.filter(Boolean).join(', ') : arr || ''; // YYYY-MM-DD for the date field in inFlow\n\n\n      const arrivalISO = items.arrival_date ? new Date(items.arrival_date).toISOString().slice(0, 10) : '';\n      const pnStr = Array.isArray(items.pn) ? items.pn.filter(Boolean).join(', ') : items.pn || '';\n      const snStr = Array.isArray(items.sn) ? items.sn.filter(Boolean).join(', ') : items.sn || ''; // Most recent WO (you already have this)\n\n      const mostRecentWO = workOrders !== null && workOrders !== void 0 && workOrders.length ? workOrders.reduce((latest, cur) => new Date(cur.date) > new Date(latest.date) ? cur : latest, workOrders[0]) : {\n        workOrder: '',\n        date: ''\n      }; // Build the numbered fields (match your inFlow “Field 1..10”)\n\n      const customFields = {\n        custom1: (oem || '').trim(),\n        // OEM   (dropdown)\n        custom2: (modality || '').trim(),\n        // Modality (dropdown)\n        custom3: (model || '').trim(),\n        // Model (dropdown)\n        custom4: (description || '').trim(),\n        // Description (text) - optional duplicate\n        custom5: (mostRecentWO.workOrder || '').trim(),\n        // Work Order (text)\n        custom6: ((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : selectedClientFrom.name) || '').trim(),\n        // From (text)\n        custom7: pnStr,\n        // Product Number (text)\n        custom8: snStr,\n        // Serial Number (text)\n        custom9: arrivalISO,\n        // Arrival Date (date)\n        custom10: ((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : selectedClientCurrent.name) || '').trim() // Current (text)\n\n      };\n      console.log('[inFlow] customFields to send (numbered):', customFields);\n      const created = await InflowAPI.upsertProduct({\n        name,\n        description,\n        sku,\n        imageUrls,\n        customFields\n      });\n      alert(`Sent to inFlow successfully. ID: ${(created === null || created === void 0 ? void 0 : created.productId) || (created === null || created === void 0 ? void 0 : created.id) || '(unknown)'}`);\n    } catch (err) {\n      console.error(err);\n      alert('Error sending to inFlow: ' + err.message);\n    }\n  }; // const [storedMachine, setStoredMachine] = useState(null);\n  // useEffect(() => {\n  //   // once any of these three change, re-merge:\n  //   if (TheMachine || selectedCurrentMachine || selectedMachine) {\n  //     const merged = updateMachineFields(\n  //       TheMachine,\n  //       selectedCurrentMachine,\n  //       selectedMachine\n  //     );\n  //     setOem(merged.oem);\n  //     setModality(merged.modality);\n  //     setModel(merged.model);\n  //   }\n  // }, [TheMachine, selectedCurrentMachine, selectedMachine]);\n  // whenever the “From” client changes:\n\n\n  useEffect(() => {\n    var _selectedClientFrom$n;\n\n    setShowLocalLocFrom((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n = selectedClientFrom.name) === null || _selectedClientFrom$n === void 0 ? void 0 : _selectedClientFrom$n.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientFrom]); // whenever the “Current” client changes:\n\n  useEffect(() => {\n    var _selectedClientCurren;\n\n    setShowLocalLocCurrent((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren = selectedClientCurrent.name) === null || _selectedClientCurren === void 0 ? void 0 : _selectedClientCurren.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientCurrent]);\n\n  const loadClients = async () => {\n    if (clientsLoaded || clientsLoading) return;\n    setClientsLoading(true);\n\n    try {\n      const clientsData = await fetchClients();\n      setClients(clientsData);\n      setClientsLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching clients: \", error);\n    } finally {\n      setClientsLoading(false);\n    }\n  };\n\n  const loadPnSnOptions = async () => {\n    if (pnSnLoaded || pnSnLoading) return;\n    setPnSnLoading(true);\n\n    try {\n      const db = firebase.firestore();\n      const snapshot = await db.collection(\"Test\").orderBy(firebase.firestore.FieldPath.documentId()).limit(500).get();\n      let pnSet = new Set();\n      let snSet = new Set();\n      snapshot.forEach(doc => {\n        const data = doc.data();\n\n        if (Array.isArray(data.pn)) {\n          data.pn.forEach(pn => pn && pnSet.add(pn));\n        } else if (data.pn) {\n          pnSet.add(data.pn);\n        }\n\n        if (Array.isArray(data.sn)) {\n          data.sn.forEach(sn => sn && snSet.add(sn));\n        } else if (data.sn) {\n          snSet.add(data.sn);\n        }\n      });\n      setPnOptions([...pnSet]);\n      setSnOptions([...snSet]);\n      setPnSnLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching PN/SN options:\", error);\n    } finally {\n      setPnSnLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (id) fetchData(); // always hydrate on the client\n  }, [id]);\n\n  async function resolveClientFromMachine(machineRef, setClient, setMachine, isFrom = true) {\n    const machineDoc = await machineRef.get();\n\n    if (machineDoc.exists) {\n      var _machineData$name;\n\n      const machineData = machineDoc.data();\n      setMachine(_objectSpread({\n        id: machineDoc.id\n      }, machineData)); // Determine if the machine is \"interior socal\"\n      // const isSocalInterior = machineData.name && machineData.name.toLowerCase() === \"interior socal\";\n      // if (isSocalInterior) {\n      //   if (isFrom) {\n      //     setShowLocalLocFrom(true);\n      //   } else {\n      //     setShowLocalLocCurrent(true);\n      //   }\n      // } else {\n      // Optionally clear the flag if it is not \"interior socal\"\n      // if (isFrom) {\n      //   setShowLocalLocFrom(false);\n      // } else {\n      //   setShowLocalLocCurrent(false);\n      // }\n      // }\n      // new: fetch client name and combine both checks\n\n      const clientDoc = machineData.client && typeof machineData.client.get === \"function\" ? await machineData.client.get() : null;\n      const clientName = clientDoc && clientDoc.exists ? clientDoc.data().name : null;\n      const isSocalInterior = ((_machineData$name = machineData.name) === null || _machineData$name === void 0 ? void 0 : _machineData$name.toLowerCase()) === \"interior socal\";\n      const shouldShow = isSocalInterior || clientName === \"SoCalWarehouse\";\n\n      if (isFrom) {\n        setShowLocalLocFrom(shouldShow);\n      } else {\n        setShowLocalLocCurrent(shouldShow);\n      }\n\n      if (machineData.client && typeof machineData.client.get === \"function\") {\n        const clientDoc = await machineData.client.get();\n\n        if (clientDoc.exists) {\n          setClient(_objectSpread({\n            id: clientDoc.id\n          }, clientDoc.data()));\n        }\n      }\n    }\n  }\n\n  const fetchData = async () => {\n    const id = (initialItem === null || initialItem === void 0 ? void 0 : initialItem.id) || idFromRouter; // <- make sure id exists here\n\n    if (!id) return;\n    setIsLoading(true);\n    const db = firebase.firestore();\n\n    try {\n      const doc = await db.collection(\"Test\").doc(id).get();\n\n      if (doc.exists) {\n        var _machineFromData, _machineFromData$name, _machineCurrentData, _machineCurrentData$n, _selectedClientFrom$n2, _selectedClientCurren2;\n\n        console.log(\"test\");\n        const data = doc.data();\n        const normalizedPN = Array.isArray(data.pn) ? data.pn : [data.pn];\n        const normalizedSN = Array.isArray(data.sn) ? data.sn : [data.sn];\n        setItems(_objectSpread(_objectSpread({}, data), {}, {\n          pn: normalizedPN,\n          sn: normalizedSN\n        }));\n        setDescriptions(data.descriptions || []);\n        setWorkOrders(data.workOrders || []);\n        if (data.localLocFrom) setLocalLocFrom(data.localLocFrom);\n        if (data.localLocCurrent) setLocalLocCurrent(data.localLocCurrent);\n\n        if (data.DOM) {\n          setDOM(data.DOM);\n        } // …after you do setItems, setDescriptions, etc.\n        // load the “newLocal” maps\n\n\n        if (data.newLocalFrom) setNewLocalFrom(data.newLocalFrom);\n        if (data.newLocalCurrent) setNewLocalCurrent(data.newLocalCurrent); // Load PO Number if it exists.\n\n        if (data.poNumber) {\n          setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n            poNumber: data.poNumber\n          }));\n        }\n\n        if (data.ClientFrom) {\n          const clientFromDoc = await data.ClientFrom.get();\n\n          if (clientFromDoc.exists) {\n            setSelectedClientFrom(_objectSpread({\n              id: clientFromDoc.id\n            }, clientFromDoc.data()));\n          }\n        }\n\n        if (data.ClientCurrent) {\n          const clientCurrentDoc = await data.ClientCurrent.get();\n\n          if (clientCurrentDoc.exists) {\n            setSelectedClientCurrent(_objectSpread({\n              id: clientCurrentDoc.id\n            }, clientCurrentDoc.data()));\n          }\n        }\n\n        if (!data.ClientFrom && data.Machine && typeof data.Machine.get === \"function\") {\n          console.log(\"Entered resolveClientFromMachine for Machine (old style for From)\");\n          await resolveClientFromMachine(data.Machine, setSelectedClientFrom, setSelectedMachine, true);\n        }\n\n        if (!data.ClientCurrent && data.CurrentMachine && typeof data.CurrentMachine.get === \"function\") {\n          console.log(\"Entered resolveClientFromMachine for CurrentMachine (old style for Current)\");\n          await resolveClientFromMachine(data.CurrentMachine, setSelectedClientCurrent, setSelectedCurrentMachine, false);\n        }\n\n        let machineFromData = null;\n        let machineCurrentData = null;\n\n        if (data.MachineFrom) {\n          const doc = await data.MachineFrom.get();\n          machineFromData = doc.exists ? doc.data() : null;\n          setSelectedMachine(_objectSpread({\n            id: doc.id\n          }, doc.data()));\n        }\n\n        if (data.MachineCurrent) {\n          const doc = await data.MachineCurrent.get();\n          machineCurrentData = doc.exists ? doc.data() : null;\n          setSelectedCurrentMachine(_objectSpread({\n            id: doc.id\n          }, doc.data()));\n        }\n\n        const nameFrom = (_machineFromData = machineFromData) === null || _machineFromData === void 0 ? void 0 : (_machineFromData$name = _machineFromData.name) === null || _machineFromData$name === void 0 ? void 0 : _machineFromData$name.toLowerCase();\n        const nameCurrent = (_machineCurrentData = machineCurrentData) === null || _machineCurrentData === void 0 ? void 0 : (_machineCurrentData$n = _machineCurrentData.name) === null || _machineCurrentData$n === void 0 ? void 0 : _machineCurrentData$n.toLowerCase(); // If the machine’s name is “interior socal”, show that branch:\n        // setShowLocalLocFrom(nameFrom === \"interior socal\");\n        // // Or if your Firestore already has a value for localLocFrom, show it anyway:\n        // if (data.localLocFrom) setShowLocalLocFrom(true);\n        // setShowLocalLocCurrent(nameCurrent === \"interior socal\");\n        // if (data.localLocCurrent) setShowLocalLocCurrent(true);\n        // new: combine machine-name OR client-name check, keep existing-data\n\n        setShowLocalLocFrom(nameFrom === \"interior socal\" || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n2 = selectedClientFrom.name) === null || _selectedClientFrom$n2 === void 0 ? void 0 : _selectedClientFrom$n2.toLowerCase()) === \"socalwarehouse\" || Boolean(data.localLocFrom));\n        setShowLocalLocCurrent(nameCurrent === \"interior socal\" || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren2 = selectedClientCurrent.name) === null || _selectedClientCurren2 === void 0 ? void 0 : _selectedClientCurren2.toLowerCase()) === \"socalwarehouse\" || Boolean(data.localLocCurrent));\n        const theMachineData = data.TheMachine || null;\n        setTheMachine(theMachineData);\n\n        if (theMachineData) {\n          var _theMachineData$oem, _theMachineData$modal, _theMachineData$model;\n\n          // pull both variants, prefer lowercase if it exists\n          const OEM = (_theMachineData$oem = theMachineData.oem) !== null && _theMachineData$oem !== void 0 ? _theMachineData$oem : theMachineData.OEM;\n          const Modality = (_theMachineData$modal = theMachineData.modality) !== null && _theMachineData$modal !== void 0 ? _theMachineData$modal : theMachineData.Modality;\n          const Model = (_theMachineData$model = theMachineData.model) !== null && _theMachineData$model !== void 0 ? _theMachineData$model : theMachineData.Model;\n          setTheMachine(_objectSpread(_objectSpread({}, theMachineData), {}, {\n            OEM,\n            Modality,\n            Model\n          }));\n        } // setStoredMachine(theMachineData);\n        // **right here** merge from the three sources you just fetched:\n\n\n        const merged = updateMachineFields(theMachineData, machineCurrentData, machineFromData);\n        applyMergedMachineFields(merged);\n        console.log(\"SelectedMachine:\", selectedMachine, \"SelectedCurrentMachine:\", selectedCurrentMachine); // Show local loc inputs if applicable\n        // if (\n        //   selectedMachine &&\n        //   selectedMachine.name &&\n        //   selectedMachine.name.toLowerCase() === \"interior socal\"\n        // ) {\n        //   setShowLocalLocFrom(true);\n        // }\n        // if (\n        //   selectedCurrentMachine &&\n        //   selectedCurrentMachine.name &&\n        //   selectedCurrentMachine.name.toLowerCase() === \"interior socal\"\n        // ) {\n        //   setShowLocalLocCurrent(true);\n        // }\n\n        if (data.Parent) {\n          const parentDoc = await data.Parent.get();\n          setSelectedParent(_objectSpread({\n            id: parentDoc.id\n          }, parentDoc.data()));\n        } // Priority auto‑population of machine fields.\n        // const updatedFields = updateMachineFields(storedMachine, selectedCurrentMachine, selectedMachine);\n        // // console.log(\"Updated machine fields:\", updatedFields);\n        // setOem(updatedFields.oem);\n        // setModality(updatedFields.modality);\n        // setModel(updatedFields.model);\n\n\n        setIsLoading(false);\n        Promise.all([fetchPhotos(id), checkIfAddedToWebsite(id), calculateItemFrequencyAndUsage(data.pn)]).catch(err => {\n          console.error(\"Background item loads failed:\", err);\n        });\n      } else {\n        router.push({\n          pathname: \"../AddItem/NewItem\",\n          query: {\n            signal: id\n          }\n        });\n      }\n    } catch (error) {\n      console.error(\"Error fetching item:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const calculateItemFrequencyAndUsage = async pn => {\n    const db = firebase.firestore();\n    const currentDate = new Date();\n    const oneYearAgo = new Date();\n    oneYearAgo.setFullYear(currentDate.getFullYear() - 1);\n    const normalizedPN = pn !== undefined ? pn : \"\";\n    const itemsSnapshot = await db.collection(\"Test\").where(\"pn\", \"==\", normalizedPN).get();\n    setFreqItem(itemsSnapshot.size);\n    let usagePastYear = 0;\n    itemsSnapshot.forEach(doc => {\n      const itemData = doc.data();\n      itemData.workOrders.forEach(workOrder => {\n        const workOrderDate = new Date(workOrder.date);\n\n        if (workOrderDate >= oneYearAgo && workOrderDate <= currentDate) {\n          usagePastYear++;\n        }\n      });\n    });\n    setUsagePastYear(usagePastYear);\n  };\n\n  const fetchMachine = async machineId => {\n    const db = firebase.firestore();\n    const doc = await db.collection(\"Machine\").doc(machineId).get();\n\n    if (doc.exists) {\n      const machineData = doc.data();\n      setTheMachine(machineData); // re-merge all three sources with correct priority:\n\n      const merged = updateMachineFields(machineData, selectedCurrentMachine, selectedMachine);\n      applyMergedMachineFields(merged);\n      const machinesSnapshot = await db.collection(\"Machine\").where(\"Model\", \"==\", machineData.Model || machineData.model).get();\n      setMachineFrequency(machinesSnapshot.size);\n    } else {\n      console.error(\"Machine not found\");\n    }\n  };\n\n  const fetchPhotos = async docID => {\n    const storageRef = firebase.storage().ref();\n    const listRef = storageRef.child(`Parts/${docID}`);\n\n    try {\n      const res = await listRef.listAll();\n      const urls = await Promise.all(res.items.map(item => item.getDownloadURL()));\n      setPhotos(urls.map(url => ({\n        url,\n        file: null\n      })));\n    } catch (error) {\n      console.error(\"Error fetching photos: \", error);\n    }\n  };\n\n  const checkIfAddedToWebsite = async docID => {\n    const db = firebase.firestore();\n    const partsDoc = await db.collection(\"Parts\").doc(docID).get();\n\n    if (partsDoc.exists) {\n      setAddToWebsite(true);\n    }\n  };\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  const handleCloseErr = () => setShowErr(false);\n\n  const handleShowErr = () => setShowErr(true);\n\n  const handleCloseSaveModal = () => setShowSaveModal(false);\n\n  const handleClosePrintModal = () => setShowPrintModal(false);\n\n  const handleShowSaveModal = () => setShowSaveModal(true);\n\n  const handleShowPrintModal = () => setShowPrintModal(true);\n\n  const handleMachineSelectionModal = () => setMachineSelectionModal(false);\n\n  const handleCloseDescModal = () => setShowDescModal(false);\n\n  const handleShowDescModal = () => setShowDescModal(true);\n\n  const handleCloseWoModal = () => setShowWoModal(false);\n\n  const handleShowWoModal = () => setShowWoModal(true);\n\n  const handleCloseClientModal = () => setShowClientModal(false);\n\n  const handleShowClientModal = async () => {\n    await loadClients();\n    setShowClientModal(true);\n  };\n\n  const handleCloseMachineModal = () => setShowMachineModal(false);\n\n  const handleShowMachineModal = () => {\n    setShowMachineModal(true);\n    setShowClientModal(false);\n  };\n\n  const handleCloseParentModal = () => setShowParentModal(false);\n\n  const handleShowParentModal = () => setShowParentModal(true); // When a client is selected from the client table.\n\n\n  const handleClientInfo = async clientId => {\n    // Clear any previously selected machine and local loc info for this branch.\n    if (machinePick) {\n      setSelectedMachine(null);\n      setShowLocalLocFrom(false);\n    } else {\n      setSelectedCurrentMachine(null);\n      setShowLocalLocCurrent(false);\n    }\n\n    const db = firebase.firestore();\n    const clientDoc = await db.collection(\"Client\").doc(clientId).get();\n\n    if (clientDoc.exists) {\n      const clientData = _objectSpread({\n        id: clientDoc.id\n      }, clientDoc.data());\n\n      if (machinePick) {\n        setSelectedClientFrom(clientData);\n      } else {\n        setSelectedClientCurrent(clientData);\n      } // after setting selectedClientFrom/Current:\n\n\n      if (clientData.name === \"SoCalWarehouse\") {\n        if (machinePick) setShowLocalLocFrom(true);else setShowLocalLocCurrent(true);\n      } // Fetch machines for this client:\n\n\n      const machinePromises = clientData.machines.map(machineRef => machineRef.get());\n      const machineDocs = await Promise.all(machinePromises);\n      const machines = machineDocs.map(machineDoc => _objectSpread({\n        id: machineDoc.id\n      }, machineDoc.data()));\n      setMachineOptions(machines); // Close the client modal\n\n      handleCloseClientModal();\n    }\n  }; // Reordering function for dropdowns.\n\n\n  const reorderArray = (arr, selectedValue) => {\n    const newArr = arr.filter(val => val !== selectedValue);\n    return [selectedValue, ...newArr];\n  };\n\n  const {\n    0: addingNewPn,\n    1: setAddingNewPn\n  } = useState(false);\n  const {\n    0: newPn,\n    1: setNewPn\n  } = useState(\"\");\n  const {\n    0: addingNewSn,\n    1: setAddingNewSn\n  } = useState(false);\n  const {\n    0: newSn,\n    1: setNewSn\n  } = useState(\"\");\n\n  const handlePnSelect = e => {\n    const selected = e.target.value;\n    setItems(prev => {\n      let updatedPn = Array.isArray(prev.pn) ? [...prev.pn] : [];\n      updatedPn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: updatedPn\n      });\n    });\n  };\n\n  const handleSnSelect = e => {\n    const selected = e.target.value;\n    setItems(prev => {\n      let updatedSn = Array.isArray(prev.sn) ? [...prev.sn] : [];\n      updatedSn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: updatedSn\n      });\n    });\n  };\n\n  const handleAddNewPn = () => {\n    if (newPn.trim() !== \"\") {\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        pn: [...prev.pn, newPn.trim()]\n      }));\n    }\n\n    setNewPn(\"\");\n    setAddingNewPn(false);\n  };\n\n  const handleAddNewSn = () => {\n    if (newSn.trim() !== \"\") {\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        sn: [...prev.sn, newSn.trim()]\n      }));\n    }\n\n    setNewSn(\"\");\n    setAddingNewSn(false);\n  }; // Generate custom document ID if needed.\n\n\n  const generateCustomID = () => {\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\n    return `AIS${randomNum}`;\n  };\n\n  function shallowClean(obj) {\n    const newObj = {};\n\n    for (const key in obj) {\n      console.log(key, obj[key]);\n\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = obj[key] === undefined ? \"\" : obj[key];\n      }\n    }\n\n    return newObj;\n  }\n\n  async function toSend() {\n    var _fromDetails$section, _fromDetails$section2, _currentDetails$secti, _currentDetails$secti2;\n\n    const db = firebase.firestore();\n    const currentUser = firebase.auth().currentUser;\n    const userEmail = currentUser ? currentUser.email : \"unknown\"; // Always use the current state values for OEM, modality, and model.\n\n    const machineData = _objectSpread(_objectSpread({}, TheMachine || {}), {}, {\n      oem: oem,\n      modality: modality,\n      model: model\n    });\n\n    const formattedItems = _objectSpread(_objectSpread({}, items), {}, {\n      descriptions,\n      workOrders\n    }); // Remove any unused fields.\n\n\n    formattedItems.status = items.status || \"\";\n    formattedItems.nameLower = (items.name || \"\").toLowerCase();\n    formattedItems.nameTokens = buildNameTokens(items.name);\n    formattedItems.DOM = DOM; // Date of Manufacture\n\n    formattedItems.localLocFrom = localLocFrom || \"\";\n    formattedItems.localLocCurrent = localLocCurrent || \"\";\n    formattedItems.date = items.date || \"\";\n    formattedItems.arrival_date = items.arrival_date || \"\"; // NEW: Arrival Date\n\n    formattedItems.poNumber = items.poNumber || \"\";\n    formattedItems.trackingNumber = items.trackingNumber || \"\";\n    formattedItems.TheMachine = machineData || {};\n    formattedItems.addedToWebsite = addToWebsite; // NEW: Add the user's email under the field \"user\"\n\n    formattedItems.lastEdited = userEmail; // Clean pn and sn arrays to replace undefined values with an empty string.\n\n    formattedItems.pn = (items.pn || []).map(value => value === undefined ? \"\" : value);\n    formattedItems.sn = (items.sn || []).map(value => value === undefined ? \"\" : value);\n    const fromDetails = buildLocalLocObject(newLocalFrom);\n    const currentDetails = buildLocalLocObject(newLocalCurrent);\n    console.log(\"From Details: \" + fromDetails.region + \" \" + ((_fromDetails$section = fromDetails.section) === null || _fromDetails$section === void 0 ? void 0 : _fromDetails$section.letter) + ((_fromDetails$section2 = fromDetails.section) === null || _fromDetails$section2 === void 0 ? void 0 : _fromDetails$section2.number) + \" \" + fromDetails.bin + \" \" + fromDetails.pallet);\n    console.log(\"Current Details: \" + currentDetails.region + \" \" + ((_currentDetails$secti = currentDetails.section) === null || _currentDetails$secti === void 0 ? void 0 : _currentDetails$secti.letter) + ((_currentDetails$secti2 = currentDetails.section) === null || _currentDetails$secti2 === void 0 ? void 0 : _currentDetails$secti2.number) + \" \" + currentDetails.bin + \" \" + currentDetails.pallet);\n\n    if (Object.keys(fromDetails).length) {\n      formattedItems.newLocalFrom = fromDetails;\n      formattedItems.localLocFrom = formatLoc(newLocalFrom) || \"\";\n    } else {\n      // all fields empty — force an empty string and remove any stray map\n      console.log(\"entered empty fromDetails else\");\n      formattedItems.localLocFrom = \"\";\n      formattedItems.newLocalFrom = {};\n    }\n\n    if (Object.keys(currentDetails).length) {\n      formattedItems.newLocalCurrent = currentDetails;\n      formattedItems.localLocCurrent = formatLoc(newLocalCurrent) || \"\";\n    } else {\n      // all fields empty — force an empty string and remove any stray map\n      formattedItems.localLocCurrent = \"\";\n      formattedItems.newLocalCurrent = {};\n    }\n\n    if (selectedMachine && selectedMachine.id) {\n      formattedItems.MachineFrom = db.collection(\"Machine\").doc(selectedMachine.id);\n    }\n\n    if (selectedCurrentMachine && selectedCurrentMachine.id) {\n      formattedItems.MachineCurrent = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n    }\n\n    if (selectedParent && selectedParent.id) {\n      formattedItems.Parent = db.collection(\"Test\").doc(selectedParent.id);\n    } // NEW: Set separate client references.\n\n\n    if (selectedClientFrom && selectedClientFrom.id) {\n      formattedItems.ClientFrom = db.collection(\"Client\").doc(selectedClientFrom.id);\n    }\n\n    if (selectedClientCurrent && selectedClientCurrent.id) {\n      formattedItems.ClientCurrent = db.collection(\"Client\").doc(selectedClientCurrent.id);\n    } // Only attach the richer “newLocal” map when the user actually filled something in\n\n\n    if (Object.keys(fromDetails).length) {\n      formattedItems.newLocalFrom = fromDetails;\n    }\n\n    if (Object.keys(currentDetails).length) {\n      formattedItems.newLocalCurrent = currentDetails;\n    }\n\n    let docId = id;\n\n    try {\n      if (docId) {\n        // Check if a localSN is provided and if it differs from the current docId.\n        const newDocId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : docId;\n\n        if (docId !== newDocId) {\n          // Migrate: Create a new document with the newDocId.\n          await db.collection(\"Test\").doc(newDocId).set(formattedItems);\n\n          if (selectedMachine && selectedMachine.id) {\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n            const machineDoc = await machineRef.get();\n\n            if (machineDoc.exists) {\n              await machineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(newDocId))\n              });\n            }\n          }\n\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\n            const currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n            const currentMachineDoc = await currentMachineRef.get();\n\n            if (currentMachineDoc.exists) {\n              await currentMachineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(newDocId))\n              });\n            }\n          } // Delete the old document.\n\n\n          await db.collection(\"Test\").doc(docId).delete(); // Set docId to the new document ID.\n\n          docId = newDocId;\n        } else {\n          // Deep-clean the formattedItems to remove any undefined nested values.\n          const cleanFormattedItems = shallowClean(formattedItems);\n          await db.collection(\"Test\").doc(docId).update(cleanFormattedItems);\n\n          if (selectedMachine && selectedMachine.id) {\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n            const machineDoc = await machineRef.get();\n\n            if (machineDoc.exists) {\n              await machineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n            }\n          }\n\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\n            const currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n            const currentMachineDoc = await currentMachineRef.get();\n\n            if (currentMachineDoc.exists) {\n              await currentMachineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n            }\n          }\n        }\n      } else {\n        // For a new item, if localSN is provided, use it; otherwise, generate a custom ID.\n        docId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : generateCustomID();\n        await db.collection(\"Test\").doc(docId).set(formattedItems);\n\n        if (selectedMachine && selectedMachine.id) {\n          const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n          const machineDoc = await machineRef.get();\n\n          if (machineDoc.exists) {\n            await machineRef.update({\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n            });\n          }\n        }\n\n        if (selectedCurrentMachine && selectedCurrentMachine.id) {\n          const currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n          const currentMachineDoc = await currentMachineRef.get();\n\n          if (currentMachineDoc.exists) {\n            await currentMachineRef.update({\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n            });\n          }\n        }\n      } // Upload any new photos to Firebase Storage.\n\n\n      await uploadPhotos(docId);\n      console.log(\"Item saved and associatedParts updated!\"); // Redirect to the new URL using the new document id.\n\n      router.push(`/NewSearch/item/${docId}`); // Optionally, you can also show a save confirmation modal:\n\n      handleShowSaveModal();\n    } catch (error) {\n      console.error(\"Error saving data:\", error);\n    }\n  } // Additional state for local warehouse location inputs.\n\n\n  const {\n    0: showLocalLocFrom,\n    1: setShowLocalLocFrom\n  } = useState(false);\n  const {\n    0: showLocalLocCurrent,\n    1: setShowLocalLocCurrent\n  } = useState(false); // When a machine is selected from the modal.\n\n  const handleSetSelectedMachine = machine => {\n    var _machine$name;\n\n    // const condition = (name) => name && name.toLowerCase() === \"interior socal\";\n    const isSocalInterior = ((_machine$name = machine.name) === null || _machine$name === void 0 ? void 0 : _machine$name.toLowerCase()) === \"interior socal\";\n\n    if (machinePick) {\n      var _selectedClientFrom$n3;\n\n      setSelectedMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocFrom(isSocalInterior || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n3 = selectedClientFrom.name) === null || _selectedClientFrom$n3 === void 0 ? void 0 : _selectedClientFrom$n3.toLowerCase()) === \"socalwarehouse\");\n    } else {\n      var _selectedClientCurren3;\n\n      setSelectedCurrentMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocCurrent(isSocalInterior || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren3 = selectedClientCurrent.name) === null || _selectedClientCurren3 === void 0 ? void 0 : _selectedClientCurren3.toLowerCase()) === \"socalwarehouse\");\n    }\n\n    fetchMachine(machine.id); // Close the machine modal (assuming you're using showMachineModal to control it)\n\n    setShowMachineModal(false);\n  };\n\n  const uploadPhotos = async docID => {\n    const storageRef = firebase.storage().ref();\n\n    for (let i = 0; i < photos.length; i++) {\n      if (photos[i].file) {\n        const photoRef = storageRef.child(`Parts/${docID}/${docID}${i === 0 ? \".jpg\" : `.${i + 1}.jpg`}`);\n        const metadata = {\n          contentType: \"image/png\"\n        };\n        await photoRef.put(photos[i].file, metadata);\n        const url = await photoRef.getDownloadURL();\n        photos[i].url = url;\n      }\n    }\n  }; // Function to handle printing the label.\n\n\n  const handlePrint = async () => {\n    if (!items.name) {\n      alert(\"Missing name\");\n      return;\n    }\n\n    let clientName = \"\"; // Attempt to fetch client name from the Machine document reference.\n\n    if (items.Machine && typeof items.Machine.get === \"function\") {\n      try {\n        const machineDoc = await items.Machine.get();\n\n        if (machineDoc.exists) {\n          const machineData = machineDoc.data();\n\n          if (machineData.client && typeof machineData.client.get === \"function\") {\n            const clientDoc = await machineData.client.get();\n\n            if (clientDoc.exists) {\n              clientName = clientDoc.data().name || \"\";\n            }\n          }\n        }\n      } catch (error) {\n        console.error(\"Error fetching machine or client:\", error);\n      }\n    } else {\n      console.warn(\"No Machine reference available in the item\");\n    }\n\n    console.log(clientName, \":\", items.client); // Fallback: if no client name was found, check items.client.\n\n    if (!clientName && items.client) {\n      if (typeof items.client.get === \"function\") {\n        try {\n          const clientDoc = await items.client.get();\n\n          if (clientDoc.exists) {\n            clientName = clientDoc.data().name || \"\";\n          }\n        } catch (error) {\n          console.error(\"Error fetching client from items.client:\", error);\n        }\n      } else {\n        clientName = items.client;\n      }\n    }\n\n    console.log(\"descriptions:\", descriptions[selectedDesc]);\n    const payload = {\n      name: items.name,\n      pn: items.pn,\n      sn: items.sn,\n      wo: workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\",\n      client: clientName,\n      status: items.status,\n      local_sn: id,\n      descriptions: [descriptions[selectedDesc] || {\n        description: \"\",\n        date: \"\"\n      }],\n      date: items.dateCreated || \"\",\n      DOM: DOM,\n      oem: oem,\n      modality: modality,\n      model: model,\n      poNumber: items.poNumber,\n      arrival_date: items.arrival_date // NEW: Include arrival_date\n\n    };\n    console.log(\"Payload for printing:\", payload);\n\n    try {\n      const response = await fetch(\"https://9d70-174-76-22-138.ngrok-free.app/print-label\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      console.log(\"Print result:\", result.status);\n\n      if (result.status.includes(\"successfully.\")) {\n        handleShowPrintModal();\n      } else {\n        console.error(\"Error printing label:\", result.error);\n      }\n    } catch (error) {\n      console.error(\"Error printing label:\", error);\n    }\n  };\n\n  async function handleSubmit(event) {\n    event.preventDefault(); // Only check that the Name field is filled out.\n\n    if (!items.name) {\n      handleShow(); // This shows the \"missing field\" modal.\n    } else {\n      toSend();\n    }\n  } // Handlers for input changes.\n\n\n  const handleChange = field => event => {\n    const value = event.target ? event.target.value : event.value;\n    setItems(prevItems => _objectSpread(_objectSpread({}, prevItems), {}, {\n      [field]: value\n    }));\n  };\n\n  const addDescription = () => {\n    setDescriptions([...descriptions, {\n      description: \"\",\n      date: \"\"\n    }]);\n  };\n\n  const removeDescription = index => {\n    setDescriptions(descriptions.filter((_, i) => i !== index));\n  };\n\n  const handleDescriptionChange = (index, field, value) => {\n    const newDescriptions = descriptions.map((desc, i) => i === index ? _objectSpread(_objectSpread({}, desc), {}, {\n      [field]: value\n    }) : desc);\n    setDescriptions(newDescriptions);\n  };\n\n  const addWorkOrder = () => {\n    setWorkOrders([...workOrders, {\n      workOrder: \"\",\n      date: \"\"\n    }]);\n  };\n\n  const removeWorkOrder = index => {\n    setWorkOrders(workOrders.filter((_, i) => i !== index));\n  };\n\n  const handleWorkOrderChange = (index, field, value) => {\n    const newWorkOrders = workOrders.map((wo, i) => i === index ? _objectSpread(_objectSpread({}, wo), {}, {\n      [field]: value\n    }) : wo);\n    setWorkOrders(newWorkOrders);\n  };\n\n  const listDescriptions = () => {\n    setShowDescModal(true);\n  };\n\n  const selectDescription = index => {\n    setSelectedDesc(index);\n    setShowDescModal(false);\n  };\n\n  const handleShowCameraModal = () => {\n    setShowCameraModal(true);\n  };\n\n  const handleCloseCameraModal = () => {\n    setShowCameraModal(false);\n    setCapturedPhoto(null);\n  };\n\n  const handleCapture = (err, result) => {\n    if (result) {\n      setCapturedPhoto(result);\n    }\n  };\n\n  const savePhoto = () => {\n    setPhotos(prevPhotos => [...prevPhotos, {\n      file: capturedPhoto,\n      url: URL.createObjectURL(capturedPhoto)\n    }]);\n    setCapturedPhoto(null);\n    handleCloseCameraModal();\n  };\n\n  const removePhoto = index => {\n    setPhotos(photos.filter((_, i) => i !== index));\n  };\n\n  const mostRecentWorkOrder = workOrders && workOrders.length > 0 ? workOrders.reduce((latest, current) => {\n    const latestDate = new Date(latest.date);\n    const currentDate = new Date(current.date);\n    return currentDate > latestDate ? current : latest;\n  }, workOrders[0]) : {};\n\n  const capturePhoto = () => {\n    const video = document.querySelector(\"video\");\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    const context = canvas.getContext(\"2d\");\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob(blob => {\n      setCapturedPhoto(blob);\n    }, \"image/png\");\n  };\n\n  const handleShowInfoModal = async () => {\n    const db = firebase.firestore();\n\n    try {\n      const doc = await db.collection(\"Test\").doc(id).get();\n\n      if (doc.exists) {\n        const data = doc.data();\n        setItemName(data.name || \"N/A\");\n        setShowInfoModal(true);\n      } else {\n        console.error(\"Item not found\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching item info:\", error);\n    }\n  };\n\n  const handleCloseInfoModal = () => setShowInfoModal(false);\n\n  const handleCloneToNewItem = () => {\n    if (!id) {\n      setErr(\"Item ID not ready yet.\");\n      setShowErr(true);\n      return;\n    }\n\n    router.push(`/NewSearch/AddItem/NewItem?cloneFrom=${encodeURIComponent(id)}`);\n  };\n\n  const handlePnChange = (index, value) => {\n    setItems(prev => {\n      const newPn = [...prev.pn];\n      newPn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: newPn\n      });\n    });\n  };\n\n  const addPn = () => {\n    setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n      pn: [...prev.pn, \"\"]\n    }));\n  };\n\n  const handleSnChange = (index, value) => {\n    setItems(prev => {\n      const newSn = [...prev.sn];\n      newSn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: newSn\n      });\n    });\n  };\n\n  const addSn = () => {\n    setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n      sn: [...prev.sn, \"\"]\n    }));\n  };\n\n  const browseInputRef = useRef(null);\n\n  const handleBrowsePhotos = () => {\n    if (browseInputRef.current) {\n      browseInputRef.current.click();\n    }\n  };\n\n  const handleFilesSelected = e => {\n    const files = e.target.files;\n\n    if (files.length) {\n      const newPhotos = [];\n\n      for (let i = 0; i < files.length; i++) {\n        newPhotos.push({\n          file: files[i],\n          url: URL.createObjectURL(files[i])\n        });\n      }\n\n      setPhotos(prevPhotos => [...prevPhotos, ...newPhotos]);\n    }\n\n    e.target.value = \"\";\n  };\n\n  const {\n    0: currentPnIndex,\n    1: setCurrentPnIndex\n  } = useState(0);\n  const {\n    0: showDropdown,\n    1: setShowDropdown\n  } = useState(false);\n  const {\n    0: currentSnIndex,\n    1: setCurrentSnIndex\n  } = useState(0);\n  const {\n    0: showSnDropdown,\n    1: setShowSnDropdown\n  } = useState(false);\n  useEffect(() => {\n    if (showDropdown || showSnDropdown) {\n      loadPnSnOptions();\n    }\n  }, [showDropdown, showSnDropdown]);\n\n  const handleAddNewClient = () => {\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\n    router.push(`../client/AIS${randomNum}/addClient?from=item&itemId=${id || \"\"}`);\n  };\n\n  const handleBluefolderButton = async () => {\n    var _descriptions$selecte2;\n\n    // Check that the work order field is filled out (using workOrders[0].workOrder as current)\n    const currentWorkOrder = workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\";\n\n    if (!currentWorkOrder) {\n      alert(\"Please fill out the work order field before adding to BlueFolder.\");\n      return;\n    } // Build the payload to send to your proxy endpoint.\n\n\n    const payload = {\n      name: items.name,\n      pn: items.pn[0] || \"\",\n      sn: items.sn[0] || \"\",\n      status: items.status,\n      description: ((_descriptions$selecte2 = descriptions[selectedDesc]) === null || _descriptions$selecte2 === void 0 ? void 0 : _descriptions$selecte2.description) || \"\",\n      workOrder: currentWorkOrder,\n      localsn: items.localSN || \"\"\n    };\n\n    try {\n      // Replace with your ngrok URL and appropriate endpoint path (e.g., /api/bluefolder)\n      const response = await fetch(\"https://9d70-174-76-22-138.ngrok-free.app/bluefolder\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      alert(\"BlueFolder service item added successfully!\");\n      console.log(\"BlueFolder result:\", result);\n    } catch (error) {\n      console.error(\"BlueFolder error:\", error);\n      alert(\"Error adding data to BlueFolder.\");\n    }\n  }; // // Slack integration handler.\n  // const handleAddToSlack = async (which) => {\n  //   try {\n  //     const pn0 = Array.isArray(items.pn) ? items.pn[0] : items.pn;\n  //     const sn0 = Array.isArray(items.sn) ? items.sn[0] : items.sn;\n  //     const linkUrl = typeof window !== \"undefined\" ? window.location.href : \"\";\n  //     const safeName = (items?.name || id || \"Untitled\").trim();\n  //     const title = `${safeName}${id ? ` (${id})` : \"\"}`;\n  //     console.log(\"[SLACK][handleAddToSlack] which:\", which);\n  //     console.log(\"[SLACK] title:\", title);\n  //     console.log(\"[SLACK] PN:\", items.pn, \"SN:\", items.sn);\n  //     const resp = await fetch(\"/api/slack/add-to-list\", {\n  //       method: \"POST\",\n  //       headers: { \"Content-Type\": \"application/json\" },\n  //       body: JSON.stringify({\n  //         listKey: which,      // \"shipping\" | \"receiving\" | \"tasks\"\n  //         title,\n  //         pn: items.pn,\n  //         sn: items.sn,\n  //         // keeping it minimal by design while we stabilize PN/SN\n  //         linkUrl,\n  //       }),\n  //     });\n  // Slack integration handler (drop-in replacement)\n  // Slack integration handler (drop-in replacement)\n  // Slack integration handler (client) — replace your existing handleAddToSlack with this\n\n\n  const handleAddToSlack = async (which = \"shipping\") => {\n    try {\n      var _sort$, _ref8, _items$trackingNumber, _json$debug, _json$debug2;\n\n      const safeName = ((items === null || items === void 0 ? void 0 : items.name) || id || \"Untitled\").trim();\n      const title = `${safeName}${id ? ` (${id})` : \"\"}`;\n      const pn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.pn) ? items.pn[0] : items === null || items === void 0 ? void 0 : items.pn;\n      const sn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.sn) ? items.sn[0] : items === null || items === void 0 ? void 0 : items.sn;\n      const pn_sn = [pn0 && `PN: ${pn0}`, sn0 && `SN: ${sn0}`].filter(Boolean).join(\"  \");\n      const mostRecentWO = workOrders && workOrders.length ? (_sort$ = [...workOrders].sort((a, b) => new Date((b === null || b === void 0 ? void 0 : b.date) || 0) - new Date((a === null || a === void 0 ? void 0 : a.date) || 0))[0]) === null || _sort$ === void 0 ? void 0 : _sort$.workOrder : \"\";\n      const description = selectedDesc != null && descriptions !== null && descriptions !== void 0 && descriptions[selectedDesc] ? descriptions[selectedDesc].description || \"\" : (items === null || items === void 0 ? void 0 : items.description) || \"\";\n      const tracking = (_ref8 = (_items$trackingNumber = items === null || items === void 0 ? void 0 : items.trackingNumber) !== null && _items$trackingNumber !== void 0 ? _items$trackingNumber : items === null || items === void 0 ? void 0 : items.tracking) !== null && _ref8 !== void 0 ? _ref8 : \"\";\n      const local_sn = id || (items === null || items === void 0 ? void 0 : items.localSN) || \"\";\n      const photoUrls = Array.isArray(photos) ? photos.map(p => p === null || p === void 0 ? void 0 : p.url).filter(Boolean) : [];\n      const resp = await fetch(\"/api/slack/add-to-list\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          listKey: which,\n          title,\n          pn_sn,\n          // <— server expects this\n          work_order: mostRecentWO || \"\",\n          local_sn,\n          tracking,\n          description: (description || \"\").trim(),\n          photoUrls // array of https URLs\n\n        })\n      });\n      const json = await resp.json();\n      console.log(\"[SLACK][handleAddToSlack] response:\", json);\n      if (json !== null && json !== void 0 && (_json$debug = json.debug) !== null && _json$debug !== void 0 && _json$debug.steps) console.table(json.debug.steps);\n      if (json !== null && json !== void 0 && (_json$debug2 = json.debug) !== null && _json$debug2 !== void 0 && _json$debug2.photos) console.table(json.debug.photos);\n\n      if (!resp.ok || !(json !== null && json !== void 0 && json.ok)) {\n        setErr(`Slack add failed: ${(json === null || json === void 0 ? void 0 : json.error) || \"unknown error\"}`);\n        setShowErr(true);\n        return;\n      }\n\n      alert(`Added to Slack ${which === \"shipping\" ? \"Shipping\" : which === \"receiving\" ? \"Receiving\" : \"Tasks\"} list.`);\n    } catch (e) {\n      console.error(e);\n      setErr(\"Error adding to Slack\");\n      setShowErr(true);\n    }\n  };\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1644,\n      columnNumber: 5\n    }\n  }, isLoading && __jsx(\"div\", {\n    className: styles.loadingOverlay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1646,\n      columnNumber: 9\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading Magmo\",\n    className: styles.loadingLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1647,\n      columnNumber: 11\n    }\n  })), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1654,\n      columnNumber: 7\n    }\n  }, __jsx(Modal, {\n    show: show,\n    onHide: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1655,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1656,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1657,\n      columnNumber: 13\n    }\n  }, \"Error\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1659,\n      columnNumber: 11\n    }\n  }, \"Missing field\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1660,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1661,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showErr,\n    onHide: handleCloseErr,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1666,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1667,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1668,\n      columnNumber: 13\n    }\n  }, \"Error\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1670,\n      columnNumber: 11\n    }\n  }, Err), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1671,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseErr,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1672,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showSaveModal,\n    onHide: handleCloseSaveModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1677,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1678,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1679,\n      columnNumber: 13\n    }\n  }, \"Save Confirmation\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1681,\n      columnNumber: 11\n    }\n  }, \"Data has been saved successfully.\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1682,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseSaveModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1683,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showPrintModal,\n    onHide: handleClosePrintModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1688,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1689,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1690,\n      columnNumber: 13\n    }\n  }, \"Print Confirmation\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1692,\n      columnNumber: 11\n    }\n  }, \"Info has been sent to print.\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1693,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClosePrintModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1694,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showDescModal,\n    onHide: handleCloseDescModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1700,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1701,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1702,\n      columnNumber: 13\n    }\n  }, \"Descriptions\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1704,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addDescription,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1705,\n      columnNumber: 13\n    }\n  }, \"Add Description\"), descriptions.map((desc, index) => __jsx(Row, {\n    key: index,\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1709,\n      columnNumber: 15\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: () => selectDescription(index),\n    style: {\n      cursor: \"pointer\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1710,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1716,\n      columnNumber: 19\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1717,\n      columnNumber: 21\n    }\n  }, desc.description || \"Description\"), __jsx(\"span\", {\n    style: {\n      borderLeft: \"1px solid #ccc\",\n      paddingLeft: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1718,\n      columnNumber: 21\n    }\n  }, desc.date || \"Date\"))))), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseDescModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1730,\n      columnNumber: 13\n    }\n  }, \"OK\"))), __jsx(Modal, {\n    show: showWoModal,\n    onHide: handleCloseWoModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1736,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1737,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1738,\n      columnNumber: 13\n    }\n  }, \"Work Orders\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1740,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addWorkOrder,\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1741,\n      columnNumber: 13\n    }\n  }, \"Add Work Order\"), workOrders.map((wo, index) => __jsx(Row, {\n    key: index,\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1750,\n      columnNumber: 15\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1751,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Work Order\",\n    value: wo.workOrder,\n    onChange: e => handleWorkOrderChange(index, \"workOrder\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1752,\n      columnNumber: 19\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1762,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Control, {\n    type: \"date\",\n    placeholder: \"Date\",\n    value: wo.date,\n    onChange: e => handleWorkOrderChange(index, \"date\", e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1763,\n      columnNumber: 19\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1772,\n      columnNumber: 17\n    }\n  }, __jsx(Button, {\n    variant: \"danger\",\n    onClick: () => removeWorkOrder(index),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1773,\n      columnNumber: 19\n    }\n  }, \"Remove\")))), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseWoModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1782,\n      columnNumber: 13\n    }\n  }, \"OK\"))), __jsx(ClientInfoModal, {\n    show: showMachineModal,\n    handleClose: handleCloseMachineModal,\n    selectedClient: selectedClient,\n    machineOptions: machineOptions,\n    setSelectedMachine: handleSetSelectedMachine,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1788,\n      columnNumber: 9\n    }\n  }), __jsx(Modal, {\n    show: showClientModal,\n    onHide: handleCloseClientModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1796,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1797,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1798,\n      columnNumber: 13\n    }\n  }, \"Select Client\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1800,\n      columnNumber: 11\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: search,\n    onChange: e => setSearch(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1801,\n      columnNumber: 13\n    }\n  }), __jsx(ClientTable, {\n    clients: clients.filter(client => (client.name || \"\").toLowerCase().includes(search.toLowerCase())),\n    onSelectClient: handleClientInfo,\n    onInfoClick: handleClientInfo,\n    clearSelection: () => handleClientInfo(null),\n    onAddClient: handleAddNewClient,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1808,\n      columnNumber: 13\n    }\n  }))), __jsx(ParentModal, {\n    show: showParentModal,\n    handleClose: handleCloseParentModal,\n    setSelectedParent: setSelectedParent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1820,\n      columnNumber: 9\n    }\n  }), __jsx(MachineSelectionModal, {\n    show: machineSelectionModal,\n    handleClose: () => setMachineSelectionModal(false),\n    setMachine: setTheMachine,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1826,\n      columnNumber: 9\n    }\n  }), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1832,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1833,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1834,\n      columnNumber: 13\n    }\n  }, \"Take a Photo\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1836,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"camera\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1837,\n      columnNumber: 13\n    }\n  }, !capturedPhoto && __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1839,\n      columnNumber: 17\n    }\n  }), capturedPhoto && __jsx(\"div\", {\n    className: \"photo-preview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1847,\n      columnNumber: 17\n    }\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1848,\n      columnNumber: 19\n    }\n  })))), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1857,\n      columnNumber: 11\n    }\n  }, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1860,\n      columnNumber: 17\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: () => setCameraFacing(prev => prev === \"environment\" ? \"user\" : \"environment\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1874,\n      columnNumber: 17\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1883,\n      columnNumber: 17\n    }\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: () => setCapturedPhoto(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1889,\n      columnNumber: 17\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1895,\n      columnNumber: 17\n    }\n  }, \"OK\")))), __jsx(InfoModal, {\n    show: showInfoModal,\n    handleClose: handleCloseInfoModal,\n    itemName: items.name,\n    dimensions: items.length + \",\" + items.width + \",\" + items.height,\n    price: items.price,\n    freqI: freqItem,\n    freqM: machineFrequency,\n    usage: usagePastYear,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1903,\n      columnNumber: 9\n    }\n  }), __jsx(Container, {\n    fluid: true,\n    className: styles.page,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1914,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.shell,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1915,\n      columnNumber: 11\n    }\n  }, __jsx(Card, {\n    className: styles.card,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1916,\n      columnNumber: 13\n    }\n  }, __jsx(Card.Body, {\n    className: styles.cardBody,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1917,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: styles.header,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1918,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.kicker,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1919,\n      columnNumber: 19\n    }\n  }, \"Item\"), __jsx(\"h2\", {\n    className: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1920,\n      columnNumber: 19\n    }\n  }, \"Item Details\"), __jsx(\"div\", {\n    className: styles.subtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1921,\n      columnNumber: 19\n    }\n  }, \"Review and update fields, photos, and routing information.\")), __jsx(Form, {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1925,\n      columnNumber: 17\n    }\n  }, __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1927,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1928,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1929,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1930,\n      columnNumber: 25\n    }\n  }, \"Name\"), __jsx(Form.Control, {\n    type: \"text\",\n    value: items.name,\n    onChange: handleChange(\"name\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1931,\n      columnNumber: 25\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1938,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"pn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1939,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1940,\n      columnNumber: 25\n    }\n  }, \"Product Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1941,\n      columnNumber: 25\n    }\n  }, __jsx(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1942,\n      columnNumber: 27\n    }\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.pn[currentPnIndex] || \"\",\n    onChange: e => handlePnChange(currentPnIndex, e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1943,\n      columnNumber: 29\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowDropdown(!showDropdown),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1950,\n      columnNumber: 29\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1956,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setAddingNewPn(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1957,\n      columnNumber: 31\n    }\n  }, \"+\"))), showDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1966,\n      columnNumber: 29\n    }\n  }, pnOptions.map((pnOption, idx) => __jsx(\"div\", {\n    key: idx,\n    style: {\n      padding: \"8px\",\n      cursor: \"pointer\"\n    },\n    onClick: () => {\n      setCurrentPnIndex(idx);\n      setShowDropdown(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1980,\n      columnNumber: 33\n    }\n  }, pnOption)))), addingNewPn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new PN\",\n    value: newPn,\n    onChange: e => setNewPn(e.target.value),\n    onBlur: handleAddNewPn,\n    onKeyDown: e => e.key === \"Enter\" && handleAddNewPn(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1995,\n      columnNumber: 27\n    }\n  })))), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2010,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2011,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"sn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2012,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2013,\n      columnNumber: 25\n    }\n  }, \"Serial Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2014,\n      columnNumber: 25\n    }\n  }, __jsx(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2015,\n      columnNumber: 27\n    }\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.sn[currentSnIndex] || \"\",\n    onChange: e => handleSnChange(currentSnIndex, e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2016,\n      columnNumber: 29\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowSnDropdown(!showSnDropdown),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2023,\n      columnNumber: 29\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2029,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setAddingNewSn(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2030,\n      columnNumber: 31\n    }\n  }, \"+\"))), showSnDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2039,\n      columnNumber: 29\n    }\n  }, snOptions.map((snOption, idx) => __jsx(\"div\", {\n    key: idx,\n    style: {\n      padding: \"8px\",\n      cursor: \"pointer\"\n    },\n    onClick: () => {\n      setCurrentSnIndex(idx);\n      setShowSnDropdown(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2053,\n      columnNumber: 33\n    }\n  }, snOption)))), addingNewSn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new SN\",\n    value: newSn,\n    onChange: e => setNewSn(e.target.value),\n    onBlur: handleAddNewSn,\n    onKeyDown: e => e.key === \"Enter\" && handleAddNewSn(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2068,\n      columnNumber: 27\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2081,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2082,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2083,\n      columnNumber: 25\n    }\n  }, \"Status\"), __jsx(Form.Select, {\n    value: items.status || \"\",\n    onChange: handleChange(\"status\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2084,\n      columnNumber: 25\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2088,\n      columnNumber: 27\n    }\n  }, \"Select status\"), __jsx(\"option\", {\n    value: \"Good\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2089,\n      columnNumber: 27\n    }\n  }, \"Good\"), __jsx(\"option\", {\n    value: \"Bad\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2090,\n      columnNumber: 27\n    }\n  }, \"Bad\"), __jsx(\"option\", {\n    value: \"Unknown\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2091,\n      columnNumber: 27\n    }\n  }, \"Unknown\"))))), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2097,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2098,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"localSN\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2099,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2100,\n      columnNumber: 25\n    }\n  }, \"Local SN\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter Local SN\",\n    value: items.localSN || \"\",\n    onChange: handleChange(\"localSN\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2101,\n      columnNumber: 25\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2109,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"arrivalDate\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2110,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2111,\n      columnNumber: 25\n    }\n  }, \"Arrival Date\"), __jsx(Form.Control, {\n    placeholder: \"Enter Arrival Date\",\n    type: \"date\",\n    value: items.arrival_date,\n    onChange: e => {\n      const value = e.target.value;\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        arrival_date: value\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2112,\n      columnNumber: 25\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2126,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"trackingNumber\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2127,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2128,\n      columnNumber: 25\n    }\n  }, \"Tracking Number\"), __jsx(Form.Control, {\n    placeholder: \"Tracking Number\",\n    type: \"text\",\n    value: items.trackingNumber,\n    onChange: handleChange(\"trackingNumber\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2129,\n      columnNumber: 25\n    }\n  })))), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2139,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2140,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2141,\n      columnNumber: 23\n    }\n  }, \"OEM\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"OEM\",\n    value: oem,\n    onChange: e => setOem(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2142,\n      columnNumber: 23\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2149,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2150,\n      columnNumber: 23\n    }\n  }, \"Modality\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Modality\",\n    value: modality,\n    onChange: e => setModality(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2151,\n      columnNumber: 23\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2158,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2159,\n      columnNumber: 23\n    }\n  }, \"Model\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Model\",\n    value: model,\n    onChange: e => setModel(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2160,\n      columnNumber: 23\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\",\n      marginTop: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2169,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex align-items-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2170,\n      columnNumber: 21\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowWoModal,\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2171,\n      columnNumber: 23\n    }\n  }, \"Manage Work Orders\"), workOrders.length > 0 && __jsx(\"div\", {\n    className: \"d-flex flex-column align-items-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2179,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2180,\n      columnNumber: 27\n    }\n  }, \"Work Order\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Most Recent Work Order\",\n    value: mostRecentWorkOrder.workOrder,\n    onChange: e => handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"workOrder\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2181,\n      columnNumber: 27\n    }\n  }), __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2194,\n      columnNumber: 27\n    }\n  }, \"Date\"), __jsx(Form.Control, {\n    type: \"date\",\n    placeholder: \"Work Order Date\",\n    value: mostRecentWorkOrder.date,\n    onChange: e => handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"date\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2195,\n      columnNumber: 27\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2211,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"desc\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2212,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: listDescriptions,\n    className: \"mb-2 me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2213,\n      columnNumber: 25\n    }\n  }, \"List Descriptions\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 3,\n    placeholder: \"Enter description\",\n    value: ((_descriptions$selecte3 = descriptions[selectedDesc]) === null || _descriptions$selecte3 === void 0 ? void 0 : _descriptions$selecte3.description) || \"\",\n    onChange: e => handleDescriptionChange(selectedDesc, \"description\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2220,\n      columnNumber: 25\n    }\n  }), __jsx(Form.Control, {\n    type: \"date\",\n    value: ((_descriptions$selecte4 = descriptions[selectedDesc]) === null || _descriptions$selecte4 === void 0 ? void 0 : _descriptions$selecte4.date) || \"\",\n    onChange: e => handleDescriptionChange(selectedDesc, \"date\", e.target.value),\n    style: {\n      marginTop: \"0.5rem\",\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2234,\n      columnNumber: 25\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2253,\n      columnNumber: 19\n    }\n  }, __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2254,\n      columnNumber: 21\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2255,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => {\n      setMachinePick(true);\n      handleShowClientModal();\n    },\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2256,\n      columnNumber: 25\n    }\n  }, \"Select From\"), selectedClientFrom && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2267,\n      columnNumber: 27\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2275,\n      columnNumber: 29\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2276,\n      columnNumber: 31\n    }\n  }, \"Selected Client (From):\"), \" \", selectedClientFrom.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2279,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowMachineModal(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2280,\n      columnNumber: 31\n    }\n  }, \"Select Machine for \", selectedClientFrom.name), selectedMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2288,\n      columnNumber: 35\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2289,\n      columnNumber: 37\n    }\n  }, \"Selected Machine (From):\"), \" \", selectedMachine.name), showLocalLocFrom && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowNewLocalModalFrom(true),\n    className: \"w-100 mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2294,\n      columnNumber: 39\n    }\n  }, [newLocalFrom.region, ((_newLocalFrom$section = newLocalFrom.section) === null || _newLocalFrom$section === void 0 ? void 0 : _newLocalFrom$section.letter) + ((_newLocalFrom$section2 = newLocalFrom.section) === null || _newLocalFrom$section2 === void 0 ? void 0 : _newLocalFrom$section2.number), newLocalFrom.bin && `B${newLocalFrom.bin}`, newLocalFrom.pallet && `P${newLocalFrom.pallet}`].filter(Boolean).join(\"-\")), __jsx(Modal, {\n    show: showNewLocalModalFrom,\n    onHide: () => setShowNewLocalModalFrom(false),\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2316,\n      columnNumber: 39\n    }\n  }, __jsx(Modal.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2323,\n      columnNumber: 41\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2324,\n      columnNumber: 43\n    }\n  }, \"Edit Local Loc (From)\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2328,\n      columnNumber: 41\n    }\n  }, __jsx(NewLocal, {\n    selectedClient: selectedClientFrom,\n    showLocalLoc: showNewLocalModalFrom,\n    value: newLocalFrom,\n    onChange: setNewLocalFrom,\n    onSave: p => {\n      setNewLocalFrom(p);\n      setShowNewLocalModalFrom(false);\n    },\n    onCancel: () => setShowNewLocalModalFrom(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2329,\n      columnNumber: 43\n    }\n  })))))))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2360,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => {\n      setMachinePick(false);\n      handleShowClientModal();\n    },\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2361,\n      columnNumber: 25\n    }\n  }, \"Select Current\"), selectedClientCurrent && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2372,\n      columnNumber: 27\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2380,\n      columnNumber: 29\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2381,\n      columnNumber: 31\n    }\n  }, \"Selected Client (Current):\"), \" \", selectedClientCurrent.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2384,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowMachineModal(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2385,\n      columnNumber: 31\n    }\n  }, \"Select Machine for \", selectedClientCurrent.name), selectedCurrentMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2393,\n      columnNumber: 35\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2394,\n      columnNumber: 37\n    }\n  }, \"Selected Machine (Current):\"), \" \", selectedCurrentMachine.name), showLocalLocCurrent && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowNewLocalModalCurrent(true),\n    className: \"w-100 mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2399,\n      columnNumber: 39\n    }\n  }, [newLocalCurrent.region, ((_newLocalCurrent$sect = newLocalCurrent.section) === null || _newLocalCurrent$sect === void 0 ? void 0 : _newLocalCurrent$sect.letter) + ((_newLocalCurrent$sect2 = newLocalCurrent.section) === null || _newLocalCurrent$sect2 === void 0 ? void 0 : _newLocalCurrent$sect2.number), newLocalCurrent.bin && `B${newLocalCurrent.bin}`, newLocalCurrent.pallet && `P${newLocalCurrent.pallet}`].filter(Boolean).join(\"-\")), __jsx(Modal, {\n    show: showNewLocalModalCurrent,\n    onHide: () => setShowNewLocalModalCurrent(false),\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2418,\n      columnNumber: 39\n    }\n  }, __jsx(Modal.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2425,\n      columnNumber: 41\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2426,\n      columnNumber: 43\n    }\n  }, \"Edit Local Loc (Current)\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2430,\n      columnNumber: 41\n    }\n  }, __jsx(NewLocal, {\n    selectedClient: selectedClientCurrent,\n    showLocalLoc: showNewLocalModalCurrent,\n    value: newLocalCurrent,\n    onChange: setNewLocalCurrent,\n    onSave: p => {\n      setNewLocalCurrent(p);\n      setShowNewLocalModalCurrent(false);\n    },\n    onCancel: () => setShowNewLocalModalCurrent(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2431,\n      columnNumber: 43\n    }\n  })))))))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2468,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowParentModal,\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2469,\n      columnNumber: 25\n    }\n  }, \"Select Parent\"), selectedParent && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Selected Parent\",\n    value: selectedParent.name,\n    readOnly: true,\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2477,\n      columnNumber: 27\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2489,\n      columnNumber: 19\n    }\n  }, __jsx(Row, {\n    className: `mb-3 ${styles.photoActionsRow}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2490,\n      columnNumber: 21\n    }\n  }, __jsx(Col, {\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2491,\n      columnNumber: 23\n    }\n  }, __jsx(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2492,\n      columnNumber: 25\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2493,\n      columnNumber: 27\n    }\n  }, \"Take Photo\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBrowsePhotos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2499,\n      columnNumber: 27\n    }\n  }, \"Browse\"))), __jsx(Col, {\n    xs: 12,\n    md: 6,\n    className: styles.photoActionsRight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2507,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"success\",\n    onClick: handleSendToInflow,\n    style: {\n      marginLeft: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2508,\n      columnNumber: 25\n    }\n  }, \"Send to inFlow\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleBluefolderButton,\n    style: {\n      marginLeft: \"0.5rem\",\n      marginRight: \".5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2515,\n      columnNumber: 25\n    }\n  }, \"BlueFolder\"), __jsx(Button, {\n    variant: addToWebsite ? \"primary\" : \"outline-primary\",\n    onClick: () => setAddToWebsite(prev => !prev),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2524,\n      columnNumber: 25\n    }\n  }, addToWebsite ? \"✓ Add to Website\" : \"Add to Website\"), __jsx(Form.Check, {\n    type: \"checkbox\",\n    id: \"hide-checkbox\",\n    label: \"Hide\" // box is checked when we want visible = false\n    ,\n    checked: !items.visible,\n    onChange: e => {\n      // grab checked immediately\n      const isHidden = e.currentTarget.checked;\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        visible: !isHidden\n      }));\n    },\n    className: \"ms-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2531,\n      columnNumber: 25\n    }\n  }))), __jsx(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    multiple: true,\n    ref: browseInputRef,\n    style: {\n      display: \"none\"\n    },\n    onChange: handleFilesSelected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2549,\n      columnNumber: 21\n    }\n  })), photos && photos.length > 0 && __jsx(\"div\", {\n    className: \"photo-gallery\",\n    style: {\n      display: \"flex\",\n      flexWrap: \"wrap\",\n      gap: \"10px\",\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2560,\n      columnNumber: 21\n    }\n  }, photos.map((photo, index) => __jsx(\"div\", {\n    key: index,\n    style: {\n      position: \"relative\",\n      width: \"100px\",\n      height: \"100px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2570,\n      columnNumber: 25\n    }\n  }, __jsx(\"img\", {\n    src: photo.url,\n    alt: `Photo ${index + 1}`,\n    style: {\n      width: \"100%\",\n      height: \"100%\",\n      objectFit: \"cover\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2578,\n      columnNumber: 27\n    }\n  }), photo.file && __jsx(Button, {\n    variant: \"danger\",\n    size: \"sm\",\n    style: {\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n      padding: \"0 5px\"\n    },\n    onClick: () => removePhoto(index),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2588,\n      columnNumber: 29\n    }\n  }, \"x\")))), __jsx(\"div\", {\n    className: `mt-3 d-flex flex-wrap align-items-center ${styles.actionRow}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2607,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    type: \"submit\",\n    style: {\n      marginRight: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2608,\n      columnNumber: 21\n    }\n  }, \"Save\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloneToNewItem,\n    style: {\n      marginRight: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2615,\n      columnNumber: 21\n    }\n  }, \"Clone\"), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"NewSearch/mainSearch\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2622,\n      columnNumber: 21\n    }\n  }), SHOW_SLACK_BUTTONS && __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      marginLeft: \".5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2628,\n      columnNumber: 23\n    }\n  }, __jsx(\"span\", {\n    style: {\n      fontSize: 12,\n      lineHeight: \"12px\",\n      textAlign: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2629,\n      columnNumber: 25\n    }\n  }, \"Slack\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      border: \"1px solid #ced4da\",\n      borderRadius: 6,\n      overflow: \"hidden\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2630,\n      columnNumber: 25\n    }\n  }, __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: () => handleAddToSlack(\"receiving\"),\n    style: {\n      border: \"none\",\n      borderRight: \"1px solid #ced4da\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2631,\n      columnNumber: 27\n    }\n  }, \"Receiving\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: () => handleAddToSlack(\"shipping\"),\n    style: {\n      border: \"none\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2638,\n      columnNumber: 27\n    }\n  }, \"Shipping\"))), __jsx(Button, {\n    variant: \"info\",\n    onClick: handlePrint,\n    style: {\n      marginLeft: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2654,\n      columnNumber: 21\n    }\n  }, \"Print Label\")), __jsx(\"div\", {\n    style: {\n      textAlign: \"center\",\n      margin: \"1rem 0\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2662,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"link\",\n    style: {\n      textDecoration: \"none\",\n      color: \"black\",\n      fontSize: \"24px\"\n    },\n    onClick: () => setShowExtra(!showExtra),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2663,\n      columnNumber: 21\n    }\n  }, \"\\u25BC\")), __jsx(Collapse, {\n    in: showExtra,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2675,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    id: \"extra-collapse\",\n    className: \"mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2676,\n      columnNumber: 21\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex justify-content-end mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2677,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleShowInfoModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2678,\n      columnNumber: 25\n    }\n  }, \"More Info\")), __jsx(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2682,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"dimensions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2683,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2684,\n      columnNumber: 27\n    }\n  }, \"Dimensions\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2685,\n      columnNumber: 27\n    }\n  }, __jsx(Form.Control, {\n    placeholder: \"Length\",\n    type: \"text\",\n    value: items.length,\n    onChange: handleChange(\"length\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2688,\n      columnNumber: 29\n    }\n  }), __jsx(\"span\", {\n    style: {\n      padding: \"0 5px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2694,\n      columnNumber: 29\n    }\n  }, \"x\"), __jsx(Form.Control, {\n    placeholder: \"Width\",\n    type: \"text\",\n    value: items.width,\n    onChange: handleChange(\"width\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2695,\n      columnNumber: 29\n    }\n  }), __jsx(\"span\", {\n    style: {\n      padding: \"0 5px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2701,\n      columnNumber: 29\n    }\n  }, \"x\"), __jsx(Form.Control, {\n    placeholder: \"Height\",\n    type: \"text\",\n    value: items.height,\n    onChange: handleChange(\"height\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2702,\n      columnNumber: 29\n    }\n  })))), __jsx(Row, {\n    className: \"mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2712,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"Price\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2713,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2714,\n      columnNumber: 27\n    }\n  }, \"Price\"), __jsx(Form.Control, {\n    placeholder: \"Price\",\n    type: \"text\",\n    value: items.price,\n    onChange: handleChange(\"price\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2715,\n      columnNumber: 27\n    }\n  })), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"DOM\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2722,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2723,\n      columnNumber: 27\n    }\n  }, \"DOM\"), __jsx(Form.Control, {\n    placeholder: \"Date of Manufacture\",\n    type: \"date\",\n    value: DOM,\n    onChange: e => setDOM(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2724,\n      columnNumber: 27\n    }\n  })), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"poNumber\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2731,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2732,\n      columnNumber: 27\n    }\n  }, \"PO Number\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"PO Number\",\n    value: items.poNumber || \"\",\n    onChange: handleChange(\"poNumber\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2733,\n      columnNumber: 27\n    }\n  }))))))))))), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2749,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2750,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2751,\n      columnNumber: 11\n    }\n  }, \"Take a Photo\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2753,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"camera\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2754,\n      columnNumber: 11\n    }\n  }, !capturedPhoto ? __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2756,\n      columnNumber: 15\n    }\n  }) : __jsx(\"div\", {\n    className: \"photo-preview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2763,\n      columnNumber: 15\n    }\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2764,\n      columnNumber: 17\n    }\n  })))), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2773,\n      columnNumber: 9\n    }\n  }, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2776,\n      columnNumber: 15\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: () => setCameraFacing(prev => prev === \"environment\" ? \"user\" : \"environment\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2790,\n      columnNumber: 15\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2799,\n      columnNumber: 15\n    }\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: () => setCapturedPhoto(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2805,\n      columnNumber: 15\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2811,\n      columnNumber: 15\n    }\n  }, \"OK\")))));\n}\n\nexport default function DisplayItemPage(props) {\n  var _router$query, _props$initialItem;\n\n  const router = useRouter();\n  const idFromRouter = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id;\n  const key = (props === null || props === void 0 ? void 0 : (_props$initialItem = props.initialItem) === null || _props$initialItem === void 0 ? void 0 : _props$initialItem.id) || idFromRouter || \"new-item\";\n  return __jsx(DisplayItemInner, _extends({}, props, {\n    key: key,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2826,\n      columnNumber: 10\n    }\n  }));\n} // Server-side rendering function\n\nexport async function getServerSideProps(context) {\n  const {\n    id\n  } = context.params;\n\n  try {\n    const itemDoc = await adminDb.collection(\"Test\").doc(id).get();\n    if (!itemDoc.exists) return {\n      notFound: true\n    };\n    const itemData = itemDoc.data(); // normalize to arrays for consistent client-side handling\n\n    const pnArray = Array.isArray(itemData.pn) ? itemData.pn : itemData.pn ? [itemData.pn] : [];\n    const snArray = Array.isArray(itemData.sn) ? itemData.sn : itemData.sn ? [itemData.sn] : []; // fetch machineData (optional; you already had this)\n\n    let machineData = {};\n\n    if (itemData.Machine && itemData.Machine.path) {\n      try {\n        const machineDoc = await adminDb.doc(itemData.Machine.path).get();\n\n        if (machineDoc.exists) {\n          machineData = machineDoc.data();\n\n          if (machineData.client && machineData.client.path) {\n            const clientDoc = await adminDb.doc(machineData.client.path).get();\n            if (clientDoc.exists) machineData.Client = clientDoc.data().name;\n          }\n        }\n      } catch (e) {\n        console.error(\"Error fetching machine data:\", e);\n      }\n    }\n\n    const serializedItem = {\n      id,\n      name: itemData.name || \"\",\n      pn: pnArray,\n      sn: snArray,\n      price: itemData.price || \"\",\n      status: itemData.status || \"\",\n      length: itemData.length || \"\",\n      width: itemData.width || \"\",\n      height: itemData.height || \"\",\n      poNumber: itemData.poNumber || \"\",\n      trackingNumber: itemData.trackingNumber || \"\",\n      localSN: itemData.localSN || \"\",\n      arrival_date: itemData.arrival_date || \"\",\n      visible: itemData.visible !== undefined ? itemData.visible : true,\n      // add the pieces the UI reads directly\n      descriptions: itemData.descriptions || [],\n      workOrders: itemData.workOrders || [],\n      DOM: itemData.DOM || \"\"\n    };\n    return {\n      props: {\n        initialItem: serializedItem,\n        initialMachineData: machineData\n      }\n    };\n  } catch (error) {\n    console.error(\"Error in getServerSideProps:\", error);\n    return {\n      props: {\n        error: \"Failed to load item data\"\n      }\n    };\n  }\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/item/[id]/index.js"],"names":["React","useEffect","useState","useRef","Form","Button","Card","Container","Row","Col","Modal","FormControl","Collapse","InputGroup","ButtonGroup","Link","useAuth","firebase","LoggedIn","useRouter","fetchClients","ClientTable","ClientInfoModal","ParentModal","dynamic","InfoModal","MachineSelectionModal","addServiceItem","NewLocal","styles","InflowAPI","buildLocalLocObject","formatLoc","updateMachineFields","buildNameTokens","adminDb","BarcodeScannerComponent","ssr","simulateNetworkRequest","Promise","resolve","setTimeout","LoadingButton","type","name","route","isLoading","setLoading","cancelled","then","handleClick","isValidMachineValue","value","Boolean","trimmed","trim","toLowerCase","DisplayItemInner","initialItem","initialMachineData","error","SHOW_SLACK_BUTTONS","process","env","NEXT_PUBLIC_SHOW_SLACK_BUTTONS","router","signOut","id","idFromRouter","query","initialId","items","setItems","pn","Array","isArray","sn","price","status","length","width","height","poNumber","trackingNumber","localSN","arrival_date","visible","savedName","setSavedName","setDescriptions","descriptions","setWorkOrders","workOrders","setDOM","DOM","prev","newLocalFrom","setNewLocalFrom","region","section","letter","number","bin","pallet","newLocalCurrent","setNewLocalCurrent","selectedClientFrom","setSelectedClientFrom","selectedClientCurrent","setSelectedClientCurrent","selectedMachine","setSelectedMachine","selectedCurrentMachine","setSelectedCurrentMachine","pnOptions","setPnOptions","snOptions","setSnOptions","pnSnLoaded","setPnSnLoaded","pnSnLoading","setPnSnLoading","description","date","workOrder","clients","setClients","clientsLoaded","setClientsLoaded","clientsLoading","setClientsLoading","photos","setPhotos","show","setShow","showErr","setShowErr","Err","setErr","showDescModal","setShowDescModal","showWoModal","setShowWoModal","showClientModal","setShowClientModal","showMachineModal","setShowMachineModal","showParentModal","setShowParentModal","showCameraModal","setShowCameraModal","showSaveModal","setShowSaveModal","showPrintModal","setShowPrintModal","machineSelectionModal","setMachineSelectionModal","selectedDesc","setSelectedDesc","selectedClient","setSelectedClient","selectedParent","setSelectedParent","TheMachine","setTheMachine","machineOptions","setMachineOptions","search","setSearch","capturedPhoto","setCapturedPhoto","cameraFacing","setCameraFacing","addToWebsite","setAddToWebsite","machinePick","setMachinePick","freqItem","setFreqItem","usagePastYear","setUsagePastYear","machineFrequency","setMachineFrequency","showExtra","setShowExtra","localLocFrom","setLocalLocFrom","localLocCurrent","setLocalLocCurrent","oem","setOem","modality","setModality","model","setModel","applyMergedMachineFields","merged","showInfoModal","setShowInfoModal","itemName","setItemName","machineFieldsInitialized","setMachineFieldsInitialized","setIsLoading","showLocalModalFrom","setShowLocalModalFrom","showLocalModalCurrent","setShowLocalModalCurrent","openLocalModalFrom","closeLocalModalFrom","openLocalModalCurrent","closeLocalModalCurrent","showNewLocalModalFrom","setShowNewLocalModalFrom","showNewLocalModalCurrent","setShowNewLocalModalCurrent","handleSendToInflow","alert","imageUrls","map","p","url","filter","sku","toString","toCSV","arr","join","arrivalISO","Date","toISOString","slice","pnStr","snStr","mostRecentWO","reduce","latest","cur","customFields","custom1","custom2","custom3","custom4","custom5","custom6","custom7","custom8","custom9","custom10","console","log","created","upsertProduct","productId","err","message","setShowLocalLocFrom","setShowLocalLocCurrent","loadClients","clientsData","loadPnSnOptions","db","firestore","snapshot","collection","orderBy","FieldPath","documentId","limit","get","pnSet","Set","snSet","forEach","doc","data","add","fetchData","resolveClientFromMachine","machineRef","setClient","setMachine","isFrom","machineDoc","exists","machineData","clientDoc","client","clientName","isSocalInterior","shouldShow","normalizedPN","normalizedSN","ClientFrom","clientFromDoc","ClientCurrent","clientCurrentDoc","Machine","CurrentMachine","machineFromData","machineCurrentData","MachineFrom","MachineCurrent","nameFrom","nameCurrent","theMachineData","OEM","Modality","Model","Parent","parentDoc","all","fetchPhotos","checkIfAddedToWebsite","calculateItemFrequencyAndUsage","catch","push","pathname","signal","currentDate","oneYearAgo","setFullYear","getFullYear","undefined","itemsSnapshot","where","size","itemData","workOrderDate","fetchMachine","machineId","machinesSnapshot","docID","storageRef","storage","ref","listRef","child","res","listAll","urls","item","getDownloadURL","file","partsDoc","handleClose","handleShow","handleCloseErr","handleShowErr","handleCloseSaveModal","handleClosePrintModal","handleShowSaveModal","handleShowPrintModal","handleMachineSelectionModal","handleCloseDescModal","handleShowDescModal","handleCloseWoModal","handleShowWoModal","handleCloseClientModal","handleShowClientModal","handleCloseMachineModal","handleShowMachineModal","handleCloseParentModal","handleShowParentModal","handleClientInfo","clientId","clientData","machinePromises","machines","machineDocs","reorderArray","selectedValue","newArr","val","addingNewPn","setAddingNewPn","newPn","setNewPn","addingNewSn","setAddingNewSn","newSn","setNewSn","handlePnSelect","e","selected","target","updatedPn","handleSnSelect","updatedSn","handleAddNewPn","handleAddNewSn","generateCustomID","randomNum","Math","floor","random","shallowClean","obj","newObj","key","hasOwnProperty","toSend","currentUser","auth","userEmail","email","formattedItems","nameLower","nameTokens","addedToWebsite","lastEdited","fromDetails","currentDetails","Object","keys","docId","newDocId","set","update","associatedParts","FieldValue","arrayUnion","currentMachineRef","currentMachineDoc","delete","cleanFormattedItems","uploadPhotos","showLocalLocFrom","showLocalLocCurrent","handleSetSelectedMachine","machine","i","photoRef","metadata","contentType","put","handlePrint","warn","payload","wo","local_sn","dateCreated","response","fetch","method","headers","body","JSON","stringify","result","json","includes","handleSubmit","event","preventDefault","handleChange","field","prevItems","addDescription","removeDescription","index","_","handleDescriptionChange","newDescriptions","desc","addWorkOrder","removeWorkOrder","handleWorkOrderChange","newWorkOrders","listDescriptions","selectDescription","handleShowCameraModal","handleCloseCameraModal","handleCapture","savePhoto","prevPhotos","URL","createObjectURL","removePhoto","mostRecentWorkOrder","current","latestDate","capturePhoto","video","document","querySelector","canvas","createElement","videoWidth","videoHeight","context","getContext","drawImage","toBlob","blob","handleShowInfoModal","handleCloseInfoModal","handleCloneToNewItem","encodeURIComponent","handlePnChange","addPn","handleSnChange","addSn","browseInputRef","handleBrowsePhotos","click","handleFilesSelected","files","newPhotos","currentPnIndex","setCurrentPnIndex","showDropdown","setShowDropdown","currentSnIndex","setCurrentSnIndex","showSnDropdown","setShowSnDropdown","handleAddNewClient","handleBluefolderButton","currentWorkOrder","localsn","handleAddToSlack","which","safeName","title","pn0","sn0","pn_sn","sort","a","b","tracking","photoUrls","resp","listKey","work_order","debug","steps","table","ok","loadingOverlay","loadingLogo","cursor","borderLeft","paddingLeft","marginBottom","borderRadius","position","left","transform","bottom","page","shell","card","cardBody","header","kicker","subtitle","top","right","backgroundColor","border","zIndex","maxHeight","overflowY","pnOption","idx","padding","snOption","marginTop","indexOf","photoActionsRow","photoActionsRight","marginLeft","marginRight","isHidden","currentTarget","checked","display","flexWrap","gap","photo","objectFit","actionRow","flexDirection","fontSize","lineHeight","textAlign","overflow","borderRight","margin","textDecoration","color","alignItems","DisplayItemPage","props","getServerSideProps","params","itemDoc","notFound","pnArray","snArray","path","Client","serializedItem"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport {\r\n  Form,\r\n  Button,\r\n  Card,\r\n  Container,\r\n  Row,\r\n  Col,\r\n  Modal,\r\n  FormControl,\r\n  Collapse,\r\n  InputGroup,\r\n  ButtonGroup,\r\n} from \"react-bootstrap\";\r\n\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"../../../../context/AuthUserContext\";\r\nimport firebase from \"../../../../context/Firebase\";\r\nimport LoggedIn from \"../../../LoggedIn\";\r\nimport { useRouter } from \"next/router\";\r\nimport { fetchClients } from \"../../../../utils/fetchAssociations\";\r\nimport ClientTable from \"../../../../utils/ClientTable\";\r\nimport ClientInfoModal from \"../../ClientInfoModal\";\r\nimport ParentModal from \"../../AddItem/parentModal\";\r\nimport dynamic from \"next/dynamic\";\r\nimport InfoModal from \"../../InfoModal\";\nimport MachineSelectionModal from \"./MachineSelectionModal\";\nimport { addServiceItem } from \"../../../../utils/BluefolderService\";\n\nimport NewLocal from \"./NewLocal\";\nimport styles from \"../../AddItem/NewItem.module.css\";\n\n//inflow API\nimport InflowAPI from \"../../../../utils/inflowAPI\";\nimport {\n  buildLocalLocObject,\n  formatLoc,\n  updateMachineFields,\n  buildNameTokens,\n} from \"../../../../utils/itemFormShared\";\n\n// Import for SSR\nimport { adminDb } from \"../../../../context/FirebaseAdmin\";\n\n// This will only load the component on the client-side.\nconst BarcodeScannerComponent = dynamic(\n  () => import(\"react-qr-barcode-scanner\"),\n  { ssr: false }\n);\r\n\r\n// Simulates a network request delay.\r\nfunction simulateNetworkRequest() {\r\n  return new Promise((resolve) => setTimeout(resolve, 2000));\r\n}\r\n\r\n// Custom LoadingButton component.\r\nfunction LoadingButton({ type, name, route }) {\n  const [isLoading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (isLoading) {\n      let cancelled = false;\n      simulateNetworkRequest().then(() => {\n        if (!cancelled) setLoading(false);\n      });\n      return () => {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\r\n  const handleClick = () => setLoading(true);\r\n\r\n  return (\r\n    <Link href={`/${route}`}>\r\n      <a\r\n        className={`btn btn-${type}`}\r\n        disabled={isLoading}\r\n        onClick={!isLoading ? handleClick : null}\r\n      >\r\n        {isLoading ? \"Loading…\" : name}\r\n      </a>\r\n    </Link>\r\n  );\r\n}\n\nfunction isValidMachineValue(value) {\n  if (value == null) return false;\n  if (typeof value !== \"string\") return Boolean(value);\n  const trimmed = value.trim();\n  return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\n}\n\n\nfunction DisplayItemInner({ initialItem, initialMachineData, error }) {\n  // Feature flag to show/hide the 3 Slack buttons\r\n  const SHOW_SLACK_BUTTONS =\r\n    process.env.NEXT_PUBLIC_SHOW_SLACK_BUTTONS === \"true\";\r\n\r\n  const router = useRouter();\r\n  const { signOut } = useAuth();\r\n  // const { id } = router.query;\r\n  const { id: idFromRouter } = router.query;\r\n  const initialId = initialItem?.id || idFromRouter;\r\n  // Use a single local var everywhere in this component\r\n  const id = initialId;\r\n\r\n  const [items, setItems] = useState({\r\n    name: initialItem?.name || \"\",\r\n    pn: Array.isArray(initialItem?.pn)\r\n      ? initialItem.pn\r\n      : (initialItem?.pn ? [initialItem.pn] : []),\r\n    sn: Array.isArray(initialItem?.sn)\r\n      ? initialItem.sn\r\n      : (initialItem?.sn ? [initialItem.sn] : []),\r\n\r\n    // hydrate these from initialItem so SSR renders fully on deploy\r\n    price: initialItem?.price ?? \"\",\r\n    status: initialItem?.status ?? \"\",\r\n    length: initialItem?.length ?? \"\",\r\n    width: initialItem?.width ?? \"\",\r\n    height: initialItem?.height ?? \"\",\r\n    poNumber: initialItem?.poNumber ?? \"\",\r\n    trackingNumber: initialItem?.trackingNumber ?? \"\",\r\n    localSN: initialItem?.localSN || \"\",\r\n    arrival_date: initialItem?.arrival_date || \"\",\r\n    visible: initialItem?.visible ?? true,\n  });\n  const [savedName, setSavedName] = useState(initialItem?.name || \"\");\n  // ⬇️ put this INSIDE DisplayItem, after the related useState hooks\r\n  useEffect(() => {\r\n    if (!initialItem) return;\r\n\r\n    setDescriptions(initialItem.descriptions || []);\r\n    setWorkOrders(initialItem.workOrders || []);\r\n    setDOM(initialItem.DOM || \"\");\r\n\r\n    setItems(prev => ({\r\n      ...prev,\r\n      // only overwrite if SSR provided a value; otherwise keep what you have\r\n      status: initialItem.status ?? prev.status ?? \"\",\r\n      price: initialItem.price ?? prev.price ?? \"\",\r\n      length: initialItem.length ?? prev.length ?? \"\",\r\n      width: initialItem.width ?? prev.width ?? \"\",\r\n      height: initialItem.height ?? prev.height ?? \"\",\r\n      poNumber: initialItem.poNumber ?? prev.poNumber ?? \"\",\r\n      trackingNumber: initialItem.trackingNumber ?? prev.trackingNumber ?? \"\",\r\n    }));\r\n  }, [initialItem]);\r\n\r\n\r\n\r\n  const [newLocalFrom, setNewLocalFrom] = useState({\r\n    region: \"\",\r\n    section: { letter: \"\", number: \"\" },\r\n    bin: \"\",\r\n    pallet: \"\",\r\n  });\r\n  const [newLocalCurrent, setNewLocalCurrent] = useState({\r\n    region: \"\",\r\n    section: { letter: \"\", number: \"\" },\r\n    bin: \"\",\r\n    pallet: \"\",\r\n  });\r\n\r\n  // New states for separate client selections:\r\n  const [selectedClientFrom, setSelectedClientFrom] = useState(null);\r\n  const [selectedClientCurrent, setSelectedClientCurrent] = useState(null);\r\n\r\n  const [selectedMachine, setSelectedMachine] = useState(null);\r\n  const [selectedCurrentMachine, setSelectedCurrentMachine] = useState(null);\r\n\r\n  // whenever you pick a new “From” client or machine, clear the old From-loc:\r\n  // useEffect(() => {\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientFrom, selectedMachine]);\r\n  // const didMountFrom = useRef(false);\r\n\r\n  // useEffect(() => {\r\n  //   if (!didMountFrom.current) {\r\n  //     // first time through (the data-load phase), don’t clear\r\n  //     didMountFrom.current = true;\r\n  //     return;\r\n  //   }\r\n  //   // thereafter, when the user picks a new client or machine, clear:\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  //   setLocalLocFrom(\"\");\r\n  // }, [selectedClientFrom, selectedMachine]);\r\n\r\n  // whenever you pick a new “Current” client or machine, clear the old Current-loc:\r\n  // useEffect(() => {\r\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\r\n  // const [didFetch, setDidFetch] = useState(false);\r\n\r\n  // useEffect(() => {\r\n  //   if (!didFetch) {\r\n  //     // we’re in the data-load phase, skip clearing\r\n  //     setDidFetch(true);\r\n  //     return;\r\n  //   }\r\n  //   // only clear on subsequent user changes:\r\n  //   setNewLocalCurrent({ region: \"\", section: {}, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\r\n\r\n  // These arrays will be populated from Firebase.\r\n  const [pnOptions, setPnOptions] = useState([]);\n  const [snOptions, setSnOptions] = useState([]);\n  const [pnSnLoaded, setPnSnLoaded] = useState(false);\n  const [pnSnLoading, setPnSnLoading] = useState(false);\n\r\n  const [descriptions, setDescriptions] = useState([\r\n    { description: \"\", date: \"\" },\r\n  ]);\r\n  const [workOrders, setWorkOrders] = useState([{ workOrder: \"\", date: \"\" }]);\r\n  const [clients, setClients] = useState([]);\n  const [clientsLoaded, setClientsLoaded] = useState(false);\n  const [clientsLoading, setClientsLoading] = useState(false);\n  const [photos, setPhotos] = useState([]);\r\n  const [show, setShow] = useState(false);\r\n  const [showErr, setShowErr] = useState(false);\r\n  const [Err, setErr] = useState(\"N/A\");\r\n  const [showDescModal, setShowDescModal] = useState(false);\r\n  const [showWoModal, setShowWoModal] = useState(false);\r\n  const [showClientModal, setShowClientModal] = useState(false);\r\n  const [showMachineModal, setShowMachineModal] = useState(false);\r\n  const [showParentModal, setShowParentModal] = useState(false);\r\n  const [showCameraModal, setShowCameraModal] = useState(false);\r\n  const [showSaveModal, setShowSaveModal] = useState(false);\r\n  const [showPrintModal, setShowPrintModal] = useState(false);\r\n  const [machineSelectionModal, setMachineSelectionModal] = useState(false);\r\n  const [selectedDesc, setSelectedDesc] = useState(0);\r\n  const [selectedClient, setSelectedClient] = useState(null);\r\n\r\n  const [selectedParent, setSelectedParent] = useState(null);\r\n  const [TheMachine, setTheMachine] = useState(null);\r\n  const [machineOptions, setMachineOptions] = useState([]);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [capturedPhoto, setCapturedPhoto] = useState(null);\r\n  const [cameraFacing, setCameraFacing] = useState(\"environment\");\r\n  const [addToWebsite, setAddToWebsite] = useState(false);\r\n  const [machinePick, setMachinePick] = useState(false);\r\n  const [freqItem, setFreqItem] = useState(0);\r\n  const [usagePastYear, setUsagePastYear] = useState(0);\r\n  const [machineFrequency, setMachineFrequency] = useState(0);\r\n  // State for the extra (dimensions/price/DOM/PO Number) section.\r\n  const [showExtra, setShowExtra] = useState(false);\r\n  // State for the local warehouse location inputs.\r\n  const [localLocFrom, setLocalLocFrom] = useState(\"\");\r\n  const [localLocCurrent, setLocalLocCurrent] = useState(\"\");\r\n\r\n  // New state for DOM (Date of Manufacture)\r\n  const [DOM, setDOM] = useState(\"\");\r\n  // New state for OEM, Modality, and Model.\r\n  const [oem, setOem] = useState(\"\");\n  const [modality, setModality] = useState(\"\");\n  const [model, setModel] = useState(\"\");\n\n  const applyMergedMachineFields = (merged) => {\n    if (!merged) return;\n    setOem((prev) => (isValidMachineValue(merged.oem) ? merged.oem : prev));\n    setModality((prev) =>\n      isValidMachineValue(merged.modality) ? merged.modality : prev\n    );\n    setModel((prev) =>\n      isValidMachineValue(merged.model) ? merged.model : prev\n    );\n  };\n\r\n  // More info modal state.\r\n  const [showInfoModal, setShowInfoModal] = useState(false);\r\n  const [itemName, setItemName] = useState(\"\");\r\n\r\n  const [machineFieldsInitialized, setMachineFieldsInitialized] =\n    useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\r\n  // near the top of DisplayItem()\r\n  const [showLocalModalFrom, setShowLocalModalFrom] = useState(false);\r\n  const [showLocalModalCurrent, setShowLocalModalCurrent] = useState(false);\r\n\r\n  const openLocalModalFrom = () => setShowLocalModalFrom(true);\r\n  const closeLocalModalFrom = () => setShowLocalModalFrom(false);\r\n  const openLocalModalCurrent = () => setShowLocalModalCurrent(true);\r\n  const closeLocalModalCurrent = () => setShowLocalModalCurrent(false);\r\n\r\n  // at the top of DisplayItem()\r\n  const [showNewLocalModalFrom, setShowNewLocalModalFrom] = useState(false);\n  const [showNewLocalModalCurrent, setShowNewLocalModalCurrent] =\n    useState(false);\n\n  // when the From-client changes, clear any old local-loc\r\n  // useEffect(() => {\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientFrom]);\r\n\r\n  // // when the From-machine changes, clear any old local-loc\r\n  // useEffect(() => {\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedMachine]);\r\n\r\n  // same for Current:\r\n  // useEffect(() => {\r\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\r\n\r\n  // const handleSendToInflow = async () => {\r\n  //   try {\r\n  //     const name = items.name;\r\n  //     const description = descriptions[selectedDesc]?.description || \"\";\r\n  //     // gather every photo URL from Firebase Storage\r\n  //     const imageUrls = photos.map((p) => p.url);\r\n  //     await InflowAPI.upsertProduct({ name, description, imageUrls });\r\n  //     alert(\"Sent to inFlow successfully!\");\r\n  //   } catch (err) {\r\n  //     console.error(err);\r\n  //     alert(\"Error sending to inFlow: \" + err.message);\r\n  //   }\r\n  // };\r\n\r\nconst handleSendToInflow = async () => {\r\n  try {\r\n    const name = (items.name || '').trim();\r\n    if (!name) {\r\n      alert('Item needs a name before sending to inFlow.');\r\n      return;\r\n    }\r\n\r\n    // Regular description (don’t also send a custom “Description” unless you truly have one)\r\n    const description = (descriptions[selectedDesc]?.description || '').trim();\r\n\r\n    // Photos already fetched from storage\r\n    const imageUrls = photos.map(p => p.url).filter(Boolean);\r\n\r\n    // SKU = your item id\r\n    const sku = (id ?? '').toString();\r\n\r\n   \r\n\r\n    // Basic normalizers\r\n    const toCSV = arr => (Array.isArray(arr) ? arr.filter(Boolean).join(', ') : (arr || ''));\r\n\r\n    // YYYY-MM-DD for the date field in inFlow\r\n    const arrivalISO = items.arrival_date\r\n      ? new Date(items.arrival_date).toISOString().slice(0, 10)\r\n      : '';\r\n\r\n    const pnStr = Array.isArray(items.pn) ? items.pn.filter(Boolean).join(', ') : (items.pn || '');\r\n    const snStr = Array.isArray(items.sn) ? items.sn.filter(Boolean).join(', ') : (items.sn || '');\r\n\r\n    // Most recent WO (you already have this)\r\n    const mostRecentWO =\r\n      workOrders?.length\r\n        ? workOrders.reduce((latest, cur) => (new Date(cur.date) > new Date(latest.date) ? cur : latest), workOrders[0])\r\n        : { workOrder: '', date: '' };\r\n\r\n    // Build the numbered fields (match your inFlow “Field 1..10”)\r\n    const customFields = {\r\n      custom1: (oem || '').trim(),                      // OEM   (dropdown)\r\n      custom2: (modality || '').trim(),                 // Modality (dropdown)\r\n      custom3: (model || '').trim(),                    // Model (dropdown)\r\n      custom4: (description || '').trim(),              // Description (text) - optional duplicate\r\n      custom5: (mostRecentWO.workOrder || '').trim(),   // Work Order (text)\r\n      custom6: (selectedClientFrom?.name || '').trim(), // From (text)\r\n      custom7: pnStr,                                   // Product Number (text)\r\n      custom8: snStr,                                   // Serial Number (text)\r\n      custom9: arrivalISO,                              // Arrival Date (date)\r\n      custom10: (selectedClientCurrent?.name || '').trim(), // Current (text)\r\n    };\r\n\r\n    console.log('[inFlow] customFields to send (numbered):', customFields);\r\n\r\n\r\n    const created = await InflowAPI.upsertProduct({\r\n      name,\r\n      description,\r\n      sku,\r\n      imageUrls,\r\n      customFields,\r\n    });\r\n\r\n    alert(`Sent to inFlow successfully. ID: ${created?.productId || created?.id || '(unknown)'}`);\r\n  } catch (err) {\r\n    console.error(err);\r\n    alert('Error sending to inFlow: ' + err.message);\r\n  }\r\n};\r\n\r\n\r\n  // const [storedMachine, setStoredMachine] = useState(null);\r\n\r\n  // useEffect(() => {\r\n  //   // once any of these three change, re-merge:\r\n  //   if (TheMachine || selectedCurrentMachine || selectedMachine) {\r\n  //     const merged = updateMachineFields(\r\n  //       TheMachine,\r\n  //       selectedCurrentMachine,\r\n  //       selectedMachine\r\n  //     );\r\n  //     setOem(merged.oem);\r\n  //     setModality(merged.modality);\r\n  //     setModel(merged.model);\r\n  //   }\r\n  // }, [TheMachine, selectedCurrentMachine, selectedMachine]);\r\n\r\n  // whenever the “From” client changes:\r\n  useEffect(() => {\r\n    setShowLocalLocFrom(\r\n      selectedClientFrom?.name?.toLowerCase() === \"socalwarehouse\"\r\n    );\r\n  }, [selectedClientFrom]);\r\n\r\n  // whenever the “Current” client changes:\r\n  useEffect(() => {\r\n    setShowLocalLocCurrent(\r\n      selectedClientCurrent?.name?.toLowerCase() === \"socalwarehouse\"\r\n    );\r\n  }, [selectedClientCurrent]);\r\n\r\n  const loadClients = async () => {\n    if (clientsLoaded || clientsLoading) return;\n    setClientsLoading(true);\n    try {\n      const clientsData = await fetchClients();\n      setClients(clientsData);\n      setClientsLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching clients: \", error);\n    } finally {\n      setClientsLoading(false);\n    }\n  };\n\r\n  const loadPnSnOptions = async () => {\n    if (pnSnLoaded || pnSnLoading) return;\n    setPnSnLoading(true);\n    try {\n      const db = firebase.firestore();\n      const snapshot = await db\n        .collection(\"Test\")\n        .orderBy(firebase.firestore.FieldPath.documentId())\n        .limit(500)\n        .get();\n      let pnSet = new Set();\n      let snSet = new Set();\n      snapshot.forEach((doc) => {\n        const data = doc.data();\n        if (Array.isArray(data.pn)) {\n          data.pn.forEach((pn) => pn && pnSet.add(pn));\n        } else if (data.pn) {\n          pnSet.add(data.pn);\n        }\n        if (Array.isArray(data.sn)) {\n          data.sn.forEach((sn) => sn && snSet.add(sn));\n        } else if (data.sn) {\n          snSet.add(data.sn);\n        }\n      });\n      setPnOptions([...pnSet]);\n      setSnOptions([...snSet]);\n      setPnSnLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching PN/SN options:\", error);\n    } finally {\n      setPnSnLoading(false);\n    }\n  };\n\n\r\n  useEffect(() => {\r\n    if (id) fetchData();           // always hydrate on the client\r\n  }, [id]);\r\n\r\n  async function resolveClientFromMachine(\r\n    machineRef,\r\n    setClient,\r\n    setMachine,\r\n    isFrom = true\r\n  ) {\r\n    const machineDoc = await machineRef.get();\r\n    if (machineDoc.exists) {\r\n      const machineData = machineDoc.data();\r\n      setMachine({ id: machineDoc.id, ...machineData });\r\n\r\n      // Determine if the machine is \"interior socal\"\r\n      // const isSocalInterior = machineData.name && machineData.name.toLowerCase() === \"interior socal\";\r\n      // if (isSocalInterior) {\r\n      //   if (isFrom) {\r\n      //     setShowLocalLocFrom(true);\r\n      //   } else {\r\n      //     setShowLocalLocCurrent(true);\r\n      //   }\r\n      // } else {\r\n      // Optionally clear the flag if it is not \"interior socal\"\r\n      // if (isFrom) {\r\n      //   setShowLocalLocFrom(false);\r\n      // } else {\r\n      //   setShowLocalLocCurrent(false);\r\n      // }\r\n      // }\r\n      // new: fetch client name and combine both checks\r\n      const clientDoc =\r\n        machineData.client && typeof machineData.client.get === \"function\"\r\n          ? await machineData.client.get()\r\n          : null;\r\n      const clientName =\r\n        clientDoc && clientDoc.exists ? clientDoc.data().name : null;\r\n      const isSocalInterior =\r\n        machineData.name?.toLowerCase() === \"interior socal\";\r\n      const shouldShow = isSocalInterior || clientName === \"SoCalWarehouse\";\r\n\r\n      if (isFrom) {\r\n        setShowLocalLocFrom(shouldShow);\r\n      } else {\r\n        setShowLocalLocCurrent(shouldShow);\r\n      }\r\n\r\n      if (machineData.client && typeof machineData.client.get === \"function\") {\r\n        const clientDoc = await machineData.client.get();\r\n        if (clientDoc.exists) {\r\n          setClient({ id: clientDoc.id, ...clientDoc.data() });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const fetchData = async () => {\n    const id = initialItem?.id || idFromRouter; // <- make sure id exists here\n    if (!id) return;\n    setIsLoading(true);\n    const db = firebase.firestore();\n    try {\n      const doc = await db.collection(\"Test\").doc(id).get();\n      if (doc.exists) {\n        console.log(\"test\");\n        const data = doc.data();\n        const normalizedPN = Array.isArray(data.pn) ? data.pn : [data.pn];\n        const normalizedSN = Array.isArray(data.sn) ? data.sn : [data.sn];\n        setItems({\n          ...data,\n          pn: normalizedPN,\n          sn: normalizedSN,\n        });\n        setDescriptions(data.descriptions || []);\n        setWorkOrders(data.workOrders || []);\n        if (data.localLocFrom) setLocalLocFrom(data.localLocFrom);\n        if (data.localLocCurrent) setLocalLocCurrent(data.localLocCurrent);\n        if (data.DOM) {\n          setDOM(data.DOM);\n        }\n\r\n      // …after you do setItems, setDescriptions, etc.\r\n\r\n      // load the “newLocal” maps\r\n      if (data.newLocalFrom) setNewLocalFrom(data.newLocalFrom);\r\n      if (data.newLocalCurrent) setNewLocalCurrent(data.newLocalCurrent);\r\n\r\n      // Load PO Number if it exists.\r\n      if (data.poNumber) {\r\n        setItems((prev) => ({ ...prev, poNumber: data.poNumber }));\r\n      }\r\n\r\n      if (data.ClientFrom) {\r\n        const clientFromDoc = await data.ClientFrom.get();\r\n        if (clientFromDoc.exists) {\r\n          setSelectedClientFrom({\r\n            id: clientFromDoc.id,\r\n            ...clientFromDoc.data(),\r\n          });\r\n        }\r\n      }\r\n      if (data.ClientCurrent) {\r\n        const clientCurrentDoc = await data.ClientCurrent.get();\r\n        if (clientCurrentDoc.exists) {\r\n          setSelectedClientCurrent({\r\n            id: clientCurrentDoc.id,\r\n            ...clientCurrentDoc.data(),\r\n          });\r\n        }\r\n      }\r\n\r\n      if (\r\n        !data.ClientFrom &&\r\n        data.Machine &&\r\n        typeof data.Machine.get === \"function\"\r\n      ) {\r\n        console.log(\r\n          \"Entered resolveClientFromMachine for Machine (old style for From)\"\r\n        );\r\n        await resolveClientFromMachine(\r\n          data.Machine,\r\n          setSelectedClientFrom,\r\n          setSelectedMachine,\r\n          true\r\n        );\r\n      }\r\n      if (\r\n        !data.ClientCurrent &&\r\n        data.CurrentMachine &&\r\n        typeof data.CurrentMachine.get === \"function\"\r\n      ) {\r\n        console.log(\r\n          \"Entered resolveClientFromMachine for CurrentMachine (old style for Current)\"\r\n        );\r\n        await resolveClientFromMachine(\r\n          data.CurrentMachine,\r\n          setSelectedClientCurrent,\r\n          setSelectedCurrentMachine,\r\n          false\r\n        );\r\n      }\r\n\r\n      let machineFromData = null;\r\n      let machineCurrentData = null;\r\n\r\n      if (data.MachineFrom) {\r\n        const doc = await data.MachineFrom.get();\r\n        machineFromData = doc.exists ? doc.data() : null;\r\n        setSelectedMachine({ id: doc.id, ...doc.data() });\r\n      }\r\n      if (data.MachineCurrent) {\r\n        const doc = await data.MachineCurrent.get();\r\n        machineCurrentData = doc.exists ? doc.data() : null;\r\n        setSelectedCurrentMachine({ id: doc.id, ...doc.data() });\r\n      }\r\n      const nameFrom = machineFromData?.name?.toLowerCase();\r\n      const nameCurrent = machineCurrentData?.name?.toLowerCase();\r\n\r\n      // If the machine’s name is “interior socal”, show that branch:\r\n      // setShowLocalLocFrom(nameFrom === \"interior socal\");\r\n      // // Or if your Firestore already has a value for localLocFrom, show it anyway:\r\n      // if (data.localLocFrom) setShowLocalLocFrom(true);\r\n\r\n      // setShowLocalLocCurrent(nameCurrent === \"interior socal\");\r\n      // if (data.localLocCurrent) setShowLocalLocCurrent(true);\r\n      // new: combine machine-name OR client-name check, keep existing-data\r\n      setShowLocalLocFrom(\r\n        nameFrom === \"interior socal\" ||\r\n          selectedClientFrom?.name?.toLowerCase() === \"socalwarehouse\" ||\r\n          Boolean(data.localLocFrom)\r\n      );\r\n      setShowLocalLocCurrent(\r\n        nameCurrent === \"interior socal\" ||\r\n          selectedClientCurrent?.name?.toLowerCase() === \"socalwarehouse\" ||\r\n          Boolean(data.localLocCurrent)\r\n      );\r\n\r\n      const theMachineData = data.TheMachine || null;\r\n\r\n      setTheMachine(theMachineData);\r\n      if (theMachineData) {\r\n        // pull both variants, prefer lowercase if it exists\r\n        const OEM = theMachineData.oem ?? theMachineData.OEM;\r\n        const Modality = theMachineData.modality ?? theMachineData.Modality;\r\n        const Model = theMachineData.model ?? theMachineData.Model;\r\n        setTheMachine({ ...theMachineData, OEM, Modality, Model });\r\n      }\r\n      // setStoredMachine(theMachineData);\r\n\r\n      // **right here** merge from the three sources you just fetched:\r\n      const merged = updateMachineFields(\n        theMachineData,\n        machineCurrentData,\n        machineFromData\n      );\n      applyMergedMachineFields(merged);\n\r\n      console.log(\r\n        \"SelectedMachine:\",\r\n        selectedMachine,\r\n        \"SelectedCurrentMachine:\",\r\n        selectedCurrentMachine\r\n      );\r\n      // Show local loc inputs if applicable\r\n      // if (\r\n      //   selectedMachine &&\r\n      //   selectedMachine.name &&\r\n      //   selectedMachine.name.toLowerCase() === \"interior socal\"\r\n      // ) {\r\n      //   setShowLocalLocFrom(true);\r\n      // }\r\n      // if (\r\n      //   selectedCurrentMachine &&\r\n      //   selectedCurrentMachine.name &&\r\n      //   selectedCurrentMachine.name.toLowerCase() === \"interior socal\"\r\n      // ) {\r\n      //   setShowLocalLocCurrent(true);\r\n      // }\r\n\r\n      if (data.Parent) {\r\n        const parentDoc = await data.Parent.get();\r\n        setSelectedParent({ id: parentDoc.id, ...parentDoc.data() });\r\n      }\r\n\r\n      // Priority auto‑population of machine fields.\r\n      // const updatedFields = updateMachineFields(storedMachine, selectedCurrentMachine, selectedMachine);\r\n      // // console.log(\"Updated machine fields:\", updatedFields);\r\n      // setOem(updatedFields.oem);\r\n      // setModality(updatedFields.modality);\r\n      // setModel(updatedFields.model);\r\n\r\n        setIsLoading(false);\n        Promise.all([\n          fetchPhotos(id),\n          checkIfAddedToWebsite(id),\n          calculateItemFrequencyAndUsage(data.pn),\n        ]).catch((err) => {\n          console.error(\"Background item loads failed:\", err);\n        });\n      } else {\n        router.push({\n          pathname: \"../AddItem/NewItem\",\n          query: { signal: id },\n        });\n      }\n    } catch (error) {\n      console.error(\"Error fetching item:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\r\n  const calculateItemFrequencyAndUsage = async (pn) => {\r\n    const db = firebase.firestore();\r\n    const currentDate = new Date();\r\n    const oneYearAgo = new Date();\r\n    oneYearAgo.setFullYear(currentDate.getFullYear() - 1);\r\n\r\n    const normalizedPN = pn !== undefined ? pn : \"\";\r\n    const itemsSnapshot = await db\r\n      .collection(\"Test\")\r\n      .where(\"pn\", \"==\", normalizedPN)\r\n      .get();\r\n\r\n    setFreqItem(itemsSnapshot.size);\r\n\r\n    let usagePastYear = 0;\r\n    itemsSnapshot.forEach((doc) => {\r\n      const itemData = doc.data();\r\n      itemData.workOrders.forEach((workOrder) => {\r\n        const workOrderDate = new Date(workOrder.date);\r\n        if (workOrderDate >= oneYearAgo && workOrderDate <= currentDate) {\r\n          usagePastYear++;\r\n        }\r\n      });\r\n    });\r\n    setUsagePastYear(usagePastYear);\r\n  };\r\n\r\n  const fetchMachine = async (machineId) => {\r\n    const db = firebase.firestore();\r\n    const doc = await db.collection(\"Machine\").doc(machineId).get();\r\n    if (doc.exists) {\r\n      const machineData = doc.data();\r\n      setTheMachine(machineData);\r\n      // re-merge all three sources with correct priority:\r\n      const merged = updateMachineFields(\n        machineData,\n        selectedCurrentMachine,\n        selectedMachine\n      );\n      applyMergedMachineFields(merged);\n      const machinesSnapshot = await db\r\n        .collection(\"Machine\")\r\n        .where(\"Model\", \"==\", machineData.Model || machineData.model)\r\n        .get();\r\n      setMachineFrequency(machinesSnapshot.size);\r\n    } else {\r\n      console.error(\"Machine not found\");\r\n    }\r\n  };\r\n\r\n  const fetchPhotos = async (docID) => {\r\n    const storageRef = firebase.storage().ref();\r\n    const listRef = storageRef.child(`Parts/${docID}`);\r\n    try {\r\n      const res = await listRef.listAll();\r\n      const urls = await Promise.all(\n        res.items.map((item) => item.getDownloadURL())\n      );\n      setPhotos(urls.map((url) => ({ url, file: null })));\n    } catch (error) {\r\n      console.error(\"Error fetching photos: \", error);\r\n    }\r\n  };\r\n\r\n  const checkIfAddedToWebsite = async (docID) => {\r\n    const db = firebase.firestore();\r\n    const partsDoc = await db.collection(\"Parts\").doc(docID).get();\r\n    if (partsDoc.exists) {\r\n      setAddToWebsite(true);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => setShow(false);\r\n  const handleShow = () => setShow(true);\r\n  const handleCloseErr = () => setShowErr(false);\r\n  const handleShowErr = () => setShowErr(true);\r\n  const handleCloseSaveModal = () => setShowSaveModal(false);\r\n  const handleClosePrintModal = () => setShowPrintModal(false);\r\n  const handleShowSaveModal = () => setShowSaveModal(true);\r\n  const handleShowPrintModal = () => setShowPrintModal(true);\r\n  const handleMachineSelectionModal = () => setMachineSelectionModal(false);\r\n  const handleCloseDescModal = () => setShowDescModal(false);\r\n  const handleShowDescModal = () => setShowDescModal(true);\r\n  const handleCloseWoModal = () => setShowWoModal(false);\r\n  const handleShowWoModal = () => setShowWoModal(true);\r\n  const handleCloseClientModal = () => setShowClientModal(false);\n  const handleShowClientModal = async () => {\n    await loadClients();\n    setShowClientModal(true);\n  };\n  const handleCloseMachineModal = () => setShowMachineModal(false);\r\n  const handleShowMachineModal = () => {\r\n    setShowMachineModal(true);\r\n    setShowClientModal(false);\r\n  };\r\n  const handleCloseParentModal = () => setShowParentModal(false);\r\n  const handleShowParentModal = () => setShowParentModal(true);\r\n\r\n  // When a client is selected from the client table.\r\n  const handleClientInfo = async (clientId) => {\r\n    // Clear any previously selected machine and local loc info for this branch.\r\n    if (machinePick) {\r\n      setSelectedMachine(null);\r\n      setShowLocalLocFrom(false);\r\n    } else {\r\n      setSelectedCurrentMachine(null);\r\n      setShowLocalLocCurrent(false);\r\n    }\r\n\r\n    const db = firebase.firestore();\r\n    const clientDoc = await db.collection(\"Client\").doc(clientId).get();\r\n    if (clientDoc.exists) {\r\n      const clientData = { id: clientDoc.id, ...clientDoc.data() };\r\n      if (machinePick) {\r\n        setSelectedClientFrom(clientData);\r\n      } else {\r\n        setSelectedClientCurrent(clientData);\r\n      }\r\n      // after setting selectedClientFrom/Current:\r\n      if (clientData.name === \"SoCalWarehouse\") {\r\n        if (machinePick) setShowLocalLocFrom(true);\r\n        else setShowLocalLocCurrent(true);\r\n      }\r\n      // Fetch machines for this client:\r\n      const machinePromises = clientData.machines.map((machineRef) =>\r\n        machineRef.get()\r\n      );\r\n      const machineDocs = await Promise.all(machinePromises);\r\n      const machines = machineDocs.map((machineDoc) => ({\r\n        id: machineDoc.id,\r\n        ...machineDoc.data(),\r\n      }));\r\n      setMachineOptions(machines);\r\n      // Close the client modal\r\n      handleCloseClientModal();\r\n    }\r\n  };\r\n\r\n  // Reordering function for dropdowns.\r\n  const reorderArray = (arr, selectedValue) => {\r\n    const newArr = arr.filter((val) => val !== selectedValue);\r\n    return [selectedValue, ...newArr];\r\n  };\r\n\r\n  const [addingNewPn, setAddingNewPn] = useState(false);\r\n  const [newPn, setNewPn] = useState(\"\");\r\n  const [addingNewSn, setAddingNewSn] = useState(false);\r\n  const [newSn, setNewSn] = useState(\"\");\r\n\r\n  const handlePnSelect = (e) => {\r\n    const selected = e.target.value;\r\n    setItems((prev) => {\r\n      let updatedPn = Array.isArray(prev.pn) ? [...prev.pn] : [];\r\n      updatedPn[0] = selected;\r\n      return { ...prev, pn: updatedPn };\r\n    });\r\n  };\r\n\r\n  const handleSnSelect = (e) => {\r\n    const selected = e.target.value;\r\n    setItems((prev) => {\r\n      let updatedSn = Array.isArray(prev.sn) ? [...prev.sn] : [];\r\n      updatedSn[0] = selected;\r\n      return { ...prev, sn: updatedSn };\r\n    });\r\n  };\r\n\r\n  const handleAddNewPn = () => {\r\n    if (newPn.trim() !== \"\") {\r\n      setItems((prev) => ({\r\n        ...prev,\r\n        pn: [...prev.pn, newPn.trim()],\r\n      }));\r\n    }\r\n    setNewPn(\"\");\r\n    setAddingNewPn(false);\r\n  };\r\n\r\n  const handleAddNewSn = () => {\r\n    if (newSn.trim() !== \"\") {\r\n      setItems((prev) => ({\r\n        ...prev,\r\n        sn: [...prev.sn, newSn.trim()],\r\n      }));\r\n    }\r\n    setNewSn(\"\");\r\n    setAddingNewSn(false);\r\n  };\r\n\r\n  // Generate custom document ID if needed.\r\n  const generateCustomID = () => {\r\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\r\n    return `AIS${randomNum}`;\r\n  };\r\n\r\n  function shallowClean(obj) {\r\n    const newObj = {};\r\n    for (const key in obj) {\r\n      console.log(key, obj[key]);\r\n      if (obj.hasOwnProperty(key)) {\r\n        newObj[key] = obj[key] === undefined ? \"\" : obj[key];\r\n      }\r\n    }\r\n    return newObj;\r\n  }\r\n\r\n  async function toSend() {\r\n    const db = firebase.firestore();\r\n    const currentUser = firebase.auth().currentUser;\r\n    const userEmail = currentUser ? currentUser.email : \"unknown\";\r\n\r\n    // Always use the current state values for OEM, modality, and model.\r\n    const machineData = {\r\n      ...(TheMachine || {}),\r\n      oem: oem,\r\n      modality: modality,\r\n      model: model,\r\n    };\r\n\r\n    const formattedItems = { ...items, descriptions, workOrders };\n    // Remove any unused fields.\n    formattedItems.status = items.status || \"\";\n    formattedItems.nameLower = (items.name || \"\").toLowerCase();\n    formattedItems.nameTokens = buildNameTokens(items.name);\n    formattedItems.DOM = DOM; // Date of Manufacture\r\n    formattedItems.localLocFrom = localLocFrom || \"\";\r\n    formattedItems.localLocCurrent = localLocCurrent || \"\";\r\n    formattedItems.date = items.date || \"\";\r\n    formattedItems.arrival_date = items.arrival_date || \"\"; // NEW: Arrival Date\r\n    formattedItems.poNumber = items.poNumber || \"\";\r\n    formattedItems.trackingNumber = items.trackingNumber || \"\";\r\n    formattedItems.TheMachine = machineData || {};\r\n    formattedItems.addedToWebsite = addToWebsite;\r\n\r\n    // NEW: Add the user's email under the field \"user\"\r\n    formattedItems.lastEdited = userEmail;\r\n\r\n    // Clean pn and sn arrays to replace undefined values with an empty string.\r\n    formattedItems.pn = (items.pn || []).map((value) =>\r\n      value === undefined ? \"\" : value\r\n    );\r\n    formattedItems.sn = (items.sn || []).map((value) =>\r\n      value === undefined ? \"\" : value\r\n    );\r\n\r\n    const fromDetails = buildLocalLocObject(newLocalFrom);\r\n    const currentDetails = buildLocalLocObject(newLocalCurrent);\r\n\r\n    console.log(\r\n      \"From Details: \" +\r\n        fromDetails.region +\r\n        \" \" +\r\n        fromDetails.section?.letter +\r\n        fromDetails.section?.number +\r\n        \" \" +\r\n        fromDetails.bin +\r\n        \" \" +\r\n        fromDetails.pallet\r\n    );\r\n    console.log(\r\n      \"Current Details: \" +\r\n        currentDetails.region +\r\n        \" \" +\r\n        currentDetails.section?.letter +\r\n        currentDetails.section?.number +\r\n        \" \" +\r\n        currentDetails.bin +\r\n        \" \" +\r\n        currentDetails.pallet\r\n    );\r\n\r\n    if (Object.keys(fromDetails).length) {\r\n      formattedItems.newLocalFrom = fromDetails;\r\n      formattedItems.localLocFrom = formatLoc(newLocalFrom) || \"\";\r\n    } else {\r\n      // all fields empty — force an empty string and remove any stray map\r\n      console.log(\"entered empty fromDetails else\");\r\n      formattedItems.localLocFrom = \"\";\r\n      formattedItems.newLocalFrom = {};\r\n    }\r\n\r\n    if (Object.keys(currentDetails).length) {\r\n      formattedItems.newLocalCurrent = currentDetails;\r\n      formattedItems.localLocCurrent = formatLoc(newLocalCurrent) || \"\";\r\n    } else {\r\n      // all fields empty — force an empty string and remove any stray map\r\n      formattedItems.localLocCurrent = \"\";\r\n      formattedItems.newLocalCurrent = {};\r\n    }\r\n\r\n    if (selectedMachine && selectedMachine.id) {\r\n      formattedItems.MachineFrom = db\r\n        .collection(\"Machine\")\r\n        .doc(selectedMachine.id);\r\n    }\r\n\r\n    if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n      formattedItems.MachineCurrent = db\r\n        .collection(\"Machine\")\r\n        .doc(selectedCurrentMachine.id);\r\n    }\r\n\r\n    if (selectedParent && selectedParent.id) {\r\n      formattedItems.Parent = db.collection(\"Test\").doc(selectedParent.id);\r\n    }\r\n\r\n    // NEW: Set separate client references.\r\n    if (selectedClientFrom && selectedClientFrom.id) {\r\n      formattedItems.ClientFrom = db\r\n        .collection(\"Client\")\r\n        .doc(selectedClientFrom.id);\r\n    }\r\n    if (selectedClientCurrent && selectedClientCurrent.id) {\r\n      formattedItems.ClientCurrent = db\r\n        .collection(\"Client\")\r\n        .doc(selectedClientCurrent.id);\r\n    }\r\n\r\n    // Only attach the richer “newLocal” map when the user actually filled something in\r\n    if (Object.keys(fromDetails).length) {\r\n      formattedItems.newLocalFrom = fromDetails;\r\n    }\r\n    if (Object.keys(currentDetails).length) {\r\n      formattedItems.newLocalCurrent = currentDetails;\r\n    }\r\n\r\n    let docId = id;\r\n    try {\r\n      if (docId) {\r\n        // Check if a localSN is provided and if it differs from the current docId.\r\n        const newDocId =\r\n          items.localSN && items.localSN.trim() !== \"\"\r\n            ? items.localSN.trim()\r\n            : docId;\r\n        if (docId !== newDocId) {\r\n          // Migrate: Create a new document with the newDocId.\r\n          await db.collection(\"Test\").doc(newDocId).set(formattedItems);\r\n\r\n          if (selectedMachine && selectedMachine.id) {\r\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\r\n            const machineDoc = await machineRef.get();\r\n            if (machineDoc.exists) {\r\n              await machineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(newDocId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n\r\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n            const currentMachineRef = db\r\n              .collection(\"Machine\")\r\n              .doc(selectedCurrentMachine.id);\r\n            const currentMachineDoc = await currentMachineRef.get();\r\n            if (currentMachineDoc.exists) {\r\n              await currentMachineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(newDocId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n          // Delete the old document.\r\n          await db.collection(\"Test\").doc(docId).delete();\r\n          // Set docId to the new document ID.\r\n          docId = newDocId;\r\n        } else {\r\n          // Deep-clean the formattedItems to remove any undefined nested values.\r\n          const cleanFormattedItems = shallowClean(formattedItems);\r\n          await db.collection(\"Test\").doc(docId).update(cleanFormattedItems);\r\n\r\n          if (selectedMachine && selectedMachine.id) {\r\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\r\n            const machineDoc = await machineRef.get();\r\n            if (machineDoc.exists) {\r\n              await machineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(docId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n\r\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n            const currentMachineRef = db\r\n              .collection(\"Machine\")\r\n              .doc(selectedCurrentMachine.id);\r\n            const currentMachineDoc = await currentMachineRef.get();\r\n            if (currentMachineDoc.exists) {\r\n              await currentMachineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(docId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // For a new item, if localSN is provided, use it; otherwise, generate a custom ID.\r\n        docId =\r\n          items.localSN && items.localSN.trim() !== \"\"\r\n            ? items.localSN.trim()\r\n            : generateCustomID();\r\n        await db.collection(\"Test\").doc(docId).set(formattedItems);\r\n\r\n        if (selectedMachine && selectedMachine.id) {\r\n          const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\r\n          const machineDoc = await machineRef.get();\r\n          if (machineDoc.exists) {\r\n            await machineRef.update({\r\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                db.collection(\"Test\").doc(docId)\r\n              ),\r\n            });\r\n          }\r\n        }\r\n\r\n        if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n          const currentMachineRef = db\r\n            .collection(\"Machine\")\r\n            .doc(selectedCurrentMachine.id);\r\n          const currentMachineDoc = await currentMachineRef.get();\r\n          if (currentMachineDoc.exists) {\r\n            await currentMachineRef.update({\r\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                db.collection(\"Test\").doc(docId)\r\n              ),\r\n            });\r\n          }\r\n        }\r\n      }\r\n      // Upload any new photos to Firebase Storage.\r\n      await uploadPhotos(docId);\r\n      console.log(\"Item saved and associatedParts updated!\");\r\n\r\n      // Redirect to the new URL using the new document id.\r\n      router.push(`/NewSearch/item/${docId}`);\r\n\r\n      // Optionally, you can also show a save confirmation modal:\r\n      handleShowSaveModal();\r\n    } catch (error) {\r\n      console.error(\"Error saving data:\", error);\r\n    }\r\n  }\r\n\r\n  // Additional state for local warehouse location inputs.\r\n  const [showLocalLocFrom, setShowLocalLocFrom] = useState(false);\r\n  const [showLocalLocCurrent, setShowLocalLocCurrent] = useState(false);\r\n\r\n  // When a machine is selected from the modal.\r\n  const handleSetSelectedMachine = (machine) => {\r\n    // const condition = (name) => name && name.toLowerCase() === \"interior socal\";\r\n    const isSocalInterior = machine.name?.toLowerCase() === \"interior socal\";\r\n\r\n    if (machinePick) {\r\n      setSelectedMachine({ id: machine.id, name: machine.name });\r\n      setShowLocalLocFrom(\r\n        isSocalInterior ||\r\n          selectedClientFrom?.name?.toLowerCase() === \"socalwarehouse\"\r\n      );\r\n    } else {\r\n      setSelectedCurrentMachine({ id: machine.id, name: machine.name });\r\n      setShowLocalLocCurrent(\r\n        isSocalInterior ||\r\n          selectedClientCurrent?.name?.toLowerCase() === \"socalwarehouse\"\r\n      );\r\n    }\r\n    fetchMachine(machine.id);\r\n    // Close the machine modal (assuming you're using showMachineModal to control it)\r\n    setShowMachineModal(false);\r\n  };\r\n\r\n  const uploadPhotos = async (docID) => {\r\n    const storageRef = firebase.storage().ref();\r\n    for (let i = 0; i < photos.length; i++) {\r\n      if (photos[i].file) {\r\n        const photoRef = storageRef.child(\r\n          `Parts/${docID}/${docID}${i === 0 ? \".jpg\" : `.${i + 1}.jpg`}`\r\n        );\r\n        const metadata = {\r\n          contentType: \"image/png\",\r\n        };\r\n        await photoRef.put(photos[i].file, metadata);\r\n        const url = await photoRef.getDownloadURL();\r\n        photos[i].url = url;\r\n      }\r\n    }\r\n  };\r\n\r\n  // Function to handle printing the label.\r\n  const handlePrint = async () => {\r\n    if (!items.name) {\r\n      alert(\"Missing name\");\r\n      return;\r\n    }\r\n\r\n    let clientName = \"\";\r\n\r\n    // Attempt to fetch client name from the Machine document reference.\r\n    if (items.Machine && typeof items.Machine.get === \"function\") {\r\n      try {\r\n        const machineDoc = await items.Machine.get();\r\n        if (machineDoc.exists) {\r\n          const machineData = machineDoc.data();\r\n          if (\r\n            machineData.client &&\r\n            typeof machineData.client.get === \"function\"\r\n          ) {\r\n            const clientDoc = await machineData.client.get();\r\n            if (clientDoc.exists) {\r\n              clientName = clientDoc.data().name || \"\";\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching machine or client:\", error);\r\n      }\r\n    } else {\r\n      console.warn(\"No Machine reference available in the item\");\r\n    }\r\n    console.log(clientName, \":\", items.client);\r\n    // Fallback: if no client name was found, check items.client.\r\n    if (!clientName && items.client) {\r\n      if (typeof items.client.get === \"function\") {\r\n        try {\r\n          const clientDoc = await items.client.get();\r\n          if (clientDoc.exists) {\r\n            clientName = clientDoc.data().name || \"\";\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Error fetching client from items.client:\", error);\r\n        }\r\n      } else {\r\n        clientName = items.client;\r\n      }\r\n    }\r\n    console.log(\"descriptions:\", descriptions[selectedDesc]);\r\n    const payload = {\r\n      name: items.name,\r\n      pn: items.pn,\r\n      sn: items.sn,\r\n      wo: workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\",\r\n      client: clientName,\r\n      status: items.status,\r\n      local_sn: id,\r\n      descriptions: [\r\n        descriptions[selectedDesc] || { description: \"\", date: \"\" },\r\n      ],\r\n      date: items.dateCreated || \"\",\r\n      DOM: DOM,\r\n      oem: oem,\r\n      modality: modality,\r\n      model: model,\r\n      poNumber: items.poNumber,\r\n      arrival_date: items.arrival_date, // NEW: Include arrival_date\r\n    };\r\n\r\n    console.log(\"Payload for printing:\", payload);\r\n    try {\r\n      const response = await fetch(\r\n        \"https://9d70-174-76-22-138.ngrok-free.app/print-label\",\r\n        {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(payload),\r\n        }\r\n      );\r\n      const result = await response.json();\r\n      console.log(\"Print result:\", result.status);\r\n\r\n      if (result.status.includes(\"successfully.\")) {\r\n        handleShowPrintModal();\r\n      } else {\r\n        console.error(\"Error printing label:\", result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error printing label:\", error);\r\n    }\r\n  };\r\n\r\n  async function handleSubmit(event) {\r\n    event.preventDefault();\r\n    // Only check that the Name field is filled out.\r\n    if (!items.name) {\r\n      handleShow(); // This shows the \"missing field\" modal.\r\n    } else {\r\n      toSend();\r\n    }\r\n  }\r\n\r\n  // Handlers for input changes.\r\n  const handleChange = (field) => (event) => {\r\n    const value = event.target ? event.target.value : event.value;\r\n    setItems((prevItems) => ({ ...prevItems, [field]: value }));\r\n  };\r\n\r\n  const addDescription = () => {\r\n    setDescriptions([...descriptions, { description: \"\", date: \"\" }]);\r\n  };\r\n\r\n  const removeDescription = (index) => {\r\n    setDescriptions(descriptions.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleDescriptionChange = (index, field, value) => {\r\n    const newDescriptions = descriptions.map((desc, i) =>\r\n      i === index ? { ...desc, [field]: value } : desc\r\n    );\r\n    setDescriptions(newDescriptions);\r\n  };\r\n\r\n  const addWorkOrder = () => {\r\n    setWorkOrders([...workOrders, { workOrder: \"\", date: \"\" }]);\r\n  };\r\n\r\n  const removeWorkOrder = (index) => {\r\n    setWorkOrders(workOrders.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleWorkOrderChange = (index, field, value) => {\r\n    const newWorkOrders = workOrders.map((wo, i) =>\r\n      i === index ? { ...wo, [field]: value } : wo\r\n    );\r\n    setWorkOrders(newWorkOrders);\r\n  };\r\n\r\n  const listDescriptions = () => {\r\n    setShowDescModal(true);\r\n  };\r\n\r\n  const selectDescription = (index) => {\r\n    setSelectedDesc(index);\r\n    setShowDescModal(false);\r\n  };\r\n\r\n  const handleShowCameraModal = () => {\r\n    setShowCameraModal(true);\r\n  };\r\n\r\n  const handleCloseCameraModal = () => {\r\n    setShowCameraModal(false);\r\n    setCapturedPhoto(null);\r\n  };\r\n\r\n  const handleCapture = (err, result) => {\r\n    if (result) {\r\n      setCapturedPhoto(result);\r\n    }\r\n  };\r\n\r\n  const savePhoto = () => {\r\n    setPhotos((prevPhotos) => [\r\n      ...prevPhotos,\r\n      { file: capturedPhoto, url: URL.createObjectURL(capturedPhoto) },\r\n    ]);\r\n    setCapturedPhoto(null);\r\n    handleCloseCameraModal();\r\n  };\r\n\r\n  const removePhoto = (index) => {\r\n    setPhotos(photos.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const mostRecentWorkOrder =\r\n    workOrders && workOrders.length > 0\r\n      ? workOrders.reduce((latest, current) => {\r\n          const latestDate = new Date(latest.date);\r\n          const currentDate = new Date(current.date);\r\n          return currentDate > latestDate ? current : latest;\r\n        }, workOrders[0])\r\n      : {};\r\n\r\n  const capturePhoto = () => {\r\n    const video = document.querySelector(\"video\");\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n    const context = canvas.getContext(\"2d\");\r\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    canvas.toBlob((blob) => {\r\n      setCapturedPhoto(blob);\r\n    }, \"image/png\");\r\n  };\r\n\r\n  const handleShowInfoModal = async () => {\r\n    const db = firebase.firestore();\r\n    try {\r\n      const doc = await db.collection(\"Test\").doc(id).get();\r\n      if (doc.exists) {\r\n        const data = doc.data();\r\n        setItemName(data.name || \"N/A\");\r\n        setShowInfoModal(true);\r\n      } else {\r\n        console.error(\"Item not found\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching item info:\", error);\r\n    }\r\n  };\r\n\r\n  const handleCloseInfoModal = () => setShowInfoModal(false);\n  const handleCloneToNewItem = () => {\n    if (!id) {\n      setErr(\"Item ID not ready yet.\");\n      setShowErr(true);\n      return;\n    }\n    router.push(`/NewSearch/AddItem/NewItem?cloneFrom=${encodeURIComponent(id)}`);\n  };\n\r\n  const handlePnChange = (index, value) => {\r\n    setItems((prev) => {\r\n      const newPn = [...prev.pn];\r\n      newPn[index] = value;\r\n      return { ...prev, pn: newPn };\r\n    });\r\n  };\r\n\r\n  const addPn = () => {\r\n    setItems((prev) => ({\r\n      ...prev,\r\n      pn: [...prev.pn, \"\"],\r\n    }));\r\n  };\r\n\r\n  const handleSnChange = (index, value) => {\r\n    setItems((prev) => {\r\n      const newSn = [...prev.sn];\r\n      newSn[index] = value;\r\n      return { ...prev, sn: newSn };\r\n    });\r\n  };\r\n\r\n  const addSn = () => {\r\n    setItems((prev) => ({\r\n      ...prev,\r\n      sn: [...prev.sn, \"\"],\r\n    }));\r\n  };\r\n\r\n  const browseInputRef = useRef(null);\r\n\r\n  const handleBrowsePhotos = () => {\r\n    if (browseInputRef.current) {\r\n      browseInputRef.current.click();\r\n    }\r\n  };\r\n\r\n  const handleFilesSelected = (e) => {\r\n    const files = e.target.files;\r\n    if (files.length) {\r\n      const newPhotos = [];\r\n      for (let i = 0; i < files.length; i++) {\r\n        newPhotos.push({\r\n          file: files[i],\r\n          url: URL.createObjectURL(files[i]),\r\n        });\r\n      }\r\n      setPhotos((prevPhotos) => [...prevPhotos, ...newPhotos]);\r\n    }\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  const [currentPnIndex, setCurrentPnIndex] = useState(0);\n  const [showDropdown, setShowDropdown] = useState(false);\n  const [currentSnIndex, setCurrentSnIndex] = useState(0);\n  const [showSnDropdown, setShowSnDropdown] = useState(false);\n\n  useEffect(() => {\n    if (showDropdown || showSnDropdown) {\n      loadPnSnOptions();\n    }\n  }, [showDropdown, showSnDropdown]);\n\r\n  const handleAddNewClient = () => {\r\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\r\n    router.push(\r\n      `../client/AIS${randomNum}/addClient?from=item&itemId=${id || \"\"}`\r\n    );\r\n  };\r\n\r\n  const handleBluefolderButton = async () => {\r\n    // Check that the work order field is filled out (using workOrders[0].workOrder as current)\r\n    const currentWorkOrder =\r\n      workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\";\r\n    if (!currentWorkOrder) {\r\n      alert(\r\n        \"Please fill out the work order field before adding to BlueFolder.\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Build the payload to send to your proxy endpoint.\r\n    const payload = {\r\n      name: items.name,\r\n      pn: items.pn[0] || \"\",\r\n      sn: items.sn[0] || \"\",\r\n      status: items.status,\r\n      description: descriptions[selectedDesc]?.description || \"\",\r\n      workOrder: currentWorkOrder,\r\n      localsn: items.localSN || \"\",\r\n    };\r\n\r\n    try {\r\n      // Replace with your ngrok URL and appropriate endpoint path (e.g., /api/bluefolder)\r\n      const response = await fetch(\r\n        \"https://9d70-174-76-22-138.ngrok-free.app/bluefolder\",\r\n        {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(payload),\r\n        }\r\n      );\r\n      const result = await response.json();\r\n      alert(\"BlueFolder service item added successfully!\");\r\n      console.log(\"BlueFolder result:\", result);\r\n    } catch (error) {\r\n      console.error(\"BlueFolder error:\", error);\r\n      alert(\"Error adding data to BlueFolder.\");\r\n    }\r\n  };\r\n\r\n// // Slack integration handler.\r\n// const handleAddToSlack = async (which) => {\r\n//   try {\r\n//     const pn0 = Array.isArray(items.pn) ? items.pn[0] : items.pn;\r\n//     const sn0 = Array.isArray(items.sn) ? items.sn[0] : items.sn;\r\n\r\n//     const linkUrl = typeof window !== \"undefined\" ? window.location.href : \"\";\r\n//     const safeName = (items?.name || id || \"Untitled\").trim();\r\n//     const title = `${safeName}${id ? ` (${id})` : \"\"}`;\r\n\r\n//     console.log(\"[SLACK][handleAddToSlack] which:\", which);\r\n//     console.log(\"[SLACK] title:\", title);\r\n//     console.log(\"[SLACK] PN:\", items.pn, \"SN:\", items.sn);\r\n\r\n//     const resp = await fetch(\"/api/slack/add-to-list\", {\r\n//       method: \"POST\",\r\n//       headers: { \"Content-Type\": \"application/json\" },\r\n//       body: JSON.stringify({\r\n//         listKey: which,      // \"shipping\" | \"receiving\" | \"tasks\"\r\n//         title,\r\n//         pn: items.pn,\r\n//         sn: items.sn,\r\n//         // keeping it minimal by design while we stabilize PN/SN\r\n//         linkUrl,\r\n//       }),\r\n//     });\r\n// Slack integration handler (drop-in replacement)\r\n// Slack integration handler (drop-in replacement)\r\n\r\n\r\n// Slack integration handler (client) — replace your existing handleAddToSlack with this\r\nconst handleAddToSlack = async (which = \"shipping\") => {\r\n  try {\r\n    const safeName = (items?.name || id || \"Untitled\").trim();\r\n    const title = `${safeName}${id ? ` (${id})` : \"\"}`;\r\n\r\n    const pn0 = Array.isArray(items?.pn) ? items.pn[0] : items?.pn;\r\n    const sn0 = Array.isArray(items?.sn) ? items.sn[0] : items?.sn;\r\n    const pn_sn = [pn0 && `PN: ${pn0}`, sn0 && `SN: ${sn0}`]\r\n      .filter(Boolean)\r\n      .join(\"  \");\r\n\r\n    const mostRecentWO =\r\n      (workOrders && workOrders.length)\r\n        ? [...workOrders].sort((a,b) => new Date(b?.date||0) - new Date(a?.date||0))[0]?.workOrder\r\n        : \"\";\r\n\r\n    const description =\r\n      (selectedDesc != null && descriptions?.[selectedDesc])\r\n        ? (descriptions[selectedDesc].description || \"\")\r\n        : (items?.description || \"\");\r\n\r\n    const tracking = items?.trackingNumber ?? items?.tracking ?? \"\";\r\n    const local_sn = id || items?.localSN || \"\";\r\n\r\n    const photoUrls = Array.isArray(photos)\r\n      ? photos.map(p => p?.url).filter(Boolean)\r\n      : [];\r\n\r\n    const resp = await fetch(\"/api/slack/add-to-list\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        listKey: which,\r\n        title,\r\n        pn_sn,                 // <— server expects this\r\n        work_order: mostRecentWO || \"\",\r\n        local_sn,\r\n        tracking,\r\n        description: (description || \"\").trim(),\r\n        photoUrls,             // array of https URLs\r\n      }),\r\n    });\r\n\r\n    const json = await resp.json();\r\n    console.log(\"[SLACK][handleAddToSlack] response:\", json);\r\n    if (json?.debug?.steps) console.table(json.debug.steps);\r\n    if (json?.debug?.photos) console.table(json.debug.photos);\r\n\r\n    if (!resp.ok || !json?.ok) {\r\n      setErr(`Slack add failed: ${json?.error || \"unknown error\"}`);\r\n      setShowErr(true);\r\n      return;\r\n    }\r\n\r\n    alert(\r\n      `Added to Slack ${which === \"shipping\" ? \"Shipping\" : which === \"receiving\" ? \"Receiving\" : \"Tasks\"} list.`\r\n    );\r\n  } catch (e) {\r\n    console.error(e);\r\n    setErr(\"Error adding to Slack\");\r\n    setShowErr(true);\r\n  }\r\n};\r\n\r\n\r\n  return (\n    <LoggedIn>\n      {isLoading && (\n        <div className={styles.loadingOverlay}>\n          <img\n            src=\"/magmo-logo.png\"\n            alt=\"Loading Magmo\"\n            className={styles.loadingLogo}\n          />\n        </div>\n      )}\n      <div>\n        <Modal show={show} onHide={handleClose}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Error</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>Missing field</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleClose}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n        <Modal show={showErr} onHide={handleCloseErr}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Error</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>{Err}</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleCloseErr}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n        <Modal show={showSaveModal} onHide={handleCloseSaveModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Save Confirmation</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>Data has been saved successfully.</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleCloseSaveModal}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n        <Modal show={showPrintModal} onHide={handleClosePrintModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Print Confirmation</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>Info has been sent to print.</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleClosePrintModal}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n\r\n        <Modal show={showDescModal} onHide={handleCloseDescModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Descriptions</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Button variant=\"primary\" className=\"mb-3\" onClick={addDescription}>\r\n              Add Description\r\n            </Button>\r\n            {descriptions.map((desc, index) => (\r\n              <Row key={index} className=\"mb-3\">\r\n                <Button\r\n                  variant=\"outline-secondary\"\r\n                  className=\"w-100\"\r\n                  onClick={() => selectDescription(index)}\r\n                  style={{ cursor: \"pointer\" }}\r\n                >\r\n                  <div className=\"d-flex justify-content-between\">\r\n                    <span>{desc.description || \"Description\"}</span>\r\n                    <span\r\n                      style={{\r\n                        borderLeft: \"1px solid #ccc\",\r\n                        paddingLeft: \"10px\",\r\n                      }}\r\n                    >\r\n                      {desc.date || \"Date\"}\r\n                    </span>\r\n                  </div>\r\n                </Button>\r\n              </Row>\r\n            ))}\r\n            <Button variant=\"primary\" onClick={handleCloseDescModal}>\r\n              OK\r\n            </Button>\r\n          </Modal.Body>\r\n        </Modal>\r\n\r\n        <Modal show={showWoModal} onHide={handleCloseWoModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Work Orders</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Button\r\n              variant=\"primary\"\r\n              className=\"mb-3\"\r\n              onClick={addWorkOrder}\r\n              style={{ marginBottom: \"1rem\" }}\r\n            >\r\n              Add Work Order\r\n            </Button>\r\n            {workOrders.map((wo, index) => (\r\n              <Row key={index} className=\"mb-3\">\r\n                <Col>\r\n                  <Form.Control\r\n                    type=\"text\"\r\n                    placeholder=\"Work Order\"\r\n                    value={wo.workOrder}\r\n                    onChange={(e) =>\r\n                      handleWorkOrderChange(index, \"workOrder\", e.target.value)\r\n                    }\r\n                    style={{ marginBottom: \"0.5rem\" }}\r\n                  />\r\n                </Col>\r\n                <Col>\r\n                  <Form.Control\r\n                    type=\"date\"\r\n                    placeholder=\"Date\"\r\n                    value={wo.date}\r\n                    onChange={(e) =>\r\n                      handleWorkOrderChange(index, \"date\", e.target.value)\r\n                    }\r\n                  />\r\n                </Col>\r\n                <Col>\r\n                  <Button\r\n                    variant=\"danger\"\r\n                    onClick={() => removeWorkOrder(index)}\r\n                  >\r\n                    Remove\r\n                  </Button>\r\n                </Col>\r\n              </Row>\r\n            ))}\r\n            <Button variant=\"primary\" onClick={handleCloseWoModal}>\r\n              OK\r\n            </Button>\r\n          </Modal.Body>\r\n        </Modal>\r\n\r\n        <ClientInfoModal\r\n          show={showMachineModal}\r\n          handleClose={handleCloseMachineModal}\r\n          selectedClient={selectedClient}\r\n          machineOptions={machineOptions}\r\n          setSelectedMachine={handleSetSelectedMachine}\r\n        />\r\n\r\n        <Modal show={showClientModal} onHide={handleCloseClientModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Select Client</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <FormControl\r\n              type=\"text\"\r\n              placeholder=\"Search by name\"\r\n              className=\"mb-3\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n            />\r\n            <ClientTable\r\n              clients={clients.filter((client) =>\r\n                (client.name || \"\").toLowerCase().includes(search.toLowerCase())\r\n              )}\r\n              onSelectClient={handleClientInfo}\r\n              onInfoClick={handleClientInfo}\r\n              clearSelection={() => handleClientInfo(null)}\r\n              onAddClient={handleAddNewClient}\r\n            />\r\n          </Modal.Body>\r\n        </Modal>\r\n\r\n        <ParentModal\r\n          show={showParentModal}\r\n          handleClose={handleCloseParentModal}\r\n          setSelectedParent={setSelectedParent}\r\n        />\r\n\r\n        <MachineSelectionModal\r\n          show={machineSelectionModal}\r\n          handleClose={() => setMachineSelectionModal(false)}\r\n          setMachine={setTheMachine}\r\n        />\r\n\r\n        <Modal show={showCameraModal} onHide={handleCloseCameraModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Take a Photo</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <div className=\"camera\">\r\n              {!capturedPhoto && (\r\n                <BarcodeScannerComponent\r\n                  width=\"100%\"\r\n                  height={300}\r\n                  onUpdate={handleCapture}\r\n                  facingMode={cameraFacing}\r\n                />\r\n              )}\r\n              {capturedPhoto && (\r\n                <div className=\"photo-preview\">\r\n                  <img\r\n                    src={URL.createObjectURL(capturedPhoto)}\r\n                    alt=\"captured\"\r\n                    style={{ width: \"100%\" }}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            {!capturedPhoto ? (\r\n              <>\r\n                <Button\r\n                  onClick={capturePhoto}\r\n                  style={{\r\n                    borderRadius: \"50%\",\r\n                    width: \"60px\",\r\n                    height: \"60px\",\r\n                    position: \"absolute\",\r\n                    left: \"50%\",\r\n                    transform: \"translateX(-50%)\",\r\n                    bottom: \"10px\",\r\n                  }}\r\n                >\r\n                  📷\r\n                </Button>\r\n                <Button\r\n                  onClick={() =>\r\n                    setCameraFacing((prev) =>\r\n                      prev === \"environment\" ? \"user\" : \"environment\"\r\n                    )\r\n                  }\r\n                >\r\n                  Flip Camera\r\n                </Button>\r\n                <Button variant=\"secondary\" onClick={handleCloseCameraModal}>\r\n                  Cancel\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  onClick={() => setCapturedPhoto(null)}\r\n                >\r\n                  Retake\r\n                </Button>\r\n                <Button variant=\"primary\" onClick={savePhoto}>\r\n                  OK\r\n                </Button>\r\n              </>\r\n            )}\r\n          </Modal.Footer>\r\n        </Modal>\r\n\r\n        <InfoModal\r\n          show={showInfoModal}\r\n          handleClose={handleCloseInfoModal}\r\n          itemName={items.name}\r\n          dimensions={items.length + \",\" + items.width + \",\" + items.height}\r\n          price={items.price}\r\n          freqI={freqItem}\r\n          freqM={machineFrequency}\r\n          usage={usagePastYear}\r\n        />\r\n\r\n        <Container fluid className={styles.page}>\n          <div className={styles.shell}>\n            <Card className={styles.card}>\n              <Card.Body className={styles.cardBody}>\n                <div className={styles.header}>\n                  <div className={styles.kicker}>Item</div>\n                  <h2 className={styles.title}>Item Details</h2>\n                  <div className={styles.subtitle}>\n                    Review and update fields, photos, and routing information.\n                  </div>\n                </div>\n                <Form onSubmit={handleSubmit}>\n                  {/* Row for Name and PN */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <Form.Group controlId=\"name\">\r\n                        <Form.Label>Name</Form.Label>\r\n                        <Form.Control\r\n                          type=\"text\"\r\n                          value={items.name}\r\n                          onChange={handleChange(\"name\")}\r\n                        />\r\n                      </Form.Group>\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Group controlId=\"pn\">\r\n                        <Form.Label>Product Number</Form.Label>\r\n                        <div style={{ position: \"relative\" }}>\r\n                          <InputGroup>\r\n                            <Form.Control\r\n                              type=\"text\"\r\n                              value={items.pn[currentPnIndex] || \"\"}\r\n                              onChange={(e) =>\r\n                                handlePnChange(currentPnIndex, e.target.value)\r\n                              }\r\n                            />\r\n                            <Button\r\n                              variant=\"outline-secondary\"\r\n                              onClick={() => setShowDropdown(!showDropdown)}\r\n                            >\r\n                              &#9662;\r\n                            </Button>\r\n                            <InputGroup.Text>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setAddingNewPn(true)}\r\n                              >\r\n                                +\r\n                              </Button>\r\n                            </InputGroup.Text>\r\n                          </InputGroup>\r\n                          {showDropdown && (\r\n                            <div\r\n                              style={{\r\n                                position: \"absolute\",\r\n                                top: \"100%\",\r\n                                left: 0,\r\n                                right: 0,\r\n                                backgroundColor: \"white\",\r\n                                border: \"1px solid #ccc\",\r\n                                zIndex: 1000,\r\n                                maxHeight: \"150px\",\r\n                                overflowY: \"auto\",\r\n                              }}\r\n                            >\r\n                              {pnOptions.map((pnOption, idx) => (\r\n                                <div\r\n                                  key={idx}\r\n                                  style={{ padding: \"8px\", cursor: \"pointer\" }}\r\n                                  onClick={() => {\r\n                                    setCurrentPnIndex(idx);\r\n                                    setShowDropdown(false);\r\n                                  }}\r\n                                >\r\n                                  {pnOption}\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {addingNewPn && (\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Enter new PN\"\r\n                            value={newPn}\r\n                            onChange={(e) => setNewPn(e.target.value)}\r\n                            onBlur={handleAddNewPn}\r\n                            onKeyDown={(e) =>\r\n                              e.key === \"Enter\" && handleAddNewPn()\r\n                            }\r\n                          />\r\n                        )}\r\n                      </Form.Group>\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Row for SN and Status */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <Form.Group controlId=\"sn\">\r\n                        <Form.Label>Serial Number</Form.Label>\r\n                        <div style={{ position: \"relative\" }}>\r\n                          <InputGroup>\r\n                            <Form.Control\r\n                              type=\"text\"\r\n                              value={items.sn[currentSnIndex] || \"\"}\r\n                              onChange={(e) =>\r\n                                handleSnChange(currentSnIndex, e.target.value)\r\n                              }\r\n                            />\r\n                            <Button\r\n                              variant=\"outline-secondary\"\r\n                              onClick={() => setShowSnDropdown(!showSnDropdown)}\r\n                            >\r\n                              &#9662;\r\n                            </Button>\r\n                            <InputGroup.Text>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setAddingNewSn(true)}\r\n                              >\r\n                                +\r\n                              </Button>\r\n                            </InputGroup.Text>\r\n                          </InputGroup>\r\n                          {showSnDropdown && (\r\n                            <div\r\n                              style={{\r\n                                position: \"absolute\",\r\n                                top: \"100%\",\r\n                                left: 0,\r\n                                right: 0,\r\n                                backgroundColor: \"white\",\r\n                                border: \"1px solid #ccc\",\r\n                                zIndex: 1000,\r\n                                maxHeight: \"150px\",\r\n                                overflowY: \"auto\",\r\n                              }}\r\n                            >\r\n                              {snOptions.map((snOption, idx) => (\r\n                                <div\r\n                                  key={idx}\r\n                                  style={{ padding: \"8px\", cursor: \"pointer\" }}\r\n                                  onClick={() => {\r\n                                    setCurrentSnIndex(idx);\r\n                                    setShowSnDropdown(false);\r\n                                  }}\r\n                                >\r\n                                  {snOption}\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {addingNewSn && (\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Enter new SN\"\r\n                            value={newSn}\r\n                            onChange={(e) => setNewSn(e.target.value)}\r\n                            onBlur={handleAddNewSn}\r\n                            onKeyDown={(e) =>\r\n                              e.key === \"Enter\" && handleAddNewSn()\r\n                            }\r\n                          />\r\n                        )}\r\n                      </Form.Group>\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Group controlId=\"status\">\r\n                        <Form.Label>Status</Form.Label>\r\n                        <Form.Select\r\n                          value={items.status || \"\"}\r\n                          onChange={handleChange(\"status\")}\r\n                        >\r\n                          <option value=\"\">Select status</option>\r\n                          <option value=\"Good\">Good</option>\r\n                          <option value=\"Bad\">Bad</option>\r\n                          <option value=\"Unknown\">Unknown</option>\r\n                        </Form.Select>\r\n                      </Form.Group>\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Row for Local SN, Arrival Date, Tracking */}\n                  <Row className=\"mb-3\">\n                    <Col>\n                      <Form.Group controlId=\"localSN\">\n                        <Form.Label>Local SN</Form.Label>\n                        <Form.Control\n                          type=\"text\"\n                          placeholder=\"Enter Local SN\"\n                          value={items.localSN || \"\"}\n                          onChange={handleChange(\"localSN\")}\n                        />\n                      </Form.Group>\n                    </Col>\n                    <Col>\n                      <Form.Group controlId=\"arrivalDate\">\n                        <Form.Label>Arrival Date</Form.Label>\n                        <Form.Control\n                          placeholder=\"Enter Arrival Date\"\n                          type=\"date\"\n                          value={items.arrival_date}\n                          onChange={(e) => {\n                            const value = e.target.value;\n                            setItems((prev) => ({\n                              ...prev,\n                              arrival_date: value,\n                            }));\n                          }}\n                        />\n                      </Form.Group>\n                    </Col>\n                    <Col>\n                      <Form.Group controlId=\"trackingNumber\">\n                        <Form.Label>Tracking Number</Form.Label>\n                        <Form.Control\n                          placeholder=\"Tracking Number\"\n                          type=\"text\"\n                          value={items.trackingNumber}\n                          onChange={handleChange(\"trackingNumber\")}\n                        />\n                      </Form.Group>\n                    </Col>\n                  </Row>\n                  {/* Row for OEM, Modality, Model */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <Form.Label>OEM</Form.Label>\r\n                      <Form.Control\r\n                        type=\"text\"\r\n                        placeholder=\"OEM\"\r\n                        value={oem}\r\n                        onChange={(e) => setOem(e.target.value)}\r\n                      />\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Label>Modality</Form.Label>\r\n                      <Form.Control\r\n                        type=\"text\"\r\n                        placeholder=\"Modality\"\r\n                        value={modality}\r\n                        onChange={(e) => setModality(e.target.value)}\r\n                      />\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Label>Model</Form.Label>\r\n                      <Form.Control\r\n                        type=\"text\"\r\n                        placeholder=\"Model\"\r\n                        value={model}\r\n                        onChange={(e) => setModel(e.target.value)}\r\n                      />\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Work Orders and Inline Description Section */}\r\n                  <div style={{ marginBottom: \"1rem\", marginTop: \"1rem\" }}>\r\n                    <div className=\"d-flex align-items-center\">\r\n                      <Button\r\n                        variant=\"outline-secondary\"\r\n                        onClick={handleShowWoModal}\r\n                        className=\"me-2\"\r\n                      >\r\n                        Manage Work Orders\r\n                      </Button>\r\n                      {workOrders.length > 0 && (\r\n                        <div className=\"d-flex flex-column align-items-start\">\r\n                          <Form.Label>Work Order</Form.Label>\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Most Recent Work Order\"\r\n                            value={mostRecentWorkOrder.workOrder}\r\n                            onChange={(e) =>\r\n                              handleWorkOrderChange(\r\n                                workOrders.indexOf(mostRecentWorkOrder),\r\n                                \"workOrder\",\r\n                                e.target.value\r\n                              )\r\n                            }\r\n                            style={{ marginBottom: \"0.5rem\" }}\r\n                          />\r\n                          <Form.Label>Date</Form.Label>\r\n                          <Form.Control\r\n                            type=\"date\"\r\n                            placeholder=\"Work Order Date\"\r\n                            value={mostRecentWorkOrder.date}\r\n                            onChange={(e) =>\r\n                              handleWorkOrderChange(\r\n                                workOrders.indexOf(mostRecentWorkOrder),\r\n                                \"date\",\r\n                                e.target.value\r\n                              )\r\n                            }\r\n                            style={{ marginBottom: \"0.5rem\" }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div style={{ marginBottom: \"1rem\" }}>\r\n                      <Form.Group controlId=\"desc\">\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={listDescriptions}\r\n                          className=\"mb-2 me-2\"\r\n                        >\r\n                          List Descriptions\r\n                        </Button>\r\n                        <Form.Control\r\n                          as=\"textarea\"\r\n                          rows={3}\r\n                          placeholder=\"Enter description\"\r\n                          value={descriptions[selectedDesc]?.description || \"\"}\r\n                          onChange={(e) =>\r\n                            handleDescriptionChange(\r\n                              selectedDesc,\r\n                              \"description\",\r\n                              e.target.value\r\n                            )\r\n                          }\r\n                          style={{ marginBottom: \"0.5rem\" }}\r\n                        />\r\n                        <Form.Control\r\n                          type=\"date\"\r\n                          value={descriptions[selectedDesc]?.date || \"\"}\r\n                          onChange={(e) =>\r\n                            handleDescriptionChange(\r\n                              selectedDesc,\r\n                              \"date\",\r\n                              e.target.value\r\n                            )\r\n                          }\r\n                          style={{\r\n                            marginTop: \"0.5rem\",\r\n                            marginBottom: \"0.5rem\",\r\n                          }}\r\n                        />\r\n                      </Form.Group>\r\n                    </div>\r\n                  </div>\r\n                  {/* Machine Selection Row */}\r\n                  <div style={{ marginBottom: \"1rem\" }}>\r\n                    <Row className=\"mb-3\">\r\n                      <Col>\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={() => {\r\n                            setMachinePick(true);\r\n                            handleShowClientModal();\r\n                          }}\r\n                          className=\"me-2\"\r\n                        >\r\n                          Select From\r\n                        </Button>\r\n                        {selectedClientFrom && (\r\n                          <div\r\n                            style={{\r\n                              border: \"1px solid #ccc\",\r\n                              padding: \"0.75rem\",\r\n                              borderRadius: \"4px\",\r\n                              marginBottom: \"1rem\",\r\n                            }}\r\n                          >\r\n                            <p>\r\n                              <strong>Selected Client (From):</strong>{\" \"}\r\n                              {selectedClientFrom.name}\r\n                            </p>\r\n                            <div style={{ marginTop: \"0.5rem\" }}>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setShowMachineModal(true)}\r\n                              >\r\n                                Select Machine for {selectedClientFrom.name}\r\n                              </Button>\r\n                              {selectedMachine && (\r\n                                <>\r\n                                  <p style={{ marginTop: \"0.5rem\" }}>\r\n                                    <strong>Selected Machine (From):</strong>{\" \"}\r\n                                    {selectedMachine.name}\r\n                                  </p>\r\n                                  {showLocalLocFrom && (\r\n                                    <>\r\n                                      <Button\r\n                                        variant=\"outline-secondary\"\r\n                                        onClick={() =>\r\n                                          setShowNewLocalModalFrom(true)\r\n                                        }\r\n                                        className=\"w-100 mb-2\"\r\n                                      >\r\n                                        {/* build a little helper inline: region-section-bin-pallet */}\r\n                                        {[\r\n                                          newLocalFrom.region,\r\n                                          newLocalFrom.section?.letter +\r\n                                            newLocalFrom.section?.number,\r\n                                          newLocalFrom.bin &&\r\n                                            `B${newLocalFrom.bin}`,\r\n                                          newLocalFrom.pallet &&\r\n                                            `P${newLocalFrom.pallet}`,\r\n                                        ]\r\n                                          .filter(Boolean)\r\n                                          .join(\"-\")}\r\n                                        {/* e.g. “E-A7-B3-P2” */}\r\n                                      </Button>\r\n\r\n                                      <Modal\r\n                                        show={showNewLocalModalFrom}\r\n                                        onHide={() =>\r\n                                          setShowNewLocalModalFrom(false)\r\n                                        }\r\n                                        centered\r\n                                      >\r\n                                        <Modal.Header>\r\n                                          <Modal.Title>\r\n                                            Edit Local Loc (From)\r\n                                          </Modal.Title>\r\n                                        </Modal.Header>\r\n                                        <Modal.Body>\r\n                                          <NewLocal\r\n                                            selectedClient={selectedClientFrom}\r\n                                            showLocalLoc={showNewLocalModalFrom}\r\n                                            value={newLocalFrom}\r\n                                            onChange={setNewLocalFrom}\r\n                                            onSave={(p) => {\r\n                                              setNewLocalFrom(p);\r\n                                              setShowNewLocalModalFrom(false);\r\n                                            }}\r\n                                            onCancel={() =>\r\n                                              setShowNewLocalModalFrom(false)\r\n                                            }\r\n                                          />\r\n                                        </Modal.Body>\r\n                                        {/* <Modal.Footer>\r\n                                          <Button\r\n                                            variant=\"secondary\"\r\n                                            onClick={() => setShowNewLocalModalFrom(false)}\r\n                                          >\r\n                                            Close\r\n                                          </Button>\r\n                                        </Modal.Footer> */}\r\n                                      </Modal>\r\n                                    </>\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </Col>\r\n                      <Col>\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={() => {\r\n                            setMachinePick(false);\r\n                            handleShowClientModal();\r\n                          }}\r\n                          className=\"me-2\"\r\n                        >\r\n                          Select Current\r\n                        </Button>\r\n                        {selectedClientCurrent && (\r\n                          <div\r\n                            style={{\r\n                              border: \"1px solid #ccc\",\r\n                              padding: \"0.75rem\",\r\n                              borderRadius: \"4px\",\r\n                              marginBottom: \"1rem\",\r\n                            }}\r\n                          >\r\n                            <p>\r\n                              <strong>Selected Client (Current):</strong>{\" \"}\r\n                              {selectedClientCurrent.name}\r\n                            </p>\r\n                            <div style={{ marginTop: \"0.5rem\" }}>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setShowMachineModal(true)}\r\n                              >\r\n                                Select Machine for {selectedClientCurrent.name}\r\n                              </Button>\r\n                              {selectedCurrentMachine && (\r\n                                <>\r\n                                  <p style={{ marginTop: \"0.5rem\" }}>\r\n                                    <strong>Selected Machine (Current):</strong>{\" \"}\r\n                                    {selectedCurrentMachine.name}\r\n                                  </p>\r\n                                  {showLocalLocCurrent && (\r\n                                    <>\r\n                                      <Button\r\n                                        variant=\"outline-secondary\"\r\n                                        onClick={() =>\r\n                                          setShowNewLocalModalCurrent(true)\r\n                                        }\r\n                                        className=\"w-100 mb-2\"\r\n                                      >\r\n                                        {[\r\n                                          newLocalCurrent.region,\r\n                                          newLocalCurrent.section?.letter +\r\n                                            newLocalCurrent.section?.number,\r\n                                          newLocalCurrent.bin &&\r\n                                            `B${newLocalCurrent.bin}`,\r\n                                          newLocalCurrent.pallet &&\r\n                                            `P${newLocalCurrent.pallet}`,\r\n                                        ]\r\n                                          .filter(Boolean)\r\n                                          .join(\"-\")}\r\n                                      </Button>\r\n                                      <Modal\r\n                                        show={showNewLocalModalCurrent}\r\n                                        onHide={() =>\r\n                                          setShowNewLocalModalCurrent(false)\r\n                                        }\r\n                                        centered\r\n                                      >\r\n                                        <Modal.Header>\r\n                                          <Modal.Title>\r\n                                            Edit Local Loc (Current)\r\n                                          </Modal.Title>\r\n                                        </Modal.Header>\r\n                                        <Modal.Body>\r\n                                          <NewLocal\r\n                                            selectedClient={\r\n                                              selectedClientCurrent\r\n                                            }\r\n                                            showLocalLoc={\r\n                                              showNewLocalModalCurrent\r\n                                            }\r\n                                            value={newLocalCurrent}\r\n                                            onChange={setNewLocalCurrent}\r\n                                            onSave={(p) => {\r\n                                              setNewLocalCurrent(p);\r\n                                              setShowNewLocalModalCurrent(\r\n                                                false\r\n                                              );\r\n                                            }}\r\n                                            onCancel={() =>\r\n                                              setShowNewLocalModalCurrent(false)\r\n                                            }\r\n                                          />\r\n                                        </Modal.Body>\r\n                                        {/* <Modal.Footer>\r\n                                          <Button\r\n                                            variant=\"secondary\"\r\n                                            onClick={() => setShowNewLocalModalCurrent(false)}\r\n                                          >\r\n                                            Close\r\n                                          </Button>\r\n                                        </Modal.Footer> */}\r\n                                      </Modal>\r\n                                    </>\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </Col>\r\n                      <Col>\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={handleShowParentModal}\r\n                          className=\"me-2\"\r\n                        >\r\n                          Select Parent\r\n                        </Button>\r\n                        {selectedParent && (\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Selected Parent\"\r\n                            value={selectedParent.name}\r\n                            readOnly\r\n                            style={{ marginTop: \"0.5rem\" }}\r\n                          />\r\n                        )}\r\n                      </Col>\r\n                    </Row>\r\n                  </div>\r\n                  {/* Photo and Website Options */}\r\n                  <div style={{ marginBottom: \"1rem\" }}>\n                    <Row className={`mb-3 ${styles.photoActionsRow}`}>\n                      <Col xs={12} md={6}>\n                        <ButtonGroup>\n                          <Button\n                            variant=\"outline-secondary\"\n                            onClick={handleShowCameraModal}\n                          >\n                            Take Photo\n                          </Button>\n                          <Button\n                            variant=\"outline-secondary\"\n                            onClick={handleBrowsePhotos}\n                          >\n                            Browse\n                          </Button>\n                        </ButtonGroup>\n                      </Col>\n                      <Col xs={12} md={6} className={styles.photoActionsRight}>\n                        <Button\n                          variant=\"success\"\n                          onClick={handleSendToInflow}\n                          style={{ marginLeft: \"auto\" }}\n                        >\n                          Send to inFlow\n                        </Button>\r\n                        <Button\r\n                          variant=\"secondary\"\r\n                          onClick={handleBluefolderButton}\r\n                          style={{ marginLeft: \"0.5rem\", marginRight: \".5rem\" }}\r\n                        >\r\n                          BlueFolder\r\n                        </Button>\r\n                        \r\n\r\n                        <Button\r\n                          variant={addToWebsite ? \"primary\" : \"outline-primary\"}\r\n                          onClick={() => setAddToWebsite((prev) => !prev)}\r\n                        >\r\n                          {addToWebsite ? \"✓ Add to Website\" : \"Add to Website\"}\r\n                        </Button>\r\n\r\n                        <Form.Check\r\n                          type=\"checkbox\"\r\n                          id=\"hide-checkbox\"\r\n                          label=\"Hide\"\r\n                          // box is checked when we want visible = false\r\n                          checked={!items.visible}\r\n                          onChange={(e) => {\r\n                            // grab checked immediately\r\n                            const isHidden = e.currentTarget.checked;\r\n                            setItems((prev) => ({\r\n                              ...prev,\r\n                              visible: !isHidden,\r\n                            }));\r\n                          }}\r\n                          className=\"ms-3\"\r\n                        />\r\n                      </Col>\r\n                    </Row>\r\n                    <input\r\n                      type=\"file\"\r\n                      accept=\"image/*\"\r\n                      multiple\r\n                      ref={browseInputRef}\r\n                      style={{ display: \"none\" }}\r\n                      onChange={handleFilesSelected}\r\n                    />\r\n                  </div>\r\n                  {/* Photo Gallery */}\r\n                  {photos && photos.length > 0 && (\r\n                    <div\r\n                      className=\"photo-gallery\"\r\n                      style={{\r\n                        display: \"flex\",\r\n                        flexWrap: \"wrap\",\r\n                        gap: \"10px\",\r\n                        marginBottom: \"1rem\",\r\n                      }}\r\n                    >\r\n                      {photos.map((photo, index) => (\r\n                        <div\r\n                          key={index}\r\n                          style={{\r\n                            position: \"relative\",\r\n                            width: \"100px\",\r\n                            height: \"100px\",\r\n                          }}\r\n                        >\r\n                          <img\r\n                            src={photo.url}\r\n                            alt={`Photo ${index + 1}`}\r\n                            style={{\r\n                              width: \"100%\",\r\n                              height: \"100%\",\r\n                              objectFit: \"cover\",\r\n                            }}\r\n                          />\r\n                          {photo.file && (\r\n                            <Button\r\n                              variant=\"danger\"\r\n                              size=\"sm\"\r\n                              style={{\r\n                                position: \"absolute\",\r\n                                top: 0,\r\n                                right: 0,\r\n                                padding: \"0 5px\",\r\n                              }}\r\n                              onClick={() => removePhoto(index)}\r\n                            >\r\n                              x\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                  {/* Action Buttons */}\r\n                  <div className={`mt-3 d-flex flex-wrap align-items-center ${styles.actionRow}`}>\n                    <Button\n                      variant=\"primary\"\n                      type=\"submit\"\n                      style={{ marginRight: \"1rem\" }}\n                    >\n                      Save\n                    </Button>\n                    <Button\n                      variant=\"secondary\"\n                      onClick={handleCloneToNewItem}\n                      style={{ marginRight: \"1rem\" }}\n                    >\n                      Clone\n                    </Button>\n                    <LoadingButton\n                      type=\"primary\"\n                      name=\"Back\"\n                      route=\"NewSearch/mainSearch\"\n                    />\r\n                    {SHOW_SLACK_BUTTONS && (\r\n                      <div style={{ display: \"flex\", flexDirection: \"column\", marginLeft: \".5rem\" }}>\r\n                        <span style={{ fontSize: 12, lineHeight: \"12px\", textAlign: \"center\" }}>Slack</span>\r\n                        <div style={{ display: \"flex\", border: \"1px solid #ced4da\", borderRadius: 6, overflow: \"hidden\" }}>\r\n                          <Button\r\n                            variant=\"outline-primary\"\r\n                            onClick={() => handleAddToSlack(\"receiving\")}\r\n                            style={{ border: \"none\", borderRight: \"1px solid #ced4da\" }}\r\n                          >\r\n                            Receiving\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"outline-primary\"\r\n                            onClick={() => handleAddToSlack(\"shipping\")}\r\n                            style={{ border: \"none\" }}\r\n                          >\r\n                            Shipping\r\n                          </Button>\r\n                          {/* <Button\r\n                            variant=\"outline-primary\"\r\n                            onClick={() => handleAddToSlack(\"tasks\")}\r\n                          >\r\n                            Tasks\r\n                          </Button> */}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                    <Button\r\n                      variant=\"info\"\r\n                      onClick={handlePrint}\r\n                      style={{ marginLeft: \"auto\" }}\r\n                    >\r\n                      Print Label\r\n                    </Button>\r\n                  </div>\r\n                  <div style={{ textAlign: \"center\", margin: \"1rem 0\" }}>\r\n                    <Button\r\n                      variant=\"link\"\r\n                      style={{\r\n                        textDecoration: \"none\",\r\n                        color: \"black\",\r\n                        fontSize: \"24px\",\r\n                      }}\r\n                      onClick={() => setShowExtra(!showExtra)}\r\n                    >\r\n                      ▼\r\n                    </Button>\r\n                  </div>\r\n                  <Collapse in={showExtra}>\n                    <div id=\"extra-collapse\" className=\"mt-3\">\n                      <div className=\"d-flex justify-content-end mb-3\">\n                        <Button variant=\"secondary\" onClick={handleShowInfoModal}>\n                          More Info\n                        </Button>\n                      </div>\n                      <Row>\n                        <Form.Group as={Col} controlId=\"dimensions\">\n                          <Form.Label>Dimensions</Form.Label>\n                          <div\r\n                            style={{ display: \"flex\", alignItems: \"center\" }}\r\n                          >\r\n                            <Form.Control\r\n                              placeholder=\"Length\"\r\n                              type=\"text\"\r\n                              value={items.length}\r\n                              onChange={handleChange(\"length\")}\r\n                            />\r\n                            <span style={{ padding: \"0 5px\" }}>x</span>\r\n                            <Form.Control\r\n                              placeholder=\"Width\"\r\n                              type=\"text\"\r\n                              value={items.width}\r\n                              onChange={handleChange(\"width\")}\r\n                            />\r\n                            <span style={{ padding: \"0 5px\" }}>x</span>\r\n                            <Form.Control\r\n                              placeholder=\"Height\"\r\n                              type=\"text\"\r\n                              value={items.height}\r\n                              onChange={handleChange(\"height\")}\r\n                            />\r\n                          </div>\r\n                        </Form.Group>\r\n                      </Row>\r\n\r\n                      <Row className=\"mt-3\">\r\n                        <Form.Group as={Col} controlId=\"Price\">\r\n                          <Form.Label>Price</Form.Label>\r\n                          <Form.Control\r\n                            placeholder=\"Price\"\r\n                            type=\"text\"\r\n                            value={items.price}\r\n                            onChange={handleChange(\"price\")}\r\n                          />\r\n                        </Form.Group>\r\n                        <Form.Group as={Col} controlId=\"DOM\">\r\n                          <Form.Label>DOM</Form.Label>\r\n                          <Form.Control\r\n                            placeholder=\"Date of Manufacture\"\r\n                            type=\"date\"\r\n                            value={DOM}\r\n                            onChange={(e) => setDOM(e.target.value)}\r\n                          />\r\n                        </Form.Group>\r\n                        <Form.Group as={Col} controlId=\"poNumber\">\r\n                          <Form.Label>PO Number</Form.Label>\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"PO Number\"\r\n                            value={items.poNumber || \"\"}\r\n                            onChange={handleChange(\"poNumber\")}\r\n                          />\r\n                        </Form.Group>\r\n                      </Row></div>\r\n                  </Collapse>\r\n                </Form>\r\n              </Card.Body>\r\n            </Card>\r\n          </div>\r\n        </Container>\r\n      </div>\r\n      {/* Camera Modal */}\r\n      <Modal show={showCameraModal} onHide={handleCloseCameraModal}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Take a Photo</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <div className=\"camera\">\r\n            {!capturedPhoto ? (\r\n              <BarcodeScannerComponent\r\n                width=\"100%\"\r\n                height={300}\r\n                onUpdate={handleCapture}\r\n                facingMode={cameraFacing}\r\n              />\r\n            ) : (\r\n              <div className=\"photo-preview\">\r\n                <img\r\n                  src={URL.createObjectURL(capturedPhoto)}\r\n                  alt=\"captured\"\r\n                  style={{ width: \"100%\" }}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          {!capturedPhoto ? (\r\n            <>\r\n              <Button\r\n                onClick={capturePhoto}\r\n                style={{\r\n                  borderRadius: \"50%\",\r\n                  width: \"60px\",\r\n                  height: \"60px\",\r\n                  position: \"absolute\",\r\n                  left: \"50%\",\r\n                  transform: \"translateX(-50%)\",\r\n                  bottom: \"10px\",\r\n                }}\r\n              >\r\n                📷\r\n              </Button>\r\n              <Button\r\n                onClick={() =>\r\n                  setCameraFacing((prev) =>\r\n                    prev === \"environment\" ? \"user\" : \"environment\"\r\n                  )\r\n                }\r\n              >\r\n                Flip Camera\r\n              </Button>\r\n              <Button variant=\"secondary\" onClick={handleCloseCameraModal}>\r\n                Cancel\r\n              </Button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Button\r\n                variant=\"secondary\"\r\n                onClick={() => setCapturedPhoto(null)}\r\n              >\r\n                Retake\r\n              </Button>\r\n              <Button variant=\"primary\" onClick={savePhoto}>\r\n                OK\r\n              </Button>\r\n            </>\r\n          )}\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </LoggedIn>\r\n  );\r\n}\n\nexport default function DisplayItemPage(props) {\n  const router = useRouter();\n  const idFromRouter = router.query?.id;\n  const key = props?.initialItem?.id || idFromRouter || \"new-item\";\n  return <DisplayItemInner {...props} key={key} />;\n}\n\r\n// Server-side rendering function\r\nexport async function getServerSideProps(context) {\r\n  const { id } = context.params;\r\n\r\n  try {\r\n    const itemDoc = await adminDb.collection(\"Test\").doc(id).get();\r\n    if (!itemDoc.exists) return { notFound: true };\r\n\r\n    const itemData = itemDoc.data();\r\n\r\n    // normalize to arrays for consistent client-side handling\r\n    const pnArray = Array.isArray(itemData.pn)\r\n      ? itemData.pn\r\n      : (itemData.pn ? [itemData.pn] : []);\r\n    const snArray = Array.isArray(itemData.sn)\r\n      ? itemData.sn\r\n      : (itemData.sn ? [itemData.sn] : []);\r\n\r\n    // fetch machineData (optional; you already had this)\r\n    let machineData = {};\r\n    if (itemData.Machine && itemData.Machine.path) {\r\n      try {\r\n        const machineDoc = await adminDb.doc(itemData.Machine.path).get();\r\n        if (machineDoc.exists) {\r\n          machineData = machineDoc.data();\r\n          if (machineData.client && machineData.client.path) {\r\n            const clientDoc = await adminDb.doc(machineData.client.path).get();\r\n            if (clientDoc.exists) machineData.Client = clientDoc.data().name;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Error fetching machine data:\", e);\r\n      }\r\n    }\r\n\r\n    const serializedItem = {\r\n      id,\r\n      name: itemData.name || \"\",\r\n      pn: pnArray,\r\n      sn: snArray,\r\n      price: itemData.price || \"\",\r\n      status: itemData.status || \"\",\r\n      length: itemData.length || \"\",\r\n      width: itemData.width || \"\",\r\n      height: itemData.height || \"\",\r\n      poNumber: itemData.poNumber || \"\",\r\n      trackingNumber: itemData.trackingNumber || \"\",\r\n      localSN: itemData.localSN || \"\",\r\n      arrival_date: itemData.arrival_date || \"\",\r\n      visible: itemData.visible !== undefined ? itemData.visible : true,\r\n\r\n      // add the pieces the UI reads directly\r\n      descriptions: itemData.descriptions || [],\r\n      workOrders: itemData.workOrders || [],\r\n      DOM: itemData.DOM || \"\",\r\n    };\r\n\r\n    return {\r\n      props: {\r\n        initialItem: serializedItem,\r\n        initialMachineData: machineData,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error in getServerSideProps:\", error);\r\n    return { props: { error: \"Failed to load item data\" } };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}