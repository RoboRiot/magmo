{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\OneDrive\\\\Desktop\\\\code\\\\pages\\\\AskMagmo.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Container, Card, Form, Button, Row, Col } from \"react-bootstrap\";\nimport Image from \"next/image\";\nimport { useAuth } from \"../context/AuthUserContext\";\nimport { useRouter } from \"next/router\";\nimport LoggedIn from \"./LoggedIn\";\nexport default function AskMagmo() {\n  const {\n    authUser,\n    loading\n  } = useAuth();\n  const router = useRouter(); // Chat log: [{ role: \"user\" | \"assistant\", text: string }]\n\n  const {\n    0: history,\n    1: setHistory\n  } = useState([]);\n  const {\n    0: question,\n    1: setQuestion\n  } = useState(\"\");\n  const {\n    0: isSending,\n    1: setIsSending\n  } = useState(false);\n  const scrollRef = useRef(null); // Redirect to login if not authenticated\n\n  useEffect(() => {\n    if (!loading && !authUser) {\n      console.log(\"user not logged in, redirecting to /\");\n      router.push(\"/\");\n    }\n  }, [authUser, loading, router]); // Auto-scroll chat to bottom whenever new messages land\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [history]);\n\n  async function handleAsk(e) {\n    e.preventDefault();\n    if (!question.trim() || isSending) return;\n    const userMsg = question.trim(); // 1. Add user question + placeholder assistant bubble\n\n    setHistory(prev => [...prev, {\n      role: \"user\",\n      text: userMsg\n    }, {\n      role: \"assistant\",\n      text: \"Thinking...\"\n    }]); // clear input + set flag\n\n    setQuestion(\"\");\n    setIsSending(true);\n\n    try {\n      // 2. Call our backend route with the question\n      const res = await fetch(\"/api/gpt/AskMagmo\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          question: userMsg\n        })\n      });\n      let answerText = \"\";\n\n      if (res.ok) {\n        const data = await res.json();\n        answerText = data.answer || \"(No answer returned)\";\n      } else {\n        answerText = \"Magmo couldn't get an answer from the manuals.\";\n      } // 3. Replace that \"Thinking...\" bubble with the real answer\n\n\n      setHistory(prev => {\n        const updated = [...prev]; // walk backward, find the last assistant \"Thinking...\"\n\n        for (let i = updated.length - 1; i >= 0; i--) {\n          if (updated[i].role === \"assistant\" && updated[i].text === \"Thinking...\") {\n            updated[i] = {\n              role: \"assistant\",\n              text: answerText\n            };\n            break;\n          }\n        }\n\n        return updated;\n      });\n    } catch (err) {\n      console.error(\"AskMagmo handleAsk error:\", err); // If something blew up, replace \"Thinking...\" with an error message\n\n      setHistory(prev => {\n        const updated = [...prev];\n\n        for (let i = updated.length - 1; i >= 0; i--) {\n          if (updated[i].role === \"assistant\" && updated[i].text === \"Thinking...\") {\n            updated[i] = {\n              role: \"assistant\",\n              text: \"There was an issue reading the service docs. Try again in a moment.\"\n            };\n            break;\n          }\n        }\n\n        return updated;\n      });\n    } finally {\n      setIsSending(false);\n    }\n  } // While auth is resolving, show loading like the rest of your app does\n\n\n  if (loading || !authUser) {\n    return __jsx(Container, {\n      className: \"d-flex align-items-center justify-content-center\",\n      style: {\n        minHeight: \"100vh\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 7\n      }\n    }, __jsx(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }\n    }, \"Loading...\"));\n  }\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, __jsx(Container, {\n    fluid: true,\n    className: \"d-flex align-items-center justify-content-center\",\n    style: {\n      minHeight: \"100vh\",\n      backgroundColor: \"#0f0f10\",\n      color: \"#fff\",\n      paddingTop: \"2rem\",\n      paddingBottom: \"2rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }\n  }, __jsx(Row, {\n    className: \"w-100 justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  }, __jsx(Col, {\n    xs: 12,\n    md: 10,\n    lg: 8,\n    xl: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 11\n    }\n  }, __jsx(Card, {\n    className: \"shadow-lg\",\n    style: {\n      backgroundColor: \"#1a1a1d\",\n      border: \"1px solid #2d2d32\",\n      borderRadius: \"16px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }\n  }, __jsx(Card.Body, {\n    style: {\n      padding: \"2rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: \"text-center mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      marginBottom: \"0.75rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 19\n    }\n  }, __jsx(Image, {\n    src: \"/magmo.png\",\n    alt: \"Magmo\",\n    width: 160,\n    height: 60,\n    style: {\n      objectFit: \"contain\",\n      filter: \"drop-shadow(0 4px 8px rgba(0,0,0,0.7))\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 21\n    }\n  }))), __jsx(Form, {\n    onSubmit: handleAsk,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"magmoQuestion\",\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 19\n    }\n  }, __jsx(Form.Label, {\n    style: {\n      fontSize: \"0.8rem\",\n      fontWeight: 500,\n      color: \"#9ca3af\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 21\n    }\n  }, \"Ask a question\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 2,\n    placeholder: `Example: \"Table won't home on HDxt. What's step one?\"`,\n    value: question,\n    onChange: e => setQuestion(e.target.value),\n    style: {\n      backgroundColor: \"#0f0f10\",\n      borderColor: \"#3a3a41\",\n      color: \"#fff\",\n      fontSize: \"0.9rem\",\n      borderRadius: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 21\n    }\n  })), __jsx(\"div\", {\n    className: \"d-flex justify-content-end mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    type: \"submit\",\n    disabled: isSending || !question.trim(),\n    style: {\n      backgroundColor: \"#4f46e5\",\n      borderColor: \"#4f46e5\",\n      fontSize: \"0.9rem\",\n      fontWeight: 600,\n      borderRadius: \"10px\",\n      padding: \"0.5rem 1rem\",\n      boxShadow: \"0 10px 24px rgba(79,70,229,0.4), 0 2px 4px rgba(0,0,0,0.6)\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 21\n    }\n  }, isSending ? \"Asking...\" : \"Ask Magmo\"))), __jsx(\"div\", {\n    style: {\n      border: \"1px solid #2d2d32\",\n      backgroundColor: \"#0f0f10\",\n      borderRadius: \"12px\",\n      maxHeight: \"300px\",\n      minHeight: \"200px\",\n      overflowY: \"auto\",\n      padding: \"1rem\"\n    },\n    ref: scrollRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 17\n    }\n  }, history.length === 0 ? __jsx(\"div\", {\n    style: {\n      color: \"#6b7280\",\n      fontSize: \"0.85rem\",\n      textAlign: \"center\",\n      paddingTop: \"2rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 21\n    }\n  }, \"Ask a question to get started.\") : history.map((msg, idx) => __jsx(\"div\", {\n    key: idx,\n    style: {\n      marginBottom: \"1rem\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: msg.role === \"user\" ? \"flex-end\" : \"flex-start\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 23\n    }\n  }, __jsx(\"div\", {\n    style: {\n      maxWidth: \"85%\",\n      whiteSpace: \"pre-wrap\",\n      wordBreak: \"break-word\",\n      backgroundColor: msg.role === \"user\" ? \"#4f46e5\" : \"#1f1f22\",\n      border: msg.role === \"user\" ? \"1px solid #4f46e5\" : \"1px solid #2d2d32\",\n      color: \"#fff\",\n      fontSize: \"0.9rem\",\n      lineHeight: \"1.4rem\",\n      borderRadius: msg.role === \"user\" ? \"12px 12px 4px 12px\" : \"12px 12px 12px 4px\",\n      padding: \"0.75rem 0.9rem\",\n      boxShadow: msg.role === \"user\" ? \"0 16px 32px rgba(79,70,229,0.45)\" : \"0 12px 24px rgba(0,0,0,0.8)\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 25\n    }\n  }, msg.text), __jsx(\"div\", {\n    style: {\n      fontSize: \"0.7rem\",\n      color: \"#6b7280\",\n      marginTop: \"0.4rem\",\n      fontWeight: 500,\n      textAlign: msg.role === \"user\" ? \"right\" : \"left\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 25\n    }\n  }, msg.role === \"user\" ? \"You\" : \"Magmo\")))), __jsx(\"div\", {\n    style: {\n      fontSize: \"0.7rem\",\n      color: \"#4b5563\",\n      textAlign: \"center\",\n      marginTop: \"1rem\",\n      lineHeight: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 17\n    }\n  }, \"Magmo answers using internal service manuals. Always lockout / tagout and follow OEM safety procedures.\")))))));\n}","map":{"version":3,"sources":["C:/Users/mack2/OneDrive/Desktop/code/pages/AskMagmo.js"],"names":["React","useState","useEffect","useRef","Container","Card","Form","Button","Row","Col","Image","useAuth","useRouter","LoggedIn","AskMagmo","authUser","loading","router","history","setHistory","question","setQuestion","isSending","setIsSending","scrollRef","console","log","push","current","scrollTop","scrollHeight","handleAsk","e","preventDefault","trim","userMsg","prev","role","text","res","fetch","method","headers","body","JSON","stringify","answerText","ok","data","json","answer","updated","i","length","err","error","minHeight","backgroundColor","color","paddingTop","paddingBottom","border","borderRadius","padding","display","justifyContent","marginBottom","objectFit","filter","fontSize","fontWeight","target","value","borderColor","boxShadow","maxHeight","overflowY","textAlign","map","msg","idx","flexDirection","alignItems","maxWidth","whiteSpace","wordBreak","lineHeight","marginTop"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport {\r\n  Container,\r\n  Card,\r\n  Form,\r\n  Button,\r\n  Row,\r\n  Col,\r\n} from \"react-bootstrap\";\r\nimport Image from \"next/image\";\r\nimport { useAuth } from \"../context/AuthUserContext\";\r\nimport { useRouter } from \"next/router\";\r\nimport LoggedIn from \"./LoggedIn\";\r\n\r\nexport default function AskMagmo() {\r\n  const { authUser, loading } = useAuth();\r\n  const router = useRouter();\r\n\r\n  // Chat log: [{ role: \"user\" | \"assistant\", text: string }]\r\n  const [history, setHistory] = useState([]);\r\n  const [question, setQuestion] = useState(\"\");\r\n  const [isSending, setIsSending] = useState(false);\r\n\r\n  const scrollRef = useRef(null);\r\n\r\n  // Redirect to login if not authenticated\r\n  useEffect(() => {\r\n    if (!loading && !authUser) {\r\n      console.log(\"user not logged in, redirecting to /\");\r\n      router.push(\"/\");\r\n    }\r\n  }, [authUser, loading, router]);\r\n\r\n  // Auto-scroll chat to bottom whenever new messages land\r\n  useEffect(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\r\n    }\r\n  }, [history]);\r\n\r\n  async function handleAsk(e) {\r\n    e.preventDefault();\r\n    if (!question.trim() || isSending) return;\r\n\r\n    const userMsg = question.trim();\r\n\r\n    // 1. Add user question + placeholder assistant bubble\r\n    setHistory((prev) => [\r\n      ...prev,\r\n      { role: \"user\", text: userMsg },\r\n      { role: \"assistant\", text: \"Thinking...\" },\r\n    ]);\r\n\r\n    // clear input + set flag\r\n    setQuestion(\"\");\r\n    setIsSending(true);\r\n\r\n    try {\r\n      // 2. Call our backend route with the question\r\n      const res = await fetch(\"/api/gpt/AskMagmo\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ question: userMsg }),\r\n      });\r\n\r\n      let answerText = \"\";\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        answerText = data.answer || \"(No answer returned)\";\r\n      } else {\r\n        answerText = \"Magmo couldn't get an answer from the manuals.\";\r\n      }\r\n\r\n      // 3. Replace that \"Thinking...\" bubble with the real answer\r\n      setHistory((prev) => {\r\n        const updated = [...prev];\r\n        // walk backward, find the last assistant \"Thinking...\"\r\n        for (let i = updated.length - 1; i >= 0; i--) {\r\n          if (\r\n            updated[i].role === \"assistant\" &&\r\n            updated[i].text === \"Thinking...\"\r\n          ) {\r\n            updated[i] = { role: \"assistant\", text: answerText };\r\n            break;\r\n          }\r\n        }\r\n        return updated;\r\n      });\r\n    } catch (err) {\r\n      console.error(\"AskMagmo handleAsk error:\", err);\r\n\r\n      // If something blew up, replace \"Thinking...\" with an error message\r\n      setHistory((prev) => {\r\n        const updated = [...prev];\r\n        for (let i = updated.length - 1; i >= 0; i--) {\r\n          if (\r\n            updated[i].role === \"assistant\" &&\r\n            updated[i].text === \"Thinking...\"\r\n          ) {\r\n            updated[i] = {\r\n              role: \"assistant\",\r\n              text:\r\n                \"There was an issue reading the service docs. Try again in a moment.\",\r\n            };\r\n            break;\r\n          }\r\n        }\r\n        return updated;\r\n      });\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  }\r\n\r\n  // While auth is resolving, show loading like the rest of your app does\r\n  if (loading || !authUser) {\r\n    return (\r\n      <Container\r\n        className=\"d-flex align-items-center justify-content-center\"\r\n        style={{ minHeight: \"100vh\" }}\r\n      >\r\n        <h3>Loading...</h3>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <LoggedIn>\r\n      <Container\r\n        fluid\r\n        className=\"d-flex align-items-center justify-content-center\"\r\n        style={{\r\n          minHeight: \"100vh\",\r\n          backgroundColor: \"#0f0f10\",\r\n          color: \"#fff\",\r\n          paddingTop: \"2rem\",\r\n          paddingBottom: \"2rem\",\r\n        }}\r\n      >\r\n        <Row className=\"w-100 justify-content-center\">\r\n          <Col xs={12} md={10} lg={8} xl={6}>\r\n            <Card\r\n              className=\"shadow-lg\"\r\n              style={{\r\n                backgroundColor: \"#1a1a1d\",\r\n                border: \"1px solid #2d2d32\",\r\n                borderRadius: \"16px\",\r\n              }}\r\n            >\r\n              <Card.Body style={{ padding: \"2rem\" }}>\r\n                {/* Header / Branding */}\r\n                <div className=\"text-center mb-4\">\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      justifyContent: \"center\",\r\n                      marginBottom: \"0.75rem\",\r\n                    }}\r\n                  >\r\n                    {/* logo image */}\r\n                    <Image\r\n                      src=\"/magmo.png\"\r\n                      alt=\"Magmo\"\r\n                      width={160}\r\n                      height={60}\r\n                      style={{\r\n                        objectFit: \"contain\",\r\n                        filter:\r\n                          \"drop-shadow(0 4px 8px rgba(0,0,0,0.7))\",\r\n                      }}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* <h2\r\n                    style={{\r\n                      fontSize: \"1.25rem\",\r\n                      fontWeight: \"600\",\r\n                      color: \"#ffffff\",\r\n                      marginBottom: \"0.25rem\",\r\n                    }}\r\n                  >\r\n                    Ask Magmo\r\n                  </h2>\r\n                  <div\r\n                    style={{\r\n                      fontSize: \"0.9rem\",\r\n                      lineHeight: \"1.4rem\",\r\n                      color: \"#9ca3af\",\r\n                    }}\r\n                  >\r\n                    Your service assistant for MRI / CT install,\r\n                    faults, and parts.\r\n                  </div> */}\r\n                </div>\r\n\r\n                {/* Ask form */}\r\n                <Form onSubmit={handleAsk}>\r\n                  <Form.Group controlId=\"magmoQuestion\" className=\"mb-3\">\r\n                    <Form.Label\r\n                      style={{\r\n                        fontSize: \"0.8rem\",\r\n                        fontWeight: 500,\r\n                        color: \"#9ca3af\",\r\n                      }}\r\n                    >\r\n                      Ask a question\r\n                    </Form.Label>\r\n                    <Form.Control\r\n                      as=\"textarea\"\r\n                      rows={2}\r\n                      placeholder={`Example: \"Table won't home on HDxt. What's step one?\"`}\r\n                      value={question}\r\n                      onChange={(e) => setQuestion(e.target.value)}\r\n                      style={{\r\n                        backgroundColor: \"#0f0f10\",\r\n                        borderColor: \"#3a3a41\",\r\n                        color: \"#fff\",\r\n                        fontSize: \"0.9rem\",\r\n                        borderRadius: \"10px\",\r\n                      }}\r\n                    />\r\n                  </Form.Group>\r\n\r\n                  <div className=\"d-flex justify-content-end mb-4\">\r\n                    <Button\r\n                      type=\"submit\"\r\n                      disabled={isSending || !question.trim()}\r\n                      style={{\r\n                        backgroundColor: \"#4f46e5\",\r\n                        borderColor: \"#4f46e5\",\r\n                        fontSize: \"0.9rem\",\r\n                        fontWeight: 600,\r\n                        borderRadius: \"10px\",\r\n                        padding: \"0.5rem 1rem\",\r\n                        boxShadow:\r\n                          \"0 10px 24px rgba(79,70,229,0.4), 0 2px 4px rgba(0,0,0,0.6)\",\r\n                      }}\r\n                    >\r\n                      {isSending ? \"Asking...\" : \"Ask Magmo\"}\r\n                    </Button>\r\n                  </div>\r\n                </Form>\r\n\r\n                {/* Chat history window */}\r\n                <div\r\n                  style={{\r\n                    border: \"1px solid #2d2d32\",\r\n                    backgroundColor: \"#0f0f10\",\r\n                    borderRadius: \"12px\",\r\n                    maxHeight: \"300px\",\r\n                    minHeight: \"200px\",\r\n                    overflowY: \"auto\",\r\n                    padding: \"1rem\",\r\n                  }}\r\n                  ref={scrollRef}\r\n                >\r\n                  {history.length === 0 ? (\r\n                    <div\r\n                      style={{\r\n                        color: \"#6b7280\",\r\n                        fontSize: \"0.85rem\",\r\n                        textAlign: \"center\",\r\n                        paddingTop: \"2rem\",\r\n                      }}\r\n                    >\r\n                      Ask a question to get started.\r\n                    </div>\r\n                  ) : (\r\n                    history.map((msg, idx) => (\r\n                      <div\r\n                        key={idx}\r\n                        style={{\r\n                          marginBottom: \"1rem\",\r\n                          display: \"flex\",\r\n                          flexDirection: \"column\",\r\n                          alignItems:\r\n                            msg.role === \"user\"\r\n                              ? \"flex-end\"\r\n                              : \"flex-start\",\r\n                        }}\r\n                      >\r\n                        {/* Bubble */}\r\n                        <div\r\n                          style={{\r\n                            maxWidth: \"85%\",\r\n                            whiteSpace: \"pre-wrap\",\r\n                            wordBreak: \"break-word\",\r\n                            backgroundColor:\r\n                              msg.role === \"user\"\r\n                                ? \"#4f46e5\"\r\n                                : \"#1f1f22\",\r\n                            border:\r\n                              msg.role === \"user\"\r\n                                ? \"1px solid #4f46e5\"\r\n                                : \"1px solid #2d2d32\",\r\n                            color: \"#fff\",\r\n                            fontSize: \"0.9rem\",\r\n                            lineHeight: \"1.4rem\",\r\n                            borderRadius:\r\n                              msg.role === \"user\"\r\n                                ? \"12px 12px 4px 12px\"\r\n                                : \"12px 12px 12px 4px\",\r\n                            padding: \"0.75rem 0.9rem\",\r\n                            boxShadow:\r\n                              msg.role === \"user\"\r\n                                ? \"0 16px 32px rgba(79,70,229,0.45)\"\r\n                                : \"0 12px 24px rgba(0,0,0,0.8)\",\r\n                          }}\r\n                        >\r\n                          {msg.text}\r\n                        </div>\r\n\r\n                        {/* role tag */}\r\n                        <div\r\n                          style={{\r\n                            fontSize: \"0.7rem\",\r\n                            color: \"#6b7280\",\r\n                            marginTop: \"0.4rem\",\r\n                            fontWeight: 500,\r\n                            textAlign:\r\n                              msg.role === \"user\"\r\n                                ? \"right\"\r\n                                : \"left\",\r\n                          }}\r\n                        >\r\n                          {msg.role === \"user\"\r\n                            ? \"You\"\r\n                            : \"Magmo\"}\r\n                        </div>\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                </div>\r\n\r\n                {/* footer disclaimer */}\r\n                <div\r\n                  style={{\r\n                    fontSize: \"0.7rem\",\r\n                    color: \"#4b5563\",\r\n                    textAlign: \"center\",\r\n                    marginTop: \"1rem\",\r\n                    lineHeight: \"1rem\",\r\n                  }}\r\n                >\r\n                  Magmo answers using internal service manuals.\r\n                  Always lockout / tagout and follow OEM safety\r\n                  procedures.\r\n                </div>\r\n              </Card.Body>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </Container>\r\n    </LoggedIn>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}