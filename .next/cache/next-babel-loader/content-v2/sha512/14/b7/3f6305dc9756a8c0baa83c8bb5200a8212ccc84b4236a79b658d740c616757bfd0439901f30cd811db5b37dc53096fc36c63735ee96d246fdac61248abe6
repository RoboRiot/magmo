{"ast":null,"code":"import _extends from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/extends\";\nimport _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState, useRef, useCallback, useMemo } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Form, Button, Card, Container, Row, Col, Modal, FormControl, Collapse, InputGroup, ButtonGroup } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useAuth } from \"../../../../context/AuthUserContext\";\nimport firebase from \"../../../../context/Firebase\";\nimport LoggedIn from \"../../../LoggedIn\";\nimport { useRouter } from \"next/router\";\nimport { fetchClients } from \"../../../../utils/fetchAssociations\";\nimport ClientTable from \"../../../../utils/ClientTable\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport ParentModal from \"../../AddItem/parentModal\";\nimport dynamic from \"next/dynamic\";\nimport InfoModal from \"../../InfoModal\";\nimport MachineSelectionModal from \"./MachineSelectionModal\";\nimport { addServiceItem } from \"../../../../utils/BluefolderService\";\nimport NewLocal from \"./NewLocal\";\nimport styles from \"../../AddItem/NewItem.module.css\"; //inflow API\n\nimport InflowAPI from \"../../../../utils/inflowAPI\";\nimport { buildLocalLocObject, formatLoc, updateMachineFields, buildNameTokens } from \"../../../../utils/itemFormShared\";\nimport MultiSelectDropdown from \"../../../../components/MultiSelectDropdown\";\nimport { fetchTrackerCatalog, buildAllOems, buildModelsForSelection, syncTrackerFromSelections, deleteTrackerOem, deleteTrackerModel } from \"../../../../utils/trackerCatalog\"; // Import for SSR\n\n// This will only load the component on the client-side.\nvar BarcodeScannerComponent = dynamic(function () {\n  return import(\"react-qr-barcode-scanner\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"react-qr-barcode-scanner\")];\n    },\n    modules: [\"NewSearch\\\\item\\\\[id]\\\\index.js -> \" + \"react-qr-barcode-scanner\"]\n  }\n}); // Simulates a network request delay.\n\nfunction simulateNetworkRequest() {\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, 2000);\n  });\n} // Custom LoadingButton component.\n\n\nfunction LoadingButton(_ref) {\n  var type = _ref.type,\n      name = _ref.name,\n      route = _ref.route;\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setLoading = _useState[1];\n\n  useEffect(function () {\n    if (isLoading) {\n      var cancelled = false;\n      simulateNetworkRequest().then(function () {\n        if (!cancelled) setLoading(false);\n      });\n      return function () {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\n  var handleClick = function handleClick() {\n    return setLoading(true);\n  };\n\n  return __jsx(Link, {\n    href: \"/\".concat(route)\n  }, __jsx(\"a\", {\n    className: \"btn btn-\".concat(type),\n    disabled: isLoading,\n    onClick: !isLoading ? handleClick : null\n  }, isLoading ? \"Loading…\" : name));\n}\n\nfunction isValidMachineValue(value) {\n  if (value == null) return false;\n\n  if (Array.isArray(value)) {\n    return value.some(function (v) {\n      var trimmed = String(v || \"\").trim();\n      return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\n    });\n  }\n\n  if (typeof value !== \"string\") return Boolean(value);\n  var trimmed = value.trim();\n  return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\n}\n\nfunction normalizeSelection(value) {\n  if (Array.isArray(value)) {\n    return value.map(function (v) {\n      return String(v).trim();\n    }).filter(function (v) {\n      return v && v.toLowerCase() !== \"n/a\";\n    });\n  }\n\n  if (value == null) return [];\n  var normalized = String(value).trim();\n  if (!normalized || normalized.toLowerCase() === \"n/a\") return [];\n  return [normalized];\n}\n\nfunction uniqueSelection(values) {\n  return Array.from(new Set(values || []));\n}\n\nfunction selectionToStoredValue(values) {\n  var cleaned = uniqueSelection(normalizeSelection(values));\n  if (cleaned.length === 0) return \"\";\n  if (cleaned.length === 1) return cleaned[0];\n  return cleaned;\n}\n\nfunction selectionToPrintValue(values) {\n  var cleaned = uniqueSelection(normalizeSelection(values));\n  if (cleaned.length === 0) return \"\";\n  if (cleaned.length === 1) return cleaned[0];\n  return \"Multi\";\n}\n\nfunction mergeOptionsWithSelection(options, selected) {\n  var map = new Map();\n  (options || []).forEach(function (value) {\n    if (value == null) return;\n    var normalized = String(value).trim();\n    if (!normalized) return;\n    map.set(normalized.toLowerCase(), normalized);\n  });\n  (selected || []).forEach(function (value) {\n    if (value == null) return;\n    var normalized = String(value).trim();\n    if (!normalized) return;\n    map.set(normalized.toLowerCase(), normalized);\n  });\n  return Array.from(map.values());\n}\n\nfunction DisplayItemInner(_ref2) {\n  var _initialItem$price, _initialItem$status, _initialItem$length, _initialItem$width, _initialItem$height, _initialItem$poNumber, _initialItem$tracking, _initialItem$visible, _descriptions$selecte3, _descriptions$selecte4, _newLocalFrom$section, _newLocalFrom$section2, _newLocalCurrent$sect, _newLocalCurrent$sect2;\n\n  var initialItem = _ref2.initialItem,\n      initialMachineData = _ref2.initialMachineData,\n      error = _ref2.error;\n  // Feature flag to show/hide the 3 Slack buttons\n  var SHOW_SLACK_BUTTONS = process.env.NEXT_PUBLIC_SHOW_SLACK_BUTTONS === \"true\";\n  var router = useRouter();\n\n  var _useAuth = useAuth(),\n      signOut = _useAuth.signOut; // const { id } = router.query;\n\n\n  var idFromRouter = router.query.id;\n  var initialId = (initialItem === null || initialItem === void 0 ? void 0 : initialItem.id) || idFromRouter; // Use a single local var everywhere in this component\n\n  var id = initialId;\n\n  var _useState2 = useState({\n    name: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.name) || \"\",\n    pn: Array.isArray(initialItem === null || initialItem === void 0 ? void 0 : initialItem.pn) ? initialItem.pn : initialItem !== null && initialItem !== void 0 && initialItem.pn ? [initialItem.pn] : [],\n    sn: Array.isArray(initialItem === null || initialItem === void 0 ? void 0 : initialItem.sn) ? initialItem.sn : initialItem !== null && initialItem !== void 0 && initialItem.sn ? [initialItem.sn] : [],\n    // hydrate these from initialItem so SSR renders fully on deploy\n    price: (_initialItem$price = initialItem === null || initialItem === void 0 ? void 0 : initialItem.price) !== null && _initialItem$price !== void 0 ? _initialItem$price : \"\",\n    status: (_initialItem$status = initialItem === null || initialItem === void 0 ? void 0 : initialItem.status) !== null && _initialItem$status !== void 0 ? _initialItem$status : \"\",\n    length: (_initialItem$length = initialItem === null || initialItem === void 0 ? void 0 : initialItem.length) !== null && _initialItem$length !== void 0 ? _initialItem$length : \"\",\n    width: (_initialItem$width = initialItem === null || initialItem === void 0 ? void 0 : initialItem.width) !== null && _initialItem$width !== void 0 ? _initialItem$width : \"\",\n    height: (_initialItem$height = initialItem === null || initialItem === void 0 ? void 0 : initialItem.height) !== null && _initialItem$height !== void 0 ? _initialItem$height : \"\",\n    poNumber: (_initialItem$poNumber = initialItem === null || initialItem === void 0 ? void 0 : initialItem.poNumber) !== null && _initialItem$poNumber !== void 0 ? _initialItem$poNumber : \"\",\n    trackingNumber: (_initialItem$tracking = initialItem === null || initialItem === void 0 ? void 0 : initialItem.trackingNumber) !== null && _initialItem$tracking !== void 0 ? _initialItem$tracking : \"\",\n    localSN: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.localSN) || \"\",\n    arrival_date: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.arrival_date) || \"\",\n    visible: (_initialItem$visible = initialItem === null || initialItem === void 0 ? void 0 : initialItem.visible) !== null && _initialItem$visible !== void 0 ? _initialItem$visible : true\n  }),\n      items = _useState2[0],\n      setItems = _useState2[1];\n\n  var _useState3 = useState((initialItem === null || initialItem === void 0 ? void 0 : initialItem.name) || \"\"),\n      savedName = _useState3[0],\n      setSavedName = _useState3[1]; // ⬇️ put this INSIDE DisplayItem, after the related useState hooks\n\n\n  useEffect(function () {\n    if (!initialItem) return;\n    setDescriptions(initialItem.descriptions || []);\n    setWorkOrders(initialItem.workOrders || []);\n    setDOM(initialItem.DOM || \"\");\n    setItems(function (prev) {\n      var _ref3, _initialItem$status2, _ref4, _initialItem$price2, _ref5, _initialItem$length2, _ref6, _initialItem$width2, _ref7, _initialItem$height2, _ref8, _initialItem$poNumber2, _ref9, _initialItem$tracking2;\n\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        // only overwrite if SSR provided a value; otherwise keep what you have\n        status: (_ref3 = (_initialItem$status2 = initialItem.status) !== null && _initialItem$status2 !== void 0 ? _initialItem$status2 : prev.status) !== null && _ref3 !== void 0 ? _ref3 : \"\",\n        price: (_ref4 = (_initialItem$price2 = initialItem.price) !== null && _initialItem$price2 !== void 0 ? _initialItem$price2 : prev.price) !== null && _ref4 !== void 0 ? _ref4 : \"\",\n        length: (_ref5 = (_initialItem$length2 = initialItem.length) !== null && _initialItem$length2 !== void 0 ? _initialItem$length2 : prev.length) !== null && _ref5 !== void 0 ? _ref5 : \"\",\n        width: (_ref6 = (_initialItem$width2 = initialItem.width) !== null && _initialItem$width2 !== void 0 ? _initialItem$width2 : prev.width) !== null && _ref6 !== void 0 ? _ref6 : \"\",\n        height: (_ref7 = (_initialItem$height2 = initialItem.height) !== null && _initialItem$height2 !== void 0 ? _initialItem$height2 : prev.height) !== null && _ref7 !== void 0 ? _ref7 : \"\",\n        poNumber: (_ref8 = (_initialItem$poNumber2 = initialItem.poNumber) !== null && _initialItem$poNumber2 !== void 0 ? _initialItem$poNumber2 : prev.poNumber) !== null && _ref8 !== void 0 ? _ref8 : \"\",\n        trackingNumber: (_ref9 = (_initialItem$tracking2 = initialItem.trackingNumber) !== null && _initialItem$tracking2 !== void 0 ? _initialItem$tracking2 : prev.trackingNumber) !== null && _ref9 !== void 0 ? _ref9 : \"\"\n      });\n    });\n\n    if (initialItem.name) {\n      setSavedName(initialItem.name);\n    }\n  }, [initialItem]);\n\n  var _useState4 = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  }),\n      newLocalFrom = _useState4[0],\n      setNewLocalFrom = _useState4[1];\n\n  var _useState5 = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  }),\n      newLocalCurrent = _useState5[0],\n      setNewLocalCurrent = _useState5[1]; // New states for separate client selections:\n\n\n  var _useState6 = useState(null),\n      selectedClientFrom = _useState6[0],\n      setSelectedClientFrom = _useState6[1];\n\n  var _useState7 = useState(null),\n      selectedClientCurrent = _useState7[0],\n      setSelectedClientCurrent = _useState7[1];\n\n  var _useState8 = useState(null),\n      selectedMachine = _useState8[0],\n      setSelectedMachine = _useState8[1];\n\n  var _useState9 = useState(null),\n      selectedCurrentMachine = _useState9[0],\n      setSelectedCurrentMachine = _useState9[1]; // whenever you pick a new “From” client or machine, clear the old From-loc:\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientFrom, selectedMachine]);\n  // const didMountFrom = useRef(false);\n  // useEffect(() => {\n  //   if (!didMountFrom.current) {\n  //     // first time through (the data-load phase), don’t clear\n  //     didMountFrom.current = true;\n  //     return;\n  //   }\n  //   // thereafter, when the user picks a new client or machine, clear:\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  //   setLocalLocFrom(\"\");\n  // }, [selectedClientFrom, selectedMachine]);\n  // whenever you pick a new “Current” client or machine, clear the old Current-loc:\n  // useEffect(() => {\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // const [didFetch, setDidFetch] = useState(false);\n  // useEffect(() => {\n  //   if (!didFetch) {\n  //     // we’re in the data-load phase, skip clearing\n  //     setDidFetch(true);\n  //     return;\n  //   }\n  //   // only clear on subsequent user changes:\n  //   setNewLocalCurrent({ region: \"\", section: {}, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // These arrays will be populated from Firebase.\n\n\n  var _useState10 = useState([]),\n      pnOptions = _useState10[0],\n      setPnOptions = _useState10[1];\n\n  var _useState11 = useState([]),\n      snOptions = _useState11[0],\n      setSnOptions = _useState11[1];\n\n  var _useState12 = useState(false),\n      pnSnLoaded = _useState12[0],\n      setPnSnLoaded = _useState12[1];\n\n  var _useState13 = useState(false),\n      pnSnLoading = _useState13[0],\n      setPnSnLoading = _useState13[1];\n\n  var _useState14 = useState([{\n    description: \"\",\n    date: \"\"\n  }]),\n      descriptions = _useState14[0],\n      setDescriptions = _useState14[1];\n\n  var _useState15 = useState([{\n    workOrder: \"\",\n    date: \"\"\n  }]),\n      workOrders = _useState15[0],\n      setWorkOrders = _useState15[1];\n\n  var _useState16 = useState([]),\n      clients = _useState16[0],\n      setClients = _useState16[1];\n\n  var _useState17 = useState(false),\n      clientsLoaded = _useState17[0],\n      setClientsLoaded = _useState17[1];\n\n  var _useState18 = useState(false),\n      clientsLoading = _useState18[0],\n      setClientsLoading = _useState18[1];\n\n  var _useState19 = useState([]),\n      photos = _useState19[0],\n      setPhotos = _useState19[1];\n\n  var _useState20 = useState(false),\n      show = _useState20[0],\n      setShow = _useState20[1];\n\n  var _useState21 = useState(false),\n      showErr = _useState21[0],\n      setShowErr = _useState21[1];\n\n  var _useState22 = useState(\"N/A\"),\n      Err = _useState22[0],\n      setErr = _useState22[1];\n\n  var _useState23 = useState(false),\n      showDescModal = _useState23[0],\n      setShowDescModal = _useState23[1];\n\n  var _useState24 = useState(false),\n      showWoModal = _useState24[0],\n      setShowWoModal = _useState24[1];\n\n  var _useState25 = useState(false),\n      showClientModal = _useState25[0],\n      setShowClientModal = _useState25[1];\n\n  var _useState26 = useState(false),\n      showMachineModal = _useState26[0],\n      setShowMachineModal = _useState26[1];\n\n  var _useState27 = useState(false),\n      showParentModal = _useState27[0],\n      setShowParentModal = _useState27[1];\n\n  var _useState28 = useState(false),\n      showCameraModal = _useState28[0],\n      setShowCameraModal = _useState28[1];\n\n  var _useState29 = useState(false),\n      showSaveModal = _useState29[0],\n      setShowSaveModal = _useState29[1];\n\n  var _useState30 = useState(false),\n      showPrintModal = _useState30[0],\n      setShowPrintModal = _useState30[1];\n\n  var _useState31 = useState(false),\n      machineSelectionModal = _useState31[0],\n      setMachineSelectionModal = _useState31[1];\n\n  var _useState32 = useState(0),\n      selectedDesc = _useState32[0],\n      setSelectedDesc = _useState32[1];\n\n  var _useState33 = useState(null),\n      selectedClient = _useState33[0],\n      setSelectedClient = _useState33[1];\n\n  var _useState34 = useState(null),\n      selectedParent = _useState34[0],\n      setSelectedParent = _useState34[1];\n\n  var _useState35 = useState(null),\n      TheMachine = _useState35[0],\n      setTheMachine = _useState35[1];\n\n  var _useState36 = useState([]),\n      machineOptions = _useState36[0],\n      setMachineOptions = _useState36[1];\n\n  var _useState37 = useState(\"\"),\n      search = _useState37[0],\n      setSearch = _useState37[1];\n\n  var _useState38 = useState(null),\n      capturedPhoto = _useState38[0],\n      setCapturedPhoto = _useState38[1];\n\n  var _useState39 = useState(\"environment\"),\n      cameraFacing = _useState39[0],\n      setCameraFacing = _useState39[1];\n\n  var _useState40 = useState(false),\n      addToWebsite = _useState40[0],\n      setAddToWebsite = _useState40[1];\n\n  var _useState41 = useState(false),\n      machinePick = _useState41[0],\n      setMachinePick = _useState41[1];\n\n  var _useState42 = useState(0),\n      freqItem = _useState42[0],\n      setFreqItem = _useState42[1];\n\n  var _useState43 = useState(0),\n      usagePastYear = _useState43[0],\n      setUsagePastYear = _useState43[1];\n\n  var _useState44 = useState(0),\n      machineFrequency = _useState44[0],\n      setMachineFrequency = _useState44[1]; // State for the extra (dimensions/price/DOM/PO Number) section.\n\n\n  var _useState45 = useState(false),\n      showExtra = _useState45[0],\n      setShowExtra = _useState45[1];\n\n  var _useState46 = useState({\n    modalities: [],\n    oemsByModality: {},\n    modelsByModalityOem: {},\n    meta: {}\n  }),\n      trackerCatalog = _useState46[0],\n      setTrackerCatalog = _useState46[1];\n\n  var _useState47 = useState(false),\n      trackerLoading = _useState47[0],\n      setTrackerLoading = _useState47[1]; // State for the local warehouse location inputs.\n\n\n  var _useState48 = useState(\"\"),\n      localLocFrom = _useState48[0],\n      setLocalLocFrom = _useState48[1];\n\n  var _useState49 = useState(\"\"),\n      localLocCurrent = _useState49[0],\n      setLocalLocCurrent = _useState49[1]; // New state for DOM (Date of Manufacture)\n\n\n  var _useState50 = useState(\"\"),\n      DOM = _useState50[0],\n      setDOM = _useState50[1]; // New state for OEM, Modality, and Model (multi-select).\n\n\n  var _useState51 = useState([]),\n      selectedModalities = _useState51[0],\n      setSelectedModalities = _useState51[1];\n\n  var _useState52 = useState([]),\n      selectedOems = _useState52[0],\n      setSelectedOems = _useState52[1];\n\n  var _useState53 = useState([]),\n      selectedModels = _useState53[0],\n      setSelectedModels = _useState53[1];\n\n  var applyMergedMachineFields = function applyMergedMachineFields(merged) {\n    var _ref10 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        _ref10$force = _ref10.force,\n        force = _ref10$force === void 0 ? false : _ref10$force;\n\n    if (!merged) return;\n    var nextOems = uniqueSelection(normalizeSelection(merged.oem));\n    var nextModalities = uniqueSelection(normalizeSelection(merged.modality));\n    var nextModels = uniqueSelection(normalizeSelection(merged.model));\n    setSelectedOems(function (prev) {\n      if (!force && prev.length) return prev;\n      return nextOems;\n    });\n    setSelectedModalities(function (prev) {\n      if (!force && prev.length) return prev;\n      return nextModalities;\n    });\n    setSelectedModels(function (prev) {\n      if (!force && prev.length) return prev;\n      return nextModels;\n    });\n  }; // More info modal state.\n\n\n  var _useState54 = useState(false),\n      showInfoModal = _useState54[0],\n      setShowInfoModal = _useState54[1];\n\n  var _useState55 = useState(\"\"),\n      itemName = _useState55[0],\n      setItemName = _useState55[1];\n\n  var _useState56 = useState(false),\n      machineFieldsInitialized = _useState56[0],\n      setMachineFieldsInitialized = _useState56[1];\n\n  var _useState57 = useState(true),\n      isLoading = _useState57[0],\n      setIsLoading = _useState57[1]; // near the top of DisplayItem()\n\n\n  var _useState58 = useState(false),\n      showLocalModalFrom = _useState58[0],\n      setShowLocalModalFrom = _useState58[1];\n\n  var _useState59 = useState(false),\n      showLocalModalCurrent = _useState59[0],\n      setShowLocalModalCurrent = _useState59[1];\n\n  var openLocalModalFrom = function openLocalModalFrom() {\n    return setShowLocalModalFrom(true);\n  };\n\n  var closeLocalModalFrom = function closeLocalModalFrom() {\n    return setShowLocalModalFrom(false);\n  };\n\n  var openLocalModalCurrent = function openLocalModalCurrent() {\n    return setShowLocalModalCurrent(true);\n  };\n\n  var closeLocalModalCurrent = function closeLocalModalCurrent() {\n    return setShowLocalModalCurrent(false);\n  }; // at the top of DisplayItem()\n\n\n  var _useState60 = useState(false),\n      showNewLocalModalFrom = _useState60[0],\n      setShowNewLocalModalFrom = _useState60[1];\n\n  var _useState61 = useState(false),\n      showNewLocalModalCurrent = _useState61[0],\n      setShowNewLocalModalCurrent = _useState61[1]; // when the From-client changes, clear any old local-loc\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientFrom]);\n  // // when the From-machine changes, clear any old local-loc\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedMachine]);\n  // same for Current:\n  // useEffect(() => {\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // const handleSendToInflow = async () => {\n  //   try {\n  //     const name = items.name;\n  //     const description = descriptions[selectedDesc]?.description || \"\";\n  //     // gather every photo URL from Firebase Storage\n  //     const imageUrls = photos.map((p) => p.url);\n  //     await InflowAPI.upsertProduct({ name, description, imageUrls });\n  //     alert(\"Sent to inFlow successfully!\");\n  //   } catch (err) {\n  //     console.error(err);\n  //     alert(\"Error sending to inFlow: \" + err.message);\n  //   }\n  // };\n\n\n  var handleSendToInflow = /*#__PURE__*/function () {\n    var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _descriptions$selecte, name, description, imageUrls, sku, toCSV, arrivalISO, pnStr, snStr, mostRecentWO, customFields, created;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              name = (items.name || '').trim();\n\n              if (name) {\n                _context.next = 5;\n                break;\n              }\n\n              alert('Item needs a name before sending to inFlow.');\n              return _context.abrupt(\"return\");\n\n            case 5:\n              // Regular description (don’t also send a custom “Description” unless you truly have one)\n              description = (((_descriptions$selecte = descriptions[selectedDesc]) === null || _descriptions$selecte === void 0 ? void 0 : _descriptions$selecte.description) || '').trim(); // Photos already fetched from storage\n\n              imageUrls = photos.map(function (p) {\n                return p.url;\n              }).filter(Boolean); // SKU = your item id\n\n              sku = (id !== null && id !== void 0 ? id : '').toString(); // Basic normalizers\n\n              toCSV = function toCSV(arr) {\n                return Array.isArray(arr) ? arr.filter(Boolean).join(', ') : arr || '';\n              }; // YYYY-MM-DD for the date field in inFlow\n\n\n              arrivalISO = items.arrival_date ? new Date(items.arrival_date).toISOString().slice(0, 10) : '';\n              pnStr = Array.isArray(items.pn) ? items.pn.filter(Boolean).join(', ') : items.pn || '';\n              snStr = Array.isArray(items.sn) ? items.sn.filter(Boolean).join(', ') : items.sn || ''; // Most recent WO (you already have this)\n\n              mostRecentWO = workOrders !== null && workOrders !== void 0 && workOrders.length ? workOrders.reduce(function (latest, cur) {\n                return new Date(cur.date) > new Date(latest.date) ? cur : latest;\n              }, workOrders[0]) : {\n                workOrder: '',\n                date: ''\n              }; // Build the numbered fields (match your inFlow “Field 1..10”)\n\n              customFields = {\n                custom1: selectionToPrintValue(selectedOems),\n                // OEM   (dropdown)\n                custom2: selectionToPrintValue(selectedModalities),\n                // Modality (dropdown)\n                custom3: selectionToPrintValue(selectedModels),\n                // Model (dropdown)\n                custom4: (description || '').trim(),\n                // Description (text) - optional duplicate\n                custom5: (mostRecentWO.workOrder || '').trim(),\n                // Work Order (text)\n                custom6: ((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : selectedClientFrom.name) || '').trim(),\n                // From (text)\n                custom7: pnStr,\n                // Product Number (text)\n                custom8: snStr,\n                // Serial Number (text)\n                custom9: arrivalISO,\n                // Arrival Date (date)\n                custom10: ((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : selectedClientCurrent.name) || '').trim() // Current (text)\n\n              };\n              console.log('[inFlow] customFields to send (numbered):', customFields);\n              _context.next = 17;\n              return InflowAPI.upsertProduct({\n                name: name,\n                description: description,\n                sku: sku,\n                imageUrls: imageUrls,\n                customFields: customFields\n              });\n\n            case 17:\n              created = _context.sent;\n              alert(\"Sent to inFlow successfully. ID: \".concat((created === null || created === void 0 ? void 0 : created.productId) || (created === null || created === void 0 ? void 0 : created.id) || '(unknown)'));\n              _context.next = 25;\n              break;\n\n            case 21:\n              _context.prev = 21;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0);\n              alert('Error sending to inFlow: ' + _context.t0.message);\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 21]]);\n    }));\n\n    return function handleSendToInflow() {\n      return _ref11.apply(this, arguments);\n    };\n  }(); // const [storedMachine, setStoredMachine] = useState(null);\n  // useEffect(() => {\n  //   // once any of these three change, re-merge:\n  //   if (TheMachine || selectedCurrentMachine || selectedMachine) {\n  //     const merged = updateMachineFields(\n  //       TheMachine,\n  //       selectedCurrentMachine,\n  //       selectedMachine\n  //     );\n  //     setOem(merged.oem);\n  //     setModality(merged.modality);\n  //     setModel(merged.model);\n  //   }\n  // }, [TheMachine, selectedCurrentMachine, selectedMachine]);\n  // whenever the “From” client changes:\n\n\n  useEffect(function () {\n    var _selectedClientFrom$n;\n\n    setShowLocalLocFrom((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n = selectedClientFrom.name) === null || _selectedClientFrom$n === void 0 ? void 0 : _selectedClientFrom$n.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientFrom]); // whenever the “Current” client changes:\n\n  useEffect(function () {\n    var _selectedClientCurren;\n\n    setShowLocalLocCurrent((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren = selectedClientCurrent.name) === null || _selectedClientCurren === void 0 ? void 0 : _selectedClientCurren.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientCurrent]);\n\n  var loadClients = /*#__PURE__*/function () {\n    var _ref12 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var clientsData;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(clientsLoaded || clientsLoading)) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              setClientsLoading(true);\n              _context2.prev = 3;\n              _context2.next = 6;\n              return fetchClients();\n\n            case 6:\n              clientsData = _context2.sent;\n              setClients(clientsData);\n              setClientsLoaded(true);\n              _context2.next = 14;\n              break;\n\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](3);\n              console.error(\"Error fetching clients: \", _context2.t0);\n\n            case 14:\n              _context2.prev = 14;\n              setClientsLoading(false);\n              return _context2.finish(14);\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[3, 11, 14, 17]]);\n    }));\n\n    return function loadClients() {\n      return _ref12.apply(this, arguments);\n    };\n  }();\n\n  var loadTracker = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n    var force,\n        catalog,\n        _args3 = arguments;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            force = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : false;\n\n            if (!trackerLoading) {\n              _context3.next = 3;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 3:\n            if (!(!force && trackerCatalog.modalities.length)) {\n              _context3.next = 5;\n              break;\n            }\n\n            return _context3.abrupt(\"return\");\n\n          case 5:\n            setTrackerLoading(true);\n            _context3.prev = 6;\n            _context3.next = 9;\n            return fetchTrackerCatalog();\n\n          case 9:\n            catalog = _context3.sent;\n            setTrackerCatalog(catalog);\n            _context3.next = 16;\n            break;\n\n          case 13:\n            _context3.prev = 13;\n            _context3.t0 = _context3[\"catch\"](6);\n            console.error(\"Failed to load tracker catalog:\", _context3.t0);\n\n          case 16:\n            _context3.prev = 16;\n            setTrackerLoading(false);\n            return _context3.finish(16);\n\n          case 19:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, null, [[6, 13, 16, 19]]);\n  })), [trackerLoading, trackerCatalog.modalities.length]);\n  useEffect(function () {\n    loadTracker();\n  }, [loadTracker]);\n  var allOemOptions = useMemo(function () {\n    return buildAllOems(trackerCatalog);\n  }, [trackerCatalog]);\n  var modelOptions = useMemo(function () {\n    return buildModelsForSelection(trackerCatalog, selectedModalities, selectedOems);\n  }, [trackerCatalog, selectedModalities, selectedOems]); // Keep selected models even if they are not in the catalog yet.\n\n  var modalityOptionsForUI = useMemo(function () {\n    return mergeOptionsWithSelection(trackerCatalog.modalities, selectedModalities);\n  }, [trackerCatalog.modalities, selectedModalities]);\n  var oemOptionsForUI = useMemo(function () {\n    return mergeOptionsWithSelection(allOemOptions, selectedOems);\n  }, [allOemOptions, selectedOems]);\n  var modelOptionsForUI = useMemo(function () {\n    return mergeOptionsWithSelection(modelOptions, selectedModels);\n  }, [modelOptions, selectedModels]); // Tracker updates are only performed on Save.\n\n  var handleDeleteOemOption = useCallback( /*#__PURE__*/function () {\n    var _ref14 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(oem) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (oem) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 2:\n              _context4.prev = 2;\n              _context4.next = 5;\n              return deleteTrackerOem({\n                oem: oem,\n                catalog: trackerCatalog\n              });\n\n            case 5:\n              setSelectedOems(function (prev) {\n                return prev.filter(function (value) {\n                  return value !== oem;\n                });\n              });\n              loadTracker(true);\n              _context4.next = 12;\n              break;\n\n            case 9:\n              _context4.prev = 9;\n              _context4.t0 = _context4[\"catch\"](2);\n              console.error(\"Failed to delete OEM:\", _context4.t0);\n\n            case 12:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[2, 9]]);\n    }));\n\n    return function (_x) {\n      return _ref14.apply(this, arguments);\n    };\n  }(), [trackerCatalog, loadTracker]);\n  var handleDeleteModelOption = useCallback( /*#__PURE__*/function () {\n    var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(model) {\n      var ops;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(!model || !selectedModalities.length || !selectedOems.length)) {\n                _context5.next = 2;\n                break;\n              }\n\n              return _context5.abrupt(\"return\");\n\n            case 2:\n              _context5.prev = 2;\n              ops = [];\n              selectedModalities.forEach(function (modalityValue) {\n                selectedOems.forEach(function (oemValue) {\n                  ops.push(deleteTrackerModel({\n                    modality: modalityValue,\n                    oem: oemValue,\n                    model: model,\n                    catalog: trackerCatalog\n                  }));\n                });\n              });\n              _context5.next = 7;\n              return Promise.allSettled(ops);\n\n            case 7:\n              setSelectedModels(function (prev) {\n                return prev.filter(function (value) {\n                  return value !== model;\n                });\n              });\n              loadTracker(true);\n              _context5.next = 14;\n              break;\n\n            case 11:\n              _context5.prev = 11;\n              _context5.t0 = _context5[\"catch\"](2);\n              console.error(\"Failed to delete model:\", _context5.t0);\n\n            case 14:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[2, 11]]);\n    }));\n\n    return function (_x2) {\n      return _ref15.apply(this, arguments);\n    };\n  }(), [selectedModalities, selectedOems, trackerCatalog, loadTracker]);\n\n  var loadPnSnOptions = /*#__PURE__*/function () {\n    var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n      var db, snapshot, pnSet, snSet;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              if (!(pnSnLoaded || pnSnLoading)) {\n                _context6.next = 2;\n                break;\n              }\n\n              return _context6.abrupt(\"return\");\n\n            case 2:\n              setPnSnLoading(true);\n              _context6.prev = 3;\n              db = firebase.firestore();\n              _context6.next = 7;\n              return db.collection(\"Test\").orderBy(firebase.firestore.FieldPath.documentId()).limit(500).get();\n\n            case 7:\n              snapshot = _context6.sent;\n              pnSet = new Set();\n              snSet = new Set();\n              snapshot.forEach(function (doc) {\n                var data = doc.data();\n\n                if (Array.isArray(data.pn)) {\n                  data.pn.forEach(function (pn) {\n                    return pn && pnSet.add(pn);\n                  });\n                } else if (data.pn) {\n                  pnSet.add(data.pn);\n                }\n\n                if (Array.isArray(data.sn)) {\n                  data.sn.forEach(function (sn) {\n                    return sn && snSet.add(sn);\n                  });\n                } else if (data.sn) {\n                  snSet.add(data.sn);\n                }\n              });\n              setPnOptions(_toConsumableArray(pnSet));\n              setSnOptions(_toConsumableArray(snSet));\n              setPnSnLoaded(true);\n              _context6.next = 19;\n              break;\n\n            case 16:\n              _context6.prev = 16;\n              _context6.t0 = _context6[\"catch\"](3);\n              console.error(\"Error fetching PN/SN options:\", _context6.t0);\n\n            case 19:\n              _context6.prev = 19;\n              setPnSnLoading(false);\n              return _context6.finish(19);\n\n            case 22:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, null, [[3, 16, 19, 22]]);\n    }));\n\n    return function loadPnSnOptions() {\n      return _ref16.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (id) fetchData(); // always hydrate on the client\n  }, [id]);\n\n  function resolveClientFromMachine(_x3, _x4, _x5) {\n    return _resolveClientFromMachine.apply(this, arguments);\n  }\n\n  function _resolveClientFromMachine() {\n    _resolveClientFromMachine = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee19(machineRef, setClient, setMachine) {\n      var isFrom,\n          machineDoc,\n          _machineData$name,\n          machineData,\n          clientDoc,\n          clientName,\n          isSocalInterior,\n          shouldShow,\n          _clientDoc2,\n          _args19 = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee19$(_context19) {\n        while (1) {\n          switch (_context19.prev = _context19.next) {\n            case 0:\n              isFrom = _args19.length > 3 && _args19[3] !== undefined ? _args19[3] : true;\n              _context19.next = 3;\n              return machineRef.get();\n\n            case 3:\n              machineDoc = _context19.sent;\n\n              if (!machineDoc.exists) {\n                _context19.next = 24;\n                break;\n              }\n\n              machineData = machineDoc.data();\n              setMachine(_objectSpread({\n                id: machineDoc.id\n              }, machineData)); // Determine if the machine is \"interior socal\"\n              // const isSocalInterior = machineData.name && machineData.name.toLowerCase() === \"interior socal\";\n              // if (isSocalInterior) {\n              //   if (isFrom) {\n              //     setShowLocalLocFrom(true);\n              //   } else {\n              //     setShowLocalLocCurrent(true);\n              //   }\n              // } else {\n              // Optionally clear the flag if it is not \"interior socal\"\n              // if (isFrom) {\n              //   setShowLocalLocFrom(false);\n              // } else {\n              //   setShowLocalLocCurrent(false);\n              // }\n              // }\n              // new: fetch client name and combine both checks\n\n              if (!(machineData.client && typeof machineData.client.get === \"function\")) {\n                _context19.next = 13;\n                break;\n              }\n\n              _context19.next = 10;\n              return machineData.client.get();\n\n            case 10:\n              _context19.t0 = _context19.sent;\n              _context19.next = 14;\n              break;\n\n            case 13:\n              _context19.t0 = null;\n\n            case 14:\n              clientDoc = _context19.t0;\n              clientName = clientDoc && clientDoc.exists ? clientDoc.data().name : null;\n              isSocalInterior = ((_machineData$name = machineData.name) === null || _machineData$name === void 0 ? void 0 : _machineData$name.toLowerCase()) === \"interior socal\";\n              shouldShow = isSocalInterior || clientName === \"SoCalWarehouse\";\n\n              if (isFrom) {\n                setShowLocalLocFrom(shouldShow);\n              } else {\n                setShowLocalLocCurrent(shouldShow);\n              }\n\n              if (!(machineData.client && typeof machineData.client.get === \"function\")) {\n                _context19.next = 24;\n                break;\n              }\n\n              _context19.next = 22;\n              return machineData.client.get();\n\n            case 22:\n              _clientDoc2 = _context19.sent;\n\n              if (_clientDoc2.exists) {\n                setClient(_objectSpread({\n                  id: _clientDoc2.id\n                }, _clientDoc2.data()));\n              }\n\n            case 24:\n            case \"end\":\n              return _context19.stop();\n          }\n        }\n      }, _callee19);\n    }));\n    return _resolveClientFromMachine.apply(this, arguments);\n  }\n\n  var fetchData = /*#__PURE__*/function () {\n    var _ref17 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n      var id, db, doc, _machineFromData, _machineFromData$name, _machineCurrentData, _machineCurrentData$n, _selectedClientFrom$n2, _selectedClientCurren2, data, normalizedPN, normalizedSN, clientFromDoc, clientCurrentDoc, machineFromData, machineCurrentData, _doc, _doc2, nameFrom, nameCurrent, theMachineData, _theMachineData$oem, _theMachineData$modal, _theMachineData$model, OEM, Modality, Model, merged, parentDoc;\n\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              id = (initialItem === null || initialItem === void 0 ? void 0 : initialItem.id) || idFromRouter; // <- make sure id exists here\n\n              if (id) {\n                _context7.next = 3;\n                break;\n              }\n\n              return _context7.abrupt(\"return\");\n\n            case 3:\n              setIsLoading(true);\n              db = firebase.firestore();\n              _context7.prev = 5;\n              _context7.next = 8;\n              return db.collection(\"Test\").doc(id).get();\n\n            case 8:\n              doc = _context7.sent;\n\n              if (!doc.exists) {\n                _context7.next = 75;\n                break;\n              }\n\n              console.log(\"test\");\n              data = doc.data();\n              normalizedPN = Array.isArray(data.pn) ? data.pn : [data.pn];\n              normalizedSN = Array.isArray(data.sn) ? data.sn : [data.sn];\n              setItems(_objectSpread(_objectSpread({}, data), {}, {\n                pn: normalizedPN,\n                sn: normalizedSN\n              }));\n              setSavedName(data.name || \"\");\n              setDescriptions(data.descriptions || []);\n              setWorkOrders(data.workOrders || []);\n              if (data.localLocFrom) setLocalLocFrom(data.localLocFrom);\n              if (data.localLocCurrent) setLocalLocCurrent(data.localLocCurrent);\n\n              if (data.DOM) {\n                setDOM(data.DOM);\n              } // …after you do setItems, setDescriptions, etc.\n              // load the “newLocal” maps\n\n\n              if (data.newLocalFrom) setNewLocalFrom(data.newLocalFrom);\n              if (data.newLocalCurrent) setNewLocalCurrent(data.newLocalCurrent); // Load PO Number if it exists.\n\n              if (data.poNumber) {\n                setItems(function (prev) {\n                  return _objectSpread(_objectSpread({}, prev), {}, {\n                    poNumber: data.poNumber\n                  });\n                });\n              }\n\n              if (!data.ClientFrom) {\n                _context7.next = 29;\n                break;\n              }\n\n              _context7.next = 27;\n              return data.ClientFrom.get();\n\n            case 27:\n              clientFromDoc = _context7.sent;\n\n              if (clientFromDoc.exists) {\n                setSelectedClientFrom(_objectSpread({\n                  id: clientFromDoc.id\n                }, clientFromDoc.data()));\n              }\n\n            case 29:\n              if (!data.ClientCurrent) {\n                _context7.next = 34;\n                break;\n              }\n\n              _context7.next = 32;\n              return data.ClientCurrent.get();\n\n            case 32:\n              clientCurrentDoc = _context7.sent;\n\n              if (clientCurrentDoc.exists) {\n                setSelectedClientCurrent(_objectSpread({\n                  id: clientCurrentDoc.id\n                }, clientCurrentDoc.data()));\n              }\n\n            case 34:\n              if (!(!data.ClientFrom && data.Machine && typeof data.Machine.get === \"function\")) {\n                _context7.next = 38;\n                break;\n              }\n\n              console.log(\"Entered resolveClientFromMachine for Machine (old style for From)\");\n              _context7.next = 38;\n              return resolveClientFromMachine(data.Machine, setSelectedClientFrom, setSelectedMachine, true);\n\n            case 38:\n              if (!(!data.ClientCurrent && data.CurrentMachine && typeof data.CurrentMachine.get === \"function\")) {\n                _context7.next = 42;\n                break;\n              }\n\n              console.log(\"Entered resolveClientFromMachine for CurrentMachine (old style for Current)\");\n              _context7.next = 42;\n              return resolveClientFromMachine(data.CurrentMachine, setSelectedClientCurrent, setSelectedCurrentMachine, false);\n\n            case 42:\n              machineFromData = null;\n              machineCurrentData = null;\n\n              if (!data.MachineFrom) {\n                _context7.next = 50;\n                break;\n              }\n\n              _context7.next = 47;\n              return data.MachineFrom.get();\n\n            case 47:\n              _doc = _context7.sent;\n              machineFromData = _doc.exists ? _doc.data() : null;\n              setSelectedMachine(_objectSpread({\n                id: _doc.id\n              }, _doc.data()));\n\n            case 50:\n              if (!data.MachineCurrent) {\n                _context7.next = 56;\n                break;\n              }\n\n              _context7.next = 53;\n              return data.MachineCurrent.get();\n\n            case 53:\n              _doc2 = _context7.sent;\n              machineCurrentData = _doc2.exists ? _doc2.data() : null;\n              setSelectedCurrentMachine(_objectSpread({\n                id: _doc2.id\n              }, _doc2.data()));\n\n            case 56:\n              nameFrom = (_machineFromData = machineFromData) === null || _machineFromData === void 0 ? void 0 : (_machineFromData$name = _machineFromData.name) === null || _machineFromData$name === void 0 ? void 0 : _machineFromData$name.toLowerCase();\n              nameCurrent = (_machineCurrentData = machineCurrentData) === null || _machineCurrentData === void 0 ? void 0 : (_machineCurrentData$n = _machineCurrentData.name) === null || _machineCurrentData$n === void 0 ? void 0 : _machineCurrentData$n.toLowerCase(); // If the machine’s name is “interior socal”, show that branch:\n              // setShowLocalLocFrom(nameFrom === \"interior socal\");\n              // // Or if your Firestore already has a value for localLocFrom, show it anyway:\n              // if (data.localLocFrom) setShowLocalLocFrom(true);\n              // setShowLocalLocCurrent(nameCurrent === \"interior socal\");\n              // if (data.localLocCurrent) setShowLocalLocCurrent(true);\n              // new: combine machine-name OR client-name check, keep existing-data\n\n              setShowLocalLocFrom(nameFrom === \"interior socal\" || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n2 = selectedClientFrom.name) === null || _selectedClientFrom$n2 === void 0 ? void 0 : _selectedClientFrom$n2.toLowerCase()) === \"socalwarehouse\" || Boolean(data.localLocFrom));\n              setShowLocalLocCurrent(nameCurrent === \"interior socal\" || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren2 = selectedClientCurrent.name) === null || _selectedClientCurren2 === void 0 ? void 0 : _selectedClientCurren2.toLowerCase()) === \"socalwarehouse\" || Boolean(data.localLocCurrent));\n              theMachineData = data.TheMachine || null;\n              setTheMachine(theMachineData);\n\n              if (theMachineData) {\n                // pull both variants, prefer lowercase if it exists\n                OEM = (_theMachineData$oem = theMachineData.oem) !== null && _theMachineData$oem !== void 0 ? _theMachineData$oem : theMachineData.OEM;\n                Modality = (_theMachineData$modal = theMachineData.modality) !== null && _theMachineData$modal !== void 0 ? _theMachineData$modal : theMachineData.Modality;\n                Model = (_theMachineData$model = theMachineData.model) !== null && _theMachineData$model !== void 0 ? _theMachineData$model : theMachineData.Model;\n                setTheMachine(_objectSpread(_objectSpread({}, theMachineData), {}, {\n                  OEM: OEM,\n                  Modality: Modality,\n                  Model: Model\n                }));\n              } // setStoredMachine(theMachineData);\n              // **right here** merge from the three sources you just fetched:\n\n\n              merged = updateMachineFields(theMachineData, machineCurrentData, machineFromData);\n              applyMergedMachineFields(merged);\n              console.log(\"SelectedMachine:\", selectedMachine, \"SelectedCurrentMachine:\", selectedCurrentMachine); // Show local loc inputs if applicable\n              // if (\n              //   selectedMachine &&\n              //   selectedMachine.name &&\n              //   selectedMachine.name.toLowerCase() === \"interior socal\"\n              // ) {\n              //   setShowLocalLocFrom(true);\n              // }\n              // if (\n              //   selectedCurrentMachine &&\n              //   selectedCurrentMachine.name &&\n              //   selectedCurrentMachine.name.toLowerCase() === \"interior socal\"\n              // ) {\n              //   setShowLocalLocCurrent(true);\n              // }\n\n              if (!data.Parent) {\n                _context7.next = 71;\n                break;\n              }\n\n              _context7.next = 69;\n              return data.Parent.get();\n\n            case 69:\n              parentDoc = _context7.sent;\n              setSelectedParent(_objectSpread({\n                id: parentDoc.id\n              }, parentDoc.data()));\n\n            case 71:\n              // Priority auto‑population of machine fields.\n              // const updatedFields = updateMachineFields(storedMachine, selectedCurrentMachine, selectedMachine);\n              // // console.log(\"Updated machine fields:\", updatedFields);\n              // setOem(updatedFields.oem);\n              // setModality(updatedFields.modality);\n              // setModel(updatedFields.model);\n              setIsLoading(false);\n              Promise.all([fetchPhotos(id), checkIfAddedToWebsite(id), calculateItemFrequencyAndUsage(data.pn)])[\"catch\"](function (err) {\n                console.error(\"Background item loads failed:\", err);\n              });\n              _context7.next = 76;\n              break;\n\n            case 75:\n              router.push({\n                pathname: \"../AddItem/NewItem\",\n                query: {\n                  signal: id\n                }\n              });\n\n            case 76:\n              _context7.next = 81;\n              break;\n\n            case 78:\n              _context7.prev = 78;\n              _context7.t0 = _context7[\"catch\"](5);\n              console.error(\"Error fetching item:\", _context7.t0);\n\n            case 81:\n              _context7.prev = 81;\n              setIsLoading(false);\n              return _context7.finish(81);\n\n            case 84:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, null, [[5, 78, 81, 84]]);\n    }));\n\n    return function fetchData() {\n      return _ref17.apply(this, arguments);\n    };\n  }();\n\n  var calculateItemFrequencyAndUsage = /*#__PURE__*/function () {\n    var _ref18 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(pn) {\n      var db, currentDate, oneYearAgo, normalizedPN, itemsSnapshot, usagePastYear;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              db = firebase.firestore();\n              currentDate = new Date();\n              oneYearAgo = new Date();\n              oneYearAgo.setFullYear(currentDate.getFullYear() - 1);\n              normalizedPN = pn !== undefined ? pn : \"\";\n              _context8.next = 7;\n              return db.collection(\"Test\").where(\"pn\", \"==\", normalizedPN).get();\n\n            case 7:\n              itemsSnapshot = _context8.sent;\n              setFreqItem(itemsSnapshot.size);\n              usagePastYear = 0;\n              itemsSnapshot.forEach(function (doc) {\n                var itemData = doc.data();\n                itemData.workOrders.forEach(function (workOrder) {\n                  var workOrderDate = new Date(workOrder.date);\n\n                  if (workOrderDate >= oneYearAgo && workOrderDate <= currentDate) {\n                    usagePastYear++;\n                  }\n                });\n              });\n              setUsagePastYear(usagePastYear);\n\n            case 12:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    return function calculateItemFrequencyAndUsage(_x6) {\n      return _ref18.apply(this, arguments);\n    };\n  }();\n\n  var fetchMachine = /*#__PURE__*/function () {\n    var _ref19 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(machineId) {\n      var db, doc, machineData, merged, machinesSnapshot;\n      return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              db = firebase.firestore();\n              _context9.next = 3;\n              return db.collection(\"Machine\").doc(machineId).get();\n\n            case 3:\n              doc = _context9.sent;\n\n              if (!doc.exists) {\n                _context9.next = 15;\n                break;\n              }\n\n              machineData = doc.data();\n              setTheMachine(machineData); // re-merge all three sources with correct priority:\n\n              merged = updateMachineFields(machineData, selectedCurrentMachine, selectedMachine);\n              applyMergedMachineFields(merged, {\n                force: true\n              });\n              _context9.next = 11;\n              return db.collection(\"Machine\").where(\"Model\", \"==\", machineData.Model || machineData.model).get();\n\n            case 11:\n              machinesSnapshot = _context9.sent;\n              setMachineFrequency(machinesSnapshot.size);\n              _context9.next = 16;\n              break;\n\n            case 15:\n              console.error(\"Machine not found\");\n\n            case 16:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee9);\n    }));\n\n    return function fetchMachine(_x7) {\n      return _ref19.apply(this, arguments);\n    };\n  }();\n\n  var fetchPhotos = /*#__PURE__*/function () {\n    var _ref20 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(docID) {\n      var storageRef, listRef, res, urls;\n      return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              storageRef = firebase.storage().ref();\n              listRef = storageRef.child(\"Parts/\".concat(docID));\n              _context10.prev = 2;\n              _context10.next = 5;\n              return listRef.listAll();\n\n            case 5:\n              res = _context10.sent;\n              _context10.next = 8;\n              return Promise.all(res.items.map(function (item) {\n                return item.getDownloadURL();\n              }));\n\n            case 8:\n              urls = _context10.sent;\n              setPhotos(urls.map(function (url) {\n                return {\n                  url: url,\n                  file: null\n                };\n              }));\n              _context10.next = 15;\n              break;\n\n            case 12:\n              _context10.prev = 12;\n              _context10.t0 = _context10[\"catch\"](2);\n              console.error(\"Error fetching photos: \", _context10.t0);\n\n            case 15:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10, null, [[2, 12]]);\n    }));\n\n    return function fetchPhotos(_x8) {\n      return _ref20.apply(this, arguments);\n    };\n  }();\n\n  var checkIfAddedToWebsite = /*#__PURE__*/function () {\n    var _ref21 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(docID) {\n      var db, partsDoc;\n      return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              db = firebase.firestore();\n              _context11.next = 3;\n              return db.collection(\"Parts\").doc(docID).get();\n\n            case 3:\n              partsDoc = _context11.sent;\n\n              if (partsDoc.exists) {\n                setAddToWebsite(true);\n              }\n\n            case 5:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, _callee11);\n    }));\n\n    return function checkIfAddedToWebsite(_x9) {\n      return _ref21.apply(this, arguments);\n    };\n  }();\n\n  var handleClose = function handleClose() {\n    return setShow(false);\n  };\n\n  var handleShow = function handleShow() {\n    return setShow(true);\n  };\n\n  var handleCloseErr = function handleCloseErr() {\n    return setShowErr(false);\n  };\n\n  var handleShowErr = function handleShowErr() {\n    return setShowErr(true);\n  };\n\n  var handleCloseSaveModal = function handleCloseSaveModal() {\n    return setShowSaveModal(false);\n  };\n\n  var handleClosePrintModal = function handleClosePrintModal() {\n    return setShowPrintModal(false);\n  };\n\n  var handleShowSaveModal = function handleShowSaveModal() {\n    return setShowSaveModal(true);\n  };\n\n  var handleShowPrintModal = function handleShowPrintModal() {\n    return setShowPrintModal(true);\n  };\n\n  var handleMachineSelectionModal = function handleMachineSelectionModal() {\n    return setMachineSelectionModal(false);\n  };\n\n  var handleCloseDescModal = function handleCloseDescModal() {\n    return setShowDescModal(false);\n  };\n\n  var handleShowDescModal = function handleShowDescModal() {\n    return setShowDescModal(true);\n  };\n\n  var handleCloseWoModal = function handleCloseWoModal() {\n    return setShowWoModal(false);\n  };\n\n  var handleShowWoModal = function handleShowWoModal() {\n    return setShowWoModal(true);\n  };\n\n  var handleCloseClientModal = function handleCloseClientModal() {\n    return setShowClientModal(false);\n  };\n\n  var handleShowClientModal = /*#__PURE__*/function () {\n    var _ref22 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n      return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n        while (1) {\n          switch (_context12.prev = _context12.next) {\n            case 0:\n              _context12.next = 2;\n              return loadClients();\n\n            case 2:\n              setShowClientModal(true);\n\n            case 3:\n            case \"end\":\n              return _context12.stop();\n          }\n        }\n      }, _callee12);\n    }));\n\n    return function handleShowClientModal() {\n      return _ref22.apply(this, arguments);\n    };\n  }();\n\n  var handleCloseMachineModal = function handleCloseMachineModal() {\n    return setShowMachineModal(false);\n  };\n\n  var handleShowMachineModal = function handleShowMachineModal() {\n    setShowMachineModal(true);\n    setShowClientModal(false);\n  };\n\n  var handleCloseParentModal = function handleCloseParentModal() {\n    return setShowParentModal(false);\n  };\n\n  var handleShowParentModal = function handleShowParentModal() {\n    return setShowParentModal(true);\n  }; // When a client is selected from the client table.\n\n\n  var handleClientInfo = /*#__PURE__*/function () {\n    var _ref23 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13(clientId) {\n      var db, clientDoc, clientData, machinePromises, machineDocs, machines;\n      return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              // Clear any previously selected machine and local loc info for this branch.\n              if (machinePick) {\n                setSelectedMachine(null);\n                setShowLocalLocFrom(false);\n              } else {\n                setSelectedCurrentMachine(null);\n                setShowLocalLocCurrent(false);\n              }\n\n              db = firebase.firestore();\n              _context13.next = 4;\n              return db.collection(\"Client\").doc(clientId).get();\n\n            case 4:\n              clientDoc = _context13.sent;\n\n              if (!clientDoc.exists) {\n                _context13.next = 16;\n                break;\n              }\n\n              clientData = _objectSpread({\n                id: clientDoc.id\n              }, clientDoc.data());\n\n              if (machinePick) {\n                setSelectedClientFrom(clientData);\n              } else {\n                setSelectedClientCurrent(clientData);\n              } // after setting selectedClientFrom/Current:\n\n\n              if (clientData.name === \"SoCalWarehouse\") {\n                if (machinePick) setShowLocalLocFrom(true);else setShowLocalLocCurrent(true);\n              } // Fetch machines for this client:\n\n\n              machinePromises = clientData.machines.map(function (machineRef) {\n                return machineRef.get();\n              });\n              _context13.next = 12;\n              return Promise.all(machinePromises);\n\n            case 12:\n              machineDocs = _context13.sent;\n              machines = machineDocs.map(function (machineDoc) {\n                return _objectSpread({\n                  id: machineDoc.id\n                }, machineDoc.data());\n              });\n              setMachineOptions(machines); // Close the client modal\n\n              handleCloseClientModal();\n\n            case 16:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee13);\n    }));\n\n    return function handleClientInfo(_x10) {\n      return _ref23.apply(this, arguments);\n    };\n  }(); // Reordering function for dropdowns.\n\n\n  var reorderArray = function reorderArray(arr, selectedValue) {\n    var newArr = arr.filter(function (val) {\n      return val !== selectedValue;\n    });\n    return [selectedValue].concat(_toConsumableArray(newArr));\n  };\n\n  var _useState62 = useState(false),\n      addingNewPn = _useState62[0],\n      setAddingNewPn = _useState62[1];\n\n  var _useState63 = useState(\"\"),\n      newPn = _useState63[0],\n      setNewPn = _useState63[1];\n\n  var _useState64 = useState(false),\n      addingNewSn = _useState64[0],\n      setAddingNewSn = _useState64[1];\n\n  var _useState65 = useState(\"\"),\n      newSn = _useState65[0],\n      setNewSn = _useState65[1];\n\n  var handlePnSelect = function handlePnSelect(e) {\n    var selected = e.target.value;\n    setItems(function (prev) {\n      var updatedPn = Array.isArray(prev.pn) ? _toConsumableArray(prev.pn) : [];\n      updatedPn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: updatedPn\n      });\n    });\n  };\n\n  var handleSnSelect = function handleSnSelect(e) {\n    var selected = e.target.value;\n    setItems(function (prev) {\n      var updatedSn = Array.isArray(prev.sn) ? _toConsumableArray(prev.sn) : [];\n      updatedSn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: updatedSn\n      });\n    });\n  };\n\n  var handleAddNewPn = function handleAddNewPn() {\n    if (newPn.trim() !== \"\") {\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          pn: [].concat(_toConsumableArray(prev.pn), [newPn.trim()])\n        });\n      });\n    }\n\n    setNewPn(\"\");\n    setAddingNewPn(false);\n  };\n\n  var handleAddNewSn = function handleAddNewSn() {\n    if (newSn.trim() !== \"\") {\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          sn: [].concat(_toConsumableArray(prev.sn), [newSn.trim()])\n        });\n      });\n    }\n\n    setNewSn(\"\");\n    setAddingNewSn(false);\n  }; // Generate custom document ID if needed.\n\n\n  var generateCustomID = function generateCustomID() {\n    var randomNum = Math.floor(10000 + Math.random() * 90000);\n    return \"AIS\".concat(randomNum);\n  };\n\n  function shallowClean(obj) {\n    var newObj = {};\n\n    for (var key in obj) {\n      console.log(key, obj[key]);\n\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = obj[key] === undefined ? \"\" : obj[key];\n      }\n    }\n\n    return newObj;\n  }\n\n  function toSend() {\n    return _toSend.apply(this, arguments);\n  } // Additional state for local warehouse location inputs.\n\n\n  function _toSend() {\n    _toSend = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee20() {\n      var _fromDetails$section, _fromDetails$section2, _currentDetails$secti, _currentDetails$secti2;\n\n      var db, currentUser, userEmail, storedOem, storedModality, storedModel, machineData, formattedItems, fromDetails, currentDetails, docId, newDocId, machineRef, machineDoc, currentMachineRef, currentMachineDoc, cleanFormattedItems, _machineRef, _machineDoc, _currentMachineRef, _currentMachineDoc, _machineRef2, _machineDoc2, _currentMachineRef2, _currentMachineDoc2, selections, updated;\n\n      return _regeneratorRuntime.wrap(function _callee20$(_context20) {\n        while (1) {\n          switch (_context20.prev = _context20.next) {\n            case 0:\n              db = firebase.firestore();\n              currentUser = firebase.auth().currentUser;\n              userEmail = currentUser ? currentUser.email : \"unknown\"; // Always use the current state values for OEM, modality, and model.\n\n              storedOem = selectionToStoredValue(selectedOems);\n              storedModality = selectionToStoredValue(selectedModalities);\n              storedModel = selectionToStoredValue(selectedModels);\n              machineData = _objectSpread(_objectSpread({}, TheMachine || {}), {}, {\n                oem: storedOem,\n                OEM: storedOem,\n                modality: storedModality,\n                Modality: storedModality,\n                model: storedModel,\n                Model: storedModel\n              });\n              formattedItems = _objectSpread(_objectSpread({}, items), {}, {\n                descriptions: descriptions,\n                workOrders: workOrders\n              }); // Remove any unused fields.\n\n              formattedItems.status = items.status || \"\";\n              formattedItems.nameLower = (items.name || \"\").toLowerCase();\n              formattedItems.nameTokens = buildNameTokens(items.name);\n              formattedItems.DOM = DOM; // Date of Manufacture\n\n              formattedItems.localLocFrom = localLocFrom || \"\";\n              formattedItems.localLocCurrent = localLocCurrent || \"\";\n              formattedItems.date = items.date || \"\";\n              formattedItems.arrival_date = items.arrival_date || \"\"; // NEW: Arrival Date\n\n              formattedItems.poNumber = items.poNumber || \"\";\n              formattedItems.trackingNumber = items.trackingNumber || \"\";\n              formattedItems.TheMachine = machineData || {};\n              formattedItems.addedToWebsite = addToWebsite; // NEW: Add the user's email under the field \"user\"\n\n              formattedItems.lastEdited = userEmail; // Clean pn and sn arrays to replace undefined values with an empty string.\n\n              formattedItems.pn = (items.pn || []).map(function (value) {\n                return value === undefined ? \"\" : value;\n              });\n              formattedItems.sn = (items.sn || []).map(function (value) {\n                return value === undefined ? \"\" : value;\n              });\n              fromDetails = buildLocalLocObject(newLocalFrom);\n              currentDetails = buildLocalLocObject(newLocalCurrent);\n              console.log(\"From Details: \" + fromDetails.region + \" \" + ((_fromDetails$section = fromDetails.section) === null || _fromDetails$section === void 0 ? void 0 : _fromDetails$section.letter) + ((_fromDetails$section2 = fromDetails.section) === null || _fromDetails$section2 === void 0 ? void 0 : _fromDetails$section2.number) + \" \" + fromDetails.bin + \" \" + fromDetails.pallet);\n              console.log(\"Current Details: \" + currentDetails.region + \" \" + ((_currentDetails$secti = currentDetails.section) === null || _currentDetails$secti === void 0 ? void 0 : _currentDetails$secti.letter) + ((_currentDetails$secti2 = currentDetails.section) === null || _currentDetails$secti2 === void 0 ? void 0 : _currentDetails$secti2.number) + \" \" + currentDetails.bin + \" \" + currentDetails.pallet);\n\n              if (Object.keys(fromDetails).length) {\n                formattedItems.newLocalFrom = fromDetails;\n                formattedItems.localLocFrom = formatLoc(newLocalFrom) || \"\";\n              } else {\n                // all fields empty — force an empty string and remove any stray map\n                console.log(\"entered empty fromDetails else\");\n                formattedItems.localLocFrom = \"\";\n                formattedItems.newLocalFrom = {};\n              }\n\n              if (Object.keys(currentDetails).length) {\n                formattedItems.newLocalCurrent = currentDetails;\n                formattedItems.localLocCurrent = formatLoc(newLocalCurrent) || \"\";\n              } else {\n                // all fields empty — force an empty string and remove any stray map\n                formattedItems.localLocCurrent = \"\";\n                formattedItems.newLocalCurrent = {};\n              }\n\n              if (selectedMachine && selectedMachine.id) {\n                formattedItems.MachineFrom = db.collection(\"Machine\").doc(selectedMachine.id);\n              }\n\n              if (selectedCurrentMachine && selectedCurrentMachine.id) {\n                formattedItems.MachineCurrent = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n              }\n\n              if (selectedParent && selectedParent.id) {\n                formattedItems.Parent = db.collection(\"Test\").doc(selectedParent.id);\n              } // NEW: Set separate client references.\n\n\n              if (selectedClientFrom && selectedClientFrom.id) {\n                formattedItems.ClientFrom = db.collection(\"Client\").doc(selectedClientFrom.id);\n              }\n\n              if (selectedClientCurrent && selectedClientCurrent.id) {\n                formattedItems.ClientCurrent = db.collection(\"Client\").doc(selectedClientCurrent.id);\n              } // Only attach the richer “newLocal” map when the user actually filled something in\n\n\n              if (Object.keys(fromDetails).length) {\n                formattedItems.newLocalFrom = fromDetails;\n              }\n\n              if (Object.keys(currentDetails).length) {\n                formattedItems.newLocalCurrent = currentDetails;\n              }\n\n              docId = id;\n              _context20.prev = 37;\n\n              if (!docId) {\n                _context20.next = 85;\n                break;\n              }\n\n              // Check if a localSN is provided and if it differs from the current docId.\n              newDocId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : docId;\n\n              if (!(docId !== newDocId)) {\n                _context20.next = 64;\n                break;\n              }\n\n              _context20.next = 43;\n              return db.collection(\"Test\").doc(newDocId).set(formattedItems);\n\n            case 43:\n              if (!(selectedMachine && selectedMachine.id)) {\n                _context20.next = 51;\n                break;\n              }\n\n              machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n              _context20.next = 47;\n              return machineRef.get();\n\n            case 47:\n              machineDoc = _context20.sent;\n\n              if (!machineDoc.exists) {\n                _context20.next = 51;\n                break;\n              }\n\n              _context20.next = 51;\n              return machineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(newDocId))\n              });\n\n            case 51:\n              if (!(selectedCurrentMachine && selectedCurrentMachine.id)) {\n                _context20.next = 59;\n                break;\n              }\n\n              currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n              _context20.next = 55;\n              return currentMachineRef.get();\n\n            case 55:\n              currentMachineDoc = _context20.sent;\n\n              if (!currentMachineDoc.exists) {\n                _context20.next = 59;\n                break;\n              }\n\n              _context20.next = 59;\n              return currentMachineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(newDocId))\n              });\n\n            case 59:\n              _context20.next = 61;\n              return db.collection(\"Test\").doc(docId)[\"delete\"]();\n\n            case 61:\n              // Set docId to the new document ID.\n              docId = newDocId;\n              _context20.next = 83;\n              break;\n\n            case 64:\n              // Deep-clean the formattedItems to remove any undefined nested values.\n              cleanFormattedItems = shallowClean(formattedItems);\n              _context20.next = 67;\n              return db.collection(\"Test\").doc(docId).update(cleanFormattedItems);\n\n            case 67:\n              if (!(selectedMachine && selectedMachine.id)) {\n                _context20.next = 75;\n                break;\n              }\n\n              _machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n              _context20.next = 71;\n              return _machineRef.get();\n\n            case 71:\n              _machineDoc = _context20.sent;\n\n              if (!_machineDoc.exists) {\n                _context20.next = 75;\n                break;\n              }\n\n              _context20.next = 75;\n              return _machineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n\n            case 75:\n              if (!(selectedCurrentMachine && selectedCurrentMachine.id)) {\n                _context20.next = 83;\n                break;\n              }\n\n              _currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n              _context20.next = 79;\n              return _currentMachineRef.get();\n\n            case 79:\n              _currentMachineDoc = _context20.sent;\n\n              if (!_currentMachineDoc.exists) {\n                _context20.next = 83;\n                break;\n              }\n\n              _context20.next = 83;\n              return _currentMachineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n\n            case 83:\n              _context20.next = 104;\n              break;\n\n            case 85:\n              // For a new item, if localSN is provided, use it; otherwise, generate a custom ID.\n              docId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : generateCustomID();\n              _context20.next = 88;\n              return db.collection(\"Test\").doc(docId).set(formattedItems);\n\n            case 88:\n              if (!(selectedMachine && selectedMachine.id)) {\n                _context20.next = 96;\n                break;\n              }\n\n              _machineRef2 = db.collection(\"Machine\").doc(selectedMachine.id);\n              _context20.next = 92;\n              return _machineRef2.get();\n\n            case 92:\n              _machineDoc2 = _context20.sent;\n\n              if (!_machineDoc2.exists) {\n                _context20.next = 96;\n                break;\n              }\n\n              _context20.next = 96;\n              return _machineRef2.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n\n            case 96:\n              if (!(selectedCurrentMachine && selectedCurrentMachine.id)) {\n                _context20.next = 104;\n                break;\n              }\n\n              _currentMachineRef2 = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n              _context20.next = 100;\n              return _currentMachineRef2.get();\n\n            case 100:\n              _currentMachineDoc2 = _context20.sent;\n\n              if (!_currentMachineDoc2.exists) {\n                _context20.next = 104;\n                break;\n              }\n\n              _context20.next = 104;\n              return _currentMachineRef2.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n\n            case 104:\n              _context20.prev = 104;\n              selections = {\n                modalities: selectedModalities,\n                oems: selectedOems,\n                models: selectedModels\n              };\n              _context20.next = 108;\n              return syncTrackerFromSelections({\n                selections: selections,\n                catalog: trackerCatalog\n              });\n\n            case 108:\n              updated = _context20.sent;\n\n              if (updated) {\n                loadTracker(true);\n              }\n\n              _context20.next = 115;\n              break;\n\n            case 112:\n              _context20.prev = 112;\n              _context20.t0 = _context20[\"catch\"](104);\n              console.error(\"Failed to sync tracker selections:\", _context20.t0);\n\n            case 115:\n              _context20.next = 117;\n              return uploadPhotos(docId);\n\n            case 117:\n              console.log(\"Item saved and associatedParts updated!\");\n              setSavedName(items.name || \"\"); // Redirect to the new URL using the new document id.\n\n              router.push(\"/NewSearch/item/\".concat(docId)); // Optionally, you can also show a save confirmation modal:\n\n              handleShowSaveModal();\n              _context20.next = 126;\n              break;\n\n            case 123:\n              _context20.prev = 123;\n              _context20.t1 = _context20[\"catch\"](37);\n              console.error(\"Error saving data:\", _context20.t1);\n\n            case 126:\n            case \"end\":\n              return _context20.stop();\n          }\n        }\n      }, _callee20, null, [[37, 123], [104, 112]]);\n    }));\n    return _toSend.apply(this, arguments);\n  }\n\n  var _useState66 = useState(false),\n      showLocalLocFrom = _useState66[0],\n      setShowLocalLocFrom = _useState66[1];\n\n  var _useState67 = useState(false),\n      showLocalLocCurrent = _useState67[0],\n      setShowLocalLocCurrent = _useState67[1]; // When a machine is selected from the modal.\n\n\n  var handleSetSelectedMachine = function handleSetSelectedMachine(machine) {\n    var _machine$name;\n\n    // const condition = (name) => name && name.toLowerCase() === \"interior socal\";\n    var isSocalInterior = ((_machine$name = machine.name) === null || _machine$name === void 0 ? void 0 : _machine$name.toLowerCase()) === \"interior socal\";\n\n    if (machinePick) {\n      var _selectedClientFrom$n3;\n\n      setSelectedMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocFrom(isSocalInterior || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n3 = selectedClientFrom.name) === null || _selectedClientFrom$n3 === void 0 ? void 0 : _selectedClientFrom$n3.toLowerCase()) === \"socalwarehouse\");\n    } else {\n      var _selectedClientCurren3;\n\n      setSelectedCurrentMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocCurrent(isSocalInterior || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren3 = selectedClientCurrent.name) === null || _selectedClientCurren3 === void 0 ? void 0 : _selectedClientCurren3.toLowerCase()) === \"socalwarehouse\");\n    }\n\n    fetchMachine(machine.id); // Close the machine modal (assuming you're using showMachineModal to control it)\n\n    setShowMachineModal(false);\n  };\n\n  var uploadPhotos = /*#__PURE__*/function () {\n    var _ref24 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14(docID) {\n      var storageRef, i, photoRef, metadata, url;\n      return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n        while (1) {\n          switch (_context14.prev = _context14.next) {\n            case 0:\n              storageRef = firebase.storage().ref();\n              i = 0;\n\n            case 2:\n              if (!(i < photos.length)) {\n                _context14.next = 15;\n                break;\n              }\n\n              if (!photos[i].file) {\n                _context14.next = 12;\n                break;\n              }\n\n              photoRef = storageRef.child(\"Parts/\".concat(docID, \"/\").concat(docID).concat(i === 0 ? \".jpg\" : \".\".concat(i + 1, \".jpg\")));\n              metadata = {\n                contentType: \"image/png\"\n              };\n              _context14.next = 8;\n              return photoRef.put(photos[i].file, metadata);\n\n            case 8:\n              _context14.next = 10;\n              return photoRef.getDownloadURL();\n\n            case 10:\n              url = _context14.sent;\n              photos[i].url = url;\n\n            case 12:\n              i++;\n              _context14.next = 2;\n              break;\n\n            case 15:\n            case \"end\":\n              return _context14.stop();\n          }\n        }\n      }, _callee14);\n    }));\n\n    return function uploadPhotos(_x11) {\n      return _ref24.apply(this, arguments);\n    };\n  }(); // Function to handle printing the label.\n\n\n  var handlePrint = /*#__PURE__*/function () {\n    var _ref25 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n      var clientName, machineDoc, machineData, clientDoc, _clientDoc, payload, response, result;\n\n      return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n        while (1) {\n          switch (_context15.prev = _context15.next) {\n            case 0:\n              if (items.name) {\n                _context15.next = 3;\n                break;\n              }\n\n              alert(\"Missing name\");\n              return _context15.abrupt(\"return\");\n\n            case 3:\n              clientName = \"\"; // Attempt to fetch client name from the Machine document reference.\n\n              if (!(items.Machine && typeof items.Machine.get === \"function\")) {\n                _context15.next = 23;\n                break;\n              }\n\n              _context15.prev = 5;\n              _context15.next = 8;\n              return items.Machine.get();\n\n            case 8:\n              machineDoc = _context15.sent;\n\n              if (!machineDoc.exists) {\n                _context15.next = 16;\n                break;\n              }\n\n              machineData = machineDoc.data();\n\n              if (!(machineData.client && typeof machineData.client.get === \"function\")) {\n                _context15.next = 16;\n                break;\n              }\n\n              _context15.next = 14;\n              return machineData.client.get();\n\n            case 14:\n              clientDoc = _context15.sent;\n\n              if (clientDoc.exists) {\n                clientName = clientDoc.data().name || \"\";\n              }\n\n            case 16:\n              _context15.next = 21;\n              break;\n\n            case 18:\n              _context15.prev = 18;\n              _context15.t0 = _context15[\"catch\"](5);\n              console.error(\"Error fetching machine or client:\", _context15.t0);\n\n            case 21:\n              _context15.next = 24;\n              break;\n\n            case 23:\n              console.warn(\"No Machine reference available in the item\");\n\n            case 24:\n              console.log(clientName, \":\", items.client); // Fallback: if no client name was found, check items.client.\n\n              if (!(!clientName && items.client)) {\n                _context15.next = 40;\n                break;\n              }\n\n              if (!(typeof items.client.get === \"function\")) {\n                _context15.next = 39;\n                break;\n              }\n\n              _context15.prev = 27;\n              _context15.next = 30;\n              return items.client.get();\n\n            case 30:\n              _clientDoc = _context15.sent;\n\n              if (_clientDoc.exists) {\n                clientName = _clientDoc.data().name || \"\";\n              }\n\n              _context15.next = 37;\n              break;\n\n            case 34:\n              _context15.prev = 34;\n              _context15.t1 = _context15[\"catch\"](27);\n              console.error(\"Error fetching client from items.client:\", _context15.t1);\n\n            case 37:\n              _context15.next = 40;\n              break;\n\n            case 39:\n              clientName = items.client;\n\n            case 40:\n              console.log(\"descriptions:\", descriptions[selectedDesc]);\n              payload = {\n                name: items.name,\n                pn: items.pn,\n                sn: items.sn,\n                wo: workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\",\n                client: clientName,\n                status: items.status,\n                local_sn: id,\n                descriptions: [descriptions[selectedDesc] || {\n                  description: \"\",\n                  date: \"\"\n                }],\n                date: items.dateCreated || \"\",\n                DOM: DOM,\n                oem: selectionToPrintValue(selectedOems),\n                modality: selectionToPrintValue(selectedModalities),\n                model: selectionToPrintValue(selectedModels),\n                poNumber: items.poNumber,\n                arrival_date: items.arrival_date // NEW: Include arrival_date\n\n              };\n              console.log(\"Payload for printing:\", payload);\n              _context15.prev = 43;\n              _context15.next = 46;\n              return fetch(\"https://9d70-174-76-22-138.ngrok-free.app/print-label\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 46:\n              response = _context15.sent;\n              _context15.next = 49;\n              return response.json();\n\n            case 49:\n              result = _context15.sent;\n              console.log(\"Print result:\", result.status);\n\n              if (result.status.includes(\"successfully.\")) {\n                handleShowPrintModal();\n              } else {\n                console.error(\"Error printing label:\", result.error);\n              }\n\n              _context15.next = 57;\n              break;\n\n            case 54:\n              _context15.prev = 54;\n              _context15.t2 = _context15[\"catch\"](43);\n              console.error(\"Error printing label:\", _context15.t2);\n\n            case 57:\n            case \"end\":\n              return _context15.stop();\n          }\n        }\n      }, _callee15, null, [[5, 18], [27, 34], [43, 54]]);\n    }));\n\n    return function handlePrint() {\n      return _ref25.apply(this, arguments);\n    };\n  }();\n\n  function handleSubmit(_x12) {\n    return _handleSubmit.apply(this, arguments);\n  } // Handlers for input changes.\n\n\n  function _handleSubmit() {\n    _handleSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee21(event) {\n      return _regeneratorRuntime.wrap(function _callee21$(_context21) {\n        while (1) {\n          switch (_context21.prev = _context21.next) {\n            case 0:\n              event.preventDefault(); // Only check that the Name field is filled out.\n\n              if (!items.name) {\n                handleShow(); // This shows the \"missing field\" modal.\n              } else {\n                toSend();\n              }\n\n            case 2:\n            case \"end\":\n              return _context21.stop();\n          }\n        }\n      }, _callee21);\n    }));\n    return _handleSubmit.apply(this, arguments);\n  }\n\n  var handleChange = function handleChange(field) {\n    return function (event) {\n      var value = event.target ? event.target.value : event.value;\n      setItems(function (prevItems) {\n        return _objectSpread(_objectSpread({}, prevItems), {}, _defineProperty({}, field, value));\n      });\n    };\n  };\n\n  var addDescription = function addDescription() {\n    setDescriptions([].concat(_toConsumableArray(descriptions), [{\n      description: \"\",\n      date: \"\"\n    }]));\n  };\n\n  var removeDescription = function removeDescription(index) {\n    setDescriptions(descriptions.filter(function (_, i) {\n      return i !== index;\n    }));\n  };\n\n  var handleDescriptionChange = function handleDescriptionChange(index, field, value) {\n    var newDescriptions = descriptions.map(function (desc, i) {\n      return i === index ? _objectSpread(_objectSpread({}, desc), {}, _defineProperty({}, field, value)) : desc;\n    });\n    setDescriptions(newDescriptions);\n  };\n\n  var addWorkOrder = function addWorkOrder() {\n    setWorkOrders([].concat(_toConsumableArray(workOrders), [{\n      workOrder: \"\",\n      date: \"\"\n    }]));\n  };\n\n  var removeWorkOrder = function removeWorkOrder(index) {\n    setWorkOrders(workOrders.filter(function (_, i) {\n      return i !== index;\n    }));\n  };\n\n  var handleWorkOrderChange = function handleWorkOrderChange(index, field, value) {\n    var newWorkOrders = workOrders.map(function (wo, i) {\n      return i === index ? _objectSpread(_objectSpread({}, wo), {}, _defineProperty({}, field, value)) : wo;\n    });\n    setWorkOrders(newWorkOrders);\n  };\n\n  var listDescriptions = function listDescriptions() {\n    setShowDescModal(true);\n  };\n\n  var selectDescription = function selectDescription(index) {\n    setSelectedDesc(index);\n    setShowDescModal(false);\n  };\n\n  var handleShowCameraModal = function handleShowCameraModal() {\n    setShowCameraModal(true);\n  };\n\n  var handleCloseCameraModal = function handleCloseCameraModal() {\n    setShowCameraModal(false);\n    setCapturedPhoto(null);\n  };\n\n  var handleCapture = function handleCapture(err, result) {\n    if (result) {\n      setCapturedPhoto(result);\n    }\n  };\n\n  var savePhoto = function savePhoto() {\n    setPhotos(function (prevPhotos) {\n      return [].concat(_toConsumableArray(prevPhotos), [{\n        file: capturedPhoto,\n        url: URL.createObjectURL(capturedPhoto)\n      }]);\n    });\n    setCapturedPhoto(null);\n    handleCloseCameraModal();\n  };\n\n  var removePhoto = function removePhoto(index) {\n    setPhotos(photos.filter(function (_, i) {\n      return i !== index;\n    }));\n  };\n\n  var mostRecentWorkOrder = workOrders && workOrders.length > 0 ? workOrders.reduce(function (latest, current) {\n    var latestDate = new Date(latest.date);\n    var currentDate = new Date(current.date);\n    return currentDate > latestDate ? current : latest;\n  }, workOrders[0]) : {};\n\n  var capturePhoto = function capturePhoto() {\n    var video = document.querySelector(\"video\");\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    var context = canvas.getContext(\"2d\");\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob(function (blob) {\n      setCapturedPhoto(blob);\n    }, \"image/png\");\n  };\n\n  var handleShowInfoModal = /*#__PURE__*/function () {\n    var _ref26 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee16() {\n      var db, doc, data;\n      return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n        while (1) {\n          switch (_context16.prev = _context16.next) {\n            case 0:\n              db = firebase.firestore();\n              _context16.prev = 1;\n              _context16.next = 4;\n              return db.collection(\"Test\").doc(id).get();\n\n            case 4:\n              doc = _context16.sent;\n\n              if (doc.exists) {\n                data = doc.data();\n                setItemName(data.name || \"N/A\");\n                setShowInfoModal(true);\n              } else {\n                console.error(\"Item not found\");\n              }\n\n              _context16.next = 11;\n              break;\n\n            case 8:\n              _context16.prev = 8;\n              _context16.t0 = _context16[\"catch\"](1);\n              console.error(\"Error fetching item info:\", _context16.t0);\n\n            case 11:\n            case \"end\":\n              return _context16.stop();\n          }\n        }\n      }, _callee16, null, [[1, 8]]);\n    }));\n\n    return function handleShowInfoModal() {\n      return _ref26.apply(this, arguments);\n    };\n  }();\n\n  var handleCloseInfoModal = function handleCloseInfoModal() {\n    return setShowInfoModal(false);\n  };\n\n  var handleCloneToNewItem = function handleCloneToNewItem() {\n    if (!id) {\n      setErr(\"Item ID not ready yet.\");\n      setShowErr(true);\n      return;\n    }\n\n    router.push(\"/NewSearch/AddItem/NewItem?cloneFrom=\".concat(encodeURIComponent(id)));\n  };\n\n  var handlePnChange = function handlePnChange(index, value) {\n    setItems(function (prev) {\n      var newPn = _toConsumableArray(prev.pn);\n\n      newPn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: newPn\n      });\n    });\n  };\n\n  var addPn = function addPn() {\n    setItems(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: [].concat(_toConsumableArray(prev.pn), [\"\"])\n      });\n    });\n  };\n\n  var handleSnChange = function handleSnChange(index, value) {\n    setItems(function (prev) {\n      var newSn = _toConsumableArray(prev.sn);\n\n      newSn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: newSn\n      });\n    });\n  };\n\n  var addSn = function addSn() {\n    setItems(function (prev) {\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: [].concat(_toConsumableArray(prev.sn), [\"\"])\n      });\n    });\n  };\n\n  var browseInputRef = useRef(null);\n\n  var handleBrowsePhotos = function handleBrowsePhotos() {\n    if (browseInputRef.current) {\n      browseInputRef.current.click();\n    }\n  };\n\n  var handleFilesSelected = function handleFilesSelected(e) {\n    var files = e.target.files;\n\n    if (files.length) {\n      var newPhotos = [];\n\n      for (var i = 0; i < files.length; i++) {\n        newPhotos.push({\n          file: files[i],\n          url: URL.createObjectURL(files[i])\n        });\n      }\n\n      setPhotos(function (prevPhotos) {\n        return [].concat(_toConsumableArray(prevPhotos), newPhotos);\n      });\n    }\n\n    e.target.value = \"\";\n  };\n\n  var _useState68 = useState(0),\n      currentPnIndex = _useState68[0],\n      setCurrentPnIndex = _useState68[1];\n\n  var _useState69 = useState(false),\n      showDropdown = _useState69[0],\n      setShowDropdown = _useState69[1];\n\n  var _useState70 = useState(0),\n      currentSnIndex = _useState70[0],\n      setCurrentSnIndex = _useState70[1];\n\n  var _useState71 = useState(false),\n      showSnDropdown = _useState71[0],\n      setShowSnDropdown = _useState71[1];\n\n  useEffect(function () {\n    if (showDropdown || showSnDropdown) {\n      loadPnSnOptions();\n    }\n  }, [showDropdown, showSnDropdown]);\n\n  var handleAddNewClient = function handleAddNewClient() {\n    var randomNum = Math.floor(10000 + Math.random() * 90000);\n    router.push(\"../client/AIS\".concat(randomNum, \"/addClient?from=item&itemId=\").concat(id || \"\"));\n  };\n\n  var handleBluefolderButton = /*#__PURE__*/function () {\n    var _ref27 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee17() {\n      var _descriptions$selecte2;\n\n      var currentWorkOrder, payload, response, result;\n      return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n        while (1) {\n          switch (_context17.prev = _context17.next) {\n            case 0:\n              // Check that the work order field is filled out (using workOrders[0].workOrder as current)\n              currentWorkOrder = workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\";\n\n              if (currentWorkOrder) {\n                _context17.next = 4;\n                break;\n              }\n\n              alert(\"Please fill out the work order field before adding to BlueFolder.\");\n              return _context17.abrupt(\"return\");\n\n            case 4:\n              // Build the payload to send to your proxy endpoint.\n              payload = {\n                name: items.name,\n                pn: items.pn[0] || \"\",\n                sn: items.sn[0] || \"\",\n                status: items.status,\n                description: ((_descriptions$selecte2 = descriptions[selectedDesc]) === null || _descriptions$selecte2 === void 0 ? void 0 : _descriptions$selecte2.description) || \"\",\n                workOrder: currentWorkOrder,\n                localsn: items.localSN || \"\"\n              };\n              _context17.prev = 5;\n              _context17.next = 8;\n              return fetch(\"https://9d70-174-76-22-138.ngrok-free.app/bluefolder\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 8:\n              response = _context17.sent;\n              _context17.next = 11;\n              return response.json();\n\n            case 11:\n              result = _context17.sent;\n              alert(\"BlueFolder service item added successfully!\");\n              console.log(\"BlueFolder result:\", result);\n              _context17.next = 20;\n              break;\n\n            case 16:\n              _context17.prev = 16;\n              _context17.t0 = _context17[\"catch\"](5);\n              console.error(\"BlueFolder error:\", _context17.t0);\n              alert(\"Error adding data to BlueFolder.\");\n\n            case 20:\n            case \"end\":\n              return _context17.stop();\n          }\n        }\n      }, _callee17, null, [[5, 16]]);\n    }));\n\n    return function handleBluefolderButton() {\n      return _ref27.apply(this, arguments);\n    };\n  }(); // // Slack integration handler.\n  // const handleAddToSlack = async (which) => {\n  //   try {\n  //     const pn0 = Array.isArray(items.pn) ? items.pn[0] : items.pn;\n  //     const sn0 = Array.isArray(items.sn) ? items.sn[0] : items.sn;\n  //     const linkUrl = typeof window !== \"undefined\" ? window.location.href : \"\";\n  //     const safeName = (items?.name || id || \"Untitled\").trim();\n  //     const title = `${safeName}${id ? ` (${id})` : \"\"}`;\n  //     console.log(\"[SLACK][handleAddToSlack] which:\", which);\n  //     console.log(\"[SLACK] title:\", title);\n  //     console.log(\"[SLACK] PN:\", items.pn, \"SN:\", items.sn);\n  //     const resp = await fetch(\"/api/slack/add-to-list\", {\n  //       method: \"POST\",\n  //       headers: { \"Content-Type\": \"application/json\" },\n  //       body: JSON.stringify({\n  //         listKey: which,      // \"shipping\" | \"receiving\" | \"tasks\"\n  //         title,\n  //         pn: items.pn,\n  //         sn: items.sn,\n  //         // keeping it minimal by design while we stabilize PN/SN\n  //         linkUrl,\n  //       }),\n  //     });\n  // Slack integration handler (drop-in replacement)\n  // Slack integration handler (drop-in replacement)\n  // Slack integration handler (client) — replace your existing handleAddToSlack with this\n\n\n  var handleAddToSlack = /*#__PURE__*/function () {\n    var _ref28 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee18() {\n      var which,\n          _sort$,\n          _ref29,\n          _items$trackingNumber,\n          _firebase$auth$curren,\n          _json$debug,\n          _json$debug2,\n          safeName,\n          title,\n          pn0,\n          sn0,\n          pn_sn,\n          mostRecentWO,\n          description,\n          tracking,\n          local_sn,\n          photoUrls,\n          idToken,\n          resp,\n          json,\n          _args18 = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee18$(_context18) {\n        while (1) {\n          switch (_context18.prev = _context18.next) {\n            case 0:\n              which = _args18.length > 0 && _args18[0] !== undefined ? _args18[0] : \"shipping\";\n              _context18.prev = 1;\n              safeName = ((items === null || items === void 0 ? void 0 : items.name) || id || \"Untitled\").trim();\n              title = \"\".concat(safeName).concat(id ? \" (\".concat(id, \")\") : \"\");\n              pn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.pn) ? items.pn[0] : items === null || items === void 0 ? void 0 : items.pn;\n              sn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.sn) ? items.sn[0] : items === null || items === void 0 ? void 0 : items.sn;\n              pn_sn = [pn0 && \"PN: \".concat(pn0), sn0 && \"SN: \".concat(sn0)].filter(Boolean).join(\"  \");\n              mostRecentWO = workOrders && workOrders.length ? (_sort$ = _toConsumableArray(workOrders).sort(function (a, b) {\n                return new Date((b === null || b === void 0 ? void 0 : b.date) || 0) - new Date((a === null || a === void 0 ? void 0 : a.date) || 0);\n              })[0]) === null || _sort$ === void 0 ? void 0 : _sort$.workOrder : \"\";\n              description = selectedDesc != null && descriptions !== null && descriptions !== void 0 && descriptions[selectedDesc] ? descriptions[selectedDesc].description || \"\" : (items === null || items === void 0 ? void 0 : items.description) || \"\";\n              tracking = (_ref29 = (_items$trackingNumber = items === null || items === void 0 ? void 0 : items.trackingNumber) !== null && _items$trackingNumber !== void 0 ? _items$trackingNumber : items === null || items === void 0 ? void 0 : items.tracking) !== null && _ref29 !== void 0 ? _ref29 : \"\";\n              local_sn = id || (items === null || items === void 0 ? void 0 : items.localSN) || \"\";\n              photoUrls = Array.isArray(photos) ? photos.map(function (p) {\n                return p === null || p === void 0 ? void 0 : p.url;\n              }).filter(Boolean) : [];\n              _context18.next = 14;\n              return (_firebase$auth$curren = firebase.auth().currentUser) === null || _firebase$auth$curren === void 0 ? void 0 : _firebase$auth$curren.getIdToken();\n\n            case 14:\n              idToken = _context18.sent;\n              _context18.next = 17;\n              return fetch(\"/api/slack/add-to-list\", {\n                method: \"POST\",\n                headers: _objectSpread({\n                  \"Content-Type\": \"application/json\"\n                }, idToken ? {\n                  Authorization: \"Bearer \".concat(idToken)\n                } : {}),\n                body: JSON.stringify({\n                  listKey: which,\n                  title: title,\n                  pn_sn: pn_sn,\n                  // <— server expects this\n                  work_order: mostRecentWO || \"\",\n                  local_sn: local_sn,\n                  tracking: tracking,\n                  description: (description || \"\").trim(),\n                  photoUrls: photoUrls // array of https URLs\n\n                })\n              });\n\n            case 17:\n              resp = _context18.sent;\n              _context18.next = 20;\n              return resp.json();\n\n            case 20:\n              json = _context18.sent;\n              console.log(\"[SLACK][handleAddToSlack] response:\", json);\n              if (json !== null && json !== void 0 && (_json$debug = json.debug) !== null && _json$debug !== void 0 && _json$debug.steps) console.table(json.debug.steps);\n              if (json !== null && json !== void 0 && (_json$debug2 = json.debug) !== null && _json$debug2 !== void 0 && _json$debug2.photos) console.table(json.debug.photos);\n\n              if (!(!resp.ok || !(json !== null && json !== void 0 && json.ok))) {\n                _context18.next = 28;\n                break;\n              }\n\n              setErr(\"Slack add failed: \".concat((json === null || json === void 0 ? void 0 : json.error) || \"unknown error\"));\n              setShowErr(true);\n              return _context18.abrupt(\"return\");\n\n            case 28:\n              alert(\"Added to Slack \".concat(which === \"shipping\" ? \"Shipping\" : which === \"receiving\" ? \"Receiving\" : \"Tasks\", \" list.\"));\n              _context18.next = 36;\n              break;\n\n            case 31:\n              _context18.prev = 31;\n              _context18.t0 = _context18[\"catch\"](1);\n              console.error(_context18.t0);\n              setErr(\"Error adding to Slack\");\n              setShowErr(true);\n\n            case 36:\n            case \"end\":\n              return _context18.stop();\n          }\n        }\n      }, _callee18, null, [[1, 31]]);\n    }));\n\n    return function handleAddToSlack() {\n      return _ref28.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(LoggedIn, null, isLoading && __jsx(\"div\", {\n    className: styles.loadingOverlay\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading Magmo\",\n    className: styles.loadingLogo\n  })), __jsx(\"div\", null, __jsx(Modal, {\n    show: show,\n    onHide: handleClose\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Error\")), __jsx(Modal.Body, null, \"Missing field\"), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClose\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showErr,\n    onHide: handleCloseErr\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Error\")), __jsx(Modal.Body, null, Err), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseErr\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showSaveModal,\n    onHide: handleCloseSaveModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Save Confirmation\")), __jsx(Modal.Body, null, \"Data has been saved successfully.\"), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseSaveModal\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showPrintModal,\n    onHide: handleClosePrintModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Print Confirmation\")), __jsx(Modal.Body, null, \"Info has been sent to print.\"), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClosePrintModal\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showDescModal,\n    onHide: handleCloseDescModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Descriptions\")), __jsx(Modal.Body, null, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addDescription\n  }, \"Add Description\"), descriptions.map(function (desc, index) {\n    return __jsx(Row, {\n      key: index,\n      className: \"mb-3\"\n    }, __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: \"w-100\",\n      onClick: function onClick() {\n        return selectDescription(index);\n      },\n      style: {\n        cursor: \"pointer\"\n      }\n    }, __jsx(\"div\", {\n      className: \"d-flex justify-content-between\"\n    }, __jsx(\"span\", null, desc.description || \"Description\"), __jsx(\"span\", {\n      style: {\n        borderLeft: \"1px solid #ccc\",\n        paddingLeft: \"10px\"\n      }\n    }, desc.date || \"Date\"))));\n  }), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseDescModal\n  }, \"OK\"))), __jsx(Modal, {\n    show: showWoModal,\n    onHide: handleCloseWoModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Work Orders\")), __jsx(Modal.Body, null, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addWorkOrder,\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, \"Add Work Order\"), workOrders.map(function (wo, index) {\n    return __jsx(Row, {\n      key: index,\n      className: \"mb-3\"\n    }, __jsx(Col, null, __jsx(Form.Control, {\n      type: \"text\",\n      placeholder: \"Work Order\",\n      value: wo.workOrder,\n      onChange: function onChange(e) {\n        return handleWorkOrderChange(index, \"workOrder\", e.target.value);\n      },\n      style: {\n        marginBottom: \"0.5rem\"\n      }\n    })), __jsx(Col, null, __jsx(Form.Control, {\n      type: \"date\",\n      placeholder: \"Date\",\n      value: wo.date,\n      onChange: function onChange(e) {\n        return handleWorkOrderChange(index, \"date\", e.target.value);\n      }\n    })), __jsx(Col, null, __jsx(Button, {\n      variant: \"danger\",\n      onClick: function onClick() {\n        return removeWorkOrder(index);\n      }\n    }, \"Remove\")));\n  }), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseWoModal\n  }, \"OK\"))), __jsx(ClientInfoModal, {\n    show: showMachineModal,\n    handleClose: handleCloseMachineModal,\n    selectedClient: selectedClient,\n    machineOptions: machineOptions,\n    setSelectedMachine: handleSetSelectedMachine\n  }), __jsx(Modal, {\n    show: showClientModal,\n    onHide: handleCloseClientModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Select Client\")), __jsx(Modal.Body, null, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: search,\n    onChange: function onChange(e) {\n      return setSearch(e.target.value);\n    }\n  }), __jsx(ClientTable, {\n    clients: clients.filter(function (client) {\n      return (client.name || \"\").toLowerCase().includes(search.toLowerCase());\n    }),\n    onSelectClient: handleClientInfo,\n    onInfoClick: handleClientInfo,\n    clearSelection: function clearSelection() {\n      return handleClientInfo(null);\n    },\n    onAddClient: handleAddNewClient\n  }))), __jsx(ParentModal, {\n    show: showParentModal,\n    handleClose: handleCloseParentModal,\n    setSelectedParent: setSelectedParent\n  }), __jsx(MachineSelectionModal, {\n    show: machineSelectionModal,\n    handleClose: function handleClose() {\n      return setMachineSelectionModal(false);\n    },\n    setMachine: setTheMachine\n  }), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Take a Photo\")), __jsx(Modal.Body, null, __jsx(\"div\", {\n    className: \"camera\"\n  }, !capturedPhoto && __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing\n  }), capturedPhoto && __jsx(\"div\", {\n    className: \"photo-preview\"\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    }\n  })))), __jsx(Modal.Footer, null, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: function onClick() {\n      return setCameraFacing(function (prev) {\n        return prev === \"environment\" ? \"user\" : \"environment\";\n      });\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: function onClick() {\n      return setCapturedPhoto(null);\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto\n  }, \"OK\")))), __jsx(InfoModal, {\n    show: showInfoModal,\n    handleClose: handleCloseInfoModal,\n    itemName: items.name,\n    dimensions: items.length + \",\" + items.width + \",\" + items.height,\n    price: items.price,\n    freqI: freqItem,\n    freqM: machineFrequency,\n    usage: usagePastYear\n  }), __jsx(Container, {\n    fluid: true,\n    className: styles.page\n  }, __jsx(\"div\", {\n    className: styles.shell\n  }, __jsx(Card, {\n    className: styles.card\n  }, __jsx(Card.Body, {\n    className: styles.cardBody\n  }, __jsx(\"div\", {\n    className: styles.header\n  }, __jsx(\"div\", {\n    className: styles.kicker\n  }, \"Item\"), __jsx(\"h2\", {\n    className: styles.title\n  }, savedName || \"Item Details\"), __jsx(\"div\", {\n    className: styles.subtitle\n  }, \"Review and update fields, photos, and routing information.\")), __jsx(Form, {\n    onSubmit: handleSubmit\n  }, __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"name\"\n  }, __jsx(Form.Label, null, \"Name\"), __jsx(Form.Control, {\n    type: \"text\",\n    value: items.name,\n    onChange: handleChange(\"name\")\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"pn\"\n  }, __jsx(Form.Label, null, \"Product Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    }\n  }, __jsx(InputGroup, null, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.pn[currentPnIndex] || \"\",\n    onChange: function onChange(e) {\n      return handlePnChange(currentPnIndex, e.target.value);\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowDropdown(!showDropdown);\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setAddingNewPn(true);\n    }\n  }, \"+\"))), showDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    }\n  }, pnOptions.map(function (pnOption, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      style: {\n        padding: \"8px\",\n        cursor: \"pointer\"\n      },\n      onClick: function onClick() {\n        setCurrentPnIndex(idx);\n        setShowDropdown(false);\n      }\n    }, pnOption);\n  }))), addingNewPn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new PN\",\n    value: newPn,\n    onChange: function onChange(e) {\n      return setNewPn(e.target.value);\n    },\n    onBlur: handleAddNewPn,\n    onKeyDown: function onKeyDown(e) {\n      return e.key === \"Enter\" && handleAddNewPn();\n    }\n  })))), __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"sn\"\n  }, __jsx(Form.Label, null, \"Serial Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    }\n  }, __jsx(InputGroup, null, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.sn[currentSnIndex] || \"\",\n    onChange: function onChange(e) {\n      return handleSnChange(currentSnIndex, e.target.value);\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowSnDropdown(!showSnDropdown);\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setAddingNewSn(true);\n    }\n  }, \"+\"))), showSnDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    }\n  }, snOptions.map(function (snOption, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      style: {\n        padding: \"8px\",\n        cursor: \"pointer\"\n      },\n      onClick: function onClick() {\n        setCurrentSnIndex(idx);\n        setShowSnDropdown(false);\n      }\n    }, snOption);\n  }))), addingNewSn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new SN\",\n    value: newSn,\n    onChange: function onChange(e) {\n      return setNewSn(e.target.value);\n    },\n    onBlur: handleAddNewSn,\n    onKeyDown: function onKeyDown(e) {\n      return e.key === \"Enter\" && handleAddNewSn();\n    }\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"status\"\n  }, __jsx(Form.Label, null, \"Status\"), __jsx(Form.Select, {\n    value: items.status || \"\",\n    onChange: handleChange(\"status\")\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Select status\"), __jsx(\"option\", {\n    value: \"Good\"\n  }, \"Good\"), __jsx(\"option\", {\n    value: \"Bad\"\n  }, \"Bad\"), __jsx(\"option\", {\n    value: \"Unknown\"\n  }, \"Unknown\"))))), __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"localSN\"\n  }, __jsx(Form.Label, null, \"Local SN\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter Local SN\",\n    value: items.localSN || \"\",\n    onChange: handleChange(\"localSN\")\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"arrivalDate\"\n  }, __jsx(Form.Label, null, \"Arrival Date\"), __jsx(Form.Control, {\n    placeholder: \"Enter Arrival Date\",\n    type: \"date\",\n    value: items.arrival_date,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          arrival_date: value\n        });\n      });\n    }\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"trackingNumber\"\n  }, __jsx(Form.Label, null, \"Tracking Number\"), __jsx(Form.Control, {\n    placeholder: \"Tracking Number\",\n    type: \"text\",\n    value: items.trackingNumber,\n    onChange: handleChange(\"trackingNumber\")\n  })))), __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(MultiSelectDropdown, {\n    label: \"OEM\",\n    placeholder: trackerLoading ? \"Loading...\" : \"Select OEM\",\n    options: oemOptionsForUI,\n    selected: selectedOems,\n    onChange: setSelectedOems,\n    enableDelete: true,\n    onDeleteOption: handleDeleteOemOption,\n    disabled: trackerLoading\n  })), __jsx(Col, null, __jsx(MultiSelectDropdown, {\n    label: \"Modality\",\n    placeholder: trackerLoading ? \"Loading...\" : \"Select Modality\",\n    options: modalityOptionsForUI,\n    selected: selectedModalities,\n    onChange: setSelectedModalities,\n    disabled: trackerLoading\n  })), __jsx(Col, null, __jsx(MultiSelectDropdown, {\n    label: \"Model\",\n    placeholder: selectedModalities.length && selectedOems.length ? \"Select Model\" : \"Select Modality + OEM\",\n    options: modelOptionsForUI,\n    selected: selectedModels,\n    onChange: setSelectedModels,\n    enableDelete: true,\n    onDeleteOption: handleDeleteModelOption,\n    disabled: trackerLoading || !selectedModalities.length || !selectedOems.length\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\",\n      marginTop: \"1rem\"\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex align-items-center\"\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowWoModal,\n    className: \"me-2\"\n  }, \"Manage Work Orders\"), workOrders.length > 0 && __jsx(\"div\", {\n    className: \"d-flex flex-column align-items-start\"\n  }, __jsx(Form.Label, null, \"Work Order\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Most Recent Work Order\",\n    value: mostRecentWorkOrder.workOrder,\n    onChange: function onChange(e) {\n      return handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"workOrder\", e.target.value);\n    },\n    style: {\n      marginBottom: \"0.5rem\"\n    }\n  }), __jsx(Form.Label, null, \"Date\"), __jsx(Form.Control, {\n    type: \"date\",\n    placeholder: \"Work Order Date\",\n    value: mostRecentWorkOrder.date,\n    onChange: function onChange(e) {\n      return handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"date\", e.target.value);\n    },\n    style: {\n      marginBottom: \"0.5rem\"\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"desc\"\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: listDescriptions,\n    className: \"mb-2 me-2\"\n  }, \"List Descriptions\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 3,\n    placeholder: \"Enter description\",\n    value: ((_descriptions$selecte3 = descriptions[selectedDesc]) === null || _descriptions$selecte3 === void 0 ? void 0 : _descriptions$selecte3.description) || \"\",\n    onChange: function onChange(e) {\n      return handleDescriptionChange(selectedDesc, \"description\", e.target.value);\n    },\n    style: {\n      marginBottom: \"0.5rem\"\n    }\n  }), __jsx(Form.Control, {\n    type: \"date\",\n    value: ((_descriptions$selecte4 = descriptions[selectedDesc]) === null || _descriptions$selecte4 === void 0 ? void 0 : _descriptions$selecte4.date) || \"\",\n    onChange: function onChange(e) {\n      return handleDescriptionChange(selectedDesc, \"date\", e.target.value);\n    },\n    style: {\n      marginTop: \"0.5rem\",\n      marginBottom: \"0.5rem\"\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      setMachinePick(true);\n      handleShowClientModal();\n    },\n    className: \"me-2\"\n  }, \"Select From\"), selectedClientFrom && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(\"p\", null, __jsx(\"strong\", null, \"Selected Client (From):\"), \" \", selectedClientFrom.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowMachineModal(true);\n    }\n  }, \"Select Machine for \", selectedClientFrom.name), selectedMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(\"strong\", null, \"Selected Machine (From):\"), \" \", selectedMachine.name), showLocalLocFrom && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowNewLocalModalFrom(true);\n    },\n    className: \"w-100 mb-2\"\n  }, [newLocalFrom.region, ((_newLocalFrom$section = newLocalFrom.section) === null || _newLocalFrom$section === void 0 ? void 0 : _newLocalFrom$section.letter) + ((_newLocalFrom$section2 = newLocalFrom.section) === null || _newLocalFrom$section2 === void 0 ? void 0 : _newLocalFrom$section2.number), newLocalFrom.bin && \"B\".concat(newLocalFrom.bin), newLocalFrom.pallet && \"P\".concat(newLocalFrom.pallet)].filter(Boolean).join(\"-\")), __jsx(Modal, {\n    show: showNewLocalModalFrom,\n    onHide: function onHide() {\n      return setShowNewLocalModalFrom(false);\n    },\n    centered: true\n  }, __jsx(Modal.Header, null, __jsx(Modal.Title, null, \"Edit Local Loc (From)\")), __jsx(Modal.Body, null, __jsx(NewLocal, {\n    selectedClient: selectedClientFrom,\n    showLocalLoc: showNewLocalModalFrom,\n    value: newLocalFrom,\n    onChange: setNewLocalFrom,\n    onSave: function onSave(p) {\n      setNewLocalFrom(p);\n      setShowNewLocalModalFrom(false);\n    },\n    onCancel: function onCancel() {\n      return setShowNewLocalModalFrom(false);\n    }\n  })))))))), __jsx(Col, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      setMachinePick(false);\n      handleShowClientModal();\n    },\n    className: \"me-2\"\n  }, \"Select Current\"), selectedClientCurrent && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(\"p\", null, __jsx(\"strong\", null, \"Selected Client (Current):\"), \" \", selectedClientCurrent.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowMachineModal(true);\n    }\n  }, \"Select Machine for \", selectedClientCurrent.name), selectedCurrentMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(\"strong\", null, \"Selected Machine (Current):\"), \" \", selectedCurrentMachine.name), showLocalLocCurrent && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowNewLocalModalCurrent(true);\n    },\n    className: \"w-100 mb-2\"\n  }, [newLocalCurrent.region, ((_newLocalCurrent$sect = newLocalCurrent.section) === null || _newLocalCurrent$sect === void 0 ? void 0 : _newLocalCurrent$sect.letter) + ((_newLocalCurrent$sect2 = newLocalCurrent.section) === null || _newLocalCurrent$sect2 === void 0 ? void 0 : _newLocalCurrent$sect2.number), newLocalCurrent.bin && \"B\".concat(newLocalCurrent.bin), newLocalCurrent.pallet && \"P\".concat(newLocalCurrent.pallet)].filter(Boolean).join(\"-\")), __jsx(Modal, {\n    show: showNewLocalModalCurrent,\n    onHide: function onHide() {\n      return setShowNewLocalModalCurrent(false);\n    },\n    centered: true\n  }, __jsx(Modal.Header, null, __jsx(Modal.Title, null, \"Edit Local Loc (Current)\")), __jsx(Modal.Body, null, __jsx(NewLocal, {\n    selectedClient: selectedClientCurrent,\n    showLocalLoc: showNewLocalModalCurrent,\n    value: newLocalCurrent,\n    onChange: setNewLocalCurrent,\n    onSave: function onSave(p) {\n      setNewLocalCurrent(p);\n      setShowNewLocalModalCurrent(false);\n    },\n    onCancel: function onCancel() {\n      return setShowNewLocalModalCurrent(false);\n    }\n  })))))))), __jsx(Col, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowParentModal,\n    className: \"me-2\"\n  }, \"Select Parent\"), selectedParent && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Selected Parent\",\n    value: selectedParent.name,\n    readOnly: true,\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(Row, {\n    className: \"mb-3 \".concat(styles.photoActionsRow)\n  }, __jsx(Col, {\n    xs: 12,\n    md: 6\n  }, __jsx(ButtonGroup, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowCameraModal\n  }, \"Take Photo\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBrowsePhotos\n  }, \"Browse\"))), __jsx(Col, {\n    xs: 12,\n    md: 6,\n    className: styles.photoActionsRight\n  }, __jsx(Button, {\n    variant: \"success\",\n    onClick: handleSendToInflow,\n    style: {\n      marginLeft: \"auto\"\n    }\n  }, \"Send to inFlow\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleBluefolderButton,\n    style: {\n      marginLeft: \"0.5rem\",\n      marginRight: \".5rem\"\n    }\n  }, \"BlueFolder\"), __jsx(Button, {\n    variant: addToWebsite ? \"primary\" : \"outline-primary\",\n    onClick: function onClick() {\n      return setAddToWebsite(function (prev) {\n        return !prev;\n      });\n    }\n  }, addToWebsite ? \"✓ Add to Website\" : \"Add to Website\"), __jsx(Form.Check, {\n    type: \"checkbox\",\n    id: \"hide-checkbox\",\n    label: \"Hide\" // box is checked when we want visible = false\n    ,\n    checked: !items.visible,\n    onChange: function onChange(e) {\n      // grab checked immediately\n      var isHidden = e.currentTarget.checked;\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          visible: !isHidden\n        });\n      });\n    },\n    className: \"ms-3\"\n  }))), __jsx(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    multiple: true,\n    ref: browseInputRef,\n    style: {\n      display: \"none\"\n    },\n    onChange: handleFilesSelected\n  })), photos && photos.length > 0 && __jsx(\"div\", {\n    className: \"photo-gallery\",\n    style: {\n      display: \"flex\",\n      flexWrap: \"wrap\",\n      gap: \"10px\",\n      marginBottom: \"1rem\"\n    }\n  }, photos.map(function (photo, index) {\n    return __jsx(\"div\", {\n      key: index,\n      style: {\n        position: \"relative\",\n        width: \"100px\",\n        height: \"100px\"\n      }\n    }, __jsx(\"img\", {\n      src: photo.url,\n      alt: \"Photo \".concat(index + 1),\n      style: {\n        width: \"100%\",\n        height: \"100%\",\n        objectFit: \"cover\"\n      }\n    }), photo.file && __jsx(Button, {\n      variant: \"danger\",\n      size: \"sm\",\n      style: {\n        position: \"absolute\",\n        top: 0,\n        right: 0,\n        padding: \"0 5px\"\n      },\n      onClick: function onClick() {\n        return removePhoto(index);\n      }\n    }, \"x\"));\n  })), __jsx(\"div\", {\n    className: \"mt-3 d-flex flex-wrap align-items-center \".concat(styles.actionRow)\n  }, __jsx(Button, {\n    variant: \"primary\",\n    type: \"submit\",\n    style: {\n      marginRight: \"1rem\"\n    }\n  }, \"Save\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloneToNewItem,\n    style: {\n      marginRight: \"1rem\"\n    }\n  }, \"Clone\"), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"NewSearch/mainSearch\"\n  }), SHOW_SLACK_BUTTONS && __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      marginLeft: \".5rem\"\n    }\n  }, __jsx(\"span\", {\n    style: {\n      fontSize: 12,\n      lineHeight: \"12px\",\n      textAlign: \"center\"\n    }\n  }, \"Slack\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      border: \"1px solid #ced4da\",\n      borderRadius: 6,\n      overflow: \"hidden\"\n    }\n  }, __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: function onClick() {\n      return handleAddToSlack(\"receiving\");\n    },\n    style: {\n      border: \"none\",\n      borderRight: \"1px solid #ced4da\"\n    }\n  }, \"Receiving\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: function onClick() {\n      return handleAddToSlack(\"shipping\");\n    },\n    style: {\n      border: \"none\"\n    }\n  }, \"Shipping\"))), __jsx(Button, {\n    variant: \"info\",\n    onClick: handlePrint,\n    style: {\n      marginLeft: \"auto\"\n    }\n  }, \"Print Label\")), __jsx(\"div\", {\n    style: {\n      textAlign: \"center\",\n      margin: \"1rem 0\"\n    }\n  }, __jsx(Button, {\n    variant: \"link\",\n    style: {\n      textDecoration: \"none\",\n      color: \"black\",\n      fontSize: \"24px\"\n    },\n    onClick: function onClick() {\n      return setShowExtra(!showExtra);\n    }\n  }, \"\\u25BC\")), __jsx(Collapse, {\n    \"in\": showExtra\n  }, __jsx(\"div\", {\n    id: \"extra-collapse\",\n    className: \"mt-3\"\n  }, __jsx(\"div\", {\n    className: \"d-flex justify-content-end mb-3\"\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleShowInfoModal\n  }, \"More Info\")), __jsx(Row, null, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"dimensions\"\n  }, __jsx(Form.Label, null, \"Dimensions\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      alignItems: \"center\"\n    }\n  }, __jsx(Form.Control, {\n    placeholder: \"Length\",\n    type: \"text\",\n    value: items.length,\n    onChange: handleChange(\"length\")\n  }), __jsx(\"span\", {\n    style: {\n      padding: \"0 5px\"\n    }\n  }, \"x\"), __jsx(Form.Control, {\n    placeholder: \"Width\",\n    type: \"text\",\n    value: items.width,\n    onChange: handleChange(\"width\")\n  }), __jsx(\"span\", {\n    style: {\n      padding: \"0 5px\"\n    }\n  }, \"x\"), __jsx(Form.Control, {\n    placeholder: \"Height\",\n    type: \"text\",\n    value: items.height,\n    onChange: handleChange(\"height\")\n  })))), __jsx(Row, {\n    className: \"mt-3\"\n  }, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"Price\"\n  }, __jsx(Form.Label, null, \"Price\"), __jsx(Form.Control, {\n    placeholder: \"Price\",\n    type: \"text\",\n    value: items.price,\n    onChange: handleChange(\"price\")\n  })), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"DOM\"\n  }, __jsx(Form.Label, null, \"DOM\"), __jsx(Form.Control, {\n    placeholder: \"Date of Manufacture\",\n    type: \"date\",\n    value: DOM,\n    onChange: function onChange(e) {\n      return setDOM(e.target.value);\n    }\n  })), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"poNumber\"\n  }, __jsx(Form.Label, null, \"PO Number\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"PO Number\",\n    value: items.poNumber || \"\",\n    onChange: handleChange(\"poNumber\")\n  }))))))))))), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Take a Photo\")), __jsx(Modal.Body, null, __jsx(\"div\", {\n    className: \"camera\"\n  }, !capturedPhoto ? __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing\n  }) : __jsx(\"div\", {\n    className: \"photo-preview\"\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    }\n  })))), __jsx(Modal.Footer, null, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: function onClick() {\n      return setCameraFacing(function (prev) {\n        return prev === \"environment\" ? \"user\" : \"environment\";\n      });\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: function onClick() {\n      return setCapturedPhoto(null);\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto\n  }, \"OK\")))));\n}\n\nexport var __N_SSP = true;\nexport default function DisplayItemPage(props) {\n  var _router$query, _props$initialItem;\n\n  var router = useRouter();\n  var idFromRouter = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id;\n  var key = (props === null || props === void 0 ? void 0 : (_props$initialItem = props.initialItem) === null || _props$initialItem === void 0 ? void 0 : _props$initialItem.id) || idFromRouter || \"new-item\";\n  return __jsx(DisplayItemInner, _extends({}, props, {\n    key: key\n  }));\n} // Server-side rendering function","map":null,"metadata":{},"sourceType":"module"}