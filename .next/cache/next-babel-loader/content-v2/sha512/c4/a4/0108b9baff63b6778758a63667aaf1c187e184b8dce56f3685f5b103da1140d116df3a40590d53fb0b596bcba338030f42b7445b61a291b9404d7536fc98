{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Container, Card, Form, Button, Row, Col } from \"react-bootstrap\";\nimport Image from \"next/image\";\nimport { useAuth } from \"../context/AuthUserContext\";\nimport { useRouter } from \"next/router\";\nimport LoggedIn from \"./LoggedIn\";\nexport default function AskMagmo() {\n  var _useAuth = useAuth(),\n      authUser = _useAuth.authUser,\n      loading = _useAuth.loading;\n\n  var router = useRouter(); // Chat log: [{ role: \"user\" | \"assistant\", text: string }]\n\n  var _useState = useState([]),\n      history = _useState[0],\n      setHistory = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      question = _useState2[0],\n      setQuestion = _useState2[1];\n\n  var _useState3 = useState(false),\n      isSending = _useState3[0],\n      setIsSending = _useState3[1];\n\n  var scrollRef = useRef(null); // Redirect to login if not authenticated\n\n  useEffect(function () {\n    if (!loading && !authUser) {\n      console.log(\"user not logged in, redirecting to /\");\n      router.push(\"/\");\n    }\n  }, [authUser, loading, router]); // Auto-scroll chat to bottom whenever new messages land\n\n  useEffect(function () {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [history]);\n\n  function handleAsk(_x) {\n    return _handleAsk.apply(this, arguments);\n  } // While auth is resolving, show loading like the rest of your app does\n\n\n  function _handleAsk() {\n    _handleAsk = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var userMsg, res, answerText, data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(!question.trim() || isSending)) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              userMsg = question.trim(); // 1. Add user question + placeholder assistant bubble\n\n              setHistory(function (prev) {\n                return [].concat(_toConsumableArray(prev), [{\n                  role: \"user\",\n                  text: userMsg\n                }, {\n                  role: \"assistant\",\n                  text: \"Thinking...\"\n                }]);\n              }); // clear input + set flag\n\n              setQuestion(\"\");\n              setIsSending(true);\n              _context.prev = 7;\n              _context.next = 10;\n              return fetch(\"/api/gpt/AskMagmo\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  question: userMsg\n                })\n              });\n\n            case 10:\n              res = _context.sent;\n              answerText = \"\";\n\n              if (!res.ok) {\n                _context.next = 19;\n                break;\n              }\n\n              _context.next = 15;\n              return res.json();\n\n            case 15:\n              data = _context.sent;\n              answerText = data.answer || \"(No answer returned)\";\n              _context.next = 20;\n              break;\n\n            case 19:\n              answerText = \"Magmo couldn't get an answer from the manuals.\";\n\n            case 20:\n              // 3. Replace that \"Thinking...\" bubble with the real answer\n              setHistory(function (prev) {\n                var updated = _toConsumableArray(prev); // walk backward, find the last assistant \"Thinking...\"\n\n\n                for (var i = updated.length - 1; i >= 0; i--) {\n                  if (updated[i].role === \"assistant\" && updated[i].text === \"Thinking...\") {\n                    updated[i] = {\n                      role: \"assistant\",\n                      text: answerText\n                    };\n                    break;\n                  }\n                }\n\n                return updated;\n              });\n              _context.next = 27;\n              break;\n\n            case 23:\n              _context.prev = 23;\n              _context.t0 = _context[\"catch\"](7);\n              console.error(\"AskMagmo handleAsk error:\", _context.t0); // If something blew up, replace \"Thinking...\" with an error message\n\n              setHistory(function (prev) {\n                var updated = _toConsumableArray(prev);\n\n                for (var i = updated.length - 1; i >= 0; i--) {\n                  if (updated[i].role === \"assistant\" && updated[i].text === \"Thinking...\") {\n                    updated[i] = {\n                      role: \"assistant\",\n                      text: \"There was an issue reading the service docs. Try again in a moment.\"\n                    };\n                    break;\n                  }\n                }\n\n                return updated;\n              });\n\n            case 27:\n              _context.prev = 27;\n              setIsSending(false);\n              return _context.finish(27);\n\n            case 30:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 23, 27, 30]]);\n    }));\n    return _handleAsk.apply(this, arguments);\n  }\n\n  if (loading || !authUser) {\n    return __jsx(Container, {\n      className: \"d-flex align-items-center justify-content-center\",\n      style: {\n        minHeight: \"100vh\"\n      }\n    }, __jsx(\"h3\", null, \"Loading...\"));\n  }\n\n  return __jsx(LoggedIn, null, __jsx(Container, {\n    fluid: true,\n    className: \"d-flex align-items-center justify-content-center\",\n    style: {\n      minHeight: \"100vh\",\n      backgroundColor: \"#0f0f10\",\n      color: \"#fff\",\n      paddingTop: \"2rem\",\n      paddingBottom: \"2rem\"\n    }\n  }, __jsx(Row, {\n    className: \"w-100 justify-content-center\"\n  }, __jsx(Col, {\n    xs: 12,\n    md: 10,\n    lg: 8,\n    xl: 6\n  }, __jsx(Card, {\n    className: \"shadow-lg\",\n    style: {\n      backgroundColor: \"#1a1a1d\",\n      border: \"1px solid #2d2d32\",\n      borderRadius: \"16px\"\n    }\n  }, __jsx(Card.Body, {\n    style: {\n      padding: \"2rem\"\n    }\n  }, __jsx(\"div\", {\n    className: \"text-center mb-4\"\n  }, __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      marginBottom: \"0.75rem\"\n    }\n  }, __jsx(Image, {\n    src: \"/magmo.png\",\n    alt: \"Magmo\",\n    width: 160,\n    height: 60,\n    style: {\n      objectFit: \"contain\",\n      filter: \"drop-shadow(0 4px 8px rgba(0,0,0,0.7))\"\n    }\n  }))), __jsx(Form, {\n    onSubmit: handleAsk\n  }, __jsx(Form.Group, {\n    controlId: \"magmoQuestion\",\n    className: \"mb-3\"\n  }, __jsx(Form.Label, {\n    style: {\n      fontSize: \"0.8rem\",\n      fontWeight: 500,\n      color: \"#9ca3af\"\n    }\n  }, \"Ask a question\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 2,\n    placeholder: \"Example: \\\"Table won't home on HDxt. What's step one?\\\"\",\n    value: question,\n    onChange: function onChange(e) {\n      return setQuestion(e.target.value);\n    },\n    style: {\n      backgroundColor: \"#0f0f10\",\n      borderColor: \"#3a3a41\",\n      color: \"#fff\",\n      fontSize: \"0.9rem\",\n      borderRadius: \"10px\"\n    }\n  })), __jsx(\"div\", {\n    className: \"d-flex justify-content-end mb-4\"\n  }, __jsx(Button, {\n    type: \"submit\",\n    disabled: isSending || !question.trim(),\n    style: {\n      backgroundColor: \"#4f46e5\",\n      borderColor: \"#4f46e5\",\n      fontSize: \"0.9rem\",\n      fontWeight: 600,\n      borderRadius: \"10px\",\n      padding: \"0.5rem 1rem\",\n      boxShadow: \"0 10px 24px rgba(79,70,229,0.4), 0 2px 4px rgba(0,0,0,0.6)\"\n    }\n  }, isSending ? \"Asking...\" : \"Ask Magmo\"))), __jsx(\"div\", {\n    style: {\n      border: \"1px solid #2d2d32\",\n      backgroundColor: \"#0f0f10\",\n      borderRadius: \"12px\",\n      maxHeight: \"300px\",\n      minHeight: \"200px\",\n      overflowY: \"auto\",\n      padding: \"1rem\"\n    },\n    ref: scrollRef\n  }, history.length === 0 ? __jsx(\"div\", {\n    style: {\n      color: \"#6b7280\",\n      fontSize: \"0.85rem\",\n      textAlign: \"center\",\n      paddingTop: \"2rem\"\n    }\n  }, \"Ask a question to get started.\") : history.map(function (msg, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      style: {\n        marginBottom: \"1rem\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: msg.role === \"user\" ? \"flex-end\" : \"flex-start\"\n      }\n    }, __jsx(\"div\", {\n      style: {\n        maxWidth: \"85%\",\n        whiteSpace: \"pre-wrap\",\n        wordBreak: \"break-word\",\n        backgroundColor: msg.role === \"user\" ? \"#4f46e5\" : \"#1f1f22\",\n        border: msg.role === \"user\" ? \"1px solid #4f46e5\" : \"1px solid #2d2d32\",\n        color: \"#fff\",\n        fontSize: \"0.9rem\",\n        lineHeight: \"1.4rem\",\n        borderRadius: msg.role === \"user\" ? \"12px 12px 4px 12px\" : \"12px 12px 12px 4px\",\n        padding: \"0.75rem 0.9rem\",\n        boxShadow: msg.role === \"user\" ? \"0 16px 32px rgba(79,70,229,0.45)\" : \"0 12px 24px rgba(0,0,0,0.8)\"\n      }\n    }, msg.text), __jsx(\"div\", {\n      style: {\n        fontSize: \"0.7rem\",\n        color: \"#6b7280\",\n        marginTop: \"0.4rem\",\n        fontWeight: 500,\n        textAlign: msg.role === \"user\" ? \"right\" : \"left\"\n      }\n    }, msg.role === \"user\" ? \"You\" : \"Magmo\"));\n  })), __jsx(\"div\", {\n    style: {\n      fontSize: \"0.7rem\",\n      color: \"#4b5563\",\n      textAlign: \"center\",\n      marginTop: \"1rem\",\n      lineHeight: \"1rem\"\n    }\n  }, \"Magmo answers using internal service manuals. Always lockout / tagout and follow OEM safety procedures.\")))))));\n}","map":null,"metadata":{},"sourceType":"module"}