{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\isavc\\\\OneDrive\\\\Documents\\\\AIS\\\\Apps\\\\magmo\\\\pages\\\\NewSearch\\\\AddItem\\\\parentModal.js\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState, useCallback } from \"react\";\nimport { Modal, InputGroup, Dropdown, FormControl, Button, NavDropdown, Form, Table, Pagination } from \"react-bootstrap\";\nimport { fetchPartsWithMachineDataPage, fetchClients, fetchModels, formatDate } from \"../../../utils/fetchAssociations\";\nimport ClientTable from \"../../../utils/ClientTable\";\nimport ModelTable from \"../../../utils/ModelTable\";\nimport styles from \"./ParentModal.module.css\";\nconst CLIENT_WAREHOUSE = \"igor-house\";\nconst CLIENT_UNASSIGNED = \"unassigned\";\nconst PAGE_SIZE = 20;\n\nconst ParentModal = ({\n  show,\n  handleClose,\n  setSelectedParent\n}) => {\n  const {\n    0: info,\n    1: setInfo\n  } = useState([]);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(false);\n  const {\n    0: page,\n    1: setPage\n  } = useState(1);\n  const {\n    0: pageCursors,\n    1: setPageCursors\n  } = useState([]);\n  const {\n    0: hasNextPage,\n    1: setHasNextPage\n  } = useState(false);\n  const {\n    0: queryEpoch,\n    1: setQueryEpoch\n  } = useState(0);\n  const {\n    0: loadError,\n    1: setLoadError\n  } = useState(null);\n  const {\n    0: search,\n    1: setSearch\n  } = useState(\"\");\n  const {\n    0: select,\n    1: setSelect\n  } = useState(\"Name\");\n  const {\n    0: showList,\n    1: setShowList\n  } = useState(false);\n  const {\n    0: showListSearch,\n    1: setShowListSearch\n  } = useState(\"text\");\n  const {\n    0: selectedOEM,\n    1: setSelectedOEM\n  } = useState(null);\n  const {\n    0: selectedModality,\n    1: setSelectedModality\n  } = useState(null);\n  const {\n    0: selectedClient,\n    1: setSelectedClient\n  } = useState(null);\n  const {\n    0: clients,\n    1: setClients\n  } = useState([]);\n  const {\n    0: showClientModal,\n    1: setShowClientModal\n  } = useState(false);\n  const {\n    0: clientButtonText,\n    1: setClientButtonText\n  } = useState(\"Select Option\");\n  const {\n    0: selectedModel,\n    1: setSelectedModel\n  } = useState(null);\n  const {\n    0: models,\n    1: setModels\n  } = useState([]);\n  const {\n    0: showModelModal,\n    1: setShowModelModal\n  } = useState(false);\n  const {\n    0: modelButtonText,\n    1: setModelButtonText\n  } = useState(\"Select Option\");\n  const {\n    0: clientSearchTerm,\n    1: setClientSearchTerm\n  } = useState(\"\");\n  const {\n    0: modelSearchTerm,\n    1: setModelSearchTerm\n  } = useState(\"\");\n\n  const normalizeText = value => {\n    if (value == null) return \"\";\n    return String(value).toLowerCase().trim();\n  };\n\n  const fieldMatchesSelection = (value, selected) => {\n    if (!selected) return true;\n\n    if (Array.isArray(value)) {\n      return value.some(entry => fieldMatchesSelection(entry, selected));\n    }\n\n    return normalizeText(value) === normalizeText(selected);\n  };\n\n  const getMachineField = (item, key) => {\n    var _ref, _ref2, _ref3, _ref4, _ref5, _item$machineData$key, _item$machineData, _item$machineData2, _key$toLowerCase, _item$currentMachineD, _item$currentMachineD2, _key$toLowerCase2, _item$TheMachine, _item$TheMachine2, _key$toLowerCase3;\n\n    if (!item) return null;\n    return (_ref = (_ref2 = (_ref3 = (_ref4 = (_ref5 = (_item$machineData$key = item === null || item === void 0 ? void 0 : (_item$machineData = item.machineData) === null || _item$machineData === void 0 ? void 0 : _item$machineData[key]) !== null && _item$machineData$key !== void 0 ? _item$machineData$key : item === null || item === void 0 ? void 0 : (_item$machineData2 = item.machineData) === null || _item$machineData2 === void 0 ? void 0 : _item$machineData2[key === null || key === void 0 ? void 0 : (_key$toLowerCase = key.toLowerCase) === null || _key$toLowerCase === void 0 ? void 0 : _key$toLowerCase.call(key)]) !== null && _ref5 !== void 0 ? _ref5 : item === null || item === void 0 ? void 0 : (_item$currentMachineD = item.currentMachineData) === null || _item$currentMachineD === void 0 ? void 0 : _item$currentMachineD[key]) !== null && _ref4 !== void 0 ? _ref4 : item === null || item === void 0 ? void 0 : (_item$currentMachineD2 = item.currentMachineData) === null || _item$currentMachineD2 === void 0 ? void 0 : _item$currentMachineD2[key === null || key === void 0 ? void 0 : (_key$toLowerCase2 = key.toLowerCase) === null || _key$toLowerCase2 === void 0 ? void 0 : _key$toLowerCase2.call(key)]) !== null && _ref3 !== void 0 ? _ref3 : item === null || item === void 0 ? void 0 : (_item$TheMachine = item.TheMachine) === null || _item$TheMachine === void 0 ? void 0 : _item$TheMachine[key]) !== null && _ref2 !== void 0 ? _ref2 : item === null || item === void 0 ? void 0 : (_item$TheMachine2 = item.TheMachine) === null || _item$TheMachine2 === void 0 ? void 0 : _item$TheMachine2[key === null || key === void 0 ? void 0 : (_key$toLowerCase3 = key.toLowerCase) === null || _key$toLowerCase3 === void 0 ? void 0 : _key$toLowerCase3.call(key)]) !== null && _ref !== void 0 ? _ref : null;\n  };\n\n  const resetPagination = () => {\n    setPage(1);\n    setPageCursors([]);\n    setHasNextPage(false);\n  };\n\n  const searchChangeHandler = event => setSearch(event.target.value);\n\n  const matchesFilters = useCallback(item => {\n    if (!item) return false;\n\n    if (selectedOEM) {\n      const OEM = getMachineField(item, \"OEM\");\n      if (!fieldMatchesSelection(OEM, selectedOEM)) return false;\n    }\n\n    if (selectedModality) {\n      const Modality = getMachineField(item, \"Modality\");\n      if (!fieldMatchesSelection(Modality, selectedModality)) return false;\n    }\n\n    if (selectedModel) {\n      const Model = getMachineField(item, \"Model\");\n      if (!fieldMatchesSelection(Model, selectedModel)) return false;\n    }\n\n    if (selectedClient) {\n      const clientRef = getMachineField(item, \"client\");\n      const clientId = typeof clientRef === \"string\" ? clientRef : (clientRef === null || clientRef === void 0 ? void 0 : clientRef.id) || null;\n      if (clientId !== selectedClient) return false;\n    }\n\n    return true;\n  }, [selectedOEM, selectedModality, selectedModel, selectedClient]);\n  const fetchData = useCallback(async (requestedPage = 1) => {\n    if (!show) return;\n    const startAfterDoc = requestedPage > 1 ? pageCursors[requestedPage - 2] : null;\n\n    if (requestedPage > 1 && !startAfterDoc) {\n      setPage(1);\n      return;\n    }\n\n    setIsLoading(true);\n    setLoadError(null);\n    const searchLower = (search || \"\").toLowerCase().trim();\n\n    try {\n      const {\n        parts: data,\n        lastDoc,\n        hasNextPage: nextPage\n      } = await fetchPartsWithMachineDataPage({\n        pageSize: PAGE_SIZE,\n        startAfterDoc,\n        visibleOnly: true,\n        filterFn: selectedOEM || selectedModality || selectedModel || selectedClient ? matchesFilters : null,\n        search: searchLower ? {\n          type: select,\n          raw: search,\n          lower: searchLower\n        } : null,\n        needsMachineData: Boolean(selectedOEM) || Boolean(selectedModality) || Boolean(selectedModel) || Boolean(selectedClient)\n      });\n      setInfo(data);\n      setHasNextPage(nextPage);\n      setPageCursors(prev => {\n        const next = requestedPage === 1 ? [] : [...prev];\n\n        if (lastDoc) {\n          next[requestedPage - 1] = lastDoc;\n        }\n\n        return next;\n      });\n    } catch (error) {\n      console.error(\"Parent modal load failed:\", error);\n      setLoadError((error === null || error === void 0 ? void 0 : error.message) || \"Failed to load items.\");\n      setInfo([]);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [show, pageCursors, search, select, selectedOEM, selectedModality, selectedModel, selectedClient, matchesFilters]);\n  useEffect(() => {\n    if (!show) return;\n    resetPagination();\n    setQueryEpoch(v => v + 1);\n  }, [show, selectedOEM, selectedModality, selectedModel, selectedClient, search, select]);\n  useEffect(() => {\n    if (!show) return;\n    fetchData(page);\n  }, [show, page, queryEpoch, fetchData]);\n\n  const rowSelect = item => {\n    setSelectedParent({\n      id: item.id,\n      name: item.name,\n      pn: item.pn\n    });\n    handleClose();\n  };\n\n  const {\n    0: dropdown1Text,\n    1: setDropdown1Text\n  } = useState(\"Select Option\");\n  const {\n    0: dropdown2Text,\n    1: setDropdown2Text\n  } = useState(\"Select Option\");\n\n  const handleSelect1 = (eventKey, event) => {\n    if (eventKey === \"unassigned\") {\n      setDropdown1Text(\"Select Option\");\n      setSelectedOEM(null);\n    } else {\n      setDropdown1Text(event.target.textContent);\n      setSelectedOEM(event.target.textContent);\n    }\n  };\n\n  const handleSelect2 = (eventKey, event) => {\n    if (eventKey === \"unassigned\") {\n      setDropdown2Text(\"Select Option\");\n      setSelectedModality(null);\n    } else {\n      setDropdown2Text(event.target.textContent);\n      setSelectedModality(event.target.textContent);\n    }\n  };\n\n  const handleClientClick = async () => {\n    const clientsData = await fetchClients(selectedOEM, selectedModality);\n    setClients(clientsData);\n    setClientSearchTerm(\"\");\n    setShowClientModal(true);\n  };\n\n  const handleClientSelect = clientId => {\n    if (!clientId) {\n      setClientButtonText(\"Select Option\");\n      setSelectedClient(null);\n      setShowClientModal(false);\n      return;\n    }\n\n    const client = clients.find(c => c.id === clientId);\n    setClientButtonText((client === null || client === void 0 ? void 0 : client.name) || \"Select Option\");\n    setSelectedClient(clientId);\n    setShowClientModal(false);\n  };\n\n  const handleClientInfo = (clientId, clientName) => {\n    console.log(`Client ID: ${clientId}, Client Name: ${clientName}`);\n  };\n\n  const handleClearClientSelection = () => {\n    setClientButtonText(\"Select Option\");\n    setSelectedClient(null);\n    setShowClientModal(false);\n  };\n\n  const handleModelClick = async () => {\n    const modelsData = await fetchModels(selectedOEM, selectedModality, selectedClient);\n    setModels(modelsData);\n    setModelSearchTerm(\"\");\n    setShowModelModal(true);\n  };\n\n  const handleModelSelect = modelName => {\n    setModelButtonText(modelName || \"Select Option\");\n    setSelectedModel(modelName || null);\n    setShowModelModal(false);\n  };\n\n  const handleClearModelSelection = () => {\n    setModelButtonText(\"Select Option\");\n    setSelectedModel(null);\n    setShowModelModal(false);\n  };\n\n  const handleWarehouseClick = () => {\n    setClientButtonText(CLIENT_WAREHOUSE);\n    setSelectedClient(CLIENT_WAREHOUSE);\n  };\n\n  const handleUnassignedClick = () => {\n    setClientButtonText(CLIENT_UNASSIGNED);\n    setSelectedClient(CLIENT_UNASSIGNED);\n  };\n\n  const totalKnownPages = Math.max(1, pageCursors.filter(Boolean).length + (hasNextPage ? 1 : 0));\n\n  const pageButtons = (() => {\n    const buttons = [];\n    const maxVisible = 6;\n\n    const pushPage = p => buttons.push(__jsx(Pagination.Item, {\n      key: `page-${p}`,\n      active: p === page,\n      onClick: () => setPage(p),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 9\n      }\n    }, p));\n\n    const pushEllipsis = key => buttons.push(__jsx(Pagination.Ellipsis, {\n      key: key,\n      disabled: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 20\n      }\n    }));\n\n    if (totalKnownPages <= maxVisible) {\n      for (let i = 1; i <= totalKnownPages; i += 1) pushPage(i);\n\n      return buttons;\n    }\n\n    let start = Math.max(2, page - 1);\n    let end = Math.min(totalKnownPages - 1, page + 1);\n    const desiredWindow = maxVisible - 2;\n    let currentWindow = end - start + 1;\n    let remaining = desiredWindow - currentWindow;\n\n    while (remaining > 0) {\n      if (start > 2) {\n        start -= 1;\n        remaining -= 1;\n      }\n\n      if (remaining > 0 && end < totalKnownPages - 1) {\n        end += 1;\n        remaining -= 1;\n      }\n\n      if (start === 2 && end === totalKnownPages - 1) break;\n    }\n\n    pushPage(1);\n    if (start > 2) pushEllipsis(\"start-ellipsis\");\n\n    for (let i = start; i <= end; i += 1) pushPage(i);\n\n    if (end < totalKnownPages - 1) pushEllipsis(\"end-ellipsis\");\n    pushPage(totalKnownPages);\n    if (hasNextPage) pushEllipsis(\"more-ellipsis\");\n    return buttons;\n  })();\n\n  return __jsx(Modal, {\n    show: show,\n    onHide: handleClose,\n    size: \"xl\",\n    centered: true,\n    dialogClassName: styles.modalDialog,\n    contentClassName: styles.modalContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 5\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    className: styles.modalHeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.modalTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 11\n    }\n  }, \"Select Parent\"), __jsx(\"div\", {\n    className: styles.modalSubtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 11\n    }\n  }, \"Search and choose a parent item for this part.\"))), __jsx(Modal.Body, {\n    className: styles.modalBody,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles.modalGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355,\n      columnNumber: 9\n    }\n  }, __jsx(\"aside\", {\n    className: styles.filtersPanel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.panelTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 13\n    }\n  }, \"Filters\"), __jsx(\"div\", {\n    className: styles.panelHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 13\n    }\n  }, \"Narrow results with machine and client filters.\"), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 13\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 15\n    }\n  }, \"OEM\"), __jsx(Dropdown, {\n    onSelect: handleSelect1,\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 15\n    }\n  }, __jsx(Dropdown.Toggle, {\n    variant: \"outline-secondary\",\n    id: \"dropdown-button-1\",\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 17\n    }\n  }, dropdown1Text), __jsx(Dropdown.Menu, {\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 17\n    }\n  }, __jsx(Dropdown.Item, {\n    eventKey: \"unassigned\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 19\n    }\n  }, \"Select Option\"), __jsx(Dropdown.Item, {\n    eventKey: \"GE\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 19\n    }\n  }, \"GE\"), __jsx(Dropdown.Item, {\n    eventKey: \"Toshiba\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 19\n    }\n  }, \"Toshiba\"), __jsx(Dropdown.Item, {\n    eventKey: \"Siemens\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 19\n    }\n  }, \"Siemens\"), __jsx(Dropdown.Item, {\n    eventKey: \"Philips\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 19\n    }\n  }, \"Philips\")))), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 13\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 15\n    }\n  }, \"Modality\"), __jsx(Dropdown, {\n    onSelect: handleSelect2,\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 15\n    }\n  }, __jsx(Dropdown.Toggle, {\n    variant: \"outline-secondary\",\n    id: \"dropdown-button-2\",\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 17\n    }\n  }, dropdown2Text), __jsx(Dropdown.Menu, {\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 17\n    }\n  }, __jsx(Dropdown.Item, {\n    eventKey: \"unassigned\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 19\n    }\n  }, \"Select Option\"), __jsx(Dropdown.Item, {\n    eventKey: \"CT\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 19\n    }\n  }, \"CT\"), __jsx(Dropdown.Item, {\n    eventKey: \"MRI\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 19\n    }\n  }, \"MRI\")))), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 13\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 15\n    }\n  }, \"Client\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: handleClientClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 15\n    }\n  }, clientButtonText)), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 13\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 15\n    }\n  }, \"Model\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: handleModelClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 15\n    }\n  }, modelButtonText)), __jsx(\"div\", {\n    className: styles.panelDivider,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    className: styles.panelTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 13\n    }\n  }, \"Quick\"), __jsx(\"div\", {\n    className: styles.quickButtons,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 427,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.quickButton,\n    onClick: handleWarehouseClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 15\n    }\n  }, \"Warehouse\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.quickButton,\n    onClick: handleUnassignedClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 435,\n      columnNumber: 15\n    }\n  }, \"Unassigned\"))), __jsx(\"section\", {\n    className: styles.resultsPanel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.resultsHeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: styles.resultsTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 448,\n      columnNumber: 17\n    }\n  }, \"Results\"), __jsx(\"div\", {\n    className: styles.resultsSubtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 449,\n      columnNumber: 17\n    }\n  }, isLoading ? \"Loading items\" : `${info.length} items`)), __jsx(Pagination, {\n    size: \"sm\",\n    className: styles.pagination,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 453,\n      columnNumber: 15\n    }\n  }, __jsx(Pagination.Prev, {\n    onClick: () => setPage(p => Math.max(1, p - 1)),\n    disabled: page <= 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 17\n    }\n  }), pageButtons, __jsx(Pagination.Next, {\n    onClick: () => setPage(p => p + 1),\n    disabled: !hasNextPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 17\n    }\n  }))), __jsx(\"div\", {\n    className: styles.searchRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 13\n    }\n  }, __jsx(FormControl, {\n    type: showListSearch,\n    placeholder: \"Search\",\n    className: styles.searchInput,\n    \"aria-label\": \"Search\",\n    value: search,\n    onChange: searchChangeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 15\n    }\n  }), __jsx(NavDropdown, {\n    title: select,\n    id: \"parent-search-dropdown\",\n    show: showList,\n    onMouseEnter: () => setShowList(true),\n    onMouseLeave: () => setShowList(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 475,\n      columnNumber: 15\n    }\n  }, __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Name\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 17\n    }\n  }, \"Name\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Date\");\n      setShowListSearch(\"date\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 490,\n      columnNumber: 17\n    }\n  }, \"Date\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Work Order\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 498,\n      columnNumber: 17\n    }\n  }, \"Work Order\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Product Number\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 506,\n      columnNumber: 17\n    }\n  }, \"Product Number\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Serial Number\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 17\n    }\n  }, \"Serial Number\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Description\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 522,\n      columnNumber: 17\n    }\n  }, \"Description\"))), __jsx(\"div\", {\n    className: styles.tableWrap,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 533,\n      columnNumber: 13\n    }\n  }, isLoading ? __jsx(\"div\", {\n    className: styles.loadingState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 535,\n      columnNumber: 17\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading\",\n    className: styles.loadingLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 536,\n      columnNumber: 19\n    }\n  })) : loadError ? __jsx(\"div\", {\n    className: styles.errorState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 543,\n      columnNumber: 17\n    }\n  }, loadError) : __jsx(Table, {\n    striped: true,\n    bordered: true,\n    hover: true,\n    size: \"sm\",\n    className: styles.table,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 545,\n      columnNumber: 17\n    }\n  }, __jsx(\"thead\", {\n    className: styles.stickyHeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 546,\n      columnNumber: 19\n    }\n  }, __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 547,\n      columnNumber: 21\n    }\n  }, __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 548,\n      columnNumber: 23\n    }\n  }, \"Name\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 549,\n      columnNumber: 23\n    }\n  }, \"Date\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 550,\n      columnNumber: 23\n    }\n  }, \"Work Order\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 551,\n      columnNumber: 23\n    }\n  }, \"Product Number\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 552,\n      columnNumber: 23\n    }\n  }, \"Serial Number\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 553,\n      columnNumber: 23\n    }\n  }, \"Select\"))), __jsx(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 556,\n      columnNumber: 19\n    }\n  }, info.length === 0 && __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 558,\n      columnNumber: 23\n    }\n  }, __jsx(\"td\", {\n    colSpan: 6,\n    className: styles.emptyState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 559,\n      columnNumber: 25\n    }\n  }, \"No items found.\")), info.map(item => __jsx(\"tr\", {\n    key: item.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 565,\n      columnNumber: 23\n    }\n  }, __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 566,\n      columnNumber: 25\n    }\n  }, item.name), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 567,\n      columnNumber: 25\n    }\n  }, formatDate(item.date)), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 568,\n      columnNumber: 25\n    }\n  }, item.workOrders && item.workOrders.length > 0 ? item.workOrders[item.workOrders.length - 1].workOrder : \"N/A\"), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 574,\n      columnNumber: 25\n    }\n  }, item.pn), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 575,\n      columnNumber: 25\n    }\n  }, item.sn), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 25\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    size: \"sm\",\n    onClick: () => rowSelect(item),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 577,\n      columnNumber: 27\n    }\n  }, \"Select\")))))))))), __jsx(Modal.Footer, {\n    className: styles.modalFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 594,\n      columnNumber: 7\n    }\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 9\n    }\n  }, \"Cancel\"), __jsx(Button, {\n    variant: \"warning\",\n    onClick: () => {\n      setSelectedParent(null);\n      handleClose();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 598,\n      columnNumber: 9\n    }\n  }, \"Clear Selection\")), __jsx(Modal, {\n    show: showClientModal,\n    onHide: () => setShowClientModal(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 608,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 609,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 610,\n      columnNumber: 11\n    }\n  }, \"Select Client\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 612,\n      columnNumber: 9\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: clientSearchTerm,\n    onChange: e => setClientSearchTerm(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 613,\n      columnNumber: 11\n    }\n  }), __jsx(ClientTable, {\n    clients: clients.filter(client => (client.name || \"\").toLowerCase().includes(clientSearchTerm.toLowerCase())),\n    disableInfo: true,\n    onSelectClient: handleClientSelect,\n    onInfoClick: handleClientInfo,\n    clearSelection: handleClearClientSelection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 620,\n      columnNumber: 11\n    }\n  }))), __jsx(Modal, {\n    show: showModelModal,\n    onHide: () => setShowModelModal(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 634,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 635,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 636,\n      columnNumber: 11\n    }\n  }, \"Select Model\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 638,\n      columnNumber: 9\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: modelSearchTerm,\n    onChange: e => setModelSearchTerm(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 639,\n      columnNumber: 11\n    }\n  }), __jsx(ModelTable, {\n    models: models.filter(model => typeof model === \"string\" ? model.toLowerCase().includes(modelSearchTerm.toLowerCase()) : false),\n    onSelectModel: handleModelSelect,\n    clearSelection: handleClearModelSelection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 646,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default ParentModal;","map":{"version":3,"sources":["C:/Users/isavc/OneDrive/Documents/AIS/Apps/magmo/pages/NewSearch/AddItem/parentModal.js"],"names":["React","useEffect","useState","useCallback","Modal","InputGroup","Dropdown","FormControl","Button","NavDropdown","Form","Table","Pagination","fetchPartsWithMachineDataPage","fetchClients","fetchModels","formatDate","ClientTable","ModelTable","styles","CLIENT_WAREHOUSE","CLIENT_UNASSIGNED","PAGE_SIZE","ParentModal","show","handleClose","setSelectedParent","info","setInfo","isLoading","setIsLoading","page","setPage","pageCursors","setPageCursors","hasNextPage","setHasNextPage","queryEpoch","setQueryEpoch","loadError","setLoadError","search","setSearch","select","setSelect","showList","setShowList","showListSearch","setShowListSearch","selectedOEM","setSelectedOEM","selectedModality","setSelectedModality","selectedClient","setSelectedClient","clients","setClients","showClientModal","setShowClientModal","clientButtonText","setClientButtonText","selectedModel","setSelectedModel","models","setModels","showModelModal","setShowModelModal","modelButtonText","setModelButtonText","clientSearchTerm","setClientSearchTerm","modelSearchTerm","setModelSearchTerm","normalizeText","value","String","toLowerCase","trim","fieldMatchesSelection","selected","Array","isArray","some","entry","getMachineField","item","key","machineData","currentMachineData","TheMachine","resetPagination","searchChangeHandler","event","target","matchesFilters","OEM","Modality","Model","clientRef","clientId","id","fetchData","requestedPage","startAfterDoc","searchLower","parts","data","lastDoc","nextPage","pageSize","visibleOnly","filterFn","type","raw","lower","needsMachineData","Boolean","prev","next","error","console","message","v","rowSelect","name","pn","dropdown1Text","setDropdown1Text","dropdown2Text","setDropdown2Text","handleSelect1","eventKey","textContent","handleSelect2","handleClientClick","clientsData","handleClientSelect","client","find","c","handleClientInfo","clientName","log","handleClearClientSelection","handleModelClick","modelsData","handleModelSelect","modelName","handleClearModelSelection","handleWarehouseClick","handleUnassignedClick","totalKnownPages","Math","max","filter","length","pageButtons","buttons","maxVisible","pushPage","p","push","pushEllipsis","i","start","end","min","desiredWindow","currentWindow","remaining","modalDialog","modalContent","modalHeader","modalTitle","modalSubtitle","modalBody","modalGrid","filtersPanel","panelTitle","panelHint","inputGroup","panelDivider","quickButtons","quickButton","resultsPanel","resultsHeader","resultsTitle","resultsSubtitle","pagination","searchRow","searchInput","tableWrap","loadingState","loadingLogo","errorState","table","stickyHeader","emptyState","map","date","workOrders","workOrder","sn","modalFooter","e","includes","model"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useCallback } from \"react\";\r\nimport {\r\n  Modal,\r\n  InputGroup,\r\n  Dropdown,\r\n  FormControl,\r\n  Button,\r\n  NavDropdown,\r\n  Form,\r\n  Table,\r\n  Pagination,\r\n} from \"react-bootstrap\";\r\nimport {\r\n  fetchPartsWithMachineDataPage,\r\n  fetchClients,\r\n  fetchModels,\r\n  formatDate,\r\n} from \"../../../utils/fetchAssociations\";\r\nimport ClientTable from \"../../../utils/ClientTable\";\r\nimport ModelTable from \"../../../utils/ModelTable\";\r\nimport styles from \"./ParentModal.module.css\";\r\n\r\nconst CLIENT_WAREHOUSE = \"igor-house\";\r\nconst CLIENT_UNASSIGNED = \"unassigned\";\r\nconst PAGE_SIZE = 20;\r\n\r\nconst ParentModal = ({ show, handleClose, setSelectedParent }) => {\r\n  const [info, setInfo] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [page, setPage] = useState(1);\r\n  const [pageCursors, setPageCursors] = useState([]);\r\n  const [hasNextPage, setHasNextPage] = useState(false);\r\n  const [queryEpoch, setQueryEpoch] = useState(0);\r\n  const [loadError, setLoadError] = useState(null);\r\n\r\n  const [search, setSearch] = useState(\"\");\r\n  const [select, setSelect] = useState(\"Name\");\r\n  const [showList, setShowList] = useState(false);\r\n  const [showListSearch, setShowListSearch] = useState(\"text\");\r\n  const [selectedOEM, setSelectedOEM] = useState(null);\r\n  const [selectedModality, setSelectedModality] = useState(null);\r\n  const [selectedClient, setSelectedClient] = useState(null);\r\n  const [clients, setClients] = useState([]);\r\n  const [showClientModal, setShowClientModal] = useState(false);\r\n  const [clientButtonText, setClientButtonText] = useState(\"Select Option\");\r\n  const [selectedModel, setSelectedModel] = useState(null);\r\n  const [models, setModels] = useState([]);\r\n  const [showModelModal, setShowModelModal] = useState(false);\r\n  const [modelButtonText, setModelButtonText] = useState(\"Select Option\");\r\n  const [clientSearchTerm, setClientSearchTerm] = useState(\"\");\r\n  const [modelSearchTerm, setModelSearchTerm] = useState(\"\");\r\n\r\n  const normalizeText = (value) => {\r\n    if (value == null) return \"\";\r\n    return String(value).toLowerCase().trim();\r\n  };\r\n\r\n  const fieldMatchesSelection = (value, selected) => {\r\n    if (!selected) return true;\r\n    if (Array.isArray(value)) {\r\n      return value.some((entry) => fieldMatchesSelection(entry, selected));\r\n    }\r\n    return normalizeText(value) === normalizeText(selected);\r\n  };\r\n\r\n  const getMachineField = (item, key) => {\r\n    if (!item) return null;\r\n    return (\r\n      item?.machineData?.[key] ??\r\n      item?.machineData?.[key?.toLowerCase?.()] ??\r\n      item?.currentMachineData?.[key] ??\r\n      item?.currentMachineData?.[key?.toLowerCase?.()] ??\r\n      item?.TheMachine?.[key] ??\r\n      item?.TheMachine?.[key?.toLowerCase?.()] ??\r\n      null\r\n    );\r\n  };\r\n\r\n  const resetPagination = () => {\r\n    setPage(1);\r\n    setPageCursors([]);\r\n    setHasNextPage(false);\r\n  };\r\n\r\n  const searchChangeHandler = (event) => setSearch(event.target.value);\r\n\r\n  const matchesFilters = useCallback(\r\n    (item) => {\r\n      if (!item) return false;\r\n      if (selectedOEM) {\r\n        const OEM = getMachineField(item, \"OEM\");\r\n        if (!fieldMatchesSelection(OEM, selectedOEM)) return false;\r\n      }\r\n      if (selectedModality) {\r\n        const Modality = getMachineField(item, \"Modality\");\r\n        if (!fieldMatchesSelection(Modality, selectedModality)) return false;\r\n      }\r\n      if (selectedModel) {\r\n        const Model = getMachineField(item, \"Model\");\r\n        if (!fieldMatchesSelection(Model, selectedModel)) return false;\r\n      }\r\n      if (selectedClient) {\r\n        const clientRef = getMachineField(item, \"client\");\r\n        const clientId =\r\n          typeof clientRef === \"string\"\r\n            ? clientRef\r\n            : clientRef?.id || null;\r\n        if (clientId !== selectedClient) return false;\r\n      }\r\n      return true;\r\n    },\r\n    [selectedOEM, selectedModality, selectedModel, selectedClient]\r\n  );\r\n\r\n  const fetchData = useCallback(\r\n    async (requestedPage = 1) => {\r\n      if (!show) return;\r\n      const startAfterDoc =\r\n        requestedPage > 1 ? pageCursors[requestedPage - 2] : null;\r\n      if (requestedPage > 1 && !startAfterDoc) {\r\n        setPage(1);\r\n        return;\r\n      }\r\n      setIsLoading(true);\r\n      setLoadError(null);\r\n      const searchLower = (search || \"\").toLowerCase().trim();\r\n      try {\r\n        const { parts: data, lastDoc, hasNextPage: nextPage } =\r\n          await fetchPartsWithMachineDataPage({\r\n            pageSize: PAGE_SIZE,\r\n            startAfterDoc,\r\n            visibleOnly: true,\r\n            filterFn:\r\n              selectedOEM || selectedModality || selectedModel || selectedClient\r\n                ? matchesFilters\r\n                : null,\r\n            search: searchLower\r\n              ? {\r\n                  type: select,\r\n                  raw: search,\r\n                  lower: searchLower,\r\n                }\r\n              : null,\r\n            needsMachineData:\r\n              Boolean(selectedOEM) ||\r\n              Boolean(selectedModality) ||\r\n              Boolean(selectedModel) ||\r\n              Boolean(selectedClient),\r\n          });\r\n        setInfo(data);\r\n        setHasNextPage(nextPage);\r\n        setPageCursors((prev) => {\r\n          const next = requestedPage === 1 ? [] : [...prev];\r\n          if (lastDoc) {\r\n            next[requestedPage - 1] = lastDoc;\r\n          }\r\n          return next;\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Parent modal load failed:\", error);\r\n        setLoadError(error?.message || \"Failed to load items.\");\r\n        setInfo([]);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    },\r\n    [\r\n      show,\r\n      pageCursors,\r\n      search,\r\n      select,\r\n      selectedOEM,\r\n      selectedModality,\r\n      selectedModel,\r\n      selectedClient,\r\n      matchesFilters,\r\n    ]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!show) return;\r\n    resetPagination();\r\n    setQueryEpoch((v) => v + 1);\r\n  }, [show, selectedOEM, selectedModality, selectedModel, selectedClient, search, select]);\r\n\r\n  useEffect(() => {\r\n    if (!show) return;\r\n    fetchData(page);\r\n  }, [show, page, queryEpoch, fetchData]);\r\n\r\n  const rowSelect = (item) => {\r\n    setSelectedParent({ id: item.id, name: item.name, pn: item.pn });\r\n    handleClose();\r\n  };\r\n\r\n  const [dropdown1Text, setDropdown1Text] = useState(\"Select Option\");\r\n  const [dropdown2Text, setDropdown2Text] = useState(\"Select Option\");\r\n\r\n  const handleSelect1 = (eventKey, event) => {\r\n    if (eventKey === \"unassigned\") {\r\n      setDropdown1Text(\"Select Option\");\r\n      setSelectedOEM(null);\r\n    } else {\r\n      setDropdown1Text(event.target.textContent);\r\n      setSelectedOEM(event.target.textContent);\r\n    }\r\n  };\r\n\r\n  const handleSelect2 = (eventKey, event) => {\r\n    if (eventKey === \"unassigned\") {\r\n      setDropdown2Text(\"Select Option\");\r\n      setSelectedModality(null);\r\n    } else {\r\n      setDropdown2Text(event.target.textContent);\r\n      setSelectedModality(event.target.textContent);\r\n    }\r\n  };\r\n\r\n  const handleClientClick = async () => {\r\n    const clientsData = await fetchClients(selectedOEM, selectedModality);\r\n    setClients(clientsData);\r\n    setClientSearchTerm(\"\");\r\n    setShowClientModal(true);\r\n  };\r\n\r\n  const handleClientSelect = (clientId) => {\r\n    if (!clientId) {\r\n      setClientButtonText(\"Select Option\");\r\n      setSelectedClient(null);\r\n      setShowClientModal(false);\r\n      return;\r\n    }\r\n    const client = clients.find((c) => c.id === clientId);\r\n    setClientButtonText(client?.name || \"Select Option\");\r\n    setSelectedClient(clientId);\r\n    setShowClientModal(false);\r\n  };\r\n\r\n  const handleClientInfo = (clientId, clientName) => {\r\n    console.log(`Client ID: ${clientId}, Client Name: ${clientName}`);\r\n  };\r\n\r\n  const handleClearClientSelection = () => {\r\n    setClientButtonText(\"Select Option\");\r\n    setSelectedClient(null);\r\n    setShowClientModal(false);\r\n  };\r\n\r\n  const handleModelClick = async () => {\r\n    const modelsData = await fetchModels(\r\n      selectedOEM,\r\n      selectedModality,\r\n      selectedClient\r\n    );\r\n    setModels(modelsData);\r\n    setModelSearchTerm(\"\");\r\n    setShowModelModal(true);\r\n  };\r\n\r\n  const handleModelSelect = (modelName) => {\r\n    setModelButtonText(modelName || \"Select Option\");\r\n    setSelectedModel(modelName || null);\r\n    setShowModelModal(false);\r\n  };\r\n\r\n  const handleClearModelSelection = () => {\r\n    setModelButtonText(\"Select Option\");\r\n    setSelectedModel(null);\r\n    setShowModelModal(false);\r\n  };\r\n\r\n  const handleWarehouseClick = () => {\r\n    setClientButtonText(CLIENT_WAREHOUSE);\r\n    setSelectedClient(CLIENT_WAREHOUSE);\r\n  };\r\n\r\n  const handleUnassignedClick = () => {\r\n    setClientButtonText(CLIENT_UNASSIGNED);\r\n    setSelectedClient(CLIENT_UNASSIGNED);\r\n  };\r\n\r\n  const totalKnownPages = Math.max(\r\n    1,\r\n    pageCursors.filter(Boolean).length + (hasNextPage ? 1 : 0)\r\n  );\r\n  const pageButtons = (() => {\r\n    const buttons = [];\r\n    const maxVisible = 6;\r\n\r\n    const pushPage = (p) =>\r\n      buttons.push(\r\n        <Pagination.Item\r\n          key={`page-${p}`}\r\n          active={p === page}\r\n          onClick={() => setPage(p)}\r\n        >\r\n          {p}\r\n        </Pagination.Item>\r\n      );\r\n\r\n    const pushEllipsis = (key) =>\r\n      buttons.push(<Pagination.Ellipsis key={key} disabled />);\r\n\r\n    if (totalKnownPages <= maxVisible) {\r\n      for (let i = 1; i <= totalKnownPages; i += 1) pushPage(i);\r\n      return buttons;\r\n    }\r\n\r\n    let start = Math.max(2, page - 1);\r\n    let end = Math.min(totalKnownPages - 1, page + 1);\r\n    const desiredWindow = maxVisible - 2;\r\n    let currentWindow = end - start + 1;\r\n    let remaining = desiredWindow - currentWindow;\r\n\r\n    while (remaining > 0) {\r\n      if (start > 2) {\r\n        start -= 1;\r\n        remaining -= 1;\r\n      }\r\n      if (remaining > 0 && end < totalKnownPages - 1) {\r\n        end += 1;\r\n        remaining -= 1;\r\n      }\r\n      if (start === 2 && end === totalKnownPages - 1) break;\r\n    }\r\n\r\n    pushPage(1);\r\n    if (start > 2) pushEllipsis(\"start-ellipsis\");\r\n    for (let i = start; i <= end; i += 1) pushPage(i);\r\n    if (end < totalKnownPages - 1) pushEllipsis(\"end-ellipsis\");\r\n    pushPage(totalKnownPages);\r\n    if (hasNextPage) pushEllipsis(\"more-ellipsis\");\r\n\r\n    return buttons;\r\n  })();\r\n\r\n  return (\r\n    <Modal\r\n      show={show}\r\n      onHide={handleClose}\r\n      size=\"xl\"\r\n      centered\r\n      dialogClassName={styles.modalDialog}\r\n      contentClassName={styles.modalContent}\r\n    >\r\n      <Modal.Header closeButton className={styles.modalHeader}>\r\n        <div>\r\n          <div className={styles.modalTitle}>Select Parent</div>\r\n          <div className={styles.modalSubtitle}>\r\n            Search and choose a parent item for this part.\r\n          </div>\r\n        </div>\r\n      </Modal.Header>\r\n      <Modal.Body className={styles.modalBody}>\r\n        <div className={styles.modalGrid}>\r\n          <aside className={styles.filtersPanel}>\r\n            <div className={styles.panelTitle}>Filters</div>\r\n            <div className={styles.panelHint}>\r\n              Narrow results with machine and client filters.\r\n            </div>\r\n            <InputGroup className={styles.inputGroup}>\r\n              <InputGroup.Text>OEM</InputGroup.Text>\r\n              <Dropdown onSelect={handleSelect1} className=\"w-100\">\r\n                <Dropdown.Toggle\r\n                  variant=\"outline-secondary\"\r\n                  id=\"dropdown-button-1\"\r\n                  className=\"w-100\"\r\n                >\r\n                  {dropdown1Text}\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu className=\"w-100\">\r\n                  <Dropdown.Item eventKey=\"unassigned\">\r\n                    Select Option\r\n                  </Dropdown.Item>\r\n                  <Dropdown.Item eventKey=\"GE\">GE</Dropdown.Item>\r\n                  <Dropdown.Item eventKey=\"Toshiba\">Toshiba</Dropdown.Item>\r\n                  <Dropdown.Item eventKey=\"Siemens\">Siemens</Dropdown.Item>\r\n                  <Dropdown.Item eventKey=\"Philips\">Philips</Dropdown.Item>\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n            </InputGroup>\r\n\r\n            <InputGroup className={styles.inputGroup}>\r\n              <InputGroup.Text>Modality</InputGroup.Text>\r\n              <Dropdown onSelect={handleSelect2} className=\"w-100\">\r\n                <Dropdown.Toggle\r\n                  variant=\"outline-secondary\"\r\n                  id=\"dropdown-button-2\"\r\n                  className=\"w-100\"\r\n                >\r\n                  {dropdown2Text}\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu className=\"w-100\">\r\n                  <Dropdown.Item eventKey=\"unassigned\">\r\n                    Select Option\r\n                  </Dropdown.Item>\r\n                  <Dropdown.Item eventKey=\"CT\">CT</Dropdown.Item>\r\n                  <Dropdown.Item eventKey=\"MRI\">MRI</Dropdown.Item>\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n            </InputGroup>\r\n\r\n            <InputGroup className={styles.inputGroup}>\r\n              <InputGroup.Text>Client</InputGroup.Text>\r\n              <Button\r\n                variant=\"outline-secondary\"\r\n                className=\"w-100\"\r\n                onClick={handleClientClick}\r\n              >\r\n                {clientButtonText}\r\n              </Button>\r\n            </InputGroup>\r\n\r\n            <InputGroup className={styles.inputGroup}>\r\n              <InputGroup.Text>Model</InputGroup.Text>\r\n              <Button\r\n                variant=\"outline-secondary\"\r\n                className=\"w-100\"\r\n                onClick={handleModelClick}\r\n              >\r\n                {modelButtonText}\r\n              </Button>\r\n            </InputGroup>\r\n\r\n            <div className={styles.panelDivider}></div>\r\n            <div className={styles.panelTitle}>Quick</div>\r\n            <div className={styles.quickButtons}>\r\n              <Button\r\n                variant=\"outline-secondary\"\r\n                className={styles.quickButton}\r\n                onClick={handleWarehouseClick}\r\n              >\r\n                Warehouse\r\n              </Button>\r\n              <Button\r\n                variant=\"outline-secondary\"\r\n                className={styles.quickButton}\r\n                onClick={handleUnassignedClick}\r\n              >\r\n                Unassigned\r\n              </Button>\r\n            </div>\r\n          </aside>\r\n\r\n          <section className={styles.resultsPanel}>\r\n            <div className={styles.resultsHeader}>\r\n              <div>\r\n                <div className={styles.resultsTitle}>Results</div>\r\n                <div className={styles.resultsSubtitle}>\r\n                  {isLoading ? \"Loading items\" : `${info.length} items`}\r\n                </div>\r\n              </div>\r\n              <Pagination size=\"sm\" className={styles.pagination}>\r\n                <Pagination.Prev\r\n                  onClick={() => setPage((p) => Math.max(1, p - 1))}\r\n                  disabled={page <= 1}\r\n                />\r\n                {pageButtons}\r\n                <Pagination.Next\r\n                  onClick={() => setPage((p) => p + 1)}\r\n                  disabled={!hasNextPage}\r\n                />\r\n              </Pagination>\r\n            </div>\r\n\r\n            <div className={styles.searchRow}>\r\n              <FormControl\r\n                type={showListSearch}\r\n                placeholder=\"Search\"\r\n                className={styles.searchInput}\r\n                aria-label=\"Search\"\r\n                value={search}\r\n                onChange={searchChangeHandler}\r\n              />\r\n              <NavDropdown\r\n                title={select}\r\n                id=\"parent-search-dropdown\"\r\n                show={showList}\r\n                onMouseEnter={() => setShowList(true)}\r\n                onMouseLeave={() => setShowList(false)}\r\n              >\r\n                <NavDropdown.Item\r\n                  onClick={() => {\r\n                    setSelect(\"Name\");\r\n                    setShowListSearch(\"text\");\r\n                  }}\r\n                >\r\n                  Name\r\n                </NavDropdown.Item>\r\n                <NavDropdown.Item\r\n                  onClick={() => {\r\n                    setSelect(\"Date\");\r\n                    setShowListSearch(\"date\");\r\n                  }}\r\n                >\r\n                  Date\r\n                </NavDropdown.Item>\r\n                <NavDropdown.Item\r\n                  onClick={() => {\r\n                    setSelect(\"Work Order\");\r\n                    setShowListSearch(\"text\");\r\n                  }}\r\n                >\r\n                  Work Order\r\n                </NavDropdown.Item>\r\n                <NavDropdown.Item\r\n                  onClick={() => {\r\n                    setSelect(\"Product Number\");\r\n                    setShowListSearch(\"text\");\r\n                  }}\r\n                >\r\n                  Product Number\r\n                </NavDropdown.Item>\r\n                <NavDropdown.Item\r\n                  onClick={() => {\r\n                    setSelect(\"Serial Number\");\r\n                    setShowListSearch(\"text\");\r\n                  }}\r\n                >\r\n                  Serial Number\r\n                </NavDropdown.Item>\r\n                <NavDropdown.Item\r\n                  onClick={() => {\r\n                    setSelect(\"Description\");\r\n                    setShowListSearch(\"text\");\r\n                  }}\r\n                >\r\n                  Description\r\n                </NavDropdown.Item>\r\n              </NavDropdown>\r\n            </div>\r\n\r\n            <div className={styles.tableWrap}>\r\n              {isLoading ? (\r\n                <div className={styles.loadingState}>\r\n                  <img\r\n                    src=\"/magmo-logo.png\"\r\n                    alt=\"Loading\"\r\n                    className={styles.loadingLogo}\r\n                  />\r\n                </div>\r\n              ) : loadError ? (\r\n                <div className={styles.errorState}>{loadError}</div>\r\n              ) : (\r\n                <Table striped bordered hover size=\"sm\" className={styles.table}>\r\n                  <thead className={styles.stickyHeader}>\r\n                    <tr>\r\n                      <th>Name</th>\r\n                      <th>Date</th>\r\n                      <th>Work Order</th>\r\n                      <th>Product Number</th>\r\n                      <th>Serial Number</th>\r\n                      <th>Select</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {info.length === 0 && (\r\n                      <tr>\r\n                        <td colSpan={6} className={styles.emptyState}>\r\n                          No items found.\r\n                        </td>\r\n                      </tr>\r\n                    )}\r\n                    {info.map((item) => (\r\n                      <tr key={item.id}>\r\n                        <td>{item.name}</td>\r\n                        <td>{formatDate(item.date)}</td>\r\n                        <td>\r\n                          {item.workOrders && item.workOrders.length > 0\r\n                            ? item.workOrders[item.workOrders.length - 1]\r\n                                .workOrder\r\n                            : \"N/A\"}\r\n                        </td>\r\n                        <td>{item.pn}</td>\r\n                        <td>{item.sn}</td>\r\n                        <td>\r\n                          <Button\r\n                            variant=\"primary\"\r\n                            size=\"sm\"\r\n                            onClick={() => rowSelect(item)}\r\n                          >\r\n                            Select\r\n                          </Button>\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </Table>\r\n              )}\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </Modal.Body>\r\n      <Modal.Footer className={styles.modalFooter}>\r\n        <Button variant=\"secondary\" onClick={handleClose}>\r\n          Cancel\r\n        </Button>\r\n        <Button\r\n          variant=\"warning\"\r\n          onClick={() => {\r\n            setSelectedParent(null);\r\n            handleClose();\r\n          }}\r\n        >\r\n          Clear Selection\r\n        </Button>\r\n      </Modal.Footer>\r\n      <Modal show={showClientModal} onHide={() => setShowClientModal(false)}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Select Client</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <FormControl\r\n            type=\"text\"\r\n            placeholder=\"Search by name\"\r\n            className=\"mb-3\"\r\n            value={clientSearchTerm}\r\n            onChange={(e) => setClientSearchTerm(e.target.value)}\r\n          />\r\n          <ClientTable\r\n            clients={clients.filter((client) =>\r\n              (client.name || \"\")\r\n                .toLowerCase()\r\n                .includes(clientSearchTerm.toLowerCase())\r\n            )}\r\n            disableInfo={true}\r\n            onSelectClient={handleClientSelect}\r\n            onInfoClick={handleClientInfo}\r\n            clearSelection={handleClearClientSelection}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n\r\n      <Modal show={showModelModal} onHide={() => setShowModelModal(false)}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Select Model</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <FormControl\r\n            type=\"text\"\r\n            placeholder=\"Search by name\"\r\n            className=\"mb-3\"\r\n            value={modelSearchTerm}\r\n            onChange={(e) => setModelSearchTerm(e.target.value)}\r\n          />\r\n          <ModelTable\r\n            models={models.filter((model) =>\r\n              typeof model === \"string\"\r\n                ? model.toLowerCase().includes(modelSearchTerm.toLowerCase())\r\n                : false\r\n            )}\r\n            onSelectModel={handleModelSelect}\r\n            clearSelection={handleClearModelSelection}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ParentModal;\r\n"]},"metadata":{},"sourceType":"module"}