{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/mack2/OneDrive/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"C:/Users/mack2/OneDrive/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:/Users/mack2/OneDrive/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\OneDrive\\\\Desktop\\\\code\\\\pages\\\\AskMagmo.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useEffect, useRef } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Container, Card, Form, Button, Row, Col } from \"react-bootstrap\";\nimport Image from \"next/image\";\nimport { useAuth } from \"../context/AuthUserContext\";\nimport { useRouter } from \"next/router\";\nimport LoggedIn from \"./LoggedIn\";\nexport default function AskMagmo() {\n  _s();\n\n  var _this = this;\n\n  var _useAuth = useAuth(),\n      authUser = _useAuth.authUser,\n      loading = _useAuth.loading;\n\n  var router = useRouter(); // Chat log: [{ role: \"user\" | \"assistant\", text: string }]\n\n  var _useState = useState([]),\n      history = _useState[0],\n      setHistory = _useState[1];\n\n  var _useState2 = useState(\"\"),\n      question = _useState2[0],\n      setQuestion = _useState2[1];\n\n  var _useState3 = useState(false),\n      isSending = _useState3[0],\n      setIsSending = _useState3[1];\n\n  var scrollRef = useRef(null); // Redirect to login if not authenticated\n\n  useEffect(function () {\n    if (!loading && !authUser) {\n      console.log(\"user not logged in, redirecting to /\");\n      router.push(\"/\");\n    }\n  }, [authUser, loading, router]); // Auto-scroll chat to bottom whenever new messages land\n\n  useEffect(function () {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [history]);\n\n  function handleAsk(_x) {\n    return _handleAsk.apply(this, arguments);\n  } // While auth is resolving, show loading like the rest of your app does\n\n\n  function _handleAsk() {\n    _handleAsk = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var userMsg, res, answerText, data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n\n              if (!(!question.trim() || isSending)) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              userMsg = question.trim(); // 1. Add user question + placeholder assistant bubble\n\n              setHistory(function (prev) {\n                return [].concat(_toConsumableArray(prev), [{\n                  role: \"user\",\n                  text: userMsg\n                }, {\n                  role: \"assistant\",\n                  text: \"Thinking...\"\n                }]);\n              }); // clear input + set flag\n\n              setQuestion(\"\");\n              setIsSending(true);\n              _context.prev = 7;\n              _context.next = 10;\n              return fetch(\"/api/gpt/AskMagmo\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  question: userMsg\n                })\n              });\n\n            case 10:\n              res = _context.sent;\n              answerText = \"\";\n\n              if (!res.ok) {\n                _context.next = 19;\n                break;\n              }\n\n              _context.next = 15;\n              return res.json();\n\n            case 15:\n              data = _context.sent;\n              answerText = data.answer || \"(No answer returned)\";\n              _context.next = 20;\n              break;\n\n            case 19:\n              answerText = \"Magmo couldn't get an answer from the manuals.\";\n\n            case 20:\n              // 3. Replace that \"Thinking...\" bubble with the real answer\n              setHistory(function (prev) {\n                var updated = _toConsumableArray(prev); // walk backward, find the last assistant \"Thinking...\"\n\n\n                for (var i = updated.length - 1; i >= 0; i--) {\n                  if (updated[i].role === \"assistant\" && updated[i].text === \"Thinking...\") {\n                    updated[i] = {\n                      role: \"assistant\",\n                      text: answerText\n                    };\n                    break;\n                  }\n                }\n\n                return updated;\n              });\n              _context.next = 27;\n              break;\n\n            case 23:\n              _context.prev = 23;\n              _context.t0 = _context[\"catch\"](7);\n              console.error(\"AskMagmo handleAsk error:\", _context.t0); // If something blew up, replace \"Thinking...\" with an error message\n\n              setHistory(function (prev) {\n                var updated = _toConsumableArray(prev);\n\n                for (var i = updated.length - 1; i >= 0; i--) {\n                  if (updated[i].role === \"assistant\" && updated[i].text === \"Thinking...\") {\n                    updated[i] = {\n                      role: \"assistant\",\n                      text: \"There was an issue reading the service docs. Try again in a moment.\"\n                    };\n                    break;\n                  }\n                }\n\n                return updated;\n              });\n\n            case 27:\n              _context.prev = 27;\n              setIsSending(false);\n              return _context.finish(27);\n\n            case 30:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[7, 23, 27, 30]]);\n    }));\n    return _handleAsk.apply(this, arguments);\n  }\n\n  if (loading || !authUser) {\n    return __jsx(Container, {\n      className: \"d-flex align-items-center justify-content-center\",\n      style: {\n        minHeight: \"100vh\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 7\n      }\n    }, __jsx(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 9\n      }\n    }, \"Loading...\"));\n  }\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, __jsx(Container, {\n    fluid: true,\n    className: \"d-flex align-items-center justify-content-center\",\n    style: {\n      minHeight: \"100vh\",\n      backgroundColor: \"#0f0f10\",\n      color: \"#fff\",\n      paddingTop: \"2rem\",\n      paddingBottom: \"2rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 7\n    }\n  }, __jsx(Row, {\n    className: \"w-100 justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  }, __jsx(Col, {\n    xs: 12,\n    md: 10,\n    lg: 8,\n    xl: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 11\n    }\n  }, __jsx(Card, {\n    className: \"shadow-lg\",\n    style: {\n      backgroundColor: \"#1a1a1d\",\n      border: \"1px solid #2d2d32\",\n      borderRadius: \"16px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }\n  }, __jsx(Card.Body, {\n    style: {\n      padding: \"2rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: \"text-center mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      marginBottom: \"0.75rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 19\n    }\n  }, __jsx(Image, {\n    src: \"/magmo.png\",\n    alt: \"Magmo\",\n    width: 160,\n    height: 60,\n    style: {\n      objectFit: \"contain\",\n      filter: \"drop-shadow(0 4px 8px rgba(0,0,0,0.7))\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 21\n    }\n  }))), __jsx(Form, {\n    onSubmit: handleAsk,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"magmoQuestion\",\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 19\n    }\n  }, __jsx(Form.Label, {\n    style: {\n      fontSize: \"0.8rem\",\n      fontWeight: 500,\n      color: \"#9ca3af\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 21\n    }\n  }, \"Ask a question\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 2,\n    placeholder: \"Example: \\\"Table won't home on HDxt. What's step one?\\\"\",\n    value: question,\n    onChange: function onChange(e) {\n      return setQuestion(e.target.value);\n    },\n    style: {\n      backgroundColor: \"#0f0f10\",\n      borderColor: \"#3a3a41\",\n      color: \"#fff\",\n      fontSize: \"0.9rem\",\n      borderRadius: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 21\n    }\n  })), __jsx(\"div\", {\n    className: \"d-flex justify-content-end mb-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    type: \"submit\",\n    disabled: isSending || !question.trim(),\n    style: {\n      backgroundColor: \"#4f46e5\",\n      borderColor: \"#4f46e5\",\n      fontSize: \"0.9rem\",\n      fontWeight: 600,\n      borderRadius: \"10px\",\n      padding: \"0.5rem 1rem\",\n      boxShadow: \"0 10px 24px rgba(79,70,229,0.4), 0 2px 4px rgba(0,0,0,0.6)\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 21\n    }\n  }, isSending ? \"Asking...\" : \"Ask Magmo\"))), __jsx(\"div\", {\n    style: {\n      border: \"1px solid #2d2d32\",\n      backgroundColor: \"#0f0f10\",\n      borderRadius: \"12px\",\n      maxHeight: \"300px\",\n      minHeight: \"200px\",\n      overflowY: \"auto\",\n      padding: \"1rem\"\n    },\n    ref: scrollRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 17\n    }\n  }, history.length === 0 ? __jsx(\"div\", {\n    style: {\n      color: \"#6b7280\",\n      fontSize: \"0.85rem\",\n      textAlign: \"center\",\n      paddingTop: \"2rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 21\n    }\n  }, \"Ask a question to get started.\") : history.map(function (msg, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      style: {\n        marginBottom: \"1rem\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        alignItems: msg.role === \"user\" ? \"flex-end\" : \"flex-start\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 23\n      }\n    }, __jsx(\"div\", {\n      style: {\n        maxWidth: \"85%\",\n        whiteSpace: \"pre-wrap\",\n        wordBreak: \"break-word\",\n        backgroundColor: msg.role === \"user\" ? \"#4f46e5\" : \"#1f1f22\",\n        border: msg.role === \"user\" ? \"1px solid #4f46e5\" : \"1px solid #2d2d32\",\n        color: \"#fff\",\n        fontSize: \"0.9rem\",\n        lineHeight: \"1.4rem\",\n        borderRadius: msg.role === \"user\" ? \"12px 12px 4px 12px\" : \"12px 12px 12px 4px\",\n        padding: \"0.75rem 0.9rem\",\n        boxShadow: msg.role === \"user\" ? \"0 16px 32px rgba(79,70,229,0.45)\" : \"0 12px 24px rgba(0,0,0,0.8)\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 25\n      }\n    }, msg.text), __jsx(\"div\", {\n      style: {\n        fontSize: \"0.7rem\",\n        color: \"#6b7280\",\n        marginTop: \"0.4rem\",\n        fontWeight: 500,\n        textAlign: msg.role === \"user\" ? \"right\" : \"left\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 25\n      }\n    }, msg.role === \"user\" ? \"You\" : \"Magmo\"));\n  })), __jsx(\"div\", {\n    style: {\n      fontSize: \"0.7rem\",\n      color: \"#4b5563\",\n      textAlign: \"center\",\n      marginTop: \"1rem\",\n      lineHeight: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 17\n    }\n  }, \"Magmo answers using internal service manuals. Always lockout / tagout and follow OEM safety procedures.\")))))));\n}\n\n_s(AskMagmo, \"Ol5I2gBJn145iNeqppFdbVLymp8=\", false, function () {\n  return [useAuth, useRouter];\n});\n\n_c = AskMagmo;\n\nvar _c;\n\n$RefreshReg$(_c, \"AskMagmo\");","map":{"version":3,"sources":["C:/Users/mack2/OneDrive/Desktop/code/pages/AskMagmo.js"],"names":["React","useState","useEffect","useRef","Container","Card","Form","Button","Row","Col","Image","useAuth","useRouter","LoggedIn","AskMagmo","authUser","loading","router","history","setHistory","question","setQuestion","isSending","setIsSending","scrollRef","console","log","push","current","scrollTop","scrollHeight","handleAsk","e","preventDefault","trim","userMsg","prev","role","text","fetch","method","headers","body","JSON","stringify","res","answerText","ok","json","data","answer","updated","i","length","error","minHeight","backgroundColor","color","paddingTop","paddingBottom","border","borderRadius","padding","display","justifyContent","marginBottom","objectFit","filter","fontSize","fontWeight","target","value","borderColor","boxShadow","maxHeight","overflowY","textAlign","map","msg","idx","flexDirection","alignItems","maxWidth","whiteSpace","wordBreak","lineHeight","marginTop"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport {\r\n  Container,\r\n  Card,\r\n  Form,\r\n  Button,\r\n  Row,\r\n  Col,\r\n} from \"react-bootstrap\";\r\nimport Image from \"next/image\";\r\nimport { useAuth } from \"../context/AuthUserContext\";\r\nimport { useRouter } from \"next/router\";\r\nimport LoggedIn from \"./LoggedIn\";\r\n\r\nexport default function AskMagmo() {\r\n  const { authUser, loading } = useAuth();\r\n  const router = useRouter();\r\n\r\n  // Chat log: [{ role: \"user\" | \"assistant\", text: string }]\r\n  const [history, setHistory] = useState([]);\r\n  const [question, setQuestion] = useState(\"\");\r\n  const [isSending, setIsSending] = useState(false);\r\n\r\n  const scrollRef = useRef(null);\r\n\r\n  // Redirect to login if not authenticated\r\n  useEffect(() => {\r\n    if (!loading && !authUser) {\r\n      console.log(\"user not logged in, redirecting to /\");\r\n      router.push(\"/\");\r\n    }\r\n  }, [authUser, loading, router]);\r\n\r\n  // Auto-scroll chat to bottom whenever new messages land\r\n  useEffect(() => {\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\r\n    }\r\n  }, [history]);\r\n\r\n  async function handleAsk(e) {\r\n    e.preventDefault();\r\n    if (!question.trim() || isSending) return;\r\n\r\n    const userMsg = question.trim();\r\n\r\n    // 1. Add user question + placeholder assistant bubble\r\n    setHistory((prev) => [\r\n      ...prev,\r\n      { role: \"user\", text: userMsg },\r\n      { role: \"assistant\", text: \"Thinking...\" },\r\n    ]);\r\n\r\n    // clear input + set flag\r\n    setQuestion(\"\");\r\n    setIsSending(true);\r\n\r\n    try {\r\n      // 2. Call our backend route with the question\r\n      const res = await fetch(\"/api/gpt/AskMagmo\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ question: userMsg }),\r\n      });\r\n\r\n      let answerText = \"\";\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        answerText = data.answer || \"(No answer returned)\";\r\n      } else {\r\n        answerText = \"Magmo couldn't get an answer from the manuals.\";\r\n      }\r\n\r\n      // 3. Replace that \"Thinking...\" bubble with the real answer\r\n      setHistory((prev) => {\r\n        const updated = [...prev];\r\n        // walk backward, find the last assistant \"Thinking...\"\r\n        for (let i = updated.length - 1; i >= 0; i--) {\r\n          if (\r\n            updated[i].role === \"assistant\" &&\r\n            updated[i].text === \"Thinking...\"\r\n          ) {\r\n            updated[i] = { role: \"assistant\", text: answerText };\r\n            break;\r\n          }\r\n        }\r\n        return updated;\r\n      });\r\n    } catch (err) {\r\n      console.error(\"AskMagmo handleAsk error:\", err);\r\n\r\n      // If something blew up, replace \"Thinking...\" with an error message\r\n      setHistory((prev) => {\r\n        const updated = [...prev];\r\n        for (let i = updated.length - 1; i >= 0; i--) {\r\n          if (\r\n            updated[i].role === \"assistant\" &&\r\n            updated[i].text === \"Thinking...\"\r\n          ) {\r\n            updated[i] = {\r\n              role: \"assistant\",\r\n              text:\r\n                \"There was an issue reading the service docs. Try again in a moment.\",\r\n            };\r\n            break;\r\n          }\r\n        }\r\n        return updated;\r\n      });\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  }\r\n\r\n  // While auth is resolving, show loading like the rest of your app does\r\n  if (loading || !authUser) {\r\n    return (\r\n      <Container\r\n        className=\"d-flex align-items-center justify-content-center\"\r\n        style={{ minHeight: \"100vh\" }}\r\n      >\r\n        <h3>Loading...</h3>\r\n      </Container>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <LoggedIn>\r\n      <Container\r\n        fluid\r\n        className=\"d-flex align-items-center justify-content-center\"\r\n        style={{\r\n          minHeight: \"100vh\",\r\n          backgroundColor: \"#0f0f10\",\r\n          color: \"#fff\",\r\n          paddingTop: \"2rem\",\r\n          paddingBottom: \"2rem\",\r\n        }}\r\n      >\r\n        <Row className=\"w-100 justify-content-center\">\r\n          <Col xs={12} md={10} lg={8} xl={6}>\r\n            <Card\r\n              className=\"shadow-lg\"\r\n              style={{\r\n                backgroundColor: \"#1a1a1d\",\r\n                border: \"1px solid #2d2d32\",\r\n                borderRadius: \"16px\",\r\n              }}\r\n            >\r\n              <Card.Body style={{ padding: \"2rem\" }}>\r\n                {/* Header / Branding */}\r\n                <div className=\"text-center mb-4\">\r\n                  <div\r\n                    style={{\r\n                      display: \"flex\",\r\n                      justifyContent: \"center\",\r\n                      marginBottom: \"0.75rem\",\r\n                    }}\r\n                  >\r\n                    {/* logo image */}\r\n                    <Image\r\n                      src=\"/magmo.png\"\r\n                      alt=\"Magmo\"\r\n                      width={160}\r\n                      height={60}\r\n                      style={{\r\n                        objectFit: \"contain\",\r\n                        filter:\r\n                          \"drop-shadow(0 4px 8px rgba(0,0,0,0.7))\",\r\n                      }}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* <h2\r\n                    style={{\r\n                      fontSize: \"1.25rem\",\r\n                      fontWeight: \"600\",\r\n                      color: \"#ffffff\",\r\n                      marginBottom: \"0.25rem\",\r\n                    }}\r\n                  >\r\n                    Ask Magmo\r\n                  </h2>\r\n                  <div\r\n                    style={{\r\n                      fontSize: \"0.9rem\",\r\n                      lineHeight: \"1.4rem\",\r\n                      color: \"#9ca3af\",\r\n                    }}\r\n                  >\r\n                    Your service assistant for MRI / CT install,\r\n                    faults, and parts.\r\n                  </div> */}\r\n                </div>\r\n\r\n                {/* Ask form */}\r\n                <Form onSubmit={handleAsk}>\r\n                  <Form.Group controlId=\"magmoQuestion\" className=\"mb-3\">\r\n                    <Form.Label\r\n                      style={{\r\n                        fontSize: \"0.8rem\",\r\n                        fontWeight: 500,\r\n                        color: \"#9ca3af\",\r\n                      }}\r\n                    >\r\n                      Ask a question\r\n                    </Form.Label>\r\n                    <Form.Control\r\n                      as=\"textarea\"\r\n                      rows={2}\r\n                      placeholder={`Example: \"Table won't home on HDxt. What's step one?\"`}\r\n                      value={question}\r\n                      onChange={(e) => setQuestion(e.target.value)}\r\n                      style={{\r\n                        backgroundColor: \"#0f0f10\",\r\n                        borderColor: \"#3a3a41\",\r\n                        color: \"#fff\",\r\n                        fontSize: \"0.9rem\",\r\n                        borderRadius: \"10px\",\r\n                      }}\r\n                    />\r\n                  </Form.Group>\r\n\r\n                  <div className=\"d-flex justify-content-end mb-4\">\r\n                    <Button\r\n                      type=\"submit\"\r\n                      disabled={isSending || !question.trim()}\r\n                      style={{\r\n                        backgroundColor: \"#4f46e5\",\r\n                        borderColor: \"#4f46e5\",\r\n                        fontSize: \"0.9rem\",\r\n                        fontWeight: 600,\r\n                        borderRadius: \"10px\",\r\n                        padding: \"0.5rem 1rem\",\r\n                        boxShadow:\r\n                          \"0 10px 24px rgba(79,70,229,0.4), 0 2px 4px rgba(0,0,0,0.6)\",\r\n                      }}\r\n                    >\r\n                      {isSending ? \"Asking...\" : \"Ask Magmo\"}\r\n                    </Button>\r\n                  </div>\r\n                </Form>\r\n\r\n                {/* Chat history window */}\r\n                <div\r\n                  style={{\r\n                    border: \"1px solid #2d2d32\",\r\n                    backgroundColor: \"#0f0f10\",\r\n                    borderRadius: \"12px\",\r\n                    maxHeight: \"300px\",\r\n                    minHeight: \"200px\",\r\n                    overflowY: \"auto\",\r\n                    padding: \"1rem\",\r\n                  }}\r\n                  ref={scrollRef}\r\n                >\r\n                  {history.length === 0 ? (\r\n                    <div\r\n                      style={{\r\n                        color: \"#6b7280\",\r\n                        fontSize: \"0.85rem\",\r\n                        textAlign: \"center\",\r\n                        paddingTop: \"2rem\",\r\n                      }}\r\n                    >\r\n                      Ask a question to get started.\r\n                    </div>\r\n                  ) : (\r\n                    history.map((msg, idx) => (\r\n                      <div\r\n                        key={idx}\r\n                        style={{\r\n                          marginBottom: \"1rem\",\r\n                          display: \"flex\",\r\n                          flexDirection: \"column\",\r\n                          alignItems:\r\n                            msg.role === \"user\"\r\n                              ? \"flex-end\"\r\n                              : \"flex-start\",\r\n                        }}\r\n                      >\r\n                        {/* Bubble */}\r\n                        <div\r\n                          style={{\r\n                            maxWidth: \"85%\",\r\n                            whiteSpace: \"pre-wrap\",\r\n                            wordBreak: \"break-word\",\r\n                            backgroundColor:\r\n                              msg.role === \"user\"\r\n                                ? \"#4f46e5\"\r\n                                : \"#1f1f22\",\r\n                            border:\r\n                              msg.role === \"user\"\r\n                                ? \"1px solid #4f46e5\"\r\n                                : \"1px solid #2d2d32\",\r\n                            color: \"#fff\",\r\n                            fontSize: \"0.9rem\",\r\n                            lineHeight: \"1.4rem\",\r\n                            borderRadius:\r\n                              msg.role === \"user\"\r\n                                ? \"12px 12px 4px 12px\"\r\n                                : \"12px 12px 12px 4px\",\r\n                            padding: \"0.75rem 0.9rem\",\r\n                            boxShadow:\r\n                              msg.role === \"user\"\r\n                                ? \"0 16px 32px rgba(79,70,229,0.45)\"\r\n                                : \"0 12px 24px rgba(0,0,0,0.8)\",\r\n                          }}\r\n                        >\r\n                          {msg.text}\r\n                        </div>\r\n\r\n                        {/* role tag */}\r\n                        <div\r\n                          style={{\r\n                            fontSize: \"0.7rem\",\r\n                            color: \"#6b7280\",\r\n                            marginTop: \"0.4rem\",\r\n                            fontWeight: 500,\r\n                            textAlign:\r\n                              msg.role === \"user\"\r\n                                ? \"right\"\r\n                                : \"left\",\r\n                          }}\r\n                        >\r\n                          {msg.role === \"user\"\r\n                            ? \"You\"\r\n                            : \"Magmo\"}\r\n                        </div>\r\n                      </div>\r\n                    ))\r\n                  )}\r\n                </div>\r\n\r\n                {/* footer disclaimer */}\r\n                <div\r\n                  style={{\r\n                    fontSize: \"0.7rem\",\r\n                    color: \"#4b5563\",\r\n                    textAlign: \"center\",\r\n                    marginTop: \"1rem\",\r\n                    lineHeight: \"1rem\",\r\n                  }}\r\n                >\r\n                  Magmo answers using internal service manuals.\r\n                  Always lockout / tagout and follow OEM safety\r\n                  procedures.\r\n                </div>\r\n              </Card.Body>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </Container>\r\n    </LoggedIn>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}