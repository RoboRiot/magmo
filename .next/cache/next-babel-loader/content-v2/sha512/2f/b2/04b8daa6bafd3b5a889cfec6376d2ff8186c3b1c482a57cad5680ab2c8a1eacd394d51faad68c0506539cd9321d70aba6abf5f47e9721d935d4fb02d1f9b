{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\mainSearch.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport { InputGroup, Dropdown, FormControl, Button, NavDropdown, Form, Modal, Pagination, Offcanvas } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { fetchPartsWithMachineDataPage, fetchClients, fetchModels } from \"../../utils/fetchAssociations\";\nimport { useAuth } from \"../../context/AuthUserContext\";\nimport LoggedIn from \"../LoggedIn\";\nimport ClientTable from \"../../utils/ClientTable\";\nimport ModelTable from \"../../utils/ModelTable\";\nimport PartTable from \"../../utils/PartTable\";\nimport styles from \"../../styles/MainSearch.module.css\";\nimport firebase from \"../../context/Firebase\";\nimport { buildNameTokens } from \"../../utils/itemFormShared\"; // Predefined warehouse client IDs and display names\n\nconst SOCAL_CLIENT_ID = \"AIS17182\";\nconst NORCAL_CLIENT_ID = \"AIS25097\";\nconst UNASSIGNED_CLIENT_ID = \"AIS00404\";\nconst DEFAULT_PAGE_SIZE = 25;\nconst MAP_REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"]; // Simulates a network request delay\n\nfunction simulateNetworkRequest() {\n  return new Promise(resolve => setTimeout(resolve, 2000));\n} // Custom LoadingButton component\n\n\nfunction LoadingButton({\n  type,\n  name,\n  route,\n  className\n}) {\n  const {\n    0: isLoading,\n    1: setLoading\n  } = useState(false);\n  useEffect(() => {\n    if (isLoading) {\n      let cancelled = false;\n      simulateNetworkRequest().then(() => {\n        if (!cancelled) setLoading(false);\n      });\n      return () => {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n  return __jsx(Link, {\n    href: `/${route}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 5\n    }\n  }, __jsx(\"a\", {\n    className: `btn btn-${type} ${className || \"\"}`,\n    disabled: isLoading,\n    onClick: () => !isLoading && setLoading(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }\n  }, isLoading ? \"Loading…\" : name));\n} // ---- DATE HELPERS (top-level scope) ----\n// Convert anything date-ish into a timestamp (ms since epoch).\n\n\nfunction toTime(value) {\n  if (!value) return null; // Firestore Timestamp { seconds, nanoseconds }\n\n  if (typeof value === \"object\" && value !== null && value.seconds != null) {\n    try {\n      return value.seconds * 1000;\n    } catch {\n      /* ignore */\n    }\n  } // Native Date\n\n\n  if (value instanceof Date) {\n    const t = value.getTime();\n    return isNaN(t) ? null : t;\n  } // Strings\n\n\n  if (typeof value === \"string\") {\n    // ISO / yyyy-mm-dd\n    const iso = Date.parse(value);\n    if (!isNaN(iso)) return iso; // mm/dd/yyyy\n\n    const parts = value.split(\"/\");\n\n    if (parts.length === 3) {\n      const [mm, dd, yyyy] = parts;\n      const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\n      if (!isNaN(alt)) return alt;\n    }\n  } // Last resort\n\n\n  const t = Date.parse(value);\n  return isNaN(t) ? null : t;\n} // Canonicalize to 'yyyy-mm-dd' (matches <input type=\"date\">)\n\n\nfunction toYMD(value) {\n  const t = toTime(value);\n  if (t == null) return null;\n  const d = new Date(t);\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nfunction normalizeText(value) {\n  if (value == null) return \"\";\n  return String(value).toLowerCase().trim();\n}\n\nfunction getMachineField(item, key) {\n  var _ref, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _item$machineData$key, _item$machineData, _item$machineData2, _item$currentMachineD, _item$currentMachineD2, _item$theMachineData, _item$theMachineData2, _item$TheMachine, _item$TheMachine2;\n\n  if (!item) return null;\n  const lower = key.toLowerCase();\n  return (_ref = (_ref2 = (_ref3 = (_ref4 = (_ref5 = (_ref6 = (_ref7 = (_item$machineData$key = item === null || item === void 0 ? void 0 : (_item$machineData = item.machineData) === null || _item$machineData === void 0 ? void 0 : _item$machineData[key]) !== null && _item$machineData$key !== void 0 ? _item$machineData$key : item === null || item === void 0 ? void 0 : (_item$machineData2 = item.machineData) === null || _item$machineData2 === void 0 ? void 0 : _item$machineData2[lower]) !== null && _ref7 !== void 0 ? _ref7 : item === null || item === void 0 ? void 0 : (_item$currentMachineD = item.currentMachineData) === null || _item$currentMachineD === void 0 ? void 0 : _item$currentMachineD[key]) !== null && _ref6 !== void 0 ? _ref6 : item === null || item === void 0 ? void 0 : (_item$currentMachineD2 = item.currentMachineData) === null || _item$currentMachineD2 === void 0 ? void 0 : _item$currentMachineD2[lower]) !== null && _ref5 !== void 0 ? _ref5 : item === null || item === void 0 ? void 0 : (_item$theMachineData = item.theMachineData) === null || _item$theMachineData === void 0 ? void 0 : _item$theMachineData[key]) !== null && _ref4 !== void 0 ? _ref4 : item === null || item === void 0 ? void 0 : (_item$theMachineData2 = item.theMachineData) === null || _item$theMachineData2 === void 0 ? void 0 : _item$theMachineData2[lower]) !== null && _ref3 !== void 0 ? _ref3 : item === null || item === void 0 ? void 0 : (_item$TheMachine = item.TheMachine) === null || _item$TheMachine === void 0 ? void 0 : _item$TheMachine[key]) !== null && _ref2 !== void 0 ? _ref2 : item === null || item === void 0 ? void 0 : (_item$TheMachine2 = item.TheMachine) === null || _item$TheMachine2 === void 0 ? void 0 : _item$TheMachine2[lower]) !== null && _ref !== void 0 ? _ref : null;\n}\n\nexport default function MainSearch() {\n  const {\n    signOut\n  } = useAuth();\n  const {\n    0: info,\n    1: setInfo\n  } = useState([]);\n  const {\n    0: backupInfo,\n    1: setBackupInfo\n  } = useState([]);\n  const {\n    0: augmentedInfo,\n    1: setAugmentedInfo\n  } = useState([]); // items with clientFromId/currentId added\n\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true);\n  const {\n    0: ids,\n    1: setID\n  } = useState([]);\n  const {\n    0: show,\n    1: setShow\n  } = useState(false);\n  const {\n    0: showFilters,\n    1: setShowFilters\n  } = useState(false);\n  const {\n    0: pageSize,\n    1: setPageSize\n  } = useState(DEFAULT_PAGE_SIZE);\n  const {\n    0: isNavigating,\n    1: setIsNavigating\n  } = useState(false);\n  const {\n    0: dItem,\n    1: setDItem\n  } = useState();\n  const {\n    0: select,\n    1: setSelect\n  } = useState(\"Name\");\n  const {\n    0: showList,\n    1: setShowList\n  } = useState(false);\n  const {\n    0: showListSearch,\n    1: setShowListSearch\n  } = useState(\"text\");\n  const {\n    0: search,\n    1: setSearch\n  } = useState(\"\");\n  const {\n    0: selectedOEM,\n    1: setSelectedOEM\n  } = useState(null);\n  const {\n    0: selectedModality,\n    1: setSelectedModality\n  } = useState(null); // Replace the old single client state with two sets:\n\n  const {\n    0: selectedClientFrom,\n    1: setSelectedClientFrom\n  } = useState(null);\n  const {\n    0: clientFromButtonText,\n    1: setClientFromButtonText\n  } = useState(\"Select Option\");\n  const {\n    0: selectedClientCurrent,\n    1: setSelectedClientCurrent\n  } = useState(null);\n  const {\n    0: clientCurrentButtonText,\n    1: setClientCurrentButtonText\n  } = useState(\"Select Option\");\n  const {\n    0: clients,\n    1: setClients\n  } = useState([]);\n  const {\n    0: showClientModal,\n    1: setShowClientModal\n  } = useState(false); // This state tells the modal which client box is being updated: \"from\" or \"current\"\n\n  const {\n    0: clientSelectionType,\n    1: setClientSelectionType\n  } = useState(null);\n  const {\n    0: showMap,\n    1: setShowMap\n  } = useState(false);\n  const {\n    0: mapRegionOptions,\n    1: setMapRegionOptions\n  } = useState([]);\n  const {\n    0: mapSectionMap,\n    1: setMapSectionMap\n  } = useState({});\n  const {\n    0: mapStep,\n    1: setMapStep\n  } = useState(\"regions\");\n  const {\n    0: mapRegion,\n    1: setMapRegion\n  } = useState(\"\");\n  const {\n    0: mapRow,\n    1: setMapRow\n  } = useState(\"\");\n  const {\n    0: mapCol,\n    1: setMapCol\n  } = useState(\"\");\n  const {\n    0: mapPallet,\n    1: setMapPallet\n  } = useState(\"\");\n  const {\n    0: mapCellPallets,\n    1: setMapCellPallets\n  } = useState({});\n  const {\n    0: mapPalletBins,\n    1: setMapPalletBins\n  } = useState({});\n  const {\n    0: mapLoading,\n    1: setMapLoading\n  } = useState(false);\n  const {\n    0: mapError,\n    1: setMapError\n  } = useState(\"\");\n  const {\n    0: mapDirectoryLoaded,\n    1: setMapDirectoryLoaded\n  } = useState(false);\n  const router = useRouter();\n  const labelBase = [\"name\", \"date\", \"w/o\", \"p/n\", \"s/n\"];\n  const labelBaseNames = [\"name\", \"date\", \"wo\", \"pn\", \"sn\"];\n  const sortCheckBase = [false, false, false, false, false, false];\n\n  function withSortIcon(baseLabels, activeIndex, isDesc) {\n    return baseLabels.map((text, i) => {\n      if (i !== activeIndex) return text; // untouched\n\n      const arrow = isDesc ? \" ▼\" : \" ▲\";\n      return `${text}${arrow}`;\n    });\n  }\n\n  const {\n    0: labels,\n    1: setLabels\n  } = useState(labelBase);\n  const {\n    0: sortCheck,\n    1: setSortCheck\n  } = useState(sortCheckBase);\n  const {\n    0: hoverIndex,\n    1: setHoverIndex\n  } = useState(null);\n  const {\n    0: selectedModel,\n    1: setSelectedModel\n  } = useState(null);\n  const {\n    0: gPos,\n    1: setGPos\n  } = useState(null);\n  const {\n    0: gIde,\n    1: setGIde\n  } = useState(null);\n  const {\n    0: isDeleting,\n    1: setIsDeleting\n  } = useState(false);\n  const {\n    0: page,\n    1: setPage\n  } = useState(1);\n  const {\n    0: pageCursors,\n    1: setPageCursors\n  } = useState([]);\n  const {\n    0: hasNextPage,\n    1: setHasNextPage\n  } = useState(false);\n  const fetchSeq = useRef(0);\n  const backfillInFlight = useRef(false);\n  const {\n    0: queryEpoch,\n    1: setQueryEpoch\n  } = useState(0);\n  const {\n    0: loadError,\n    1: setLoadError\n  } = useState(null);\n  const tableBodyRef = useRef(null);\n  const rowHeightRef = useRef(46);\n  const headerHeightRef = useRef(38);\n  const LOAD_TIMEOUT_MS = 30000;\n  const mapLetters = useMemo(() => Array.from({\n    length: 26\n  }, (_, i) => String.fromCharCode(65 + i)), []);\n  const mapNumbers = useMemo(() => Array.from({\n    length: 50\n  }, (_, i) => i + 1), []);\n  const loadMapDirectory = useCallback(async () => {\n    if (mapDirectoryLoaded) return;\n\n    try {\n      const doc = await firebase.firestore().collection(\"Warehouse\").doc(\"directory\").get();\n      const data = doc.data() || {};\n      setMapRegionOptions(data.Region || []);\n      setMapSectionMap(data.Section || {});\n      setMapDirectoryLoaded(true);\n    } catch (error) {\n      console.error(\"Failed to load map directory\", error);\n      setMapError(\"Failed to load warehouse directory.\");\n    }\n  }, [mapDirectoryLoaded]);\n  const getMapRegionDimensions = useCallback(regionId => {\n    const entry = mapSectionMap === null || mapSectionMap === void 0 ? void 0 : mapSectionMap[regionId];\n\n    if (Array.isArray(entry) && entry.length >= 2) {\n      const cols = parseInt(entry[0], 10);\n      const rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0\n      };\n    }\n\n    return {\n      cols: 0,\n      rows: 0\n    };\n  }, [mapSectionMap]);\n  const loadMapInventory = useCallback(async regionId => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n\n    try {\n      const snap = await firebase.firestore().collection(\"Test\").where(\"newLocalCurrent.region\", \"==\", regionId).get();\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach(doc => {\n        var _doc$data, _loc$section, _loc$section2;\n\n        const loc = ((_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.newLocalCurrent) || {};\n        let row = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.letter;\n        let col = (_loc$section2 = loc.section) === null || _loc$section2 === void 0 ? void 0 : _loc$section2.number;\n\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n\n        if (pallet !== undefined && pallet !== null && `${pallet}` !== \"\") {\n          if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n          cellPallets[cellKey].add(String(pallet));\n\n          if (bin !== undefined && bin !== null && `${bin}` !== \"\") {\n            const palletKey = `${cellKey}-P${pallet}`;\n            if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n            palletBins[palletKey].add(String(bin));\n          }\n        }\n      });\n      const cellObj = {};\n      Object.keys(cellPallets).forEach(key => {\n        cellObj[key] = Array.from(cellPallets[key]).sort((a, b) => Number(a) - Number(b));\n      });\n      const palletObj = {};\n      Object.keys(palletBins).forEach(key => {\n        palletObj[key] = Array.from(palletBins[key]).sort((a, b) => Number(a) - Number(b));\n      });\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  }, []);\n\n  const openMap = async () => {\n    setMapError(\"\");\n    await loadMapDirectory();\n\n    if (mapRegion) {\n      setMapStep(\"grid\");\n      loadMapInventory(mapRegion);\n    } else {\n      setMapStep(\"regions\");\n    }\n\n    setShowMap(true);\n  };\n\n  const handleMapSelectRegion = regionId => {\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapStep(\"grid\");\n    loadMapInventory(regionId);\n  };\n\n  const handleMapSelectCell = (rowLetter, colNumber) => {\n    setMapRow(rowLetter);\n    setMapCol(colNumber);\n    setMapPallet(\"\");\n    setMapStep(\"pallets\");\n  };\n\n  const handleMapSelectPallet = palletId => {\n    setMapPallet(palletId);\n    setMapStep(\"bins\");\n  };\n\n  const handleMapBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");else if (mapStep === \"pallets\") setMapStep(\"grid\");else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleMapView = (overrides = {}) => {\n    var _overrides$region, _overrides$sectionLet, _overrides$sectionNum, _overrides$pallet, _overrides$bin;\n\n    const params = new URLSearchParams();\n    const regionValue = (_overrides$region = overrides.region) !== null && _overrides$region !== void 0 ? _overrides$region : mapRegion;\n    const letterValue = (_overrides$sectionLet = overrides.sectionLetter) !== null && _overrides$sectionLet !== void 0 ? _overrides$sectionLet : mapRow;\n    const numberValue = (_overrides$sectionNum = overrides.sectionNumber) !== null && _overrides$sectionNum !== void 0 ? _overrides$sectionNum : mapCol;\n    const palletValue = (_overrides$pallet = overrides.pallet) !== null && _overrides$pallet !== void 0 ? _overrides$pallet : mapPallet;\n    const binValue = (_overrides$bin = overrides.bin) !== null && _overrides$bin !== void 0 ? _overrides$bin : \"\";\n    if (regionValue) params.set(\"region\", regionValue);\n    if (letterValue) params.set(\"sectionLetter\", letterValue);\n    if (numberValue) params.set(\"sectionNumber\", numberValue);\n    if (palletValue) params.set(\"pallet\", palletValue);\n    if (binValue) params.set(\"bin\", binValue);\n    const query = params.toString();\n    router.push(`/NewSearch/inventory/inventoryManage${query ? `?${query}` : \"\"}`);\n  };\n\n  const startNameTokenBackfill = useCallback(async (reason = \"\") => {\n    if (backfillInFlight.current) return;\n\n    if (false) {\n      const lastRun = window.localStorage.getItem(\"nameTokensBackfillAt\");\n\n      if (lastRun && Date.now() - Number(lastRun) < 24 * 60 * 60 * 1000) {\n        return;\n      }\n    }\n\n    backfillInFlight.current = true;\n    const db = firebase.firestore();\n    let lastDoc = null;\n\n    const tokensEqual = (a, b) => {\n      if (a.length !== b.length) return false;\n      const setA = new Set(a);\n      const setB = new Set(b);\n      if (setA.size !== setB.size) return false;\n\n      for (const v of setA) if (!setB.has(v)) return false;\n\n      return true;\n    };\n\n    try {\n      while (true) {\n        let query = db.collection(\"Test\").orderBy(firebase.firestore.FieldPath.documentId()).limit(200);\n        if (lastDoc) query = query.startAfter(lastDoc);\n        const snap = await query.get();\n        if (snap.empty) break;\n        const batch = db.batch();\n        let writes = 0;\n        snap.docs.forEach(doc => {\n          const data = doc.data() || {};\n          const name = typeof data.name === \"string\" ? data.name : \"\";\n          const nameLower = name.toLowerCase();\n          const nameTokens = buildNameTokens(name);\n          const existingTokens = Array.isArray(data.nameTokens) ? Array.from(new Set(data.nameTokens.map(v => String(v)))) : [];\n          const needsUpdate = data.nameLower !== nameLower || !tokensEqual(existingTokens, nameTokens);\n\n          if (needsUpdate) {\n            batch.update(doc.ref, {\n              nameLower,\n              nameTokens\n            });\n            writes += 1;\n          }\n        });\n\n        if (writes > 0) {\n          await batch.commit();\n        }\n\n        lastDoc = snap.docs[snap.docs.length - 1];\n        await new Promise(resolve => setTimeout(resolve, 25));\n      }\n\n      if (false) {\n        window.localStorage.setItem(\"nameTokensBackfillAt\", String(Date.now()));\n      }\n    } catch (error) {\n      console.error(\"Name token backfill failed:\", reason, error);\n    } finally {\n      backfillInFlight.current = false;\n    }\n  }, []);\n  const searchLower = (search || \"\").toLowerCase().trim();\n  const hasActiveFilters = Boolean(selectedOEM) || Boolean(selectedModality) || Boolean(selectedModel) || Boolean(selectedClientFrom) || Boolean(selectedClientCurrent) || Boolean(searchLower);\n\n  const valueMatches = (value, s) => {\n    if (!value) return false;\n\n    if (Array.isArray(value)) {\n      return value.some(v => valueMatches(v, s));\n    }\n\n    return String(value).toLowerCase().includes(s);\n  };\n\n  const matchesFilters = useCallback(item => {\n    // hide explicitly hidden items\n    if ((item === null || item === void 0 ? void 0 : item.visible) === false) return false; // OEM / Modality / Model filtering\n\n    const OEM = getMachineField(item, \"OEM\");\n    const Modality = getMachineField(item, \"Modality\");\n    const Model = getMachineField(item, \"Model\");\n\n    if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n      return false;\n    }\n\n    if (selectedModality && normalizeText(Modality) !== normalizeText(selectedModality)) {\n      return false;\n    }\n\n    if (selectedModel && normalizeText(Model) !== normalizeText(selectedModel)) {\n      return false;\n    } // Client filters\n\n\n    if (selectedClientFrom && (item === null || item === void 0 ? void 0 : item.clientFromId) !== selectedClientFrom) {\n      return false;\n    }\n\n    if (selectedClientCurrent && (item === null || item === void 0 ? void 0 : item.clientCurrentId) !== selectedClientCurrent) {\n      return false;\n    } // Search\n\n\n    if (searchLower) {\n      if (select === \"Name\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.name, searchLower);\n      }\n\n      if (select === \"Date\") {\n        const wantedDay = searchLower; // yyyy-mm-dd from input\n\n        const itemYMD = toYMD(item === null || item === void 0 ? void 0 : item.date);\n        if (itemYMD && itemYMD === wantedDay) return true;\n\n        if (Array.isArray(item === null || item === void 0 ? void 0 : item.descriptions)) {\n          if (item.descriptions.some(d => toYMD(d === null || d === void 0 ? void 0 : d.date) === wantedDay)) {\n            return true;\n          }\n        }\n\n        if (Array.isArray(item === null || item === void 0 ? void 0 : item.workOrders)) {\n          if (item.workOrders.some(w => toYMD(w === null || w === void 0 ? void 0 : w.date) === wantedDay)) {\n            return true;\n          }\n        }\n\n        return false;\n      }\n\n      if (select === \"Work Order\") {\n        return Array.isArray(item === null || item === void 0 ? void 0 : item.workOrders) && item.workOrders.some(wo => valueMatches(wo === null || wo === void 0 ? void 0 : wo.workOrder, searchLower));\n      }\n\n      if (select === \"Product Number\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.pn, searchLower);\n      }\n\n      if (select === \"Serial Number\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.sn, searchLower);\n      }\n\n      if (select === \"Description\") {\n        if (valueMatches(item === null || item === void 0 ? void 0 : item.desc, searchLower)) return true;\n        if (valueMatches(item === null || item === void 0 ? void 0 : item.description, searchLower)) return true;\n\n        if (Array.isArray(item === null || item === void 0 ? void 0 : item.descriptions)) {\n          return item.descriptions.some(d => valueMatches(d === null || d === void 0 ? void 0 : d.description, searchLower));\n        }\n\n        return false;\n      }\n\n      if (select === \"SKU\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.id, searchLower) || valueMatches(item === null || item === void 0 ? void 0 : item.localSN, searchLower) || valueMatches(item === null || item === void 0 ? void 0 : item.local_sn, searchLower);\n      }\n    }\n\n    return true;\n  }, [selectedOEM, selectedModality, selectedModel, selectedClientFrom, selectedClientCurrent, searchLower, select]);\n\n  const resetPagination = () => {\n    setPage(1);\n    setPageCursors([]);\n    setHasNextPage(false);\n  }; // Reset pagination on route/query change (prevents stale pages like “starting at 6”)\n\n\n  useEffect(() => {\n    resetPagination();\n    setQueryEpoch(v => v + 1);\n  }, [router.asPath]); // Reset and refetch when filters/search change\n\n  useEffect(() => {\n    resetPagination();\n    setQueryEpoch(v => v + 1);\n  }, [selectedOEM, selectedModality, selectedModel, selectedClientFrom, selectedClientCurrent, search, select]); // Fetch data on component mount and route change\n\n  useEffect(() => {\n    fetchData(page);\n  }, [page, queryEpoch]);\n  useEffect(() => {\n    if (!(router !== null && router !== void 0 && router.events)) return;\n\n    const handleDone = () => setIsNavigating(false);\n\n    router.events.on(\"routeChangeComplete\", handleDone);\n    router.events.on(\"routeChangeError\", handleDone);\n    return () => {\n      router.events.off(\"routeChangeComplete\", handleDone);\n      router.events.off(\"routeChangeError\", handleDone);\n    };\n  }, [router]);\n\n  async function fetchData(requestedPage = 1) {\n    const seq = ++fetchSeq.current;\n    let timedOut = false;\n    setIsLoading(true);\n    setLoadError(null);\n    const timeoutId = setTimeout(() => {\n      timedOut = true;\n\n      if (seq === fetchSeq.current) {\n        setLoadError({\n          code: \"timeout\",\n          message: `Loading is taking longer than ${Math.round(LOAD_TIMEOUT_MS / 1000)}s. This is likely due to very selective filters.`\n        });\n        setIsLoading(false);\n      }\n    }, LOAD_TIMEOUT_MS);\n\n    try {\n      if (router.query.inputText && router.query.selectedType) {\n        setSelect(router.query.selectedType);\n        setSearch(router.query.inputText);\n      }\n\n      const startAfterDoc = requestedPage > 1 ? pageCursors[requestedPage - 2] : null;\n\n      if (requestedPage > 1 && !startAfterDoc) {\n        setPage(1);\n\n        if (seq === fetchSeq.current) {\n          clearTimeout(timeoutId);\n          setIsLoading(false);\n        }\n\n        return;\n      }\n\n      const effectiveSelect = router.query.selectedType || select;\n      const effectiveSearch = router.query.inputText || search;\n      const effectiveSearchLower = (effectiveSearch || \"\").toLowerCase().trim(); // light retry for transient Firestore hiccups\n\n      const load = async (attempt = 1) => {\n        try {\n          return await fetchPartsWithMachineDataPage({\n            pageSize,\n            startAfterDoc,\n            visibleOnly: true,\n            filterFn: hasActiveFilters ? matchesFilters : null,\n            search: effectiveSearchLower ? {\n              type: effectiveSelect,\n              raw: effectiveSearch,\n              lower: effectiveSearchLower\n            } : null,\n            needsMachineData: Boolean(selectedOEM) || Boolean(selectedModality) || Boolean(selectedModel) || Boolean(selectedClientFrom) || Boolean(selectedClientCurrent)\n          });\n        } catch (e) {\n          if (attempt >= 3) throw e;\n          await new Promise(r => setTimeout(r, 250 * Math.pow(2, attempt - 1)));\n          return load(attempt + 1);\n        }\n      };\n\n      const {\n        parts: data,\n        lastDoc,\n        hasNextPage: nextPage\n      } = await load();\n      if (timedOut || seq !== fetchSeq.current) return;\n      const hasNameSearch = Boolean(effectiveSearchLower) && effectiveSelect === \"Name\";\n\n      if (hasNameSearch && (data.length === 0 || data.some(item => !Array.isArray(item === null || item === void 0 ? void 0 : item.nameTokens) || item.nameTokens.length === 0))) {\n        startNameTokenBackfill(\"name-search\");\n      }\n\n      if (requestedPage === 1 && data.length === 0) {\n        setPageCursors([]);\n        setHasNextPage(false);\n      }\n\n      setBackupInfo(data);\n      setLabels(labelBase); // <-- add this line after setBackupInfo(data)\n\n      setID(data.map(item => item.id));\n\n      if (requestedPage > 1 && data.length === 0) {\n        setHasNextPage(false);\n        setPage(1);\n        return;\n      }\n\n      setHasNextPage(nextPage);\n      setPageCursors(prev => {\n        const next = requestedPage === 1 ? [] : [...prev];\n\n        if (lastDoc) {\n          next[requestedPage - 1] = lastDoc;\n        }\n\n        return next;\n      });\n      setSelectedItems([]); // Normalize client ids for filtering\n\n      const augmented = data.map(item => {\n        var _ref8, _ref9, _item$clientFromId, _item$ClientFrom, _ref10, _ref11, _item$clientCurrentId, _item$ClientCurrent;\n\n        return _objectSpread(_objectSpread({}, item), {}, {\n          clientFromId: (_ref8 = (_ref9 = (_item$clientFromId = item === null || item === void 0 ? void 0 : item.clientFromId) !== null && _item$clientFromId !== void 0 ? _item$clientFromId : typeof (item === null || item === void 0 ? void 0 : item.ClientFrom) === \"string\" ? item.ClientFrom : null) !== null && _ref9 !== void 0 ? _ref9 : item === null || item === void 0 ? void 0 : (_item$ClientFrom = item.ClientFrom) === null || _item$ClientFrom === void 0 ? void 0 : _item$ClientFrom.id) !== null && _ref8 !== void 0 ? _ref8 : null,\n          clientCurrentId: (_ref10 = (_ref11 = (_item$clientCurrentId = item === null || item === void 0 ? void 0 : item.clientCurrentId) !== null && _item$clientCurrentId !== void 0 ? _item$clientCurrentId : typeof (item === null || item === void 0 ? void 0 : item.ClientCurrent) === \"string\" ? item.ClientCurrent : null) !== null && _ref11 !== void 0 ? _ref11 : item === null || item === void 0 ? void 0 : (_item$ClientCurrent = item.ClientCurrent) === null || _item$ClientCurrent === void 0 ? void 0 : _item$ClientCurrent.id) !== null && _ref10 !== void 0 ? _ref10 : null\n        });\n      });\n      setAugmentedInfo(augmented); // default view = filtered (keeps pagination and filters consistent)\n\n      setInfo(augmented.filter(matchesFilters));\n    } catch (err) {\n      if (seq !== fetchSeq.current) return;\n      console.error(\"Error fetching data:\", err);\n      const code = (err === null || err === void 0 ? void 0 : err.code) || \"unknown\";\n      setLoadError({\n        code,\n        message: (err === null || err === void 0 ? void 0 : err.message) || \"Failed to load items.\"\n      });\n      setInfo([]);\n      setAugmentedInfo([]);\n    } finally {\n      clearTimeout(timeoutId);\n      if (seq === fetchSeq.current && !timedOut) setIsLoading(false);\n    }\n  }\n\n  const searchChangeHandler = event => setSearch(event.target.value); // Filter the currently loaded items (now consistent with paged filtering)\n\n\n  useEffect(() => {\n    const base = augmentedInfo || [];\n    setInfo(base.filter(matchesFilters));\n  }, [augmentedInfo, matchesFilters]);\n\n  function sortCheckAll(pos) {\n    // Determine next direction: toggle the clicked column only\n    const nextSortCheck = sortCheck.map((v, i) => i === pos ? !v : v);\n    const isDesc = nextSortCheck[pos]; // true means descending\n\n    const sortedInfo = [...info].sort((a, b) => {\n      const key = labelBaseNames[pos];\n\n      if (pos === 1) {\n        // DATE column\n        const ta = toTime(a[key]);\n        const tb = toTime(b[key]); // Put missing dates at the end for ascending, at the start for descending\n\n        if (ta === null && tb === null) return 0;\n        if (ta === null) return isDesc ? -1 : 1;\n        if (tb === null) return isDesc ? 1 : -1;\n        return isDesc ? tb - ta : ta - tb;\n      } // NAME or SKU (string-y columns): indexes 0 or 5 in your original logic\n\n\n      if (pos === 0 || pos === 5) {\n        var _a$key, _b$key;\n\n        const av = ((_a$key = a[key]) !== null && _a$key !== void 0 ? _a$key : \"\").toString();\n        const bv = ((_b$key = b[key]) !== null && _b$key !== void 0 ? _b$key : \"\").toString();\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\n      } // Numeric-ish columns (wo, pn, sn) — fall back to string compare if NaN\n\n\n      const an = Number(a[key]);\n      const bn = Number(b[key]);\n\n      if (!isNaN(an) && !isNaN(bn)) {\n        return isDesc ? bn - an : an - bn;\n      } else {\n        var _a$key2, _b$key2;\n\n        const av = ((_a$key2 = a[key]) !== null && _a$key2 !== void 0 ? _a$key2 : \"\").toString();\n        const bv = ((_b$key2 = b[key]) !== null && _b$key2 !== void 0 ? _b$key2 : \"\").toString();\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\n      }\n    });\n    setInfo(sortedInfo);\n    setSortCheck(nextSortCheck); // Update header labels to show the little arrow on the active column\n\n    setLabels(withSortIcon(labelBase, pos, isDesc));\n  }\n\n  const rowSelect = item => {\n    if (item && item.id) {\n      console.log(\"Selected item:\", item);\n      setIsNavigating(true);\n      router.push(\"./item/\" + item.id);\n    } else {\n      console.error(\"Unable to determine the selected item’s ID: \", item);\n    }\n  };\n\n  const {\n    0: selectedItems,\n    1: setSelectedItems\n  } = useState([]);\n  const {\n    0: showDeleteModal,\n    1: setShowDeleteModal\n  } = useState(false);\n\n  const handleSelectItem = id => {\n    setSelectedItems(prev => prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]);\n  }; // setSelectedItems((prev) => {\n  //   const newSelection = prev.includes(id)\n  //     ? prev.filter((itemId) => itemId !== id)\n  //     : [...prev, id];\n  //   console.log(\"Selected items:\", newSelection);\n  //   return newSelection; // <- important\n  // });\n\n\n  const handleShowDeleteModal = () => setShowDeleteModal(true);\n\n  const handleCloseDeleteModal = () => setShowDeleteModal(false);\n\n  const handleDeleteSelected = async () => {\n    setIsDeleting(true);\n    const db = firebase.firestore();\n\n    try {\n      // Loop over each selected item one at a time\n      for (const itemId of selectedItems) {\n        console.log(itemId);\n\n        try {\n          // Delete from \"Test\" collection\n          await db.collection(\"Test\").doc(itemId).delete();\n        } catch (err) {\n          console.error(`Error deleting document ${itemId} from Test:`, err);\n        }\n\n        try {\n          // Delete from \"Parts\" collection\n          await db.collection(\"Parts\").doc(itemId).delete();\n        } catch (err) {\n          console.error(`Error deleting document ${itemId} from Parts:`, err);\n        }\n\n        try {\n          // Delete associated photos from storage\n          await deleteFromStorage(itemId);\n        } catch (err) {\n          console.error(`Error deleting storage for ${itemId}:`, err);\n        }\n      } // Update local state by filtering out the deleted items\n\n\n      setInfo(info.filter(item => !selectedItems.includes(item.id)));\n      setSelectedItems([]);\n    } catch (error) {\n      console.error(\"Error deleting items:\", error);\n    } finally {\n      setIsDeleting(false);\n      handleCloseDeleteModal(); // Optionally, reload the page\n      // router.reload();\n    }\n  };\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  const checkDelete = (event, pos, idsToDelete, name) => {\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    console.log(\"Selected IDs to delete:\", idsToDelete);\n    setSelectedItems(idsToDelete);\n    setDItem(name);\n    setShowDeleteModal(true);\n  }; // const handleDelete = async () => {\n  //   let itemId = gIde;\n  //   try {\n  //     setIsDeleting(true);\n  //     const db = firebase.firestore();\n  //     await db.collection(\"Test\").doc(itemId).delete();\n  //     await deleteFromPartsCollection(itemId);\n  //     await deleteFromStorage(itemId);\n  //     setInfo(info.filter((_, i) => gPos !== i));\n  //     console.log(`Deleted item: ${itemId}`);\n  //   } catch (error) {\n  //     console.error(\"Error deleting item:\", error);\n  //   } finally {\n  //     setIsDeleting(false);\n  //   }\n  //   handleClose();\n  // };\n\n\n  const hoverStyle = index => ({\n    backgroundColor: hoverIndex === index ? \"#ddd\" : \"transparent\",\n    textAlign: \"center\",\n    cursor: \"default\"\n  });\n\n  const {\n    0: dropdown1Text,\n    1: setDropdown1Text\n  } = useState(\"Select Option\");\n  const {\n    0: dropdown2Text,\n    1: setDropdown2Text\n  } = useState(\"Select Option\");\n\n  const handleSelect1 = (eventKey, event) => {\n    if (eventKey === \"unassigned\") {\n      setDropdown1Text(\"Select Option\");\n      setSelectedOEM(null);\n    } else {\n      setDropdown1Text(event.target.textContent);\n      setSelectedOEM(event.target.textContent);\n    }\n  };\n\n  const handleSelect2 = (eventKey, event) => {\n    if (eventKey === \"unassigned\") {\n      setDropdown2Text(\"Select Option\");\n      setSelectedModality(null);\n    } else {\n      setDropdown2Text(event.target.textContent);\n      setSelectedModality(event.target.textContent);\n    }\n  }; // Build a unique list of clients from the items currently loaded, filtered by OEM/Modality.\n  // `type` is \"from\" or \"current\" to decide which client ref to read.\n\n\n  async function buildClientsFromItems(type) {\n    const db = firebase.firestore();\n    const ids = new Set(); // Respect current OEM / Modality filters when deriving client options\n\n    const filtered = augmentedInfo.filter(item => {\n      const OEM = getMachineField(item, \"OEM\");\n      const Modality = getMachineField(item, \"Modality\");\n\n      if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n        return false;\n      }\n\n      if (selectedModality && normalizeText(Modality) !== normalizeText(selectedModality)) {\n        return false;\n      }\n\n      return true;\n    });\n\n    for (const it of filtered) {\n      const id = type === \"from\" ? it.clientFromId : it.clientCurrentId;\n      if (id) ids.add(id);\n    }\n\n    const out = [];\n    const idArray = [...ids];\n\n    for (let i = 0; i < idArray.length; i += 10) {\n      const chunk = idArray.slice(i, i + 10);\n      const snap = await db.collection(\"Client\").where(firebase.firestore.FieldPath.documentId(), \"in\", chunk).get();\n      snap.forEach(doc => {\n        const d = doc.data() || {};\n        out.push({\n          id: doc.id,\n          name: d.name || doc.id\n        });\n      });\n    } // sort by name for nicer UX\n\n\n    out.sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\"));\n    return out;\n  } // --------------------\n  // CLIENT SELECTION HANDLING\n  // --------------------\n  // This function fetches clients and opens the client modal.\n\n\n  const handleClientClick = async () => {\n    let safeClients = [];\n\n    try {\n      const clientsData = await fetchClients(selectedOEM, selectedModality);\n      safeClients = Array.isArray(clientsData) ? clientsData : [];\n    } catch (e) {\n      console.error(\"fetchClients failed:\", e);\n    } // Fallback to building from loaded items if API gave us nothing\n\n\n    if (safeClients.length === 0) {\n      try {\n        if (!clientSelectionType) {\n          // if somehow not set yet, default to \"from\"\n          setClientSelectionType(\"from\");\n        }\n\n        const derived = await buildClientsFromItems(clientSelectionType || \"from\");\n        safeClients = derived;\n      } catch (e) {\n        console.error(\"Fallback buildClientsFromItems failed:\", e);\n        safeClients = [];\n      }\n    }\n\n    setClients(safeClients);\n    setClientSearchTerm(\"\");\n    setShowClientModal(true);\n  }; // When a client is selected in the modal, we now assume the parameter is a client ID.\n  // If the passed value is null, we clear the selection.\n\n\n  const handleClientSelect = async clientId => {\n    console.log(\"User selected client id:\", clientId);\n\n    if (!clientId) {\n      if (clientSelectionType === \"from\") {\n        setClientFromButtonText(\"Select Option\");\n        setSelectedClientFrom(null);\n      } else if (clientSelectionType === \"current\") {\n        setClientCurrentButtonText(\"Select Option\");\n        setSelectedClientCurrent(null);\n      }\n\n      setShowClientModal(false);\n      return;\n    }\n\n    try {\n      const clientSnap = await firebase.firestore().collection(\"Client\").doc(clientId).get();\n\n      if (clientSnap.exists) {\n        const clientData = clientSnap.data();\n\n        if (clientSelectionType === \"from\") {\n          setClientFromButtonText(clientData.name);\n          setSelectedClientFrom(clientId);\n        } else if (clientSelectionType === \"current\") {\n          setClientCurrentButtonText(clientData.name);\n          setSelectedClientCurrent(clientId);\n        }\n      } else {\n        console.error(\"No client document found for id:\", clientId);\n      }\n    } catch (error) {\n      console.error(\"Error fetching client data:\", error);\n    }\n\n    setShowClientModal(false);\n  };\n\n  const handleClientInfo = (clientId, clientName) => {\n    console.log(`Client ID: ${clientId}, Client Name: ${clientName}`);\n    router.push(\"client/\" + clientId);\n  };\n\n  const handleClearClientSelection = () => {\n    if (clientSelectionType === \"from\") {\n      setClientFromButtonText(\"Select Option\");\n      setSelectedClientFrom(null);\n    } else if (clientSelectionType === \"current\") {\n      setClientCurrentButtonText(\"Select Option\");\n      setSelectedClientCurrent(null);\n    }\n\n    setShowClientModal(false);\n  }; // --------------------\n  // MODEL SELECTION HANDLING\n  // --------------------\n\n\n  const {\n    0: models,\n    1: setModels\n  } = useState([]);\n  const {\n    0: showModelModal,\n    1: setShowModelModal\n  } = useState(false);\n  const {\n    0: modelButtonText,\n    1: setModelButtonText\n  } = useState(\"Select Option\");\n\n  const handleModelClick = async () => {\n    const modelsData = await fetchModels(selectedOEM, selectedModality, selectedClientFrom);\n    setModels(modelsData);\n    setModelSearchTerm(\"\");\n    setShowModelModal(true);\n  };\n\n  const handleModelSelect = modelName => {\n    setModelButtonText(modelName || \"Select Option\");\n    setSelectedModel(modelName || null);\n    setShowModelModal(false);\n  };\n\n  const handleClearModelSelection = () => {\n    setModelButtonText(\"Select Option\");\n    setSelectedModel(null);\n    setShowModelModal(false);\n  }; // --------------------\n  // WAREHOUSE BUTTONS (for Client Current)\n  // --------------------\n\n\n  const handleSoCalWarehouseClick = () => {\n    setClientCurrentButtonText(\"SoCal Warehouse\");\n    setSelectedClientCurrent(SOCAL_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", SOCAL_CLIENT_ID);\n  };\n\n  const handleNorCalWarehouseClick = () => {\n    setClientCurrentButtonText(\"NorCal Warehouse\");\n    setSelectedClientCurrent(NORCAL_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", NORCAL_CLIENT_ID);\n  };\n\n  const handleWarehouseUnassignedClick = () => {\n    setClientCurrentButtonText(\"Unassigned\");\n    setSelectedClientCurrent(UNASSIGNED_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", UNASSIGNED_CLIENT_ID);\n  };\n\n  const {\n    0: clientSearchTerm,\n    1: setClientSearchTerm\n  } = useState(\"\");\n  const {\n    0: modelSearchTerm,\n    1: setModelSearchTerm\n  } = useState(\"\");\n\n  const deleteFromStorage = async itemId => {\n    const storageRef = firebase.storage().ref();\n    const folderRef = storageRef.child(`Parts/${itemId}/`);\n\n    try {\n      const listResult = await folderRef.listAll();\n      const deletePromises = listResult.items.map(item => item.delete());\n      await Promise.all(deletePromises);\n    } catch (error) {\n      console.error(\"Error deleting from storage:\", error);\n    }\n  };\n\n  const deleteFromPartsCollection = async itemId => {\n    const db = firebase.firestore();\n\n    try {\n      await db.collection(\"Parts\").doc(itemId).delete();\n      console.log(`Deleted item from Parts collection: ${itemId}`);\n    } catch (error) {\n      console.error(\"Error deleting from Parts collection:\", error);\n    }\n  }; //   // Safely convert any date-ish value into a comparable timestamp (ms since epoch).\n  // function toTime(value) {\n  //   if (!value) return null;\n  //   // Firestore Timestamp: { seconds, nanoseconds }\n  //   if (typeof value === \"object\" && value.seconds) {\n  //     try {\n  //       return value.seconds * 1000;\n  //     } catch { /* fallthrough */ }\n  //   }\n  //   // If already a Date\n  //   if (value instanceof Date) return isNaN(value.getTime()) ? null : value.getTime();\n  //   // If string: try ISO first\n  //   if (typeof value === \"string\") {\n  //     // yyyy-mm-dd (from your form inputs)\n  //     const iso = Date.parse(value);\n  //     if (!isNaN(iso)) return iso;\n  //     // mm/dd/yyyy fallback (older items)\n  //     const parts = value.split(\"/\");\n  //     if (parts.length === 3) {\n  //       const [mm, dd, yyyy] = parts;\n  //       const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\n  //       if (!isNaN(alt)) return alt;\n  //     }\n  //   }\n  //   // Canonicalize any date-ish value to 'yyyy-mm-dd' so it matches <input type=\"date\"> values\n  //   function toYMD(value) {\n  //     const t = toTime(value);\n  //     if (t == null) return null;\n  //     const d = new Date(t);\n  //     const yyyy = d.getFullYear();\n  //     const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  //     const dd = String(d.getDate()).padStart(2, \"0\");\n  //     return `${yyyy}-${mm}-${dd}`;\n  //   }\n  //   // Last resort\n  //   const t = Date.parse(value);\n  //   return isNaN(t) ? null : t;\n  // }\n\n\n  const totalKnownPages = Math.max(1, pageCursors.filter(Boolean).length + (hasNextPage ? 1 : 0));\n\n  const pageButtons = (() => {\n    const buttons = [];\n    const maxVisible = 7;\n\n    const pushPage = p => buttons.push(__jsx(Pagination.Item, {\n      key: `page-${p}`,\n      active: p === page,\n      onClick: () => setPage(p),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1209,\n        columnNumber: 9\n      }\n    }, p));\n\n    const pushEllipsis = key => buttons.push(__jsx(Pagination.Ellipsis, {\n      key: key,\n      disabled: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1219,\n        columnNumber: 20\n      }\n    }));\n\n    if (totalKnownPages <= maxVisible) {\n      for (let i = 1; i <= totalKnownPages; i += 1) pushPage(i);\n\n      return buttons;\n    }\n\n    let start = Math.max(2, page - 1);\n    let end = Math.min(totalKnownPages - 1, page + 1);\n    const desiredWindow = maxVisible - 2;\n    let currentWindow = end - start + 1;\n    let remaining = desiredWindow - currentWindow;\n\n    while (remaining > 0) {\n      if (start > 2) {\n        start -= 1;\n        remaining -= 1;\n      }\n\n      if (remaining > 0 && end < totalKnownPages - 1) {\n        end += 1;\n        remaining -= 1;\n      }\n\n      if (start === 2 && end === totalKnownPages - 1) break;\n    }\n\n    pushPage(1);\n    if (start > 2) pushEllipsis(\"start-ellipsis\");\n\n    for (let i = start; i <= end; i += 1) pushPage(i);\n\n    if (end < totalKnownPages - 1) pushEllipsis(\"end-ellipsis\");\n    pushPage(totalKnownPages);\n    if (hasNextPage) pushEllipsis(\"more-ellipsis\");\n    return buttons;\n  })();\n\n  const recalcPageSize = useCallback(() => {\n    if (true) return;\n    if (page !== 1) return;\n    if (!tableBodyRef.current) return;\n    const containerHeight = tableBodyRef.current.getBoundingClientRect().height || 0;\n    if (!containerHeight) return;\n    const headerRow = tableBodyRef.current.querySelector(\"table thead tr\") || tableBodyRef.current.querySelector(\"thead tr\");\n    const bodyRow = tableBodyRef.current.querySelector(\"table tbody tr\") || tableBodyRef.current.querySelector(\"tbody tr\");\n\n    if (headerRow) {\n      const h = headerRow.getBoundingClientRect().height;\n      if (h) headerHeightRef.current = h;\n    }\n\n    if (bodyRow) {\n      const r = bodyRow.getBoundingClientRect().height;\n      if (r) rowHeightRef.current = r;\n    }\n\n    const verticalPadding = 24;\n    const available = containerHeight - headerHeightRef.current - verticalPadding;\n    const estimated = Math.floor(available / rowHeightRef.current);\n    const clamped = Math.max(5, Math.min(50, estimated));\n\n    if (clamped > 0 && clamped !== pageSize) {\n      setPageSize(clamped);\n      resetPagination();\n      setQueryEpoch(v => v + 1);\n    }\n  }, [page, pageSize]);\n  useEffect(() => {\n    if (true) return;\n    recalcPageSize();\n\n    const onResize = () => recalcPageSize();\n\n    window.addEventListener(\"resize\", onResize);\n    return () => window.removeEventListener(\"resize\", onResize);\n  }, [recalcPageSize]);\n  useEffect(() => {\n    if (isLoading || page !== 1) return;\n    recalcPageSize();\n  }, [page, isLoading, recalcPageSize]);\n\n  const renderFilters = idPrefix => __jsx(\"div\", {\n    className: styles.filtersPanel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1305,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: styles.filtersHeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1306,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1307,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.filtersTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1308,\n      columnNumber: 11\n    }\n  }, \"Filters\"), __jsx(\"div\", {\n    className: styles.filtersSubtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1309,\n      columnNumber: 11\n    }\n  }, \"Narrow results by machine, client, or warehouse.\")), hasActiveFilters ? __jsx(\"span\", {\n    className: styles.filtersBadge,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1314,\n      columnNumber: 11\n    }\n  }, \"Active\") : null), __jsx(\"div\", {\n    className: styles.filterSection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1318,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles.filterSectionTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1319,\n      columnNumber: 9\n    }\n  }, \"Machine\"), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1320,\n      columnNumber: 9\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1321,\n      columnNumber: 11\n    }\n  }, \"OEM\"), __jsx(Dropdown, {\n    onSelect: handleSelect1,\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1322,\n      columnNumber: 11\n    }\n  }, __jsx(Dropdown.Toggle, {\n    variant: \"outline-secondary\",\n    id: `${idPrefix}-oem`,\n    className: `w-100 ${styles.inputButton}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1323,\n      columnNumber: 13\n    }\n  }, dropdown1Text), __jsx(Dropdown.Menu, {\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1330,\n      columnNumber: 13\n    }\n  }, __jsx(Dropdown.Item, {\n    eventKey: \"unassigned\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1331,\n      columnNumber: 15\n    }\n  }, \"Select Option\"), __jsx(Dropdown.Item, {\n    eventKey: \"GE\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1332,\n      columnNumber: 15\n    }\n  }, \"GE\"), __jsx(Dropdown.Item, {\n    eventKey: \"Toshiba\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1333,\n      columnNumber: 15\n    }\n  }, \"Toshiba\"), __jsx(Dropdown.Item, {\n    eventKey: \"Siemens\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1334,\n      columnNumber: 15\n    }\n  }, \"Siemens\"), __jsx(Dropdown.Item, {\n    eventKey: \"Philips\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1335,\n      columnNumber: 15\n    }\n  }, \"Philips\")))), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1340,\n      columnNumber: 9\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1341,\n      columnNumber: 11\n    }\n  }, \"Modality\"), __jsx(Dropdown, {\n    onSelect: handleSelect2,\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1342,\n      columnNumber: 11\n    }\n  }, __jsx(Dropdown.Toggle, {\n    variant: \"outline-secondary\",\n    id: `${idPrefix}-modality`,\n    className: `w-100 ${styles.inputButton}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1343,\n      columnNumber: 13\n    }\n  }, dropdown2Text), __jsx(Dropdown.Menu, {\n    className: \"w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1350,\n      columnNumber: 13\n    }\n  }, __jsx(Dropdown.Item, {\n    eventKey: \"unassigned\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1351,\n      columnNumber: 15\n    }\n  }, \"Select Option\"), __jsx(Dropdown.Item, {\n    eventKey: \"CT\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1352,\n      columnNumber: 15\n    }\n  }, \"CT\"), __jsx(Dropdown.Item, {\n    eventKey: \"MRI\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1353,\n      columnNumber: 15\n    }\n  }, \"MRI\")))), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1358,\n      columnNumber: 9\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1359,\n      columnNumber: 11\n    }\n  }, \"Model\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: `w-100 ${styles.inputButton}`,\n    onClick: handleModelClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1360,\n      columnNumber: 11\n    }\n  }, modelButtonText))), __jsx(\"div\", {\n    className: styles.filterSection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1370,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles.filterSectionTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1371,\n      columnNumber: 9\n    }\n  }, \"Client\"), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1372,\n      columnNumber: 9\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1373,\n      columnNumber: 11\n    }\n  }, \"Client From\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: `w-100 ${styles.inputButton}`,\n    onClick: () => handleClientClick(\"from\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1374,\n      columnNumber: 11\n    }\n  }, clientFromButtonText)), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1383,\n      columnNumber: 9\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1384,\n      columnNumber: 11\n    }\n  }, \"Client Current\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: `w-100 ${styles.inputButton}`,\n    onClick: () => handleClientClick(\"current\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1385,\n      columnNumber: 11\n    }\n  }, clientCurrentButtonText))), __jsx(\"div\", {\n    className: styles.filterSection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1395,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles.filterSectionTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1396,\n      columnNumber: 9\n    }\n  }, \"Warehouse\"), __jsx(InputGroup, {\n    className: styles.inputGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1397,\n      columnNumber: 9\n    }\n  }, __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1398,\n      columnNumber: 11\n    }\n  }, \"Quick\"), __jsx(\"div\", {\n    className: styles.buttonGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1399,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.flexButton,\n    onClick: handleSoCalWarehouseClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1400,\n      columnNumber: 13\n    }\n  }, \"SoCal Warehouse\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.flexButton,\n    onClick: handleNorCalWarehouseClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1407,\n      columnNumber: 13\n    }\n  }, \"NorCal Warehouse\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.flexButton,\n    onClick: handleWarehouseUnassignedClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1414,\n      columnNumber: 13\n    }\n  }, \"Unassigned\")))));\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1429,\n      columnNumber: 5\n    }\n  }, (isDeleting || isNavigating) && __jsx(\"div\", {\n    className: styles.loadingOverlay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1431,\n      columnNumber: 9\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading Magmo\",\n    className: styles.loadingLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1432,\n      columnNumber: 11\n    }\n  })), __jsx(Modal, {\n    show: showDeleteModal,\n    onHide: handleCloseDeleteModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1439,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1440,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1441,\n      columnNumber: 11\n    }\n  }, \"Confirm Deletion\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1443,\n      columnNumber: 9\n    }\n  }, \"Are you sure you want to delete \", selectedItems.length, \" item\", selectedItems.length > 1 ? \"s\" : \"\", \"?\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1447,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    variant: \"danger\",\n    onClick: handleDeleteSelected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1448,\n      columnNumber: 11\n    }\n  }, \"Yes, delete\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseDeleteModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1451,\n      columnNumber: 11\n    }\n  }, \"Cancel\"))), __jsx(Modal, {\n    show: showClientModal,\n    onHide: () => setShowClientModal(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1457,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1458,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1459,\n      columnNumber: 11\n    }\n  }, \"Select \", clientSelectionType === \"from\" ? \"Client From\" : \"Client Current\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1463,\n      columnNumber: 9\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: clientSearchTerm,\n    onChange: e => setClientSearchTerm(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1464,\n      columnNumber: 11\n    }\n  }), __jsx(ClientTable, {\n    clients: (Array.isArray(clients) ? clients : []).filter(client => {\n      var _client$name;\n\n      return ((_client$name = client === null || client === void 0 ? void 0 : client.name) !== null && _client$name !== void 0 ? _client$name : \"\").toLowerCase().includes(clientSearchTerm.toLowerCase());\n    }),\n    onSelectClient: handleClientSelect,\n    onInfoClick: handleClientInfo,\n    isClientSearch: false,\n    clearSelection: () => handleClientSelect(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1471,\n      columnNumber: 11\n    }\n  }))), __jsx(Modal, {\n    show: showModelModal,\n    onHide: () => setShowModelModal(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1483,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1484,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1485,\n      columnNumber: 11\n    }\n  }, \"Select Model\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1487,\n      columnNumber: 9\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: modelSearchTerm,\n    onChange: e => setModelSearchTerm(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1488,\n      columnNumber: 11\n    }\n  }), __jsx(ModelTable, {\n    models: models.filter(model => typeof model === \"string\" ? model.toLowerCase().includes(modelSearchTerm.toLowerCase()) : false),\n    onSelectModel: handleModelSelect,\n    clearSelection: () => handleModelSelect(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1495,\n      columnNumber: 11\n    }\n  }))), __jsx(\"div\", {\n    className: styles.page,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1507,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles.pageInner,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1508,\n      columnNumber: 9\n    }\n  }, __jsx(\"header\", {\n    className: styles.header,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1509,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.headerLeft,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1510,\n      columnNumber: 13\n    }\n  }, __jsx(\"button\", {\n    type: \"button\",\n    className: styles.burger,\n    onClick: () => setShowFilters(true),\n    \"aria-label\": \"Open filters\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1511,\n      columnNumber: 15\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1517,\n      columnNumber: 17\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1518,\n      columnNumber: 17\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1519,\n      columnNumber: 17\n    }\n  })), __jsx(\"div\", {\n    className: styles.brand,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1521,\n      columnNumber: 15\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Magmo\",\n    className: styles.brandLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1522,\n      columnNumber: 17\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1527,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.brandName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1528,\n      columnNumber: 19\n    }\n  }, \"Magmo\"), __jsx(\"div\", {\n    className: styles.brandSub,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1529,\n      columnNumber: 19\n    }\n  }, \"Inventory Search\")))), __jsx(\"div\", {\n    className: styles.headerRight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1533,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.headerStatus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1534,\n      columnNumber: 15\n    }\n  }, hasActiveFilters ? \"Filters active\" : \"All items\"))), __jsx(\"div\", {\n    className: styles.content,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1540,\n      columnNumber: 11\n    }\n  }, __jsx(\"aside\", {\n    className: styles.sidebar,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1541,\n      columnNumber: 13\n    }\n  }, renderFilters(\"sidebar\")), __jsx(\"main\", {\n    className: styles.main,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1542,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableCard,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1543,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableHeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1544,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1545,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1546,\n      columnNumber: 21\n    }\n  }, \"Items\"), __jsx(\"div\", {\n    className: styles.tableSubtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1547,\n      columnNumber: 21\n    }\n  }, isLoading ? \"Loading items\" : `${info.length} items on this page`)), __jsx(\"div\", {\n    className: styles.tableMeta,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1551,\n      columnNumber: 19\n    }\n  }, \"Page \", page, \" \", hasNextPage ? `of ${totalKnownPages}+` : `of ${totalKnownPages}`)), __jsx(\"div\", {\n    className: styles.tableBody,\n    ref: tableBodyRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1556,\n      columnNumber: 17\n    }\n  }, isLoading ? __jsx(\"div\", {\n    className: styles.loadingState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1558,\n      columnNumber: 21\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading Magmo\",\n    className: styles.loadingLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1559,\n      columnNumber: 23\n    }\n  }), __jsx(\"div\", {\n    className: styles.loadingText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1564,\n      columnNumber: 23\n    }\n  }, \"Loading\")) : loadError ? __jsx(\"div\", {\n    className: styles.errorState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1567,\n      columnNumber: 21\n    }\n  }, __jsx(\"div\", {\n    className: styles.errorTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1568,\n      columnNumber: 23\n    }\n  }, \"Load failed (\", loadError.code, \")\"), __jsx(\"div\", {\n    className: styles.errorMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1571,\n      columnNumber: 23\n    }\n  }, loadError.message), __jsx(Button, {\n    variant: \"outline-secondary\",\n    size: \"sm\",\n    onClick: () => {\n      resetPagination();\n      setQueryEpoch(v => v + 1);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1572,\n      columnNumber: 23\n    }\n  }, \"Retry\")) : __jsx(PartTable, {\n    info: info,\n    labels: labels,\n    ids: ids,\n    hoverStyle: hoverStyle,\n    sortCheckAll: sortCheckAll,\n    checkDelete: checkDelete,\n    isDeleting: isDeleting,\n    rowSelect: rowSelect,\n    setHoverIndex: setHoverIndex,\n    hoverIndex: hoverIndex,\n    selectedItems: selectedItems,\n    setSelectedItems: setSelectedItems,\n    minRows: pageSize,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1584,\n      columnNumber: 21\n    }\n  })), __jsx(\"div\", {\n    className: styles.tableFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1602,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.paginationRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1603,\n      columnNumber: 19\n    }\n  }, __jsx(Pagination, {\n    size: \"sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1604,\n      columnNumber: 21\n    }\n  }, __jsx(Pagination.Prev, {\n    onClick: () => setPage(p => Math.max(1, p - 1)),\n    disabled: page <= 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1605,\n      columnNumber: 23\n    }\n  }, \"Previous\"), pageButtons, __jsx(Pagination.Next, {\n    onClick: () => setPage(p => p + 1),\n    disabled: !hasNextPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1612,\n      columnNumber: 23\n    }\n  }, \"Next\"))), __jsx(Form, {\n    className: styles.searchRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1620,\n      columnNumber: 19\n    }\n  }, __jsx(FormControl, {\n    type: showListSearch,\n    placeholder: \"Search\",\n    className: styles.searchInput,\n    \"aria-label\": \"Search\",\n    value: search,\n    onChange: searchChangeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1621,\n      columnNumber: 21\n    }\n  }), __jsx(NavDropdown, {\n    title: select,\n    id: \"collasible-nav-dropdown\",\n    show: showList,\n    onMouseEnter: () => setShowList(true),\n    onMouseLeave: () => setShowList(false),\n    className: styles.searchSelect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1629,\n      columnNumber: 21\n    }\n  }, __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Name\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1637,\n      columnNumber: 23\n    }\n  }, \"Name\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Date\");\n      setShowListSearch(\"date\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1645,\n      columnNumber: 23\n    }\n  }, \"Date\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Work Order\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1653,\n      columnNumber: 23\n    }\n  }, \"Work Order\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Product Number\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1661,\n      columnNumber: 23\n    }\n  }, \"Product Number\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Serial Number\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1669,\n      columnNumber: 23\n    }\n  }, \"Serial Number\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"Description\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1677,\n      columnNumber: 23\n    }\n  }, \"Description\"), __jsx(NavDropdown.Item, {\n    onClick: () => {\n      setSelect(\"SKU\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1685,\n      columnNumber: 23\n    }\n  }, \"SKU\"))), __jsx(\"div\", {\n    className: styles.footerActions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1695,\n      columnNumber: 19\n    }\n  }, __jsx(LoadingButton, {\n    type: \"secondary\",\n    name: \"Add New Item\",\n    route: \"NewSearch/AddItem/NewItem\",\n    className: styles.actionButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1696,\n      columnNumber: 21\n    }\n  }), __jsx(LoadingButton, {\n    type: \"light\",\n    name: \"Map\",\n    route: \"NewSearch/inventory/inventoryManage\",\n    className: styles.actionButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1702,\n      columnNumber: 21\n    }\n  }), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"Warehousedb/WarehouseSelect\",\n    className: styles.actionButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1708,\n      columnNumber: 21\n    }\n  }))))))), __jsx(Offcanvas, {\n    show: showFilters,\n    onHide: () => setShowFilters(false),\n    placement: \"start\",\n    className: styles.filtersDrawer,\n    scroll: true,\n    backdrop: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1721,\n      columnNumber: 9\n    }\n  }, __jsx(Offcanvas.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1729,\n      columnNumber: 11\n    }\n  }, __jsx(Offcanvas.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1730,\n      columnNumber: 13\n    }\n  }, \"Filters\")), __jsx(Offcanvas.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1732,\n      columnNumber: 11\n    }\n  }, renderFilters(\"drawer\")))));\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/mainSearch.js"],"names":["React","useEffect","useState","useRef","useCallback","InputGroup","Dropdown","FormControl","Button","NavDropdown","Form","Modal","Pagination","Offcanvas","Link","useRouter","fetchPartsWithMachineDataPage","fetchClients","fetchModels","useAuth","LoggedIn","ClientTable","ModelTable","PartTable","styles","firebase","buildNameTokens","SOCAL_CLIENT_ID","NORCAL_CLIENT_ID","UNASSIGNED_CLIENT_ID","DEFAULT_PAGE_SIZE","MAP_REGION_ORDER","simulateNetworkRequest","Promise","resolve","setTimeout","LoadingButton","type","name","route","className","isLoading","setLoading","cancelled","then","toTime","value","seconds","Date","t","getTime","isNaN","iso","parse","parts","split","length","mm","dd","yyyy","alt","toYMD","d","getFullYear","String","getMonth","padStart","getDate","normalizeText","toLowerCase","trim","getMachineField","item","key","lower","machineData","currentMachineData","theMachineData","TheMachine","MainSearch","signOut","info","setInfo","backupInfo","setBackupInfo","augmentedInfo","setAugmentedInfo","setIsLoading","ids","setID","show","setShow","showFilters","setShowFilters","pageSize","setPageSize","isNavigating","setIsNavigating","dItem","setDItem","select","setSelect","showList","setShowList","showListSearch","setShowListSearch","search","setSearch","selectedOEM","setSelectedOEM","selectedModality","setSelectedModality","selectedClientFrom","setSelectedClientFrom","clientFromButtonText","setClientFromButtonText","selectedClientCurrent","setSelectedClientCurrent","clientCurrentButtonText","setClientCurrentButtonText","clients","setClients","showClientModal","setShowClientModal","clientSelectionType","setClientSelectionType","showMap","setShowMap","mapRegionOptions","setMapRegionOptions","mapSectionMap","setMapSectionMap","mapStep","setMapStep","mapRegion","setMapRegion","mapRow","setMapRow","mapCol","setMapCol","mapPallet","setMapPallet","mapCellPallets","setMapCellPallets","mapPalletBins","setMapPalletBins","mapLoading","setMapLoading","mapError","setMapError","mapDirectoryLoaded","setMapDirectoryLoaded","router","labelBase","labelBaseNames","sortCheckBase","withSortIcon","baseLabels","activeIndex","isDesc","map","text","i","arrow","labels","setLabels","sortCheck","setSortCheck","hoverIndex","setHoverIndex","selectedModel","setSelectedModel","gPos","setGPos","gIde","setGIde","isDeleting","setIsDeleting","page","setPage","pageCursors","setPageCursors","hasNextPage","setHasNextPage","fetchSeq","backfillInFlight","queryEpoch","setQueryEpoch","loadError","setLoadError","tableBodyRef","rowHeightRef","headerHeightRef","LOAD_TIMEOUT_MS","mapLetters","useMemo","Array","from","_","fromCharCode","mapNumbers","loadMapDirectory","doc","firestore","collection","get","data","Region","Section","error","console","getMapRegionDimensions","regionId","entry","isArray","cols","parseInt","rows","Number","isFinite","loadMapInventory","snap","where","cellPallets","palletBins","forEach","loc","newLocalCurrent","row","section","letter","col","number","trimmed","slice","undefined","pallet","bin","cellKey","Set","add","palletKey","cellObj","Object","keys","sort","a","b","palletObj","openMap","handleMapSelectRegion","handleMapSelectCell","rowLetter","colNumber","handleMapSelectPallet","palletId","handleMapBack","handleMapView","overrides","params","URLSearchParams","regionValue","region","letterValue","sectionLetter","numberValue","sectionNumber","palletValue","binValue","set","query","toString","push","startNameTokenBackfill","reason","current","lastRun","window","localStorage","getItem","now","db","lastDoc","tokensEqual","setA","setB","size","v","has","orderBy","FieldPath","documentId","limit","startAfter","empty","batch","writes","docs","nameLower","nameTokens","existingTokens","needsUpdate","update","ref","commit","setItem","searchLower","hasActiveFilters","Boolean","valueMatches","s","some","includes","matchesFilters","visible","OEM","Modality","Model","clientFromId","clientCurrentId","wantedDay","itemYMD","date","descriptions","workOrders","w","wo","workOrder","pn","sn","desc","description","id","localSN","local_sn","resetPagination","asPath","fetchData","events","handleDone","on","off","requestedPage","seq","timedOut","timeoutId","code","message","Math","round","inputText","selectedType","startAfterDoc","clearTimeout","effectiveSelect","effectiveSearch","effectiveSearchLower","load","attempt","visibleOnly","filterFn","raw","needsMachineData","e","r","pow","nextPage","hasNameSearch","prev","next","setSelectedItems","augmented","ClientFrom","ClientCurrent","filter","err","searchChangeHandler","event","target","base","sortCheckAll","pos","nextSortCheck","sortedInfo","ta","tb","av","bv","localeCompare","an","bn","rowSelect","log","selectedItems","showDeleteModal","setShowDeleteModal","handleSelectItem","x","handleShowDeleteModal","handleCloseDeleteModal","handleDeleteSelected","itemId","delete","deleteFromStorage","handleClose","handleShow","checkDelete","idsToDelete","preventDefault","stopPropagation","hoverStyle","index","backgroundColor","textAlign","cursor","dropdown1Text","setDropdown1Text","dropdown2Text","setDropdown2Text","handleSelect1","eventKey","textContent","handleSelect2","buildClientsFromItems","filtered","it","out","idArray","chunk","handleClientClick","safeClients","clientsData","derived","setClientSearchTerm","handleClientSelect","clientId","clientSnap","exists","clientData","handleClientInfo","clientName","handleClearClientSelection","models","setModels","showModelModal","setShowModelModal","modelButtonText","setModelButtonText","handleModelClick","modelsData","setModelSearchTerm","handleModelSelect","modelName","handleClearModelSelection","handleSoCalWarehouseClick","handleNorCalWarehouseClick","handleWarehouseUnassignedClick","clientSearchTerm","modelSearchTerm","storageRef","storage","folderRef","child","listResult","listAll","deletePromises","items","all","deleteFromPartsCollection","totalKnownPages","max","pageButtons","buttons","maxVisible","pushPage","p","pushEllipsis","start","end","min","desiredWindow","currentWindow","remaining","recalcPageSize","containerHeight","getBoundingClientRect","height","headerRow","querySelector","bodyRow","h","verticalPadding","available","estimated","floor","clamped","onResize","addEventListener","removeEventListener","renderFilters","idPrefix","filtersPanel","filtersHeader","filtersTitle","filtersSubtitle","filtersBadge","filterSection","filterSectionTitle","inputGroup","inputButton","buttonGroup","flexButton","loadingOverlay","loadingLogo","client","model","pageInner","header","headerLeft","burger","brand","brandLogo","brandName","brandSub","headerRight","headerStatus","content","sidebar","main","tableCard","tableHeader","tableTitle","tableSubtitle","tableMeta","tableBody","loadingState","loadingText","errorState","errorTitle","errorMessage","tableFooter","paginationRow","searchRow","searchInput","searchSelect","footerActions","actionButton","filtersDrawer"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport {\n  InputGroup,\n  Dropdown,\n  FormControl,\n  Button,\n  NavDropdown,\n  Form,\n  Modal,\n  Pagination,\n  Offcanvas,\n} from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport {\n  fetchPartsWithMachineDataPage,\n  fetchClients,\n  fetchModels,\n} from \"../../utils/fetchAssociations\";\nimport { useAuth } from \"../../context/AuthUserContext\";\r\nimport LoggedIn from \"../LoggedIn\";\r\nimport ClientTable from \"../../utils/ClientTable\";\r\nimport ModelTable from \"../../utils/ModelTable\";\r\nimport PartTable from \"../../utils/PartTable\";\nimport styles from \"../../styles/MainSearch.module.css\";\nimport firebase from \"../../context/Firebase\";\nimport { buildNameTokens } from \"../../utils/itemFormShared\";\n\r\n// Predefined warehouse client IDs and display names\r\nconst SOCAL_CLIENT_ID = \"AIS17182\";\r\nconst NORCAL_CLIENT_ID = \"AIS25097\";\nconst UNASSIGNED_CLIENT_ID = \"AIS00404\";\nconst DEFAULT_PAGE_SIZE = 25;\nconst MAP_REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\n\r\n\r\n// Simulates a network request delay\r\nfunction simulateNetworkRequest() {\r\n  return new Promise((resolve) => setTimeout(resolve, 2000));\r\n}\r\n\r\n// Custom LoadingButton component\r\nfunction LoadingButton({ type, name, route, className }) {\n  const [isLoading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (isLoading) {\n      let cancelled = false;\n      simulateNetworkRequest().then(() => {\n        if (!cancelled) setLoading(false);\n      });\n      return () => {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\r\n  return (\n    <Link href={`/${route}`}>\n      <a\n        className={`btn btn-${type} ${className || \"\"}`}\n        disabled={isLoading}\n        onClick={() => !isLoading && setLoading(true)}\n      >\n        {isLoading ? \"Loading…\" : name}\r\n      </a>\r\n    </Link>\r\n  );\r\n}\r\n\r\n// ---- DATE HELPERS (top-level scope) ----\r\n\r\n// Convert anything date-ish into a timestamp (ms since epoch).\r\nfunction toTime(value) {\r\n  if (!value) return null;\r\n\r\n  // Firestore Timestamp { seconds, nanoseconds }\r\n  if (typeof value === \"object\" && value !== null && value.seconds != null) {\r\n    try { return value.seconds * 1000; } catch { /* ignore */ }\r\n  }\r\n\r\n  // Native Date\r\n  if (value instanceof Date) {\r\n    const t = value.getTime();\r\n    return isNaN(t) ? null : t;\r\n  }\r\n\r\n  // Strings\r\n  if (typeof value === \"string\") {\r\n    // ISO / yyyy-mm-dd\r\n    const iso = Date.parse(value);\r\n    if (!isNaN(iso)) return iso;\r\n\r\n    // mm/dd/yyyy\r\n    const parts = value.split(\"/\");\r\n    if (parts.length === 3) {\r\n      const [mm, dd, yyyy] = parts;\r\n      const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\r\n      if (!isNaN(alt)) return alt;\r\n    }\r\n  }\r\n\r\n  // Last resort\r\n  const t = Date.parse(value);\r\n  return isNaN(t) ? null : t;\r\n}\r\n\r\n// Canonicalize to 'yyyy-mm-dd' (matches <input type=\"date\">)\r\nfunction toYMD(value) {\n  const t = toTime(value);\n  if (t == null) return null;\n  const d = new Date(t);\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nfunction normalizeText(value) {\n  if (value == null) return \"\";\n  return String(value).toLowerCase().trim();\n}\n\nfunction getMachineField(item, key) {\n  if (!item) return null;\n  const lower = key.toLowerCase();\n  return (\n    item?.machineData?.[key] ??\n    item?.machineData?.[lower] ??\n    item?.currentMachineData?.[key] ??\n    item?.currentMachineData?.[lower] ??\n    item?.theMachineData?.[key] ??\n    item?.theMachineData?.[lower] ??\n    item?.TheMachine?.[key] ??\n    item?.TheMachine?.[lower] ??\n    null\n  );\n}\n\n\nexport default function MainSearch() {\n  const { signOut } = useAuth();\r\n  const [info, setInfo] = useState([]);\r\n  const [backupInfo, setBackupInfo] = useState([]);\r\n  const [augmentedInfo, setAugmentedInfo] = useState([]); // items with clientFromId/currentId added\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [ids, setID] = useState([]);\n  const [show, setShow] = useState(false);\n  const [showFilters, setShowFilters] = useState(false);\n  const [pageSize, setPageSize] = useState(DEFAULT_PAGE_SIZE);\n  const [isNavigating, setIsNavigating] = useState(false);\n  const [dItem, setDItem] = useState();\r\n  const [select, setSelect] = useState(\"Name\");\r\n  const [showList, setShowList] = useState(false);\r\n  const [showListSearch, setShowListSearch] = useState(\"text\");\r\n  const [search, setSearch] = useState(\"\");\r\n  const [selectedOEM, setSelectedOEM] = useState(null);\r\n  const [selectedModality, setSelectedModality] = useState(null);\r\n  // Replace the old single client state with two sets:\r\n  const [selectedClientFrom, setSelectedClientFrom] = useState(null);\r\n  const [clientFromButtonText, setClientFromButtonText] = useState(\"Select Option\");\r\n  const [selectedClientCurrent, setSelectedClientCurrent] = useState(null);\r\n  const [clientCurrentButtonText, setClientCurrentButtonText] = useState(\"Select Option\");\r\n\r\n  const [clients, setClients] = useState([]);\n  const [showClientModal, setShowClientModal] = useState(false);\n  // This state tells the modal which client box is being updated: \"from\" or \"current\"\n  const [clientSelectionType, setClientSelectionType] = useState(null);\n  const [showMap, setShowMap] = useState(false);\n  const [mapRegionOptions, setMapRegionOptions] = useState([]);\n  const [mapSectionMap, setMapSectionMap] = useState({});\n  const [mapStep, setMapStep] = useState(\"regions\");\n  const [mapRegion, setMapRegion] = useState(\"\");\n  const [mapRow, setMapRow] = useState(\"\");\n  const [mapCol, setMapCol] = useState(\"\");\n  const [mapPallet, setMapPallet] = useState(\"\");\n  const [mapCellPallets, setMapCellPallets] = useState({});\n  const [mapPalletBins, setMapPalletBins] = useState({});\n  const [mapLoading, setMapLoading] = useState(false);\n  const [mapError, setMapError] = useState(\"\");\n  const [mapDirectoryLoaded, setMapDirectoryLoaded] = useState(false);\n\r\n  const router = useRouter();\r\n  const labelBase = [\"name\", \"date\", \"w/o\", \"p/n\", \"s/n\"];\r\n  const labelBaseNames = [\"name\", \"date\", \"wo\", \"pn\", \"sn\"];\r\n  const sortCheckBase = [false, false, false, false, false, false];\r\n\r\n  function withSortIcon(baseLabels, activeIndex, isDesc) {\r\n    return baseLabels.map((text, i) => {\r\n      if (i !== activeIndex) return text; // untouched\r\n      const arrow = isDesc ? \" ▼\" : \" ▲\";\r\n      return `${text}${arrow}`;\r\n    });\r\n  }\r\n\r\n\r\n  const [labels, setLabels] = useState(labelBase);\r\n  const [sortCheck, setSortCheck] = useState(sortCheckBase);\r\n  const [hoverIndex, setHoverIndex] = useState(null);\r\n  const [selectedModel, setSelectedModel] = useState(null);\r\n  const [gPos, setGPos] = useState(null);\n  const [gIde, setGIde] = useState(null);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [page, setPage] = useState(1);\n  const [pageCursors, setPageCursors] = useState([]);\n  const [hasNextPage, setHasNextPage] = useState(false);\n  const fetchSeq = useRef(0);\n  const backfillInFlight = useRef(false);\n  const [queryEpoch, setQueryEpoch] = useState(0);\n  const [loadError, setLoadError] = useState(null);\n  const tableBodyRef = useRef(null);\n  const rowHeightRef = useRef(46);\n  const headerHeightRef = useRef(38);\n\n  const LOAD_TIMEOUT_MS = 30000;\n  const mapLetters = useMemo(\n    () => Array.from({ length: 26 }, (_, i) => String.fromCharCode(65 + i)),\n    []\n  );\n  const mapNumbers = useMemo(\n    () => Array.from({ length: 50 }, (_, i) => i + 1),\n    []\n  );\n\n  const loadMapDirectory = useCallback(async () => {\n    if (mapDirectoryLoaded) return;\n    try {\n      const doc = await firebase\n        .firestore()\n        .collection(\"Warehouse\")\n        .doc(\"directory\")\n        .get();\n      const data = doc.data() || {};\n      setMapRegionOptions(data.Region || []);\n      setMapSectionMap(data.Section || {});\n      setMapDirectoryLoaded(true);\n    } catch (error) {\n      console.error(\"Failed to load map directory\", error);\n      setMapError(\"Failed to load warehouse directory.\");\n    }\n  }, [mapDirectoryLoaded]);\n\n  const getMapRegionDimensions = useCallback(\n    (regionId) => {\n      const entry = mapSectionMap?.[regionId];\n      if (Array.isArray(entry) && entry.length >= 2) {\n        const cols = parseInt(entry[0], 10);\n        const rows = parseInt(entry[1], 10);\n        return {\n          cols: Number.isFinite(cols) ? cols : 0,\n          rows: Number.isFinite(rows) ? rows : 0,\n        };\n      }\n      return { cols: 0, rows: 0 };\n    },\n    [mapSectionMap]\n  );\n\n  const loadMapInventory = useCallback(async (regionId) => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n    try {\n      const snap = await firebase\n        .firestore()\n        .collection(\"Test\")\n        .where(\"newLocalCurrent.region\", \"==\", regionId)\n        .get();\n\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach((doc) => {\n        const loc = doc.data()?.newLocalCurrent || {};\n        let row = loc.section?.letter;\n        let col = loc.section?.number;\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n        if (pallet !== undefined && pallet !== null && `${pallet}` !== \"\") {\n          if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n          cellPallets[cellKey].add(String(pallet));\n          if (bin !== undefined && bin !== null && `${bin}` !== \"\") {\n            const palletKey = `${cellKey}-P${pallet}`;\n            if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n            palletBins[palletKey].add(String(bin));\n          }\n        }\n      });\n\n      const cellObj = {};\n      Object.keys(cellPallets).forEach((key) => {\n        cellObj[key] = Array.from(cellPallets[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      const palletObj = {};\n      Object.keys(palletBins).forEach((key) => {\n        palletObj[key] = Array.from(palletBins[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  }, []);\n\n  const openMap = async () => {\n    setMapError(\"\");\n    await loadMapDirectory();\n    if (mapRegion) {\n      setMapStep(\"grid\");\n      loadMapInventory(mapRegion);\n    } else {\n      setMapStep(\"regions\");\n    }\n    setShowMap(true);\n  };\n\n  const handleMapSelectRegion = (regionId) => {\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapStep(\"grid\");\n    loadMapInventory(regionId);\n  };\n\n  const handleMapSelectCell = (rowLetter, colNumber) => {\n    setMapRow(rowLetter);\n    setMapCol(colNumber);\n    setMapPallet(\"\");\n    setMapStep(\"pallets\");\n  };\n\n  const handleMapSelectPallet = (palletId) => {\n    setMapPallet(palletId);\n    setMapStep(\"bins\");\n  };\n\n  const handleMapBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");\n    else if (mapStep === \"pallets\") setMapStep(\"grid\");\n    else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleMapView = (overrides = {}) => {\n    const params = new URLSearchParams();\n    const regionValue = overrides.region ?? mapRegion;\n    const letterValue = overrides.sectionLetter ?? mapRow;\n    const numberValue = overrides.sectionNumber ?? mapCol;\n    const palletValue = overrides.pallet ?? mapPallet;\n    const binValue = overrides.bin ?? \"\";\n\n    if (regionValue) params.set(\"region\", regionValue);\n    if (letterValue) params.set(\"sectionLetter\", letterValue);\n    if (numberValue) params.set(\"sectionNumber\", numberValue);\n    if (palletValue) params.set(\"pallet\", palletValue);\n    if (binValue) params.set(\"bin\", binValue);\n\n    const query = params.toString();\n    router.push(\n      `/NewSearch/inventory/inventoryManage${query ? `?${query}` : \"\"}`\n    );\n  };\n\n  const startNameTokenBackfill = useCallback(async (reason = \"\") => {\n    if (backfillInFlight.current) return;\n    if (typeof window !== \"undefined\") {\n      const lastRun = window.localStorage.getItem(\"nameTokensBackfillAt\");\n      if (lastRun && Date.now() - Number(lastRun) < 24 * 60 * 60 * 1000) {\n        return;\n      }\n    }\n\n    backfillInFlight.current = true;\n    const db = firebase.firestore();\n    let lastDoc = null;\n\n    const tokensEqual = (a, b) => {\n      if (a.length !== b.length) return false;\n      const setA = new Set(a);\n      const setB = new Set(b);\n      if (setA.size !== setB.size) return false;\n      for (const v of setA) if (!setB.has(v)) return false;\n      return true;\n    };\n\n    try {\n      while (true) {\n        let query = db\n          .collection(\"Test\")\n          .orderBy(firebase.firestore.FieldPath.documentId())\n          .limit(200);\n        if (lastDoc) query = query.startAfter(lastDoc);\n\n        const snap = await query.get();\n        if (snap.empty) break;\n\n        const batch = db.batch();\n        let writes = 0;\n\n        snap.docs.forEach((doc) => {\n          const data = doc.data() || {};\n          const name = typeof data.name === \"string\" ? data.name : \"\";\n          const nameLower = name.toLowerCase();\n          const nameTokens = buildNameTokens(name);\n          const existingTokens = Array.isArray(data.nameTokens)\n            ? Array.from(new Set(data.nameTokens.map((v) => String(v))))\n            : [];\n\n          const needsUpdate =\n            data.nameLower !== nameLower ||\n            !tokensEqual(existingTokens, nameTokens);\n\n          if (needsUpdate) {\n            batch.update(doc.ref, { nameLower, nameTokens });\n            writes += 1;\n          }\n        });\n\n        if (writes > 0) {\n          await batch.commit();\n        }\n\n        lastDoc = snap.docs[snap.docs.length - 1];\n        await new Promise((resolve) => setTimeout(resolve, 25));\n      }\n\n      if (typeof window !== \"undefined\") {\n        window.localStorage.setItem(\n          \"nameTokensBackfillAt\",\n          String(Date.now())\n        );\n      }\n    } catch (error) {\n      console.error(\"Name token backfill failed:\", reason, error);\n    } finally {\n      backfillInFlight.current = false;\n    }\n  }, []);\n\n  const searchLower = (search || \"\").toLowerCase().trim();\n  const hasActiveFilters =\n    Boolean(selectedOEM) ||\n    Boolean(selectedModality) ||\n    Boolean(selectedModel) ||\n    Boolean(selectedClientFrom) ||\n    Boolean(selectedClientCurrent) ||\n    Boolean(searchLower);\n\n  const valueMatches = (value, s) => {\n    if (!value) return false;\n    if (Array.isArray(value)) {\n      return value.some((v) => valueMatches(v, s));\n    }\n    return String(value).toLowerCase().includes(s);\n  };\n\n  const matchesFilters = useCallback(\n    (item) => {\n      // hide explicitly hidden items\n      if (item?.visible === false) return false;\n\n      // OEM / Modality / Model filtering\n      const OEM = getMachineField(item, \"OEM\");\n      const Modality = getMachineField(item, \"Modality\");\n      const Model = getMachineField(item, \"Model\");\n\n      if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n        return false;\n      }\n      if (\n        selectedModality &&\n        normalizeText(Modality) !== normalizeText(selectedModality)\n      ) {\n        return false;\n      }\n      if (selectedModel && normalizeText(Model) !== normalizeText(selectedModel)) {\n        return false;\n      }\n\n      // Client filters\n      if (selectedClientFrom && item?.clientFromId !== selectedClientFrom) {\n        return false;\n      }\n      if (\n        selectedClientCurrent &&\n        item?.clientCurrentId !== selectedClientCurrent\n      ) {\n        return false;\n      }\n\n      // Search\n      if (searchLower) {\n        if (select === \"Name\") {\n          return valueMatches(item?.name, searchLower);\n        }\n        if (select === \"Date\") {\n          const wantedDay = searchLower; // yyyy-mm-dd from input\n          const itemYMD = toYMD(item?.date);\n          if (itemYMD && itemYMD === wantedDay) return true;\n          if (Array.isArray(item?.descriptions)) {\n            if (item.descriptions.some((d) => toYMD(d?.date) === wantedDay)) {\n              return true;\n            }\n          }\n          if (Array.isArray(item?.workOrders)) {\n            if (item.workOrders.some((w) => toYMD(w?.date) === wantedDay)) {\n              return true;\n            }\n          }\n          return false;\n        }\n        if (select === \"Work Order\") {\n          return (\n            Array.isArray(item?.workOrders) &&\n            item.workOrders.some((wo) =>\n              valueMatches(wo?.workOrder, searchLower)\n            )\n          );\n        }\n        if (select === \"Product Number\") {\n          return valueMatches(item?.pn, searchLower);\n        }\n        if (select === \"Serial Number\") {\n          return valueMatches(item?.sn, searchLower);\n        }\n        if (select === \"Description\") {\n          if (valueMatches(item?.desc, searchLower)) return true;\n          if (valueMatches(item?.description, searchLower)) return true;\n          if (Array.isArray(item?.descriptions)) {\n            return item.descriptions.some((d) =>\n              valueMatches(d?.description, searchLower)\n            );\n          }\n          return false;\n        }\n        if (select === \"SKU\") {\n          return (\n            valueMatches(item?.id, searchLower) ||\n            valueMatches(item?.localSN, searchLower) ||\n            valueMatches(item?.local_sn, searchLower)\n          );\n        }\n      }\n\n      return true;\n    },\n    [\n      selectedOEM,\n      selectedModality,\n      selectedModel,\n      selectedClientFrom,\n      selectedClientCurrent,\n      searchLower,\n      select,\n    ]\n  );\n\n  const resetPagination = () => {\n    setPage(1);\n    setPageCursors([]);\n    setHasNextPage(false);\n  };\n\n  // Reset pagination on route/query change (prevents stale pages like “starting at 6”)\n  useEffect(() => {\n    resetPagination();\n    setQueryEpoch((v) => v + 1);\n  }, [router.asPath]);\n\n  // Reset and refetch when filters/search change\n  useEffect(() => {\n    resetPagination();\n    setQueryEpoch((v) => v + 1);\n  }, [\n    selectedOEM,\n    selectedModality,\n    selectedModel,\n    selectedClientFrom,\n    selectedClientCurrent,\n    search,\n    select,\n  ]);\n\n\n  // Fetch data on component mount and route change\n  useEffect(() => {\n    fetchData(page);\n  }, [page, queryEpoch]);\n\n  useEffect(() => {\n    if (!router?.events) return;\n    const handleDone = () => setIsNavigating(false);\n    router.events.on(\"routeChangeComplete\", handleDone);\n    router.events.on(\"routeChangeError\", handleDone);\n    return () => {\n      router.events.off(\"routeChangeComplete\", handleDone);\n      router.events.off(\"routeChangeError\", handleDone);\n    };\n  }, [router]);\n\n  async function fetchData(requestedPage = 1) {\n    const seq = ++fetchSeq.current;\n    let timedOut = false;\n    setIsLoading(true);\n    setLoadError(null);\n    const timeoutId = setTimeout(() => {\n      timedOut = true;\n      if (seq === fetchSeq.current) {\n        setLoadError({\n          code: \"timeout\",\n          message: `Loading is taking longer than ${Math.round(\n            LOAD_TIMEOUT_MS / 1000\n          )}s. This is likely due to very selective filters.`,\n        });\n        setIsLoading(false);\n      }\n    }, LOAD_TIMEOUT_MS);\n    try {\n      if (router.query.inputText && router.query.selectedType) {\n        setSelect(router.query.selectedType);\n        setSearch(router.query.inputText);\n      }\n      const startAfterDoc =\n        requestedPage > 1 ? pageCursors[requestedPage - 2] : null;\n      if (requestedPage > 1 && !startAfterDoc) {\n        setPage(1);\n        if (seq === fetchSeq.current) {\n          clearTimeout(timeoutId);\n          setIsLoading(false);\n        }\n        return;\n      }\n      const effectiveSelect = router.query.selectedType || select;\n      const effectiveSearch = router.query.inputText || search;\n      const effectiveSearchLower = (effectiveSearch || \"\")\n        .toLowerCase()\n        .trim();\n\n      // light retry for transient Firestore hiccups\n      const load = async (attempt = 1) => {\n        try {\n          return await fetchPartsWithMachineDataPage({\n            pageSize,\n            startAfterDoc,\n            visibleOnly: true,\n            filterFn: hasActiveFilters ? matchesFilters : null,\n            search: effectiveSearchLower\n              ? {\n                  type: effectiveSelect,\n                  raw: effectiveSearch,\n                  lower: effectiveSearchLower,\n                }\n              : null,\n            needsMachineData:\n              Boolean(selectedOEM) ||\n              Boolean(selectedModality) ||\n              Boolean(selectedModel) ||\n              Boolean(selectedClientFrom) ||\n              Boolean(selectedClientCurrent),\n          });\n        } catch (e) {\n          if (attempt >= 3) throw e;\n          await new Promise(r => setTimeout(r, 250 * Math.pow(2, attempt - 1)));\n          return load(attempt + 1);\n        }\n      };\n      const { parts: data, lastDoc, hasNextPage: nextPage } = await load();\n      if (timedOut || seq !== fetchSeq.current) return;\n      const hasNameSearch =\n        Boolean(effectiveSearchLower) && effectiveSelect === \"Name\";\n      if (\n        hasNameSearch &&\n        (data.length === 0 ||\n          data.some(\n            (item) =>\n              !Array.isArray(item?.nameTokens) || item.nameTokens.length === 0\n          ))\n      ) {\n        startNameTokenBackfill(\"name-search\");\n      }\n      if (requestedPage === 1 && data.length === 0) {\n        setPageCursors([]);\n        setHasNextPage(false);\n      }\n      setBackupInfo(data);\n      setLabels(labelBase); // <-- add this line after setBackupInfo(data)\n      setID(data.map((item) => item.id));\n      if (requestedPage > 1 && data.length === 0) {\n        setHasNextPage(false);\n        setPage(1);\n        return;\n      }\n      setHasNextPage(nextPage);\n      setPageCursors((prev) => {\n        const next = requestedPage === 1 ? [] : [...prev];\n        if (lastDoc) {\n          next[requestedPage - 1] = lastDoc;\n        }\n        return next;\n      });\n      setSelectedItems([]);\n\n      // Normalize client ids for filtering\n      const augmented = data.map((item) => ({\n        ...item,\n        clientFromId:\n          item?.clientFromId ??\n          (typeof item?.ClientFrom === \"string\" ? item.ClientFrom : null) ??\n          item?.ClientFrom?.id ??\n          null,\n        clientCurrentId:\n          item?.clientCurrentId ??\n          (typeof item?.ClientCurrent === \"string\" ? item.ClientCurrent : null) ??\n          item?.ClientCurrent?.id ??\n          null,\n      }));\n\r\n      setAugmentedInfo(augmented);\n      // default view = filtered (keeps pagination and filters consistent)\n      setInfo(augmented.filter(matchesFilters));\n    } catch (err) {\n      if (seq !== fetchSeq.current) return;\n      console.error(\"Error fetching data:\", err);\n      const code = err?.code || \"unknown\";\n      setLoadError({\n        code,\n        message: err?.message || \"Failed to load items.\",\n      });\n      setInfo([]);\n      setAugmentedInfo([]);\n    } finally {\n      clearTimeout(timeoutId);\n      if (seq === fetchSeq.current && !timedOut) setIsLoading(false);\n    }\n  }\n\r\n  const searchChangeHandler = (event) => setSearch(event.target.value);\r\n\r\n  // Filter the currently loaded items (now consistent with paged filtering)\n  useEffect(() => {\n    const base = augmentedInfo || [];\n    setInfo(base.filter(matchesFilters));\n  }, [augmentedInfo, matchesFilters]);\n\r\n  function sortCheckAll(pos) {\r\n    // Determine next direction: toggle the clicked column only\r\n    const nextSortCheck = sortCheck.map((v, i) => (i === pos ? !v : v));\r\n    const isDesc = nextSortCheck[pos]; // true means descending\r\n\r\n    const sortedInfo = [...info].sort((a, b) => {\r\n      const key = labelBaseNames[pos];\r\n\r\n      if (pos === 1) {\r\n        // DATE column\r\n        const ta = toTime(a[key]);\r\n        const tb = toTime(b[key]);\r\n\r\n        // Put missing dates at the end for ascending, at the start for descending\r\n        if (ta === null && tb === null) return 0;\r\n        if (ta === null) return isDesc ? -1 : 1;\r\n        if (tb === null) return isDesc ? 1 : -1;\r\n\r\n        return isDesc ? (tb - ta) : (ta - tb);\r\n      }\r\n\r\n      // NAME or SKU (string-y columns): indexes 0 or 5 in your original logic\r\n      if (pos === 0 || pos === 5) {\r\n        const av = (a[key] ?? \"\").toString();\r\n        const bv = (b[key] ?? \"\").toString();\r\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\r\n      }\r\n\r\n      // Numeric-ish columns (wo, pn, sn) — fall back to string compare if NaN\r\n      const an = Number(a[key]);\r\n      const bn = Number(b[key]);\r\n\r\n      if (!isNaN(an) && !isNaN(bn)) {\r\n        return isDesc ? (bn - an) : (an - bn);\r\n      } else {\r\n        const av = (a[key] ?? \"\").toString();\r\n        const bv = (b[key] ?? \"\").toString();\r\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\r\n      }\r\n    });\r\n\r\n    setInfo(sortedInfo);\r\n    setSortCheck(nextSortCheck);\r\n\r\n    // Update header labels to show the little arrow on the active column\r\n    setLabels(withSortIcon(labelBase, pos, isDesc));\r\n  }\r\n\r\n\r\n  const rowSelect = (item) => {\r\n    if (item && item.id) {\r\n      console.log(\"Selected item:\", item);\n      setIsNavigating(true);\n      router.push(\"./item/\" + item.id);\n    } else {\r\n      console.error(\"Unable to determine the selected item’s ID: \", item);\r\n    }\r\n  };\r\n\r\n  const [selectedItems, setSelectedItems] = useState([]);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n\r\n  const handleSelectItem = (id) => {\r\n    setSelectedItems(prev =>\r\n      prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]\r\n    );\r\n  };\r\n\r\n\r\n  // setSelectedItems((prev) => {\r\n  //   const newSelection = prev.includes(id)\r\n  //     ? prev.filter((itemId) => itemId !== id)\r\n  //     : [...prev, id];\r\n  //   console.log(\"Selected items:\", newSelection);\r\n  //   return newSelection; // <- important\r\n  // });\r\n\r\n  const handleShowDeleteModal = () => setShowDeleteModal(true);\r\n  const handleCloseDeleteModal = () => setShowDeleteModal(false);\r\n\r\n  const handleDeleteSelected = async () => {\r\n    setIsDeleting(true);\r\n    const db = firebase.firestore();\r\n    try {\r\n      // Loop over each selected item one at a time\r\n      for (const itemId of selectedItems) {\r\n        console.log(itemId)\r\n        try {\r\n          // Delete from \"Test\" collection\r\n          await db.collection(\"Test\").doc(itemId).delete();\r\n        } catch (err) {\r\n          console.error(`Error deleting document ${itemId} from Test:`, err);\r\n        }\r\n        try {\r\n          // Delete from \"Parts\" collection\r\n          await db.collection(\"Parts\").doc(itemId).delete();\r\n        } catch (err) {\r\n          console.error(`Error deleting document ${itemId} from Parts:`, err);\r\n        }\r\n        try {\r\n          // Delete associated photos from storage\r\n          await deleteFromStorage(itemId);\r\n        } catch (err) {\r\n          console.error(`Error deleting storage for ${itemId}:`, err);\r\n        }\r\n      }\r\n      // Update local state by filtering out the deleted items\r\n      setInfo(info.filter((item) => !selectedItems.includes(item.id)));\r\n      setSelectedItems([]);\r\n    } catch (error) {\r\n      console.error(\"Error deleting items:\", error);\r\n    } finally {\r\n      setIsDeleting(false);\r\n      handleCloseDeleteModal();\r\n      // Optionally, reload the page\r\n      // router.reload();\r\n    }\r\n  };\r\n\r\n\r\n  const handleClose = () => setShow(false);\r\n  const handleShow = () => setShow(true);\r\n\r\n  const checkDelete = (event, pos, idsToDelete, name) => {\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n    console.log(\"Selected IDs to delete:\", idsToDelete);\r\n    setSelectedItems(idsToDelete);\r\n    setDItem(name);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  // const handleDelete = async () => {\r\n  //   let itemId = gIde;\r\n  //   try {\r\n  //     setIsDeleting(true);\r\n  //     const db = firebase.firestore();\r\n  //     await db.collection(\"Test\").doc(itemId).delete();\r\n  //     await deleteFromPartsCollection(itemId);\r\n  //     await deleteFromStorage(itemId);\r\n  //     setInfo(info.filter((_, i) => gPos !== i));\r\n  //     console.log(`Deleted item: ${itemId}`);\r\n  //   } catch (error) {\r\n  //     console.error(\"Error deleting item:\", error);\r\n  //   } finally {\r\n  //     setIsDeleting(false);\r\n  //   }\r\n  //   handleClose();\r\n  // };\r\n\r\n  const hoverStyle = (index) => ({\r\n    backgroundColor: hoverIndex === index ? \"#ddd\" : \"transparent\",\r\n    textAlign: \"center\",\r\n    cursor: \"default\",\r\n  });\r\n\r\n  const [dropdown1Text, setDropdown1Text] = useState(\"Select Option\");\r\n  const [dropdown2Text, setDropdown2Text] = useState(\"Select Option\");\r\n\r\n  const handleSelect1 = (eventKey, event) => {\r\n    if (eventKey === \"unassigned\") {\r\n      setDropdown1Text(\"Select Option\");\r\n      setSelectedOEM(null);\r\n    } else {\r\n      setDropdown1Text(event.target.textContent);\r\n      setSelectedOEM(event.target.textContent);\r\n    }\r\n  };\r\n\r\n  const handleSelect2 = (eventKey, event) => {\r\n    if (eventKey === \"unassigned\") {\r\n      setDropdown2Text(\"Select Option\");\r\n      setSelectedModality(null);\r\n    } else {\r\n      setDropdown2Text(event.target.textContent);\r\n      setSelectedModality(event.target.textContent);\r\n    }\r\n  };\r\n\r\n  // Build a unique list of clients from the items currently loaded, filtered by OEM/Modality.\r\n  // `type` is \"from\" or \"current\" to decide which client ref to read.\r\n  async function buildClientsFromItems(type) {\n    const db = firebase.firestore();\n    const ids = new Set();\n\n    // Respect current OEM / Modality filters when deriving client options\n    const filtered = augmentedInfo.filter((item) => {\n      const OEM = getMachineField(item, \"OEM\");\n      const Modality = getMachineField(item, \"Modality\");\n      if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n        return false;\n      }\n      if (\n        selectedModality &&\n        normalizeText(Modality) !== normalizeText(selectedModality)\n      ) {\n        return false;\n      }\n      return true;\n    });\n\r\n    for (const it of filtered) {\r\n      const id = type === \"from\" ? it.clientFromId : it.clientCurrentId;\r\n      if (id) ids.add(id);\r\n    }\r\n\r\n    const out = [];\r\n    const idArray = [...ids];\r\n    for (let i = 0; i < idArray.length; i += 10) {\r\n      const chunk = idArray.slice(i, i + 10);\r\n      const snap = await db\r\n        .collection(\"Client\")\r\n        .where(firebase.firestore.FieldPath.documentId(), \"in\", chunk)\r\n        .get();\r\n      snap.forEach((doc) => {\r\n        const d = doc.data() || {};\r\n        out.push({ id: doc.id, name: d.name || doc.id });\r\n      });\r\n    }\r\n\r\n    // sort by name for nicer UX\r\n    out.sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\"));\r\n    return out;\r\n  }\r\n\r\n\r\n  // --------------------\r\n  // CLIENT SELECTION HANDLING\r\n  // --------------------\r\n  // This function fetches clients and opens the client modal.\r\n  const handleClientClick = async () => {\r\n    let safeClients = [];\r\n    try {\r\n      const clientsData = await fetchClients(selectedOEM, selectedModality);\r\n      safeClients = Array.isArray(clientsData) ? clientsData : [];\r\n    } catch (e) {\r\n      console.error(\"fetchClients failed:\", e);\r\n    }\r\n\r\n    // Fallback to building from loaded items if API gave us nothing\r\n    if (safeClients.length === 0) {\r\n      try {\r\n        if (!clientSelectionType) {\r\n          // if somehow not set yet, default to \"from\"\r\n          setClientSelectionType(\"from\");\r\n        }\r\n        const derived = await buildClientsFromItems(clientSelectionType || \"from\");\r\n        safeClients = derived;\r\n      } catch (e) {\r\n        console.error(\"Fallback buildClientsFromItems failed:\", e);\r\n        safeClients = [];\r\n      }\r\n    }\r\n\r\n    setClients(safeClients);\r\n    setClientSearchTerm(\"\");\r\n    setShowClientModal(true);\r\n  };\r\n\r\n\r\n\r\n  // When a client is selected in the modal, we now assume the parameter is a client ID.\r\n  // If the passed value is null, we clear the selection.\r\n  const handleClientSelect = async (clientId) => {\r\n    console.log(\"User selected client id:\", clientId);\r\n    if (!clientId) {\r\n      if (clientSelectionType === \"from\") {\r\n        setClientFromButtonText(\"Select Option\");\r\n        setSelectedClientFrom(null);\r\n      } else if (clientSelectionType === \"current\") {\r\n        setClientCurrentButtonText(\"Select Option\");\r\n        setSelectedClientCurrent(null);\r\n      }\r\n      setShowClientModal(false);\r\n      return;\r\n    }\r\n    try {\r\n      const clientSnap = await firebase.firestore().collection(\"Client\").doc(clientId).get();\r\n      if (clientSnap.exists) {\r\n        const clientData = clientSnap.data();\r\n        if (clientSelectionType === \"from\") {\r\n          setClientFromButtonText(clientData.name);\r\n          setSelectedClientFrom(clientId);\r\n        } else if (clientSelectionType === \"current\") {\r\n          setClientCurrentButtonText(clientData.name);\r\n          setSelectedClientCurrent(clientId);\r\n        }\r\n      } else {\r\n        console.error(\"No client document found for id:\", clientId);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching client data:\", error);\r\n    }\r\n    setShowClientModal(false);\r\n  };\r\n\r\n  const handleClientInfo = (clientId, clientName) => {\r\n    console.log(`Client ID: ${clientId}, Client Name: ${clientName}`);\r\n    router.push(\"client/\" + clientId);\r\n  };\r\n\r\n  const handleClearClientSelection = () => {\r\n    if (clientSelectionType === \"from\") {\r\n      setClientFromButtonText(\"Select Option\");\r\n      setSelectedClientFrom(null);\r\n    } else if (clientSelectionType === \"current\") {\r\n      setClientCurrentButtonText(\"Select Option\");\r\n      setSelectedClientCurrent(null);\r\n    }\r\n    setShowClientModal(false);\r\n  };\r\n\r\n  // --------------------\r\n  // MODEL SELECTION HANDLING\r\n  // --------------------\r\n  const [models, setModels] = useState([]);\r\n  const [showModelModal, setShowModelModal] = useState(false);\r\n  const [modelButtonText, setModelButtonText] = useState(\"Select Option\");\r\n\r\n  const handleModelClick = async () => {\r\n    const modelsData = await fetchModels(\r\n      selectedOEM,\r\n      selectedModality,\r\n      selectedClientFrom\r\n    );\r\n    setModels(modelsData);\r\n    setModelSearchTerm(\"\");\r\n    setShowModelModal(true);\r\n  };\r\n\r\n  const handleModelSelect = (modelName) => {\r\n    setModelButtonText(modelName || \"Select Option\");\r\n    setSelectedModel(modelName || null);\r\n    setShowModelModal(false);\r\n  };\r\n\r\n  const handleClearModelSelection = () => {\r\n    setModelButtonText(\"Select Option\");\r\n    setSelectedModel(null);\r\n    setShowModelModal(false);\r\n  };\r\n\r\n  // --------------------\r\n  // WAREHOUSE BUTTONS (for Client Current)\r\n  // --------------------\r\n  const handleSoCalWarehouseClick = () => {\r\n    setClientCurrentButtonText(\"SoCal Warehouse\");\r\n    setSelectedClientCurrent(SOCAL_CLIENT_ID);\r\n    console.log(\"Warehouse button clicked: setting Client Current to\", SOCAL_CLIENT_ID);\r\n  };\r\n\r\n  const handleNorCalWarehouseClick = () => {\r\n    setClientCurrentButtonText(\"NorCal Warehouse\");\r\n    setSelectedClientCurrent(NORCAL_CLIENT_ID);\r\n    console.log(\"Warehouse button clicked: setting Client Current to\", NORCAL_CLIENT_ID);\r\n  };\r\n\r\n  const handleWarehouseUnassignedClick = () => {\r\n    setClientCurrentButtonText(\"Unassigned\");\r\n    setSelectedClientCurrent(UNASSIGNED_CLIENT_ID);\r\n    console.log(\"Warehouse button clicked: setting Client Current to\", UNASSIGNED_CLIENT_ID);\r\n  };\r\n\r\n  const [clientSearchTerm, setClientSearchTerm] = useState(\"\");\r\n  const [modelSearchTerm, setModelSearchTerm] = useState(\"\");\r\n\r\n  const deleteFromStorage = async (itemId) => {\r\n    const storageRef = firebase.storage().ref();\r\n    const folderRef = storageRef.child(`Parts/${itemId}/`);\r\n    try {\r\n      const listResult = await folderRef.listAll();\r\n      const deletePromises = listResult.items.map((item) => item.delete());\r\n      await Promise.all(deletePromises);\r\n    } catch (error) {\r\n      console.error(\"Error deleting from storage:\", error);\r\n    }\r\n  };\r\n\r\n  const deleteFromPartsCollection = async (itemId) => {\r\n    const db = firebase.firestore();\r\n    try {\r\n      await db.collection(\"Parts\").doc(itemId).delete();\r\n      console.log(`Deleted item from Parts collection: ${itemId}`);\r\n    } catch (error) {\r\n      console.error(\"Error deleting from Parts collection:\", error);\r\n    }\r\n  };\r\n\r\n  //   // Safely convert any date-ish value into a comparable timestamp (ms since epoch).\r\n  // function toTime(value) {\r\n  //   if (!value) return null;\r\n\r\n  //   // Firestore Timestamp: { seconds, nanoseconds }\r\n  //   if (typeof value === \"object\" && value.seconds) {\r\n  //     try {\r\n  //       return value.seconds * 1000;\r\n  //     } catch { /* fallthrough */ }\r\n  //   }\r\n\r\n  //   // If already a Date\r\n  //   if (value instanceof Date) return isNaN(value.getTime()) ? null : value.getTime();\r\n\r\n  //   // If string: try ISO first\r\n  //   if (typeof value === \"string\") {\r\n  //     // yyyy-mm-dd (from your form inputs)\r\n  //     const iso = Date.parse(value);\r\n  //     if (!isNaN(iso)) return iso;\r\n\r\n  //     // mm/dd/yyyy fallback (older items)\r\n  //     const parts = value.split(\"/\");\r\n  //     if (parts.length === 3) {\r\n  //       const [mm, dd, yyyy] = parts;\r\n  //       const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\r\n  //       if (!isNaN(alt)) return alt;\r\n  //     }\r\n  //   }\r\n\r\n  //   // Canonicalize any date-ish value to 'yyyy-mm-dd' so it matches <input type=\"date\"> values\r\n  //   function toYMD(value) {\r\n  //     const t = toTime(value);\r\n  //     if (t == null) return null;\r\n  //     const d = new Date(t);\r\n  //     const yyyy = d.getFullYear();\r\n  //     const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  //     const dd = String(d.getDate()).padStart(2, \"0\");\r\n  //     return `${yyyy}-${mm}-${dd}`;\r\n  //   }\r\n\r\n\r\n  //   // Last resort\n  //   const t = Date.parse(value);\n  //   return isNaN(t) ? null : t;\n  // }\n\n  const totalKnownPages = Math.max(\n    1,\n    pageCursors.filter(Boolean).length + (hasNextPage ? 1 : 0)\n  );\n  const pageButtons = (() => {\n    const buttons = [];\n    const maxVisible = 7;\n\n    const pushPage = (p) =>\n      buttons.push(\n        <Pagination.Item\n          key={`page-${p}`}\n          active={p === page}\n          onClick={() => setPage(p)}\n        >\n          {p}\n        </Pagination.Item>\n      );\n\n    const pushEllipsis = (key) =>\n      buttons.push(<Pagination.Ellipsis key={key} disabled />);\n\n    if (totalKnownPages <= maxVisible) {\n      for (let i = 1; i <= totalKnownPages; i += 1) pushPage(i);\n      return buttons;\n    }\n\n    let start = Math.max(2, page - 1);\n    let end = Math.min(totalKnownPages - 1, page + 1);\n\n    const desiredWindow = maxVisible - 2;\n    let currentWindow = end - start + 1;\n    let remaining = desiredWindow - currentWindow;\n\n    while (remaining > 0) {\n      if (start > 2) {\n        start -= 1;\n        remaining -= 1;\n      }\n      if (remaining > 0 && end < totalKnownPages - 1) {\n        end += 1;\n        remaining -= 1;\n      }\n      if (start === 2 && end === totalKnownPages - 1) break;\n    }\n\n    pushPage(1);\n    if (start > 2) pushEllipsis(\"start-ellipsis\");\n    for (let i = start; i <= end; i += 1) pushPage(i);\n    if (end < totalKnownPages - 1) pushEllipsis(\"end-ellipsis\");\n    pushPage(totalKnownPages);\n    if (hasNextPage) pushEllipsis(\"more-ellipsis\");\n\n    return buttons;\n  })();\n\n  const recalcPageSize = useCallback(() => {\n    if (typeof window === \"undefined\") return;\n    if (page !== 1) return;\n    if (!tableBodyRef.current) return;\n    const containerHeight =\n      tableBodyRef.current.getBoundingClientRect().height || 0;\n    if (!containerHeight) return;\n\n    const headerRow =\n      tableBodyRef.current.querySelector(\"table thead tr\") ||\n      tableBodyRef.current.querySelector(\"thead tr\");\n    const bodyRow =\n      tableBodyRef.current.querySelector(\"table tbody tr\") ||\n      tableBodyRef.current.querySelector(\"tbody tr\");\n\n    if (headerRow) {\n      const h = headerRow.getBoundingClientRect().height;\n      if (h) headerHeightRef.current = h;\n    }\n    if (bodyRow) {\n      const r = bodyRow.getBoundingClientRect().height;\n      if (r) rowHeightRef.current = r;\n    }\n\n    const verticalPadding = 24;\n    const available =\n      containerHeight - headerHeightRef.current - verticalPadding;\n    const estimated = Math.floor(available / rowHeightRef.current);\n    const clamped = Math.max(5, Math.min(50, estimated));\n    if (clamped > 0 && clamped !== pageSize) {\n      setPageSize(clamped);\n      resetPagination();\n      setQueryEpoch((v) => v + 1);\n    }\n  }, [page, pageSize]);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    recalcPageSize();\n    const onResize = () => recalcPageSize();\n    window.addEventListener(\"resize\", onResize);\n    return () => window.removeEventListener(\"resize\", onResize);\n  }, [recalcPageSize]);\n\n  useEffect(() => {\n    if (isLoading || page !== 1) return;\n    recalcPageSize();\n  }, [page, isLoading, recalcPageSize]);\n\n  const renderFilters = (idPrefix) => (\n    <div className={styles.filtersPanel}>\n      <div className={styles.filtersHeader}>\n        <div>\n          <div className={styles.filtersTitle}>Filters</div>\n          <div className={styles.filtersSubtitle}>\n            Narrow results by machine, client, or warehouse.\n          </div>\n        </div>\n        {hasActiveFilters ? (\n          <span className={styles.filtersBadge}>Active</span>\n        ) : null}\n      </div>\n\n      <div className={styles.filterSection}>\n        <div className={styles.filterSectionTitle}>Machine</div>\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>OEM</InputGroup.Text>\n          <Dropdown onSelect={handleSelect1} className=\"w-100\">\n            <Dropdown.Toggle\n              variant=\"outline-secondary\"\n              id={`${idPrefix}-oem`}\n              className={`w-100 ${styles.inputButton}`}\n            >\n              {dropdown1Text}\n            </Dropdown.Toggle>\n            <Dropdown.Menu className=\"w-100\">\n              <Dropdown.Item eventKey=\"unassigned\">Select Option</Dropdown.Item>\n              <Dropdown.Item eventKey=\"GE\">GE</Dropdown.Item>\n              <Dropdown.Item eventKey=\"Toshiba\">Toshiba</Dropdown.Item>\n              <Dropdown.Item eventKey=\"Siemens\">Siemens</Dropdown.Item>\n              <Dropdown.Item eventKey=\"Philips\">Philips</Dropdown.Item>\n            </Dropdown.Menu>\n          </Dropdown>\n        </InputGroup>\n\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Modality</InputGroup.Text>\n          <Dropdown onSelect={handleSelect2} className=\"w-100\">\n            <Dropdown.Toggle\n              variant=\"outline-secondary\"\n              id={`${idPrefix}-modality`}\n              className={`w-100 ${styles.inputButton}`}\n            >\n              {dropdown2Text}\n            </Dropdown.Toggle>\n            <Dropdown.Menu className=\"w-100\">\n              <Dropdown.Item eventKey=\"unassigned\">Select Option</Dropdown.Item>\n              <Dropdown.Item eventKey=\"CT\">CT</Dropdown.Item>\n              <Dropdown.Item eventKey=\"MRI\">MRI</Dropdown.Item>\n            </Dropdown.Menu>\n          </Dropdown>\n        </InputGroup>\n\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Model</InputGroup.Text>\n          <Button\n            variant=\"outline-secondary\"\n            className={`w-100 ${styles.inputButton}`}\n            onClick={handleModelClick}\n          >\n            {modelButtonText}\n          </Button>\n        </InputGroup>\n      </div>\n\n      <div className={styles.filterSection}>\n        <div className={styles.filterSectionTitle}>Client</div>\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Client From</InputGroup.Text>\n          <Button\n            variant=\"outline-secondary\"\n            className={`w-100 ${styles.inputButton}`}\n            onClick={() => handleClientClick(\"from\")}\n          >\n            {clientFromButtonText}\n          </Button>\n        </InputGroup>\n\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Client Current</InputGroup.Text>\n          <Button\n            variant=\"outline-secondary\"\n            className={`w-100 ${styles.inputButton}`}\n            onClick={() => handleClientClick(\"current\")}\n          >\n            {clientCurrentButtonText}\n          </Button>\n        </InputGroup>\n      </div>\n\n      <div className={styles.filterSection}>\n        <div className={styles.filterSectionTitle}>Warehouse</div>\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Quick</InputGroup.Text>\n          <div className={styles.buttonGroup}>\n            <Button\n              variant=\"outline-secondary\"\n              className={styles.flexButton}\n              onClick={handleSoCalWarehouseClick}\n            >\n              SoCal Warehouse\n            </Button>\n            <Button\n              variant=\"outline-secondary\"\n              className={styles.flexButton}\n              onClick={handleNorCalWarehouseClick}\n            >\n              NorCal Warehouse\n            </Button>\n            <Button\n              variant=\"outline-secondary\"\n              className={styles.flexButton}\n              onClick={handleWarehouseUnassignedClick}\n            >\n              Unassigned\n            </Button>\n          </div>\n        </InputGroup>\n      </div>\n    </div>\n  );\n\n\n  return (\n    <LoggedIn>\n      {(isDeleting || isNavigating) && (\n        <div className={styles.loadingOverlay}>\n          <img\n            src=\"/magmo-logo.png\"\n            alt=\"Loading Magmo\"\n            className={styles.loadingLogo}\n          />\n        </div>\n      )}\n      <Modal show={showDeleteModal} onHide={handleCloseDeleteModal}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Confirm Deletion</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          Are you sure you want to delete {selectedItems.length} item\r\n          {selectedItems.length > 1 ? \"s\" : \"\"}?\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"danger\" onClick={handleDeleteSelected}>\r\n            Yes, delete\r\n          </Button>\r\n          <Button variant=\"secondary\" onClick={handleCloseDeleteModal}>\r\n            Cancel\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n\r\n      <Modal show={showClientModal} onHide={() => setShowClientModal(false)}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            Select {clientSelectionType === \"from\" ? \"Client From\" : \"Client Current\"}\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <FormControl\r\n            type=\"text\"\r\n            placeholder=\"Search by name\"\r\n            className=\"mb-3\"\r\n            value={clientSearchTerm}\r\n            onChange={(e) => setClientSearchTerm(e.target.value)}\r\n          />\r\n          <ClientTable\r\n            clients={(Array.isArray(clients) ? clients : []).filter(\r\n              (client) => (client?.name ?? \"\").toLowerCase().includes(clientSearchTerm.toLowerCase())\r\n            )}\r\n            onSelectClient={handleClientSelect}\r\n            onInfoClick={handleClientInfo}\r\n            isClientSearch={false}\r\n            clearSelection={() => handleClientSelect(null)}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n\r\n      <Modal show={showModelModal} onHide={() => setShowModelModal(false)}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Select Model</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <FormControl\r\n            type=\"text\"\r\n            placeholder=\"Search by name\"\r\n            className=\"mb-3\"\r\n            value={modelSearchTerm}\r\n            onChange={(e) => setModelSearchTerm(e.target.value)}\r\n          />\r\n          <ModelTable\r\n            models={models.filter((model) =>\r\n              typeof model === \"string\"\r\n                ? model.toLowerCase().includes(modelSearchTerm.toLowerCase())\r\n                : false\r\n            )}\r\n            onSelectModel={handleModelSelect}\r\n            clearSelection={() => handleModelSelect(null)}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n\r\n      <div className={styles.page}>\n        <div className={styles.pageInner}>\n          <header className={styles.header}>\n            <div className={styles.headerLeft}>\n              <button\n                type=\"button\"\n                className={styles.burger}\n                onClick={() => setShowFilters(true)}\n                aria-label=\"Open filters\"\n              >\n                <span></span>\n                <span></span>\n                <span></span>\n              </button>\n              <div className={styles.brand}>\n                <img\n                  src=\"/magmo-logo.png\"\n                  alt=\"Magmo\"\n                  className={styles.brandLogo}\n                />\n                <div>\n                  <div className={styles.brandName}>Magmo</div>\n                  <div className={styles.brandSub}>Inventory Search</div>\n                </div>\n              </div>\n            </div>\n            <div className={styles.headerRight}>\n              <div className={styles.headerStatus}>\n                {hasActiveFilters ? \"Filters active\" : \"All items\"}\n              </div>\n            </div>\n          </header>\n\n          <div className={styles.content}>\n            <aside className={styles.sidebar}>{renderFilters(\"sidebar\")}</aside>\n            <main className={styles.main}>\n              <div className={styles.tableCard}>\n                <div className={styles.tableHeader}>\n                  <div>\n                    <div className={styles.tableTitle}>Items</div>\n                    <div className={styles.tableSubtitle}>\n                      {isLoading ? \"Loading items\" : `${info.length} items on this page`}\n                    </div>\n                  </div>\n                  <div className={styles.tableMeta}>\n                    Page {page} {hasNextPage ? `of ${totalKnownPages}+` : `of ${totalKnownPages}`}\n                  </div>\n                </div>\n\n                <div className={styles.tableBody} ref={tableBodyRef}>\n                  {isLoading ? (\n                    <div className={styles.loadingState}>\n                      <img\n                        src=\"/magmo-logo.png\"\n                        alt=\"Loading Magmo\"\n                        className={styles.loadingLogo}\n                      />\n                      <div className={styles.loadingText}>Loading</div>\n                    </div>\n                  ) : loadError ? (\n                    <div className={styles.errorState}>\n                      <div className={styles.errorTitle}>\n                        Load failed ({loadError.code})\n                      </div>\n                      <div className={styles.errorMessage}>{loadError.message}</div>\n                      <Button\n                        variant=\"outline-secondary\"\n                        size=\"sm\"\n                        onClick={() => {\n                          resetPagination();\n                          setQueryEpoch((v) => v + 1);\n                        }}\n                      >\n                        Retry\n                      </Button>\n                    </div>\n                  ) : (\n                    <PartTable\n                      info={info}\n                      labels={labels}\n                      ids={ids}\n                      hoverStyle={hoverStyle}\n                      sortCheckAll={sortCheckAll}\n                      checkDelete={checkDelete}\n                      isDeleting={isDeleting}\n                      rowSelect={rowSelect}\n                      setHoverIndex={setHoverIndex}\n                      hoverIndex={hoverIndex}\n                      selectedItems={selectedItems}\n                      setSelectedItems={setSelectedItems}\n                      minRows={pageSize}\n                    />\n                  )}\n                </div>\n\n                <div className={styles.tableFooter}>\n                  <div className={styles.paginationRow}>\n                    <Pagination size=\"sm\">\n                      <Pagination.Prev\n                        onClick={() => setPage((p) => Math.max(1, p - 1))}\n                        disabled={page <= 1}\n                      >\n                        Previous\n                      </Pagination.Prev>\n                      {pageButtons}\n                      <Pagination.Next\n                        onClick={() => setPage((p) => p + 1)}\n                        disabled={!hasNextPage}\n                      >\n                        Next\n                      </Pagination.Next>\n                    </Pagination>\n                  </div>\n                  <Form className={styles.searchRow}>\n                    <FormControl\n                      type={showListSearch}\n                      placeholder=\"Search\"\n                      className={styles.searchInput}\n                      aria-label=\"Search\"\n                      value={search}\n                      onChange={searchChangeHandler}\n                    />\n                    <NavDropdown\n                      title={select}\n                      id=\"collasible-nav-dropdown\"\n                      show={showList}\n                      onMouseEnter={() => setShowList(true)}\n                      onMouseLeave={() => setShowList(false)}\n                      className={styles.searchSelect}\n                    >\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Name\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Name\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Date\");\n                          setShowListSearch(\"date\");\n                        }}\n                      >\n                        Date\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Work Order\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Work Order\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Product Number\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Product Number\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Serial Number\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Serial Number\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Description\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Description\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"SKU\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        SKU\n                      </NavDropdown.Item>\n                    </NavDropdown>\n                  </Form>\n                  <div className={styles.footerActions}>\n                    <LoadingButton\n                      type=\"secondary\"\n                      name=\"Add New Item\"\n                      route=\"NewSearch/AddItem/NewItem\"\n                      className={styles.actionButton}\n                    />\n                    <LoadingButton\n                      type=\"light\"\n                      name=\"Map\"\n                      route=\"NewSearch/inventory/inventoryManage\"\n                      className={styles.actionButton}\n                    />\n                    <LoadingButton\n                      type=\"primary\"\n                      name=\"Back\"\n                      route=\"Warehousedb/WarehouseSelect\"\n                      className={styles.actionButton}\n                    />\n                  </div>\n                </div>\n              </div>\n            </main>\n          </div>\n        </div>\n\n        <Offcanvas\n          show={showFilters}\n          onHide={() => setShowFilters(false)}\n          placement=\"start\"\n          className={styles.filtersDrawer}\n          scroll\n          backdrop\n        >\n          <Offcanvas.Header closeButton>\n            <Offcanvas.Title>Filters</Offcanvas.Title>\n          </Offcanvas.Header>\n          <Offcanvas.Body>{renderFilters(\"drawer\")}</Offcanvas.Body>\n        </Offcanvas>\n      </div>\n    </LoggedIn>\n  );\n\r\n\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}