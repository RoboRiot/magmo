{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\index.js\";\nvar __jsx = React.createElement;\n// pages/index.js\nimport Head from \"next/head\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Card, Container, Alert } from \"react-bootstrap\";\nimport styles from \"../styles/Home.module.css\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../context/Firebase\"; // compat default export ONLY\n\nexport default function Home() {\n  const router = useRouter();\n  const {\n    0: error,\n    1: setError\n  } = useState(\"\");\n  const {\n    0: hasMounted,\n    1: setHasMounted\n  } = useState(false);\n  const {\n    0: authReady,\n    1: setAuthReady\n  } = useState(false);\n  const unsubRef = useRef(null);\n\n  const getDestination = () => {\n    var _router$query;\n\n    const q = router === null || router === void 0 ? void 0 : (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.redirect;\n    return Array.isArray(q) ? q[0] || \"/NewSearch/mainSearch\" : q || \"/NewSearch/mainSearch\";\n  };\n\n  const isIosSafari = () => {\n    if (typeof navigator === \"undefined\") return false;\n    const ua = navigator.userAgent;\n    const isIOS = /iP(hone|ad|od)/i.test(ua);\n    const isSafari = /Safari/i.test(ua) && !/Chrome|CriOS|FxiOS|EdgiOS/i.test(ua);\n    return isIOS && isSafari;\n  };\n\n  useEffect(() => setHasMounted(true), []); // One-time auth listener\n\n  useEffect(() => {\n    if (!hasMounted) return;\n\n    (async () => {\n      try {\n        await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL); // simple storage probe to detect hostile environments\n\n        try {\n          localStorage.setItem(\"__magmo_probe\", \"1\");\n        } catch (e) {\n          console.warn(\"[auth] localStorage not available; redirects may fail\");\n        }\n\n        unsubRef.current = firebase.auth().onAuthStateChanged(user => {\n          console.log(\"[auth] onAuthStateChanged:\", user);\n          setAuthReady(true);\n\n          if (user) {\n            const dest = getDestination();\n            router.replace(dest);\n          }\n        });\n      } catch (e) {\n        console.error(\"[auth] persistence setup error:\", e);\n        setError(\"Authentication init failed.\");\n      }\n    })();\n\n    return () => {\n      if (unsubRef.current) unsubRef.current();\n    };\n  }, [hasMounted, router]);\n  if (!hasMounted) return null;\n\n  const handleGoogleSignIn = async () => {\n    setError(\"\");\n\n    try {\n      await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);\n      const provider = new firebase.auth.GoogleAuthProvider();\n      provider.addScope(\"email\");\n      provider.addScope(\"profile\");\n      provider.setCustomParameters({\n        prompt: \"select_account\"\n      }); // prefer popup (no redirect state), fallback to redirect only where needed\n\n      if (isIosSafari()) {\n        console.log(\"[auth] Using redirect (iOS Safari)\"); // mark that we attempted sign-in (to detect storage loss)\n\n        try {\n          localStorage.setItem(\"__magmo_signin_attempt\", Date.now().toString());\n        } catch (_) {}\n\n        await firebase.auth().signInWithRedirect(provider);\n      } else {\n        console.log(\"[auth] Using popup\");\n        const result = await firebase.auth().signInWithPopup(provider);\n        console.log(\"[auth] popup result:\", result && result.user); // onAuthStateChanged will route; but we can route immediately too:\n\n        if (result && result.user) {\n          const dest = getDestination();\n          router.replace(dest);\n        }\n      }\n    } catch (err) {\n      console.error(\"[auth] sign-in error:\", err);\n      setError(\"Failed to log in with Google: \" + (err && err.message ? err.message : String(err)));\n    }\n  };\n\n  const handleTestLogin = async () => {\n    setError(\"\");\n    const password = prompt(\"Enter password:\");\n    if (!password) return;\n\n    try {\n      await firebase.auth().signInWithEmailAndPassword(\"test@test.com\", password);\n      router.replace(\"/NewSearch/searchTest\");\n    } catch (err) {\n      setError(\"Test login failed: \" + (err && err.message ? err.message : String(err)));\n    }\n  };\n\n  return __jsx(\"div\", {\n    className: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 5\n    }\n  }, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }\n  }, __jsx(\"title\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 9\n    }\n  }, \"magmo\"), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/favicon.ico\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }\n  }), __jsx(\"meta\", {\n    name: \"viewport\",\n    content: \"width=device-width, initial-scale=1.0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  })), __jsx(Container, {\n    className: \"d-flex align-items-center justify-content-center\",\n    style: {\n      minHeight: \"100vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"w-100\",\n    style: {\n      maxWidth: \"400px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 9\n    }\n  }, __jsx(Card, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 11\n    }\n  }, __jsx(Card.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }\n  }, __jsx(\"h2\", {\n    className: \"text-center mb-4\",\n    style: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 15\n    }\n  }, \"MAGM\", __jsx(\"img\", {\n    src: \"/magmo-logo.png\" // make sure to place your logo file in the public/ folder\n    ,\n    alt: \"Magmo logo\",\n    style: {\n      width: \"32px\",\n      // adjust size to match text\n      height: \"32px\",\n      marginLeft: \"4px\",\n      marginRight: \"2px\",\n      verticalAlign: \"middle\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 17\n    }\n  })), !authReady && __jsx(\"div\", {\n    className: \"mb-2 small text-muted\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 30\n    }\n  }, \"Initializing\\u2026\"), error && __jsx(Alert, {\n    variant: \"danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 25\n    }\n  }, error), __jsx(Button, {\n    variant: \"light\",\n    className: \"w-100 d-flex align-items-center justify-content-center\",\n    onClick: handleGoogleSignIn,\n    style: {\n      border: \"1px solid #dadce0\",\n      borderRadius: \"0.375rem\",\n      color: \"#757575\",\n      padding: \"0.5rem 1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 15\n    }\n  }, __jsx(\"img\", {\n    src: \"https://www.svgrepo.com/show/355037/google.svg\",\n    alt: \"Google logo\",\n    width: \"20\",\n    height: \"20\",\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 17\n    }\n  }), \"Sign in with Google\"), __jsx(Button, {\n    variant: \"secondary\",\n    className: \"w-100 mt-3\",\n    onClick: handleTestLogin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 15\n    }\n  }, \"Test Login\"))))));\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/index.js"],"names":["Head","React","useState","useEffect","useRef","Button","Card","Container","Alert","styles","useRouter","firebase","Home","router","error","setError","hasMounted","setHasMounted","authReady","setAuthReady","unsubRef","getDestination","q","query","redirect","Array","isArray","isIosSafari","navigator","ua","userAgent","isIOS","test","isSafari","auth","setPersistence","Auth","Persistence","LOCAL","localStorage","setItem","e","console","warn","current","onAuthStateChanged","user","log","dest","replace","handleGoogleSignIn","provider","GoogleAuthProvider","addScope","setCustomParameters","prompt","Date","now","toString","_","signInWithRedirect","result","signInWithPopup","err","message","String","handleTestLogin","password","signInWithEmailAndPassword","container","minHeight","maxWidth","display","justifyContent","alignItems","width","height","marginLeft","marginRight","verticalAlign","border","borderRadius","color","padding"],"mappings":";;AAAA;AACA,OAAOA,IAAP,MAAiB,WAAjB;AACA,OAAOC,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,EAAqCC,MAArC,QAAmD,OAAnD;AACA,SAASC,MAAT,EAAiBC,IAAjB,EAAuBC,SAAvB,EAAkCC,KAAlC,QAA+C,iBAA/C;AACA,OAAOC,MAAP,MAAmB,2BAAnB;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,OAAOC,QAAP,MAAqB,qBAArB,C,CAA4C;;AAE5C,eAAe,SAASC,IAAT,GAAgB;AAC7B,QAAMC,MAAM,GAAGH,SAAS,EAAxB;AACA,QAAM;AAAA,OAACI,KAAD;AAAA,OAAQC;AAAR,MAAoBb,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM;AAAA,OAACc,UAAD;AAAA,OAAaC;AAAb,MAA8Bf,QAAQ,CAAC,KAAD,CAA5C;AACA,QAAM;AAAA,OAACgB,SAAD;AAAA,OAAYC;AAAZ,MAA4BjB,QAAQ,CAAC,KAAD,CAA1C;AACA,QAAMkB,QAAQ,GAAGhB,MAAM,CAAC,IAAD,CAAvB;;AAEA,QAAMiB,cAAc,GAAG,MAAM;AAAA;;AAC3B,UAAMC,CAAC,GAAGT,MAAH,aAAGA,MAAH,wCAAGA,MAAM,CAAEU,KAAX,kDAAG,cAAeC,QAAzB;AACA,WAAOC,KAAK,CAACC,OAAN,CAAcJ,CAAd,IAAmBA,CAAC,CAAC,CAAD,CAAD,IAAQ,uBAA3B,GAAsDA,CAAC,IAAI,uBAAlE;AACD,GAHD;;AAKA,QAAMK,WAAW,GAAG,MAAM;AACxB,QAAI,OAAOC,SAAP,KAAqB,WAAzB,EAAsC,OAAO,KAAP;AACtC,UAAMC,EAAE,GAAGD,SAAS,CAACE,SAArB;AACA,UAAMC,KAAK,GAAG,kBAAkBC,IAAlB,CAAuBH,EAAvB,CAAd;AACA,UAAMI,QAAQ,GAAG,UAAUD,IAAV,CAAeH,EAAf,KAAsB,CAAC,6BAA6BG,IAA7B,CAAkCH,EAAlC,CAAxC;AACA,WAAOE,KAAK,IAAIE,QAAhB;AACD,GAND;;AAQA9B,EAAAA,SAAS,CAAC,MAAMc,aAAa,CAAC,IAAD,CAApB,EAA4B,EAA5B,CAAT,CApB6B,CAsB7B;;AACAd,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACa,UAAL,EAAiB;;AACjB,KAAC,YAAY;AACX,UAAI;AACF,cAAML,QAAQ,CAACuB,IAAT,GAAgBC,cAAhB,CAA+BxB,QAAQ,CAACuB,IAAT,CAAcE,IAAd,CAAmBC,WAAnB,CAA+BC,KAA9D,CAAN,CADE,CAEF;;AACA,YAAI;AACFC,UAAAA,YAAY,CAACC,OAAb,CAAqB,eAArB,EAAsC,GAAtC;AACD,SAFD,CAEE,OAAOC,CAAP,EAAU;AACVC,UAAAA,OAAO,CAACC,IAAR,CAAa,uDAAb;AACD;;AAEDvB,QAAAA,QAAQ,CAACwB,OAAT,GAAmBjC,QAAQ,CAACuB,IAAT,GAAgBW,kBAAhB,CAAoCC,IAAD,IAAU;AAC9DJ,UAAAA,OAAO,CAACK,GAAR,CAAY,4BAAZ,EAA0CD,IAA1C;AACA3B,UAAAA,YAAY,CAAC,IAAD,CAAZ;;AACA,cAAI2B,IAAJ,EAAU;AACR,kBAAME,IAAI,GAAG3B,cAAc,EAA3B;AACAR,YAAAA,MAAM,CAACoC,OAAP,CAAeD,IAAf;AACD;AACF,SAPkB,CAAnB;AAQD,OAjBD,CAiBE,OAAOP,CAAP,EAAU;AACVC,QAAAA,OAAO,CAAC5B,KAAR,CAAc,iCAAd,EAAiD2B,CAAjD;AACA1B,QAAAA,QAAQ,CAAC,6BAAD,CAAR;AACD;AACF,KAtBD;;AAwBA,WAAO,MAAM;AACX,UAAIK,QAAQ,CAACwB,OAAb,EAAsBxB,QAAQ,CAACwB,OAAT;AACvB,KAFD;AAGD,GA7BQ,EA6BN,CAAC5B,UAAD,EAAaH,MAAb,CA7BM,CAAT;AA+BA,MAAI,CAACG,UAAL,EAAiB,OAAO,IAAP;;AAEjB,QAAMkC,kBAAkB,GAAG,YAAY;AACrCnC,IAAAA,QAAQ,CAAC,EAAD,CAAR;;AACA,QAAI;AACF,YAAMJ,QAAQ,CAACuB,IAAT,GAAgBC,cAAhB,CAA+BxB,QAAQ,CAACuB,IAAT,CAAcE,IAAd,CAAmBC,WAAnB,CAA+BC,KAA9D,CAAN;AACA,YAAMa,QAAQ,GAAG,IAAIxC,QAAQ,CAACuB,IAAT,CAAckB,kBAAlB,EAAjB;AACAD,MAAAA,QAAQ,CAACE,QAAT,CAAkB,OAAlB;AACAF,MAAAA,QAAQ,CAACE,QAAT,CAAkB,SAAlB;AACAF,MAAAA,QAAQ,CAACG,mBAAT,CAA6B;AAAEC,QAAAA,MAAM,EAAE;AAAV,OAA7B,EALE,CAOF;;AACA,UAAI5B,WAAW,EAAf,EAAmB;AACjBe,QAAAA,OAAO,CAACK,GAAR,CAAY,oCAAZ,EADiB,CAEjB;;AACA,YAAI;AAAER,UAAAA,YAAY,CAACC,OAAb,CAAqB,wBAArB,EAA+CgB,IAAI,CAACC,GAAL,GAAWC,QAAX,EAA/C;AAAwE,SAA9E,CAA+E,OAAOC,CAAP,EAAU,CAAE;;AAC3F,cAAMhD,QAAQ,CAACuB,IAAT,GAAgB0B,kBAAhB,CAAmCT,QAAnC,CAAN;AACD,OALD,MAKO;AACLT,QAAAA,OAAO,CAACK,GAAR,CAAY,oBAAZ;AACA,cAAMc,MAAM,GAAG,MAAMlD,QAAQ,CAACuB,IAAT,GAAgB4B,eAAhB,CAAgCX,QAAhC,CAArB;AACAT,QAAAA,OAAO,CAACK,GAAR,CAAY,sBAAZ,EAAoCc,MAAM,IAAIA,MAAM,CAACf,IAArD,EAHK,CAIL;;AACA,YAAIe,MAAM,IAAIA,MAAM,CAACf,IAArB,EAA2B;AACzB,gBAAME,IAAI,GAAG3B,cAAc,EAA3B;AACAR,UAAAA,MAAM,CAACoC,OAAP,CAAeD,IAAf;AACD;AACF;AACF,KAvBD,CAuBE,OAAOe,GAAP,EAAY;AACZrB,MAAAA,OAAO,CAAC5B,KAAR,CAAc,uBAAd,EAAuCiD,GAAvC;AACAhD,MAAAA,QAAQ,CAAC,oCAAoCgD,GAAG,IAAIA,GAAG,CAACC,OAAX,GAAqBD,GAAG,CAACC,OAAzB,GAAmCC,MAAM,CAACF,GAAD,CAA7E,CAAD,CAAR;AACD;AACF,GA7BD;;AA+BA,QAAMG,eAAe,GAAG,YAAY;AAClCnD,IAAAA,QAAQ,CAAC,EAAD,CAAR;AACA,UAAMoD,QAAQ,GAAGZ,MAAM,CAAC,iBAAD,CAAvB;AACA,QAAI,CAACY,QAAL,EAAe;;AACf,QAAI;AACF,YAAMxD,QAAQ,CAACuB,IAAT,GAAgBkC,0BAAhB,CAA2C,eAA3C,EAA4DD,QAA5D,CAAN;AACAtD,MAAAA,MAAM,CAACoC,OAAP,CAAe,uBAAf;AACD,KAHD,CAGE,OAAOc,GAAP,EAAY;AACZhD,MAAAA,QAAQ,CAAC,yBAAyBgD,GAAG,IAAIA,GAAG,CAACC,OAAX,GAAqBD,GAAG,CAACC,OAAzB,GAAmCC,MAAM,CAACF,GAAD,CAAlE,CAAD,CAAR;AACD;AACF,GAVD;;AAYA,SACE;AAAK,IAAA,SAAS,EAAEtD,MAAM,CAAC4D,SAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADF,EAEE;AAAM,IAAA,GAAG,EAAC,MAAV;AAAiB,IAAA,IAAI,EAAC,cAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,EAGE;AAAM,IAAA,IAAI,EAAC,UAAX;AAAsB,IAAA,OAAO,EAAC,uCAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAHF,CADF,EAOE,MAAC,SAAD;AAAW,IAAA,SAAS,EAAC,kDAArB;AAAwE,IAAA,KAAK,EAAE;AAAEC,MAAAA,SAAS,EAAE;AAAb,KAA/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAC,OAAf;AAAuB,IAAA,KAAK,EAAE;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,IAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,IAAD,CAAM,IAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAI,IAAA,SAAS,EAAC,kBAAd;AAAiC,IAAA,KAAK,EAAE;AAAEC,MAAAA,OAAO,EAAE,MAAX;AAAmBC,MAAAA,cAAc,EAAE,QAAnC;AAA6CC,MAAAA,UAAU,EAAE;AAAzD,KAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAEE;AACE,IAAA,GAAG,EAAC,iBADN,CACwB;AADxB;AAEE,IAAA,GAAG,EAAC,YAFN;AAGE,IAAA,KAAK,EAAE;AACLC,MAAAA,KAAK,EAAE,MADF;AACU;AACfC,MAAAA,MAAM,EAAE,MAFH;AAGLC,MAAAA,UAAU,EAAE,KAHP;AAILC,MAAAA,WAAW,EAAE,KAJR;AAKLC,MAAAA,aAAa,EAAE;AALV,KAHT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,CADF,EAeG,CAAC7D,SAAD,IAAc;AAAK,IAAA,SAAS,EAAC,uBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAfjB,EAgBGJ,KAAK,IAAI,MAAC,KAAD;AAAO,IAAA,OAAO,EAAC,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAyBA,KAAzB,CAhBZ,EAkBE,MAAC,MAAD;AACE,IAAA,OAAO,EAAC,OADV;AAEE,IAAA,SAAS,EAAC,wDAFZ;AAGE,IAAA,OAAO,EAAEoC,kBAHX;AAIE,IAAA,KAAK,EAAE;AACL8B,MAAAA,MAAM,EAAE,mBADH;AAELC,MAAAA,YAAY,EAAE,UAFT;AAGLC,MAAAA,KAAK,EAAE,SAHF;AAILC,MAAAA,OAAO,EAAE;AAJJ,KAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAWE;AACE,IAAA,GAAG,EAAC,gDADN;AAEE,IAAA,GAAG,EAAC,aAFN;AAGE,IAAA,KAAK,EAAC,IAHR;AAIE,IAAA,MAAM,EAAC,IAJT;AAKE,IAAA,SAAS,EAAC,MALZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAXF,wBAlBF,EAuCE,MAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,WAAhB;AAA4B,IAAA,SAAS,EAAC,YAAtC;AAAmD,IAAA,OAAO,EAAEjB,eAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAvCF,CADF,CADF,CADF,CAPF,CADF;AA2DD","sourcesContent":["// pages/index.js\nimport Head from \"next/head\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Card, Container, Alert } from \"react-bootstrap\";\nimport styles from \"../styles/Home.module.css\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../context/Firebase\"; // compat default export ONLY\n\nexport default function Home() {\n  const router = useRouter();\n  const [error, setError] = useState(\"\");\n  const [hasMounted, setHasMounted] = useState(false);\n  const [authReady, setAuthReady] = useState(false);\n  const unsubRef = useRef(null);\n\n  const getDestination = () => {\n    const q = router?.query?.redirect;\n    return Array.isArray(q) ? q[0] || \"/NewSearch/mainSearch\" : (q || \"/NewSearch/mainSearch\");\n  };\n\n  const isIosSafari = () => {\n    if (typeof navigator === \"undefined\") return false;\n    const ua = navigator.userAgent;\n    const isIOS = /iP(hone|ad|od)/i.test(ua);\n    const isSafari = /Safari/i.test(ua) && !/Chrome|CriOS|FxiOS|EdgiOS/i.test(ua);\n    return isIOS && isSafari;\n  };\n\n  useEffect(() => setHasMounted(true), []);\n\n  // One-time auth listener\n  useEffect(() => {\n    if (!hasMounted) return;\n    (async () => {\n      try {\n        await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);\n        // simple storage probe to detect hostile environments\n        try {\n          localStorage.setItem(\"__magmo_probe\", \"1\");\n        } catch (e) {\n          console.warn(\"[auth] localStorage not available; redirects may fail\");\n        }\n\n        unsubRef.current = firebase.auth().onAuthStateChanged((user) => {\n          console.log(\"[auth] onAuthStateChanged:\", user);\n          setAuthReady(true);\n          if (user) {\n            const dest = getDestination();\n            router.replace(dest);\n          }\n        });\n      } catch (e) {\n        console.error(\"[auth] persistence setup error:\", e);\n        setError(\"Authentication init failed.\");\n      }\n    })();\n\n    return () => {\n      if (unsubRef.current) unsubRef.current();\n    };\n  }, [hasMounted, router]);\n\n  if (!hasMounted) return null;\n\n  const handleGoogleSignIn = async () => {\n    setError(\"\");\n    try {\n      await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);\n      const provider = new firebase.auth.GoogleAuthProvider();\n      provider.addScope(\"email\");\n      provider.addScope(\"profile\");\n      provider.setCustomParameters({ prompt: \"select_account\" });\n\n      // prefer popup (no redirect state), fallback to redirect only where needed\n      if (isIosSafari()) {\n        console.log(\"[auth] Using redirect (iOS Safari)\");\n        // mark that we attempted sign-in (to detect storage loss)\n        try { localStorage.setItem(\"__magmo_signin_attempt\", Date.now().toString()); } catch (_) {}\n        await firebase.auth().signInWithRedirect(provider);\n      } else {\n        console.log(\"[auth] Using popup\");\n        const result = await firebase.auth().signInWithPopup(provider);\n        console.log(\"[auth] popup result:\", result && result.user);\n        // onAuthStateChanged will route; but we can route immediately too:\n        if (result && result.user) {\n          const dest = getDestination();\n          router.replace(dest);\n        }\n      }\n    } catch (err) {\n      console.error(\"[auth] sign-in error:\", err);\n      setError(\"Failed to log in with Google: \" + (err && err.message ? err.message : String(err)));\n    }\n  };\n\n  const handleTestLogin = async () => {\n    setError(\"\");\n    const password = prompt(\"Enter password:\");\n    if (!password) return;\n    try {\n      await firebase.auth().signInWithEmailAndPassword(\"test@test.com\", password);\n      router.replace(\"/NewSearch/searchTest\");\n    } catch (err) {\n      setError(\"Test login failed: \" + (err && err.message ? err.message : String(err)));\n    }\n  };\n\n  return (\n    <div className={styles.container}>\n      <Head>\n        <title>magmo</title>\n        <link rel=\"icon\" href=\"/favicon.ico\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\n      </Head>\n\n      <Container className=\"d-flex align-items-center justify-content-center\" style={{ minHeight: \"100vh\" }}>\n        <div className=\"w-100\" style={{ maxWidth: \"400px\" }}>\n          <Card>\n            <Card.Body>\n              <h2 className=\"text-center mb-4\" style={{ display: \"flex\", justifyContent: \"center\", alignItems: \"center\" }}>\n                MAGM\n                <img\n                  src=\"/magmo-logo.png\" // make sure to place your logo file in the public/ folder\n                  alt=\"Magmo logo\"\n                  style={{\n                    width: \"32px\", // adjust size to match text\n                    height: \"32px\",\n                    marginLeft: \"4px\",\n                    marginRight: \"2px\",\n                    verticalAlign: \"middle\",\n                  }}\n                />\n              </h2>\n              {!authReady && <div className=\"mb-2 small text-muted\">Initializingâ€¦</div>}\n              {error && <Alert variant=\"danger\">{error}</Alert>}\n\n              <Button\n                variant=\"light\"\n                className=\"w-100 d-flex align-items-center justify-content-center\"\n                onClick={handleGoogleSignIn}\n                style={{\n                  border: \"1px solid #dadce0\",\n                  borderRadius: \"0.375rem\",\n                  color: \"#757575\",\n                  padding: \"0.5rem 1rem\",\n                }}\n              >\n                <img\n                  src=\"https://www.svgrepo.com/show/355037/google.svg\"\n                  alt=\"Google logo\"\n                  width=\"20\"\n                  height=\"20\"\n                  className=\"me-2\"\n                />\n                Sign in with Google\n              </Button>\n\n              <Button variant=\"secondary\" className=\"w-100 mt-3\" onClick={handleTestLogin}>\n                Test Login\n              </Button>\n            </Card.Body>\n          </Card>\n        </div>\n      </Container>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}