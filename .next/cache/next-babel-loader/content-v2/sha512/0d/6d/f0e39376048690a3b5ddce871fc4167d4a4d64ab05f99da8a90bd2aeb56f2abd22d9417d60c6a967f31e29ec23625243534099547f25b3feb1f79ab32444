{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\item\\\\[id]\\\\index.js\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState, useRef, useCallback, useMemo } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Form, Button, Card, Container, Row, Col, Modal, FormControl, Collapse, InputGroup, ButtonGroup } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useAuth } from \"../../../../context/AuthUserContext\";\nimport firebase from \"../../../../context/Firebase\";\nimport LoggedIn from \"../../../LoggedIn\";\nimport { useRouter } from \"next/router\";\nimport { fetchClients } from \"../../../../utils/fetchAssociations\";\nimport ClientTable from \"../../../../utils/ClientTable\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport ParentModal from \"../../AddItem/parentModal\";\nimport dynamic from \"next/dynamic\";\nimport InfoModal from \"../../InfoModal\";\nimport MachineSelectionModal from \"./MachineSelectionModal\";\nimport { addServiceItem } from \"../../../../utils/BluefolderService\";\nimport NewLocal from \"./NewLocal\";\nimport styles from \"../../AddItem/NewItem.module.css\"; //inflow API\n\nimport InflowAPI from \"../../../../utils/inflowAPI\";\nimport { buildLocalLocObject, formatLoc, updateMachineFields, buildNameTokens } from \"../../../../utils/itemFormShared\";\nimport MultiSelectDropdown from \"../../../../components/MultiSelectDropdown\";\nimport { fetchTrackerCatalog, buildAllOems, buildModelsForSelection, syncTrackerFromSelections, deleteTrackerOem, deleteTrackerModel } from \"../../../../utils/trackerCatalog\"; // Import for SSR\n\nimport { adminDb } from \"../../../../context/FirebaseAdmin\"; // This will only load the component on the client-side.\n\nconst BarcodeScannerComponent = dynamic(() => import(\"react-qr-barcode-scanner\"), {\n  ssr: false,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"react-qr-barcode-scanner\")],\n    modules: [\"NewSearch\\\\item\\\\[id]\\\\index.js -> \" + \"react-qr-barcode-scanner\"]\n  }\n}); // Simulates a network request delay.\n\nfunction simulateNetworkRequest() {\n  return new Promise(resolve => setTimeout(resolve, 2000));\n} // Custom LoadingButton component.\n\n\nfunction LoadingButton({\n  type,\n  name,\n  route\n}) {\n  const {\n    0: isLoading,\n    1: setLoading\n  } = useState(false);\n  useEffect(() => {\n    if (isLoading) {\n      let cancelled = false;\n      simulateNetworkRequest().then(() => {\n        if (!cancelled) setLoading(false);\n      });\n      return () => {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\n  const handleClick = () => setLoading(true);\n\n  return __jsx(Link, {\n    href: `/${route}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 5\n    }\n  }, __jsx(\"a\", {\n    className: `btn btn-${type}`,\n    disabled: isLoading,\n    onClick: !isLoading ? handleClick : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 7\n    }\n  }, isLoading ? \"Loading…\" : name));\n}\n\nfunction isValidMachineValue(value) {\n  if (value == null) return false;\n\n  if (Array.isArray(value)) {\n    return value.some(v => {\n      const trimmed = String(v || \"\").trim();\n      return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\n    });\n  }\n\n  if (typeof value !== \"string\") return Boolean(value);\n  const trimmed = value.trim();\n  return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\n}\n\nfunction normalizeSelection(value) {\n  if (Array.isArray(value)) {\n    return value.map(v => String(v).trim()).filter(v => v && v.toLowerCase() !== \"n/a\");\n  }\n\n  if (value == null) return [];\n  const normalized = String(value).trim();\n  if (!normalized || normalized.toLowerCase() === \"n/a\") return [];\n  return [normalized];\n}\n\nfunction uniqueSelection(values) {\n  return Array.from(new Set(values || []));\n}\n\nfunction selectionToStoredValue(values) {\n  const cleaned = uniqueSelection(normalizeSelection(values));\n  if (cleaned.length === 0) return \"\";\n  if (cleaned.length === 1) return cleaned[0];\n  return cleaned;\n}\n\nfunction selectionToPrintValue(values) {\n  const cleaned = uniqueSelection(normalizeSelection(values));\n  if (cleaned.length === 0) return \"\";\n  if (cleaned.length === 1) return cleaned[0];\n  return \"Multi\";\n}\n\nfunction mergeOptionsWithSelection(options, selected) {\n  const map = new Map();\n  (options || []).forEach(value => {\n    if (value == null) return;\n    const normalized = String(value).trim();\n    if (!normalized) return;\n    map.set(normalized.toLowerCase(), normalized);\n  });\n  (selected || []).forEach(value => {\n    if (value == null) return;\n    const normalized = String(value).trim();\n    if (!normalized) return;\n    map.set(normalized.toLowerCase(), normalized);\n  });\n  return Array.from(map.values());\n}\n\nfunction DisplayItemInner({\n  initialItem,\n  initialMachineData,\n  error\n}) {\n  var _initialItem$price, _initialItem$status, _initialItem$length, _initialItem$width, _initialItem$height, _initialItem$poNumber, _initialItem$tracking, _initialItem$visible, _descriptions$selecte3, _descriptions$selecte4, _newLocalFrom$section, _newLocalFrom$section2, _newLocalCurrent$sect, _newLocalCurrent$sect2;\n\n  // Feature flag to show/hide the 3 Slack buttons\n  const SHOW_SLACK_BUTTONS = process.env.NEXT_PUBLIC_SHOW_SLACK_BUTTONS === \"true\";\n  const router = useRouter();\n  const {\n    signOut\n  } = useAuth(); // const { id } = router.query;\n\n  const {\n    id: idFromRouter\n  } = router.query;\n  const initialId = (initialItem === null || initialItem === void 0 ? void 0 : initialItem.id) || idFromRouter; // Use a single local var everywhere in this component\n\n  const id = initialId;\n  const {\n    0: items,\n    1: setItems\n  } = useState({\n    name: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.name) || \"\",\n    pn: Array.isArray(initialItem === null || initialItem === void 0 ? void 0 : initialItem.pn) ? initialItem.pn : initialItem !== null && initialItem !== void 0 && initialItem.pn ? [initialItem.pn] : [],\n    sn: Array.isArray(initialItem === null || initialItem === void 0 ? void 0 : initialItem.sn) ? initialItem.sn : initialItem !== null && initialItem !== void 0 && initialItem.sn ? [initialItem.sn] : [],\n    // hydrate these from initialItem so SSR renders fully on deploy\n    price: (_initialItem$price = initialItem === null || initialItem === void 0 ? void 0 : initialItem.price) !== null && _initialItem$price !== void 0 ? _initialItem$price : \"\",\n    status: (_initialItem$status = initialItem === null || initialItem === void 0 ? void 0 : initialItem.status) !== null && _initialItem$status !== void 0 ? _initialItem$status : \"\",\n    length: (_initialItem$length = initialItem === null || initialItem === void 0 ? void 0 : initialItem.length) !== null && _initialItem$length !== void 0 ? _initialItem$length : \"\",\n    width: (_initialItem$width = initialItem === null || initialItem === void 0 ? void 0 : initialItem.width) !== null && _initialItem$width !== void 0 ? _initialItem$width : \"\",\n    height: (_initialItem$height = initialItem === null || initialItem === void 0 ? void 0 : initialItem.height) !== null && _initialItem$height !== void 0 ? _initialItem$height : \"\",\n    poNumber: (_initialItem$poNumber = initialItem === null || initialItem === void 0 ? void 0 : initialItem.poNumber) !== null && _initialItem$poNumber !== void 0 ? _initialItem$poNumber : \"\",\n    trackingNumber: (_initialItem$tracking = initialItem === null || initialItem === void 0 ? void 0 : initialItem.trackingNumber) !== null && _initialItem$tracking !== void 0 ? _initialItem$tracking : \"\",\n    localSN: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.localSN) || \"\",\n    arrival_date: (initialItem === null || initialItem === void 0 ? void 0 : initialItem.arrival_date) || \"\",\n    visible: (_initialItem$visible = initialItem === null || initialItem === void 0 ? void 0 : initialItem.visible) !== null && _initialItem$visible !== void 0 ? _initialItem$visible : true\n  });\n  const {\n    0: savedName,\n    1: setSavedName\n  } = useState((initialItem === null || initialItem === void 0 ? void 0 : initialItem.name) || \"\"); // ⬇️ put this INSIDE DisplayItem, after the related useState hooks\n\n  useEffect(() => {\n    if (!initialItem) return;\n    setDescriptions(initialItem.descriptions || []);\n    setWorkOrders(initialItem.workOrders || []);\n    setDOM(initialItem.DOM || \"\");\n    setItems(prev => {\n      var _ref, _initialItem$status2, _ref2, _initialItem$price2, _ref3, _initialItem$length2, _ref4, _initialItem$width2, _ref5, _initialItem$height2, _ref6, _initialItem$poNumber2, _ref7, _initialItem$tracking2;\n\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        // only overwrite if SSR provided a value; otherwise keep what you have\n        status: (_ref = (_initialItem$status2 = initialItem.status) !== null && _initialItem$status2 !== void 0 ? _initialItem$status2 : prev.status) !== null && _ref !== void 0 ? _ref : \"\",\n        price: (_ref2 = (_initialItem$price2 = initialItem.price) !== null && _initialItem$price2 !== void 0 ? _initialItem$price2 : prev.price) !== null && _ref2 !== void 0 ? _ref2 : \"\",\n        length: (_ref3 = (_initialItem$length2 = initialItem.length) !== null && _initialItem$length2 !== void 0 ? _initialItem$length2 : prev.length) !== null && _ref3 !== void 0 ? _ref3 : \"\",\n        width: (_ref4 = (_initialItem$width2 = initialItem.width) !== null && _initialItem$width2 !== void 0 ? _initialItem$width2 : prev.width) !== null && _ref4 !== void 0 ? _ref4 : \"\",\n        height: (_ref5 = (_initialItem$height2 = initialItem.height) !== null && _initialItem$height2 !== void 0 ? _initialItem$height2 : prev.height) !== null && _ref5 !== void 0 ? _ref5 : \"\",\n        poNumber: (_ref6 = (_initialItem$poNumber2 = initialItem.poNumber) !== null && _initialItem$poNumber2 !== void 0 ? _initialItem$poNumber2 : prev.poNumber) !== null && _ref6 !== void 0 ? _ref6 : \"\",\n        trackingNumber: (_ref7 = (_initialItem$tracking2 = initialItem.trackingNumber) !== null && _initialItem$tracking2 !== void 0 ? _initialItem$tracking2 : prev.trackingNumber) !== null && _ref7 !== void 0 ? _ref7 : \"\"\n      });\n    });\n\n    if (initialItem.name) {\n      setSavedName(initialItem.name);\n    }\n  }, [initialItem]);\n  const {\n    0: newLocalFrom,\n    1: setNewLocalFrom\n  } = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  });\n  const {\n    0: newLocalCurrent,\n    1: setNewLocalCurrent\n  } = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  }); // New states for separate client selections:\n\n  const {\n    0: selectedClientFrom,\n    1: setSelectedClientFrom\n  } = useState(null);\n  const {\n    0: selectedClientCurrent,\n    1: setSelectedClientCurrent\n  } = useState(null);\n  const {\n    0: selectedMachine,\n    1: setSelectedMachine\n  } = useState(null);\n  const {\n    0: selectedCurrentMachine,\n    1: setSelectedCurrentMachine\n  } = useState(null); // whenever you pick a new “From” client or machine, clear the old From-loc:\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientFrom, selectedMachine]);\n  // const didMountFrom = useRef(false);\n  // useEffect(() => {\n  //   if (!didMountFrom.current) {\n  //     // first time through (the data-load phase), don’t clear\n  //     didMountFrom.current = true;\n  //     return;\n  //   }\n  //   // thereafter, when the user picks a new client or machine, clear:\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  //   setLocalLocFrom(\"\");\n  // }, [selectedClientFrom, selectedMachine]);\n  // whenever you pick a new “Current” client or machine, clear the old Current-loc:\n  // useEffect(() => {\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // const [didFetch, setDidFetch] = useState(false);\n  // useEffect(() => {\n  //   if (!didFetch) {\n  //     // we’re in the data-load phase, skip clearing\n  //     setDidFetch(true);\n  //     return;\n  //   }\n  //   // only clear on subsequent user changes:\n  //   setNewLocalCurrent({ region: \"\", section: {}, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // These arrays will be populated from Firebase.\n\n  const {\n    0: pnOptions,\n    1: setPnOptions\n  } = useState([]);\n  const {\n    0: snOptions,\n    1: setSnOptions\n  } = useState([]);\n  const {\n    0: pnSnLoaded,\n    1: setPnSnLoaded\n  } = useState(false);\n  const {\n    0: pnSnLoading,\n    1: setPnSnLoading\n  } = useState(false);\n  const {\n    0: descriptions,\n    1: setDescriptions\n  } = useState([{\n    description: \"\",\n    date: \"\"\n  }]);\n  const {\n    0: workOrders,\n    1: setWorkOrders\n  } = useState([{\n    workOrder: \"\",\n    date: \"\"\n  }]);\n  const {\n    0: clients,\n    1: setClients\n  } = useState([]);\n  const {\n    0: clientsLoaded,\n    1: setClientsLoaded\n  } = useState(false);\n  const {\n    0: clientsLoading,\n    1: setClientsLoading\n  } = useState(false);\n  const {\n    0: photos,\n    1: setPhotos\n  } = useState([]);\n  const {\n    0: show,\n    1: setShow\n  } = useState(false);\n  const {\n    0: showErr,\n    1: setShowErr\n  } = useState(false);\n  const {\n    0: Err,\n    1: setErr\n  } = useState(\"N/A\");\n  const {\n    0: showDescModal,\n    1: setShowDescModal\n  } = useState(false);\n  const {\n    0: showWoModal,\n    1: setShowWoModal\n  } = useState(false);\n  const {\n    0: showClientModal,\n    1: setShowClientModal\n  } = useState(false);\n  const {\n    0: showMachineModal,\n    1: setShowMachineModal\n  } = useState(false);\n  const {\n    0: showParentModal,\n    1: setShowParentModal\n  } = useState(false);\n  const {\n    0: showCameraModal,\n    1: setShowCameraModal\n  } = useState(false);\n  const {\n    0: showSaveModal,\n    1: setShowSaveModal\n  } = useState(false);\n  const {\n    0: showPrintModal,\n    1: setShowPrintModal\n  } = useState(false);\n  const {\n    0: machineSelectionModal,\n    1: setMachineSelectionModal\n  } = useState(false);\n  const {\n    0: selectedDesc,\n    1: setSelectedDesc\n  } = useState(0);\n  const {\n    0: selectedClient,\n    1: setSelectedClient\n  } = useState(null);\n  const {\n    0: selectedParent,\n    1: setSelectedParent\n  } = useState(null);\n  const {\n    0: TheMachine,\n    1: setTheMachine\n  } = useState(null);\n  const {\n    0: machineOptions,\n    1: setMachineOptions\n  } = useState([]);\n  const {\n    0: search,\n    1: setSearch\n  } = useState(\"\");\n  const {\n    0: capturedPhoto,\n    1: setCapturedPhoto\n  } = useState(null);\n  const {\n    0: cameraFacing,\n    1: setCameraFacing\n  } = useState(\"environment\");\n  const {\n    0: addToWebsite,\n    1: setAddToWebsite\n  } = useState(false);\n  const {\n    0: machinePick,\n    1: setMachinePick\n  } = useState(false);\n  const {\n    0: freqItem,\n    1: setFreqItem\n  } = useState(0);\n  const {\n    0: usagePastYear,\n    1: setUsagePastYear\n  } = useState(0);\n  const {\n    0: machineFrequency,\n    1: setMachineFrequency\n  } = useState(0); // State for the extra (dimensions/price/DOM/PO Number) section.\n\n  const {\n    0: showExtra,\n    1: setShowExtra\n  } = useState(false);\n  const {\n    0: trackerCatalog,\n    1: setTrackerCatalog\n  } = useState({\n    modalities: [],\n    oemsByModality: {},\n    modelsByModalityOem: {},\n    meta: {}\n  });\n  const {\n    0: trackerLoading,\n    1: setTrackerLoading\n  } = useState(false); // State for the local warehouse location inputs.\n\n  const {\n    0: localLocFrom,\n    1: setLocalLocFrom\n  } = useState(\"\");\n  const {\n    0: localLocCurrent,\n    1: setLocalLocCurrent\n  } = useState(\"\"); // New state for DOM (Date of Manufacture)\n\n  const {\n    0: DOM,\n    1: setDOM\n  } = useState(\"\"); // New state for OEM, Modality, and Model (multi-select).\n\n  const {\n    0: selectedModalities,\n    1: setSelectedModalities\n  } = useState([]);\n  const {\n    0: selectedOems,\n    1: setSelectedOems\n  } = useState([]);\n  const {\n    0: selectedModels,\n    1: setSelectedModels\n  } = useState([]);\n\n  const applyMergedMachineFields = (merged, {\n    force = false\n  } = {}) => {\n    if (!merged) return;\n    const nextOems = uniqueSelection(normalizeSelection(merged.oem));\n    const nextModalities = uniqueSelection(normalizeSelection(merged.modality));\n    const nextModels = uniqueSelection(normalizeSelection(merged.model));\n    setSelectedOems(prev => {\n      if (!force && prev.length) return prev;\n      return nextOems;\n    });\n    setSelectedModalities(prev => {\n      if (!force && prev.length) return prev;\n      return nextModalities;\n    });\n    setSelectedModels(prev => {\n      if (!force && prev.length) return prev;\n      return nextModels;\n    });\n  }; // More info modal state.\n\n\n  const {\n    0: showInfoModal,\n    1: setShowInfoModal\n  } = useState(false);\n  const {\n    0: itemName,\n    1: setItemName\n  } = useState(\"\");\n  const {\n    0: machineFieldsInitialized,\n    1: setMachineFieldsInitialized\n  } = useState(false);\n  const {\n    0: isLoading,\n    1: setIsLoading\n  } = useState(true); // near the top of DisplayItem()\n\n  const {\n    0: showLocalModalFrom,\n    1: setShowLocalModalFrom\n  } = useState(false);\n  const {\n    0: showLocalModalCurrent,\n    1: setShowLocalModalCurrent\n  } = useState(false);\n\n  const openLocalModalFrom = () => setShowLocalModalFrom(true);\n\n  const closeLocalModalFrom = () => setShowLocalModalFrom(false);\n\n  const openLocalModalCurrent = () => setShowLocalModalCurrent(true);\n\n  const closeLocalModalCurrent = () => setShowLocalModalCurrent(false); // at the top of DisplayItem()\n\n\n  const {\n    0: showNewLocalModalFrom,\n    1: setShowNewLocalModalFrom\n  } = useState(false);\n  const {\n    0: showNewLocalModalCurrent,\n    1: setShowNewLocalModalCurrent\n  } = useState(false); // when the From-client changes, clear any old local-loc\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientFrom]);\n  // // when the From-machine changes, clear any old local-loc\n  // useEffect(() => {\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedMachine]);\n  // same for Current:\n  // useEffect(() => {\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\n  // const handleSendToInflow = async () => {\n  //   try {\n  //     const name = items.name;\n  //     const description = descriptions[selectedDesc]?.description || \"\";\n  //     // gather every photo URL from Firebase Storage\n  //     const imageUrls = photos.map((p) => p.url);\n  //     await InflowAPI.upsertProduct({ name, description, imageUrls });\n  //     alert(\"Sent to inFlow successfully!\");\n  //   } catch (err) {\n  //     console.error(err);\n  //     alert(\"Error sending to inFlow: \" + err.message);\n  //   }\n  // };\n\n  const handleSendToInflow = async () => {\n    try {\n      var _descriptions$selecte;\n\n      const name = (items.name || '').trim();\n\n      if (!name) {\n        alert('Item needs a name before sending to inFlow.');\n        return;\n      } // Regular description (don’t also send a custom “Description” unless you truly have one)\n\n\n      const description = (((_descriptions$selecte = descriptions[selectedDesc]) === null || _descriptions$selecte === void 0 ? void 0 : _descriptions$selecte.description) || '').trim(); // Photos already fetched from storage\n\n      const imageUrls = photos.map(p => p.url).filter(Boolean); // SKU = your item id\n\n      const sku = (id !== null && id !== void 0 ? id : '').toString(); // Basic normalizers\n\n      const toCSV = arr => Array.isArray(arr) ? arr.filter(Boolean).join(', ') : arr || ''; // YYYY-MM-DD for the date field in inFlow\n\n\n      const arrivalISO = items.arrival_date ? new Date(items.arrival_date).toISOString().slice(0, 10) : '';\n      const pnStr = Array.isArray(items.pn) ? items.pn.filter(Boolean).join(', ') : items.pn || '';\n      const snStr = Array.isArray(items.sn) ? items.sn.filter(Boolean).join(', ') : items.sn || ''; // Most recent WO (you already have this)\n\n      const mostRecentWO = workOrders !== null && workOrders !== void 0 && workOrders.length ? workOrders.reduce((latest, cur) => new Date(cur.date) > new Date(latest.date) ? cur : latest, workOrders[0]) : {\n        workOrder: '',\n        date: ''\n      }; // Build the numbered fields (match your inFlow “Field 1..10”)\n\n      const customFields = {\n        custom1: selectionToPrintValue(selectedOems),\n        // OEM   (dropdown)\n        custom2: selectionToPrintValue(selectedModalities),\n        // Modality (dropdown)\n        custom3: selectionToPrintValue(selectedModels),\n        // Model (dropdown)\n        custom4: (description || '').trim(),\n        // Description (text) - optional duplicate\n        custom5: (mostRecentWO.workOrder || '').trim(),\n        // Work Order (text)\n        custom6: ((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : selectedClientFrom.name) || '').trim(),\n        // From (text)\n        custom7: pnStr,\n        // Product Number (text)\n        custom8: snStr,\n        // Serial Number (text)\n        custom9: arrivalISO,\n        // Arrival Date (date)\n        custom10: ((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : selectedClientCurrent.name) || '').trim() // Current (text)\n\n      };\n      console.log('[inFlow] customFields to send (numbered):', customFields);\n      const created = await InflowAPI.upsertProduct({\n        name,\n        description,\n        sku,\n        imageUrls,\n        customFields\n      });\n      alert(`Sent to inFlow successfully. ID: ${(created === null || created === void 0 ? void 0 : created.productId) || (created === null || created === void 0 ? void 0 : created.id) || '(unknown)'}`);\n    } catch (err) {\n      console.error(err);\n      alert('Error sending to inFlow: ' + err.message);\n    }\n  }; // const [storedMachine, setStoredMachine] = useState(null);\n  // useEffect(() => {\n  //   // once any of these three change, re-merge:\n  //   if (TheMachine || selectedCurrentMachine || selectedMachine) {\n  //     const merged = updateMachineFields(\n  //       TheMachine,\n  //       selectedCurrentMachine,\n  //       selectedMachine\n  //     );\n  //     setOem(merged.oem);\n  //     setModality(merged.modality);\n  //     setModel(merged.model);\n  //   }\n  // }, [TheMachine, selectedCurrentMachine, selectedMachine]);\n  // whenever the “From” client changes:\n\n\n  useEffect(() => {\n    var _selectedClientFrom$n;\n\n    setShowLocalLocFrom((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n = selectedClientFrom.name) === null || _selectedClientFrom$n === void 0 ? void 0 : _selectedClientFrom$n.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientFrom]); // whenever the “Current” client changes:\n\n  useEffect(() => {\n    var _selectedClientCurren;\n\n    setShowLocalLocCurrent((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren = selectedClientCurrent.name) === null || _selectedClientCurren === void 0 ? void 0 : _selectedClientCurren.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientCurrent]);\n\n  const loadClients = async () => {\n    if (clientsLoaded || clientsLoading) return;\n    setClientsLoading(true);\n\n    try {\n      const clientsData = await fetchClients();\n      setClients(clientsData);\n      setClientsLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching clients: \", error);\n    } finally {\n      setClientsLoading(false);\n    }\n  };\n\n  const loadTracker = useCallback(async (force = false) => {\n    if (trackerLoading) return;\n    if (!force && trackerCatalog.modalities.length) return;\n    setTrackerLoading(true);\n\n    try {\n      const catalog = await fetchTrackerCatalog();\n      setTrackerCatalog(catalog);\n    } catch (error) {\n      console.error(\"Failed to load tracker catalog:\", error);\n    } finally {\n      setTrackerLoading(false);\n    }\n  }, [trackerLoading, trackerCatalog.modalities.length]);\n  useEffect(() => {\n    loadTracker();\n  }, [loadTracker]);\n  const allOemOptions = useMemo(() => buildAllOems(trackerCatalog), [trackerCatalog]);\n  const modelOptions = useMemo(() => buildModelsForSelection(trackerCatalog, selectedModalities, selectedOems), [trackerCatalog, selectedModalities, selectedOems]); // Keep selected models even if they are not in the catalog yet.\n\n  const modalityOptionsForUI = useMemo(() => mergeOptionsWithSelection(trackerCatalog.modalities, selectedModalities), [trackerCatalog.modalities, selectedModalities]);\n  const oemOptionsForUI = useMemo(() => mergeOptionsWithSelection(allOemOptions, selectedOems), [allOemOptions, selectedOems]);\n  const modelOptionsForUI = useMemo(() => mergeOptionsWithSelection(modelOptions, selectedModels), [modelOptions, selectedModels]); // Tracker updates are only performed on Save.\n\n  const handleDeleteOemOption = useCallback(async oem => {\n    if (!oem) return;\n\n    try {\n      await deleteTrackerOem({\n        oem,\n        catalog: trackerCatalog\n      });\n      setSelectedOems(prev => prev.filter(value => value !== oem));\n      loadTracker(true);\n    } catch (error) {\n      console.error(\"Failed to delete OEM:\", error);\n    }\n  }, [trackerCatalog, loadTracker]);\n  const handleDeleteModelOption = useCallback(async model => {\n    if (!model || !selectedModalities.length || !selectedOems.length) return;\n\n    try {\n      const ops = [];\n      selectedModalities.forEach(modalityValue => {\n        selectedOems.forEach(oemValue => {\n          ops.push(deleteTrackerModel({\n            modality: modalityValue,\n            oem: oemValue,\n            model,\n            catalog: trackerCatalog\n          }));\n        });\n      });\n      await Promise.allSettled(ops);\n      setSelectedModels(prev => prev.filter(value => value !== model));\n      loadTracker(true);\n    } catch (error) {\n      console.error(\"Failed to delete model:\", error);\n    }\n  }, [selectedModalities, selectedOems, trackerCatalog, loadTracker]);\n\n  const loadPnSnOptions = async () => {\n    if (pnSnLoaded || pnSnLoading) return;\n    setPnSnLoading(true);\n\n    try {\n      const db = firebase.firestore();\n      const snapshot = await db.collection(\"Test\").orderBy(firebase.firestore.FieldPath.documentId()).limit(500).get();\n      let pnSet = new Set();\n      let snSet = new Set();\n      snapshot.forEach(doc => {\n        const data = doc.data();\n\n        if (Array.isArray(data.pn)) {\n          data.pn.forEach(pn => pn && pnSet.add(pn));\n        } else if (data.pn) {\n          pnSet.add(data.pn);\n        }\n\n        if (Array.isArray(data.sn)) {\n          data.sn.forEach(sn => sn && snSet.add(sn));\n        } else if (data.sn) {\n          snSet.add(data.sn);\n        }\n      });\n      setPnOptions([...pnSet]);\n      setSnOptions([...snSet]);\n      setPnSnLoaded(true);\n    } catch (error) {\n      console.error(\"Error fetching PN/SN options:\", error);\n    } finally {\n      setPnSnLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    if (id) fetchData(); // always hydrate on the client\n  }, [id]);\n\n  async function resolveClientFromMachine(machineRef, setClient, setMachine, isFrom = true) {\n    const machineDoc = await machineRef.get();\n\n    if (machineDoc.exists) {\n      var _machineData$name;\n\n      const machineData = machineDoc.data();\n      setMachine(_objectSpread({\n        id: machineDoc.id\n      }, machineData)); // Determine if the machine is \"interior socal\"\n      // const isSocalInterior = machineData.name && machineData.name.toLowerCase() === \"interior socal\";\n      // if (isSocalInterior) {\n      //   if (isFrom) {\n      //     setShowLocalLocFrom(true);\n      //   } else {\n      //     setShowLocalLocCurrent(true);\n      //   }\n      // } else {\n      // Optionally clear the flag if it is not \"interior socal\"\n      // if (isFrom) {\n      //   setShowLocalLocFrom(false);\n      // } else {\n      //   setShowLocalLocCurrent(false);\n      // }\n      // }\n      // new: fetch client name and combine both checks\n\n      const clientDoc = machineData.client && typeof machineData.client.get === \"function\" ? await machineData.client.get() : null;\n      const clientName = clientDoc && clientDoc.exists ? clientDoc.data().name : null;\n      const isSocalInterior = ((_machineData$name = machineData.name) === null || _machineData$name === void 0 ? void 0 : _machineData$name.toLowerCase()) === \"interior socal\";\n      const shouldShow = isSocalInterior || clientName === \"SoCalWarehouse\";\n\n      if (isFrom) {\n        setShowLocalLocFrom(shouldShow);\n      } else {\n        setShowLocalLocCurrent(shouldShow);\n      }\n\n      if (machineData.client && typeof machineData.client.get === \"function\") {\n        const clientDoc = await machineData.client.get();\n\n        if (clientDoc.exists) {\n          setClient(_objectSpread({\n            id: clientDoc.id\n          }, clientDoc.data()));\n        }\n      }\n    }\n  }\n\n  const fetchData = async () => {\n    const id = (initialItem === null || initialItem === void 0 ? void 0 : initialItem.id) || idFromRouter; // <- make sure id exists here\n\n    if (!id) return;\n    setIsLoading(true);\n    const db = firebase.firestore();\n\n    try {\n      const doc = await db.collection(\"Test\").doc(id).get();\n\n      if (doc.exists) {\n        var _machineFromData, _machineFromData$name, _machineCurrentData, _machineCurrentData$n, _selectedClientFrom$n2, _selectedClientCurren2;\n\n        console.log(\"test\");\n        const data = doc.data();\n        const normalizedPN = Array.isArray(data.pn) ? data.pn : [data.pn];\n        const normalizedSN = Array.isArray(data.sn) ? data.sn : [data.sn];\n        setItems(_objectSpread(_objectSpread({}, data), {}, {\n          pn: normalizedPN,\n          sn: normalizedSN\n        }));\n        setSavedName(data.name || \"\");\n        setDescriptions(data.descriptions || []);\n        setWorkOrders(data.workOrders || []);\n        if (data.localLocFrom) setLocalLocFrom(data.localLocFrom);\n        if (data.localLocCurrent) setLocalLocCurrent(data.localLocCurrent);\n\n        if (data.DOM) {\n          setDOM(data.DOM);\n        } // …after you do setItems, setDescriptions, etc.\n        // load the “newLocal” maps\n\n\n        if (data.newLocalFrom) setNewLocalFrom(data.newLocalFrom);\n        if (data.newLocalCurrent) setNewLocalCurrent(data.newLocalCurrent); // Load PO Number if it exists.\n\n        if (data.poNumber) {\n          setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n            poNumber: data.poNumber\n          }));\n        }\n\n        if (data.ClientFrom) {\n          const clientFromDoc = await data.ClientFrom.get();\n\n          if (clientFromDoc.exists) {\n            setSelectedClientFrom(_objectSpread({\n              id: clientFromDoc.id\n            }, clientFromDoc.data()));\n          }\n        }\n\n        if (data.ClientCurrent) {\n          const clientCurrentDoc = await data.ClientCurrent.get();\n\n          if (clientCurrentDoc.exists) {\n            setSelectedClientCurrent(_objectSpread({\n              id: clientCurrentDoc.id\n            }, clientCurrentDoc.data()));\n          }\n        }\n\n        if (!data.ClientFrom && data.Machine && typeof data.Machine.get === \"function\") {\n          console.log(\"Entered resolveClientFromMachine for Machine (old style for From)\");\n          await resolveClientFromMachine(data.Machine, setSelectedClientFrom, setSelectedMachine, true);\n        }\n\n        if (!data.ClientCurrent && data.CurrentMachine && typeof data.CurrentMachine.get === \"function\") {\n          console.log(\"Entered resolveClientFromMachine for CurrentMachine (old style for Current)\");\n          await resolveClientFromMachine(data.CurrentMachine, setSelectedClientCurrent, setSelectedCurrentMachine, false);\n        }\n\n        let machineFromData = null;\n        let machineCurrentData = null;\n\n        if (data.MachineFrom) {\n          const doc = await data.MachineFrom.get();\n          machineFromData = doc.exists ? doc.data() : null;\n          setSelectedMachine(_objectSpread({\n            id: doc.id\n          }, doc.data()));\n        }\n\n        if (data.MachineCurrent) {\n          const doc = await data.MachineCurrent.get();\n          machineCurrentData = doc.exists ? doc.data() : null;\n          setSelectedCurrentMachine(_objectSpread({\n            id: doc.id\n          }, doc.data()));\n        }\n\n        const nameFrom = (_machineFromData = machineFromData) === null || _machineFromData === void 0 ? void 0 : (_machineFromData$name = _machineFromData.name) === null || _machineFromData$name === void 0 ? void 0 : _machineFromData$name.toLowerCase();\n        const nameCurrent = (_machineCurrentData = machineCurrentData) === null || _machineCurrentData === void 0 ? void 0 : (_machineCurrentData$n = _machineCurrentData.name) === null || _machineCurrentData$n === void 0 ? void 0 : _machineCurrentData$n.toLowerCase(); // If the machine’s name is “interior socal”, show that branch:\n        // setShowLocalLocFrom(nameFrom === \"interior socal\");\n        // // Or if your Firestore already has a value for localLocFrom, show it anyway:\n        // if (data.localLocFrom) setShowLocalLocFrom(true);\n        // setShowLocalLocCurrent(nameCurrent === \"interior socal\");\n        // if (data.localLocCurrent) setShowLocalLocCurrent(true);\n        // new: combine machine-name OR client-name check, keep existing-data\n\n        setShowLocalLocFrom(nameFrom === \"interior socal\" || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n2 = selectedClientFrom.name) === null || _selectedClientFrom$n2 === void 0 ? void 0 : _selectedClientFrom$n2.toLowerCase()) === \"socalwarehouse\" || Boolean(data.localLocFrom));\n        setShowLocalLocCurrent(nameCurrent === \"interior socal\" || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren2 = selectedClientCurrent.name) === null || _selectedClientCurren2 === void 0 ? void 0 : _selectedClientCurren2.toLowerCase()) === \"socalwarehouse\" || Boolean(data.localLocCurrent));\n        const theMachineData = data.TheMachine || null;\n        setTheMachine(theMachineData);\n\n        if (theMachineData) {\n          var _theMachineData$oem, _theMachineData$modal, _theMachineData$model;\n\n          // pull both variants, prefer lowercase if it exists\n          const OEM = (_theMachineData$oem = theMachineData.oem) !== null && _theMachineData$oem !== void 0 ? _theMachineData$oem : theMachineData.OEM;\n          const Modality = (_theMachineData$modal = theMachineData.modality) !== null && _theMachineData$modal !== void 0 ? _theMachineData$modal : theMachineData.Modality;\n          const Model = (_theMachineData$model = theMachineData.model) !== null && _theMachineData$model !== void 0 ? _theMachineData$model : theMachineData.Model;\n          setTheMachine(_objectSpread(_objectSpread({}, theMachineData), {}, {\n            OEM,\n            Modality,\n            Model\n          }));\n        } // setStoredMachine(theMachineData);\n        // **right here** merge from the three sources you just fetched:\n\n\n        const merged = updateMachineFields(theMachineData, machineCurrentData, machineFromData);\n        applyMergedMachineFields(merged);\n        console.log(\"SelectedMachine:\", selectedMachine, \"SelectedCurrentMachine:\", selectedCurrentMachine); // Show local loc inputs if applicable\n        // if (\n        //   selectedMachine &&\n        //   selectedMachine.name &&\n        //   selectedMachine.name.toLowerCase() === \"interior socal\"\n        // ) {\n        //   setShowLocalLocFrom(true);\n        // }\n        // if (\n        //   selectedCurrentMachine &&\n        //   selectedCurrentMachine.name &&\n        //   selectedCurrentMachine.name.toLowerCase() === \"interior socal\"\n        // ) {\n        //   setShowLocalLocCurrent(true);\n        // }\n\n        if (data.Parent) {\n          const parentDoc = await data.Parent.get();\n          setSelectedParent(_objectSpread({\n            id: parentDoc.id\n          }, parentDoc.data()));\n        } // Priority auto‑population of machine fields.\n        // const updatedFields = updateMachineFields(storedMachine, selectedCurrentMachine, selectedMachine);\n        // // console.log(\"Updated machine fields:\", updatedFields);\n        // setOem(updatedFields.oem);\n        // setModality(updatedFields.modality);\n        // setModel(updatedFields.model);\n\n\n        setIsLoading(false);\n        Promise.all([fetchPhotos(id), checkIfAddedToWebsite(id), calculateItemFrequencyAndUsage(data.pn)]).catch(err => {\n          console.error(\"Background item loads failed:\", err);\n        });\n      } else {\n        router.push({\n          pathname: \"../AddItem/NewItem\",\n          query: {\n            signal: id\n          }\n        });\n      }\n    } catch (error) {\n      console.error(\"Error fetching item:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const calculateItemFrequencyAndUsage = async pn => {\n    const db = firebase.firestore();\n    const currentDate = new Date();\n    const oneYearAgo = new Date();\n    oneYearAgo.setFullYear(currentDate.getFullYear() - 1);\n    const normalizedPN = pn !== undefined ? pn : \"\";\n    const itemsSnapshot = await db.collection(\"Test\").where(\"pn\", \"==\", normalizedPN).get();\n    setFreqItem(itemsSnapshot.size);\n    let usagePastYear = 0;\n    itemsSnapshot.forEach(doc => {\n      const itemData = doc.data();\n      itemData.workOrders.forEach(workOrder => {\n        const workOrderDate = new Date(workOrder.date);\n\n        if (workOrderDate >= oneYearAgo && workOrderDate <= currentDate) {\n          usagePastYear++;\n        }\n      });\n    });\n    setUsagePastYear(usagePastYear);\n  };\n\n  const fetchMachine = async machineId => {\n    const db = firebase.firestore();\n    const doc = await db.collection(\"Machine\").doc(machineId).get();\n\n    if (doc.exists) {\n      const machineData = doc.data();\n      setTheMachine(machineData); // re-merge all three sources with correct priority:\n\n      const merged = updateMachineFields(machineData, selectedCurrentMachine, selectedMachine);\n      applyMergedMachineFields(merged, {\n        force: true\n      });\n      const machinesSnapshot = await db.collection(\"Machine\").where(\"Model\", \"==\", machineData.Model || machineData.model).get();\n      setMachineFrequency(machinesSnapshot.size);\n    } else {\n      console.error(\"Machine not found\");\n    }\n  };\n\n  const fetchPhotos = async docID => {\n    const storageRef = firebase.storage().ref();\n    const listRef = storageRef.child(`Parts/${docID}`);\n\n    try {\n      const res = await listRef.listAll();\n      const urls = await Promise.all(res.items.map(item => item.getDownloadURL()));\n      setPhotos(urls.map(url => ({\n        url,\n        file: null\n      })));\n    } catch (error) {\n      console.error(\"Error fetching photos: \", error);\n    }\n  };\n\n  const checkIfAddedToWebsite = async docID => {\n    const db = firebase.firestore();\n    const partsDoc = await db.collection(\"Parts\").doc(docID).get();\n\n    if (partsDoc.exists) {\n      setAddToWebsite(true);\n    }\n  };\n\n  const handleClose = () => setShow(false);\n\n  const handleShow = () => setShow(true);\n\n  const handleCloseErr = () => setShowErr(false);\n\n  const handleShowErr = () => setShowErr(true);\n\n  const handleCloseSaveModal = () => setShowSaveModal(false);\n\n  const handleClosePrintModal = () => setShowPrintModal(false);\n\n  const handleShowSaveModal = () => setShowSaveModal(true);\n\n  const handleShowPrintModal = () => setShowPrintModal(true);\n\n  const handleMachineSelectionModal = () => setMachineSelectionModal(false);\n\n  const handleCloseDescModal = () => setShowDescModal(false);\n\n  const handleShowDescModal = () => setShowDescModal(true);\n\n  const handleCloseWoModal = () => setShowWoModal(false);\n\n  const handleShowWoModal = () => setShowWoModal(true);\n\n  const handleCloseClientModal = () => setShowClientModal(false);\n\n  const handleShowClientModal = async () => {\n    await loadClients();\n    setShowClientModal(true);\n  };\n\n  const handleCloseMachineModal = () => setShowMachineModal(false);\n\n  const handleShowMachineModal = () => {\n    setShowMachineModal(true);\n    setShowClientModal(false);\n  };\n\n  const handleCloseParentModal = () => setShowParentModal(false);\n\n  const handleShowParentModal = () => setShowParentModal(true); // When a client is selected from the client table.\n\n\n  const handleClientInfo = async clientId => {\n    // Clear any previously selected machine and local loc info for this branch.\n    if (machinePick) {\n      setSelectedMachine(null);\n      setShowLocalLocFrom(false);\n    } else {\n      setSelectedCurrentMachine(null);\n      setShowLocalLocCurrent(false);\n    }\n\n    const db = firebase.firestore();\n    const clientDoc = await db.collection(\"Client\").doc(clientId).get();\n\n    if (clientDoc.exists) {\n      const clientData = _objectSpread({\n        id: clientDoc.id\n      }, clientDoc.data());\n\n      if (machinePick) {\n        setSelectedClientFrom(clientData);\n      } else {\n        setSelectedClientCurrent(clientData);\n      } // after setting selectedClientFrom/Current:\n\n\n      if (clientData.name === \"SoCalWarehouse\") {\n        if (machinePick) setShowLocalLocFrom(true);else setShowLocalLocCurrent(true);\n      } // Fetch machines for this client:\n\n\n      const machinePromises = clientData.machines.map(machineRef => machineRef.get());\n      const machineDocs = await Promise.all(machinePromises);\n      const machines = machineDocs.map(machineDoc => _objectSpread({\n        id: machineDoc.id\n      }, machineDoc.data()));\n      setMachineOptions(machines); // Close the client modal\n\n      handleCloseClientModal();\n    }\n  }; // Reordering function for dropdowns.\n\n\n  const reorderArray = (arr, selectedValue) => {\n    const newArr = arr.filter(val => val !== selectedValue);\n    return [selectedValue, ...newArr];\n  };\n\n  const {\n    0: addingNewPn,\n    1: setAddingNewPn\n  } = useState(false);\n  const {\n    0: newPn,\n    1: setNewPn\n  } = useState(\"\");\n  const {\n    0: addingNewSn,\n    1: setAddingNewSn\n  } = useState(false);\n  const {\n    0: newSn,\n    1: setNewSn\n  } = useState(\"\");\n\n  const handlePnSelect = e => {\n    const selected = e.target.value;\n    setItems(prev => {\n      let updatedPn = Array.isArray(prev.pn) ? [...prev.pn] : [];\n      updatedPn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: updatedPn\n      });\n    });\n  };\n\n  const handleSnSelect = e => {\n    const selected = e.target.value;\n    setItems(prev => {\n      let updatedSn = Array.isArray(prev.sn) ? [...prev.sn] : [];\n      updatedSn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: updatedSn\n      });\n    });\n  };\n\n  const handleAddNewPn = () => {\n    if (newPn.trim() !== \"\") {\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        pn: [...prev.pn, newPn.trim()]\n      }));\n    }\n\n    setNewPn(\"\");\n    setAddingNewPn(false);\n  };\n\n  const handleAddNewSn = () => {\n    if (newSn.trim() !== \"\") {\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        sn: [...prev.sn, newSn.trim()]\n      }));\n    }\n\n    setNewSn(\"\");\n    setAddingNewSn(false);\n  }; // Generate custom document ID if needed.\n\n\n  const generateCustomID = () => {\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\n    return `AIS${randomNum}`;\n  };\n\n  function shallowClean(obj) {\n    const newObj = {};\n\n    for (const key in obj) {\n      console.log(key, obj[key]);\n\n      if (obj.hasOwnProperty(key)) {\n        newObj[key] = obj[key] === undefined ? \"\" : obj[key];\n      }\n    }\n\n    return newObj;\n  }\n\n  async function toSend() {\n    var _fromDetails$section, _fromDetails$section2, _currentDetails$secti, _currentDetails$secti2;\n\n    const db = firebase.firestore();\n    const currentUser = firebase.auth().currentUser;\n    const userEmail = currentUser ? currentUser.email : \"unknown\"; // Always use the current state values for OEM, modality, and model.\n\n    const storedOem = selectionToStoredValue(selectedOems);\n    const storedModality = selectionToStoredValue(selectedModalities);\n    const storedModel = selectionToStoredValue(selectedModels);\n\n    const machineData = _objectSpread(_objectSpread({}, TheMachine || {}), {}, {\n      oem: storedOem,\n      OEM: storedOem,\n      modality: storedModality,\n      Modality: storedModality,\n      model: storedModel,\n      Model: storedModel\n    });\n\n    const formattedItems = _objectSpread(_objectSpread({}, items), {}, {\n      descriptions,\n      workOrders\n    }); // Remove any unused fields.\n\n\n    formattedItems.status = items.status || \"\";\n    formattedItems.nameLower = (items.name || \"\").toLowerCase();\n    formattedItems.nameTokens = buildNameTokens(items.name);\n    formattedItems.DOM = DOM; // Date of Manufacture\n\n    formattedItems.localLocFrom = localLocFrom || \"\";\n    formattedItems.localLocCurrent = localLocCurrent || \"\";\n    formattedItems.date = items.date || \"\";\n    formattedItems.arrival_date = items.arrival_date || \"\"; // NEW: Arrival Date\n\n    formattedItems.poNumber = items.poNumber || \"\";\n    formattedItems.trackingNumber = items.trackingNumber || \"\";\n    formattedItems.TheMachine = machineData || {};\n    formattedItems.addedToWebsite = addToWebsite; // NEW: Add the user's email under the field \"user\"\n\n    formattedItems.lastEdited = userEmail; // Clean pn and sn arrays to replace undefined values with an empty string.\n\n    formattedItems.pn = (items.pn || []).map(value => value === undefined ? \"\" : value);\n    formattedItems.sn = (items.sn || []).map(value => value === undefined ? \"\" : value);\n    const fromDetails = buildLocalLocObject(newLocalFrom);\n    const currentDetails = buildLocalLocObject(newLocalCurrent);\n    console.log(\"From Details: \" + fromDetails.region + \" \" + ((_fromDetails$section = fromDetails.section) === null || _fromDetails$section === void 0 ? void 0 : _fromDetails$section.letter) + ((_fromDetails$section2 = fromDetails.section) === null || _fromDetails$section2 === void 0 ? void 0 : _fromDetails$section2.number) + \" \" + fromDetails.bin + \" \" + fromDetails.pallet);\n    console.log(\"Current Details: \" + currentDetails.region + \" \" + ((_currentDetails$secti = currentDetails.section) === null || _currentDetails$secti === void 0 ? void 0 : _currentDetails$secti.letter) + ((_currentDetails$secti2 = currentDetails.section) === null || _currentDetails$secti2 === void 0 ? void 0 : _currentDetails$secti2.number) + \" \" + currentDetails.bin + \" \" + currentDetails.pallet);\n\n    if (Object.keys(fromDetails).length) {\n      formattedItems.newLocalFrom = fromDetails;\n      formattedItems.localLocFrom = formatLoc(newLocalFrom) || \"\";\n    } else {\n      // all fields empty — force an empty string and remove any stray map\n      console.log(\"entered empty fromDetails else\");\n      formattedItems.localLocFrom = \"\";\n      formattedItems.newLocalFrom = {};\n    }\n\n    if (Object.keys(currentDetails).length) {\n      formattedItems.newLocalCurrent = currentDetails;\n      formattedItems.localLocCurrent = formatLoc(newLocalCurrent) || \"\";\n    } else {\n      // all fields empty — force an empty string and remove any stray map\n      formattedItems.localLocCurrent = \"\";\n      formattedItems.newLocalCurrent = {};\n    }\n\n    if (selectedMachine && selectedMachine.id) {\n      formattedItems.MachineFrom = db.collection(\"Machine\").doc(selectedMachine.id);\n    }\n\n    if (selectedCurrentMachine && selectedCurrentMachine.id) {\n      formattedItems.MachineCurrent = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n    }\n\n    if (selectedParent && selectedParent.id) {\n      formattedItems.Parent = db.collection(\"Test\").doc(selectedParent.id);\n    } // NEW: Set separate client references.\n\n\n    if (selectedClientFrom && selectedClientFrom.id) {\n      formattedItems.ClientFrom = db.collection(\"Client\").doc(selectedClientFrom.id);\n    }\n\n    if (selectedClientCurrent && selectedClientCurrent.id) {\n      formattedItems.ClientCurrent = db.collection(\"Client\").doc(selectedClientCurrent.id);\n    } // Only attach the richer “newLocal” map when the user actually filled something in\n\n\n    if (Object.keys(fromDetails).length) {\n      formattedItems.newLocalFrom = fromDetails;\n    }\n\n    if (Object.keys(currentDetails).length) {\n      formattedItems.newLocalCurrent = currentDetails;\n    }\n\n    let docId = id;\n\n    try {\n      if (docId) {\n        // Check if a localSN is provided and if it differs from the current docId.\n        const newDocId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : docId;\n\n        if (docId !== newDocId) {\n          // Migrate: Create a new document with the newDocId.\n          await db.collection(\"Test\").doc(newDocId).set(formattedItems);\n\n          if (selectedMachine && selectedMachine.id) {\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n            const machineDoc = await machineRef.get();\n\n            if (machineDoc.exists) {\n              await machineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(newDocId))\n              });\n            }\n          }\n\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\n            const currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n            const currentMachineDoc = await currentMachineRef.get();\n\n            if (currentMachineDoc.exists) {\n              await currentMachineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(newDocId))\n              });\n            }\n          } // Delete the old document.\n\n\n          await db.collection(\"Test\").doc(docId).delete(); // Set docId to the new document ID.\n\n          docId = newDocId;\n        } else {\n          // Deep-clean the formattedItems to remove any undefined nested values.\n          const cleanFormattedItems = shallowClean(formattedItems);\n          await db.collection(\"Test\").doc(docId).update(cleanFormattedItems);\n\n          if (selectedMachine && selectedMachine.id) {\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n            const machineDoc = await machineRef.get();\n\n            if (machineDoc.exists) {\n              await machineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n            }\n          }\n\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\n            const currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n            const currentMachineDoc = await currentMachineRef.get();\n\n            if (currentMachineDoc.exists) {\n              await currentMachineRef.update({\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n              });\n            }\n          }\n        }\n      } else {\n        // For a new item, if localSN is provided, use it; otherwise, generate a custom ID.\n        docId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : generateCustomID();\n        await db.collection(\"Test\").doc(docId).set(formattedItems);\n\n        if (selectedMachine && selectedMachine.id) {\n          const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\n          const machineDoc = await machineRef.get();\n\n          if (machineDoc.exists) {\n            await machineRef.update({\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n            });\n          }\n        }\n\n        if (selectedCurrentMachine && selectedCurrentMachine.id) {\n          const currentMachineRef = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n          const currentMachineDoc = await currentMachineRef.get();\n\n          if (currentMachineDoc.exists) {\n            await currentMachineRef.update({\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(docId))\n            });\n          }\n        }\n      } // Update Tracker only on Save.\n\n\n      try {\n        const selections = {\n          modalities: selectedModalities,\n          oems: selectedOems,\n          models: selectedModels\n        };\n        const updated = await syncTrackerFromSelections({\n          selections,\n          catalog: trackerCatalog\n        });\n\n        if (updated) {\n          loadTracker(true);\n        }\n      } catch (error) {\n        console.error(\"Failed to sync tracker selections:\", error);\n      } // Upload any new photos to Firebase Storage.\n\n\n      await uploadPhotos(docId);\n      console.log(\"Item saved and associatedParts updated!\");\n      setSavedName(items.name || \"\"); // Redirect to the new URL using the new document id.\n\n      router.push(`/NewSearch/item/${docId}`); // Optionally, you can also show a save confirmation modal:\n\n      handleShowSaveModal();\n    } catch (error) {\n      console.error(\"Error saving data:\", error);\n    }\n  } // Additional state for local warehouse location inputs.\n\n\n  const {\n    0: showLocalLocFrom,\n    1: setShowLocalLocFrom\n  } = useState(false);\n  const {\n    0: showLocalLocCurrent,\n    1: setShowLocalLocCurrent\n  } = useState(false); // When a machine is selected from the modal.\n\n  const handleSetSelectedMachine = machine => {\n    var _machine$name;\n\n    // const condition = (name) => name && name.toLowerCase() === \"interior socal\";\n    const isSocalInterior = ((_machine$name = machine.name) === null || _machine$name === void 0 ? void 0 : _machine$name.toLowerCase()) === \"interior socal\";\n\n    if (machinePick) {\n      var _selectedClientFrom$n3;\n\n      setSelectedMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocFrom(isSocalInterior || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n3 = selectedClientFrom.name) === null || _selectedClientFrom$n3 === void 0 ? void 0 : _selectedClientFrom$n3.toLowerCase()) === \"socalwarehouse\");\n    } else {\n      var _selectedClientCurren3;\n\n      setSelectedCurrentMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocCurrent(isSocalInterior || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren3 = selectedClientCurrent.name) === null || _selectedClientCurren3 === void 0 ? void 0 : _selectedClientCurren3.toLowerCase()) === \"socalwarehouse\");\n    }\n\n    fetchMachine(machine.id); // Close the machine modal (assuming you're using showMachineModal to control it)\n\n    setShowMachineModal(false);\n  };\n\n  const uploadPhotos = async docID => {\n    const storageRef = firebase.storage().ref();\n\n    for (let i = 0; i < photos.length; i++) {\n      if (photos[i].file) {\n        const photoRef = storageRef.child(`Parts/${docID}/${docID}${i === 0 ? \".jpg\" : `.${i + 1}.jpg`}`);\n        const metadata = {\n          contentType: \"image/png\"\n        };\n        await photoRef.put(photos[i].file, metadata);\n        const url = await photoRef.getDownloadURL();\n        photos[i].url = url;\n      }\n    }\n  }; // Function to handle printing the label.\n\n\n  const handlePrint = async () => {\n    if (!items.name) {\n      alert(\"Missing name\");\n      return;\n    }\n\n    let clientName = \"\"; // Attempt to fetch client name from the Machine document reference.\n\n    if (items.Machine && typeof items.Machine.get === \"function\") {\n      try {\n        const machineDoc = await items.Machine.get();\n\n        if (machineDoc.exists) {\n          const machineData = machineDoc.data();\n\n          if (machineData.client && typeof machineData.client.get === \"function\") {\n            const clientDoc = await machineData.client.get();\n\n            if (clientDoc.exists) {\n              clientName = clientDoc.data().name || \"\";\n            }\n          }\n        }\n      } catch (error) {\n        console.error(\"Error fetching machine or client:\", error);\n      }\n    } else {\n      console.warn(\"No Machine reference available in the item\");\n    }\n\n    console.log(clientName, \":\", items.client); // Fallback: if no client name was found, check items.client.\n\n    if (!clientName && items.client) {\n      if (typeof items.client.get === \"function\") {\n        try {\n          const clientDoc = await items.client.get();\n\n          if (clientDoc.exists) {\n            clientName = clientDoc.data().name || \"\";\n          }\n        } catch (error) {\n          console.error(\"Error fetching client from items.client:\", error);\n        }\n      } else {\n        clientName = items.client;\n      }\n    }\n\n    console.log(\"descriptions:\", descriptions[selectedDesc]);\n    const payload = {\n      name: items.name,\n      pn: items.pn,\n      sn: items.sn,\n      wo: workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\",\n      client: clientName,\n      status: items.status,\n      local_sn: id,\n      descriptions: [descriptions[selectedDesc] || {\n        description: \"\",\n        date: \"\"\n      }],\n      date: items.dateCreated || \"\",\n      DOM: DOM,\n      oem: selectionToPrintValue(selectedOems),\n      modality: selectionToPrintValue(selectedModalities),\n      model: selectionToPrintValue(selectedModels),\n      poNumber: items.poNumber,\n      arrival_date: items.arrival_date // NEW: Include arrival_date\n\n    };\n    console.log(\"Payload for printing:\", payload);\n\n    try {\n      const response = await fetch(\"https://9d70-174-76-22-138.ngrok-free.app/print-label\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      console.log(\"Print result:\", result.status);\n\n      if (result.status.includes(\"successfully.\")) {\n        handleShowPrintModal();\n      } else {\n        console.error(\"Error printing label:\", result.error);\n      }\n    } catch (error) {\n      console.error(\"Error printing label:\", error);\n    }\n  };\n\n  async function handleSubmit(event) {\n    event.preventDefault(); // Only check that the Name field is filled out.\n\n    if (!items.name) {\n      handleShow(); // This shows the \"missing field\" modal.\n    } else {\n      toSend();\n    }\n  } // Handlers for input changes.\n\n\n  const handleChange = field => event => {\n    const value = event.target ? event.target.value : event.value;\n    setItems(prevItems => _objectSpread(_objectSpread({}, prevItems), {}, {\n      [field]: value\n    }));\n  };\n\n  const addDescription = () => {\n    setDescriptions([...descriptions, {\n      description: \"\",\n      date: \"\"\n    }]);\n  };\n\n  const removeDescription = index => {\n    setDescriptions(descriptions.filter((_, i) => i !== index));\n  };\n\n  const handleDescriptionChange = (index, field, value) => {\n    const newDescriptions = descriptions.map((desc, i) => i === index ? _objectSpread(_objectSpread({}, desc), {}, {\n      [field]: value\n    }) : desc);\n    setDescriptions(newDescriptions);\n  };\n\n  const addWorkOrder = () => {\n    setWorkOrders([...workOrders, {\n      workOrder: \"\",\n      date: \"\"\n    }]);\n  };\n\n  const removeWorkOrder = index => {\n    setWorkOrders(workOrders.filter((_, i) => i !== index));\n  };\n\n  const handleWorkOrderChange = (index, field, value) => {\n    const newWorkOrders = workOrders.map((wo, i) => i === index ? _objectSpread(_objectSpread({}, wo), {}, {\n      [field]: value\n    }) : wo);\n    setWorkOrders(newWorkOrders);\n  };\n\n  const listDescriptions = () => {\n    setShowDescModal(true);\n  };\n\n  const selectDescription = index => {\n    setSelectedDesc(index);\n    setShowDescModal(false);\n  };\n\n  const handleShowCameraModal = () => {\n    setShowCameraModal(true);\n  };\n\n  const handleCloseCameraModal = () => {\n    setShowCameraModal(false);\n    setCapturedPhoto(null);\n  };\n\n  const handleCapture = (err, result) => {\n    if (result) {\n      setCapturedPhoto(result);\n    }\n  };\n\n  const savePhoto = () => {\n    setPhotos(prevPhotos => [...prevPhotos, {\n      file: capturedPhoto,\n      url: URL.createObjectURL(capturedPhoto)\n    }]);\n    setCapturedPhoto(null);\n    handleCloseCameraModal();\n  };\n\n  const removePhoto = index => {\n    setPhotos(photos.filter((_, i) => i !== index));\n  };\n\n  const mostRecentWorkOrder = workOrders && workOrders.length > 0 ? workOrders.reduce((latest, current) => {\n    const latestDate = new Date(latest.date);\n    const currentDate = new Date(current.date);\n    return currentDate > latestDate ? current : latest;\n  }, workOrders[0]) : {};\n\n  const capturePhoto = () => {\n    const video = document.querySelector(\"video\");\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    const context = canvas.getContext(\"2d\");\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob(blob => {\n      setCapturedPhoto(blob);\n    }, \"image/png\");\n  };\n\n  const handleShowInfoModal = async () => {\n    const db = firebase.firestore();\n\n    try {\n      const doc = await db.collection(\"Test\").doc(id).get();\n\n      if (doc.exists) {\n        const data = doc.data();\n        setItemName(data.name || \"N/A\");\n        setShowInfoModal(true);\n      } else {\n        console.error(\"Item not found\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching item info:\", error);\n    }\n  };\n\n  const handleCloseInfoModal = () => setShowInfoModal(false);\n\n  const handleCloneToNewItem = () => {\n    if (!id) {\n      setErr(\"Item ID not ready yet.\");\n      setShowErr(true);\n      return;\n    }\n\n    router.push(`/NewSearch/AddItem/NewItem?cloneFrom=${encodeURIComponent(id)}`);\n  };\n\n  const handlePnChange = (index, value) => {\n    setItems(prev => {\n      const newPn = [...prev.pn];\n      newPn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: newPn\n      });\n    });\n  };\n\n  const addPn = () => {\n    setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n      pn: [...prev.pn, \"\"]\n    }));\n  };\n\n  const handleSnChange = (index, value) => {\n    setItems(prev => {\n      const newSn = [...prev.sn];\n      newSn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: newSn\n      });\n    });\n  };\n\n  const addSn = () => {\n    setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n      sn: [...prev.sn, \"\"]\n    }));\n  };\n\n  const browseInputRef = useRef(null);\n\n  const handleBrowsePhotos = () => {\n    if (browseInputRef.current) {\n      browseInputRef.current.click();\n    }\n  };\n\n  const handleFilesSelected = e => {\n    const files = e.target.files;\n\n    if (files.length) {\n      const newPhotos = [];\n\n      for (let i = 0; i < files.length; i++) {\n        newPhotos.push({\n          file: files[i],\n          url: URL.createObjectURL(files[i])\n        });\n      }\n\n      setPhotos(prevPhotos => [...prevPhotos, ...newPhotos]);\n    }\n\n    e.target.value = \"\";\n  };\n\n  const {\n    0: currentPnIndex,\n    1: setCurrentPnIndex\n  } = useState(0);\n  const {\n    0: showDropdown,\n    1: setShowDropdown\n  } = useState(false);\n  const {\n    0: currentSnIndex,\n    1: setCurrentSnIndex\n  } = useState(0);\n  const {\n    0: showSnDropdown,\n    1: setShowSnDropdown\n  } = useState(false);\n  useEffect(() => {\n    if (showDropdown || showSnDropdown) {\n      loadPnSnOptions();\n    }\n  }, [showDropdown, showSnDropdown]);\n\n  const handleAddNewClient = () => {\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\n    router.push(`../client/AIS${randomNum}/addClient?from=item&itemId=${id || \"\"}`);\n  };\n\n  const handleBluefolderButton = async () => {\n    var _descriptions$selecte2;\n\n    // Check that the work order field is filled out (using workOrders[0].workOrder as current)\n    const currentWorkOrder = workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\";\n\n    if (!currentWorkOrder) {\n      alert(\"Please fill out the work order field before adding to BlueFolder.\");\n      return;\n    } // Build the payload to send to your proxy endpoint.\n\n\n    const payload = {\n      name: items.name,\n      pn: items.pn[0] || \"\",\n      sn: items.sn[0] || \"\",\n      status: items.status,\n      description: ((_descriptions$selecte2 = descriptions[selectedDesc]) === null || _descriptions$selecte2 === void 0 ? void 0 : _descriptions$selecte2.description) || \"\",\n      workOrder: currentWorkOrder,\n      localsn: items.localSN || \"\"\n    };\n\n    try {\n      // Replace with your ngrok URL and appropriate endpoint path (e.g., /api/bluefolder)\n      const response = await fetch(\"https://9d70-174-76-22-138.ngrok-free.app/bluefolder\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(payload)\n      });\n      const result = await response.json();\n      alert(\"BlueFolder service item added successfully!\");\n      console.log(\"BlueFolder result:\", result);\n    } catch (error) {\n      console.error(\"BlueFolder error:\", error);\n      alert(\"Error adding data to BlueFolder.\");\n    }\n  }; // // Slack integration handler.\n  // const handleAddToSlack = async (which) => {\n  //   try {\n  //     const pn0 = Array.isArray(items.pn) ? items.pn[0] : items.pn;\n  //     const sn0 = Array.isArray(items.sn) ? items.sn[0] : items.sn;\n  //     const linkUrl = typeof window !== \"undefined\" ? window.location.href : \"\";\n  //     const safeName = (items?.name || id || \"Untitled\").trim();\n  //     const title = `${safeName}${id ? ` (${id})` : \"\"}`;\n  //     console.log(\"[SLACK][handleAddToSlack] which:\", which);\n  //     console.log(\"[SLACK] title:\", title);\n  //     console.log(\"[SLACK] PN:\", items.pn, \"SN:\", items.sn);\n  //     const resp = await fetch(\"/api/slack/add-to-list\", {\n  //       method: \"POST\",\n  //       headers: { \"Content-Type\": \"application/json\" },\n  //       body: JSON.stringify({\n  //         listKey: which,      // \"shipping\" | \"receiving\" | \"tasks\"\n  //         title,\n  //         pn: items.pn,\n  //         sn: items.sn,\n  //         // keeping it minimal by design while we stabilize PN/SN\n  //         linkUrl,\n  //       }),\n  //     });\n  // Slack integration handler (drop-in replacement)\n  // Slack integration handler (drop-in replacement)\n  // Slack integration handler (client) — replace your existing handleAddToSlack with this\n\n\n  const handleAddToSlack = async (which = \"shipping\") => {\n    try {\n      var _sort$, _ref8, _items$trackingNumber, _json$debug, _json$debug2;\n\n      const safeName = ((items === null || items === void 0 ? void 0 : items.name) || id || \"Untitled\").trim();\n      const title = `${safeName}${id ? ` (${id})` : \"\"}`;\n      const pn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.pn) ? items.pn[0] : items === null || items === void 0 ? void 0 : items.pn;\n      const sn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.sn) ? items.sn[0] : items === null || items === void 0 ? void 0 : items.sn;\n      const pn_sn = [pn0 && `PN: ${pn0}`, sn0 && `SN: ${sn0}`].filter(Boolean).join(\"  \");\n      const mostRecentWO = workOrders && workOrders.length ? (_sort$ = [...workOrders].sort((a, b) => new Date((b === null || b === void 0 ? void 0 : b.date) || 0) - new Date((a === null || a === void 0 ? void 0 : a.date) || 0))[0]) === null || _sort$ === void 0 ? void 0 : _sort$.workOrder : \"\";\n      const description = selectedDesc != null && descriptions !== null && descriptions !== void 0 && descriptions[selectedDesc] ? descriptions[selectedDesc].description || \"\" : (items === null || items === void 0 ? void 0 : items.description) || \"\";\n      const tracking = (_ref8 = (_items$trackingNumber = items === null || items === void 0 ? void 0 : items.trackingNumber) !== null && _items$trackingNumber !== void 0 ? _items$trackingNumber : items === null || items === void 0 ? void 0 : items.tracking) !== null && _ref8 !== void 0 ? _ref8 : \"\";\n      const local_sn = id || (items === null || items === void 0 ? void 0 : items.localSN) || \"\";\n      const photoUrls = Array.isArray(photos) ? photos.map(p => p === null || p === void 0 ? void 0 : p.url).filter(Boolean) : [];\n      const resp = await fetch(\"/api/slack/add-to-list\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          listKey: which,\n          title,\n          pn_sn,\n          // <— server expects this\n          work_order: mostRecentWO || \"\",\n          local_sn,\n          tracking,\n          description: (description || \"\").trim(),\n          photoUrls // array of https URLs\n\n        })\n      });\n      const json = await resp.json();\n      console.log(\"[SLACK][handleAddToSlack] response:\", json);\n      if (json !== null && json !== void 0 && (_json$debug = json.debug) !== null && _json$debug !== void 0 && _json$debug.steps) console.table(json.debug.steps);\n      if (json !== null && json !== void 0 && (_json$debug2 = json.debug) !== null && _json$debug2 !== void 0 && _json$debug2.photos) console.table(json.debug.photos);\n\n      if (!resp.ok || !(json !== null && json !== void 0 && json.ok)) {\n        setErr(`Slack add failed: ${(json === null || json === void 0 ? void 0 : json.error) || \"unknown error\"}`);\n        setShowErr(true);\n        return;\n      }\n\n      alert(`Added to Slack ${which === \"shipping\" ? \"Shipping\" : which === \"receiving\" ? \"Receiving\" : \"Tasks\"} list.`);\n    } catch (e) {\n      console.error(e);\n      setErr(\"Error adding to Slack\");\n      setShowErr(true);\n    }\n  };\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1850,\n      columnNumber: 5\n    }\n  }, isLoading && __jsx(\"div\", {\n    className: styles.loadingOverlay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1852,\n      columnNumber: 9\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading Magmo\",\n    className: styles.loadingLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1853,\n      columnNumber: 11\n    }\n  })), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1860,\n      columnNumber: 7\n    }\n  }, __jsx(Modal, {\n    show: show,\n    onHide: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1861,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1862,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1863,\n      columnNumber: 13\n    }\n  }, \"Error\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1865,\n      columnNumber: 11\n    }\n  }, \"Missing field\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1866,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1867,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showErr,\n    onHide: handleCloseErr,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1872,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1873,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1874,\n      columnNumber: 13\n    }\n  }, \"Error\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1876,\n      columnNumber: 11\n    }\n  }, Err), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1877,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseErr,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1878,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showSaveModal,\n    onHide: handleCloseSaveModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1883,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1884,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1885,\n      columnNumber: 13\n    }\n  }, \"Save Confirmation\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1887,\n      columnNumber: 11\n    }\n  }, \"Data has been saved successfully.\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1888,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseSaveModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1889,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showPrintModal,\n    onHide: handleClosePrintModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1894,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1895,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1896,\n      columnNumber: 13\n    }\n  }, \"Print Confirmation\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1898,\n      columnNumber: 11\n    }\n  }, \"Info has been sent to print.\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1899,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClosePrintModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1900,\n      columnNumber: 13\n    }\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showDescModal,\n    onHide: handleCloseDescModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1906,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1907,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1908,\n      columnNumber: 13\n    }\n  }, \"Descriptions\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1910,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addDescription,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1911,\n      columnNumber: 13\n    }\n  }, \"Add Description\"), descriptions.map((desc, index) => __jsx(Row, {\n    key: index,\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1915,\n      columnNumber: 15\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: () => selectDescription(index),\n    style: {\n      cursor: \"pointer\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1916,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1922,\n      columnNumber: 19\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1923,\n      columnNumber: 21\n    }\n  }, desc.description || \"Description\"), __jsx(\"span\", {\n    style: {\n      borderLeft: \"1px solid #ccc\",\n      paddingLeft: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1924,\n      columnNumber: 21\n    }\n  }, desc.date || \"Date\"))))), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseDescModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1936,\n      columnNumber: 13\n    }\n  }, \"OK\"))), __jsx(Modal, {\n    show: showWoModal,\n    onHide: handleCloseWoModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1942,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1943,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1944,\n      columnNumber: 13\n    }\n  }, \"Work Orders\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1946,\n      columnNumber: 11\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addWorkOrder,\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1947,\n      columnNumber: 13\n    }\n  }, \"Add Work Order\"), workOrders.map((wo, index) => __jsx(Row, {\n    key: index,\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1956,\n      columnNumber: 15\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1957,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Work Order\",\n    value: wo.workOrder,\n    onChange: e => handleWorkOrderChange(index, \"workOrder\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1958,\n      columnNumber: 19\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1968,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Control, {\n    type: \"date\",\n    placeholder: \"Date\",\n    value: wo.date,\n    onChange: e => handleWorkOrderChange(index, \"date\", e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1969,\n      columnNumber: 19\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1978,\n      columnNumber: 17\n    }\n  }, __jsx(Button, {\n    variant: \"danger\",\n    onClick: () => removeWorkOrder(index),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1979,\n      columnNumber: 19\n    }\n  }, \"Remove\")))), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseWoModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1988,\n      columnNumber: 13\n    }\n  }, \"OK\"))), __jsx(ClientInfoModal, {\n    show: showMachineModal,\n    handleClose: handleCloseMachineModal,\n    selectedClient: selectedClient,\n    machineOptions: machineOptions,\n    setSelectedMachine: handleSetSelectedMachine,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1994,\n      columnNumber: 9\n    }\n  }), __jsx(Modal, {\n    show: showClientModal,\n    onHide: handleCloseClientModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2002,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2003,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2004,\n      columnNumber: 13\n    }\n  }, \"Select Client\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2006,\n      columnNumber: 11\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: search,\n    onChange: e => setSearch(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2007,\n      columnNumber: 13\n    }\n  }), __jsx(ClientTable, {\n    clients: clients.filter(client => (client.name || \"\").toLowerCase().includes(search.toLowerCase())),\n    onSelectClient: handleClientInfo,\n    onInfoClick: handleClientInfo,\n    clearSelection: () => handleClientInfo(null),\n    onAddClient: handleAddNewClient,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2014,\n      columnNumber: 13\n    }\n  }))), __jsx(ParentModal, {\n    show: showParentModal,\n    handleClose: handleCloseParentModal,\n    setSelectedParent: setSelectedParent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2026,\n      columnNumber: 9\n    }\n  }), __jsx(MachineSelectionModal, {\n    show: machineSelectionModal,\n    handleClose: () => setMachineSelectionModal(false),\n    setMachine: setTheMachine,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2032,\n      columnNumber: 9\n    }\n  }), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2038,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2039,\n      columnNumber: 11\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2040,\n      columnNumber: 13\n    }\n  }, \"Take a Photo\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2042,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"camera\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2043,\n      columnNumber: 13\n    }\n  }, !capturedPhoto && __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2045,\n      columnNumber: 17\n    }\n  }), capturedPhoto && __jsx(\"div\", {\n    className: \"photo-preview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2053,\n      columnNumber: 17\n    }\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2054,\n      columnNumber: 19\n    }\n  })))), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2063,\n      columnNumber: 11\n    }\n  }, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2066,\n      columnNumber: 17\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: () => setCameraFacing(prev => prev === \"environment\" ? \"user\" : \"environment\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2080,\n      columnNumber: 17\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2089,\n      columnNumber: 17\n    }\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: () => setCapturedPhoto(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2095,\n      columnNumber: 17\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2101,\n      columnNumber: 17\n    }\n  }, \"OK\")))), __jsx(InfoModal, {\n    show: showInfoModal,\n    handleClose: handleCloseInfoModal,\n    itemName: items.name,\n    dimensions: items.length + \",\" + items.width + \",\" + items.height,\n    price: items.price,\n    freqI: freqItem,\n    freqM: machineFrequency,\n    usage: usagePastYear,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2109,\n      columnNumber: 9\n    }\n  }), __jsx(Container, {\n    fluid: true,\n    className: styles.page,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2120,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.shell,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2121,\n      columnNumber: 11\n    }\n  }, __jsx(Card, {\n    className: styles.card,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2122,\n      columnNumber: 13\n    }\n  }, __jsx(Card.Body, {\n    className: styles.cardBody,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2123,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: styles.header,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2124,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.kicker,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2125,\n      columnNumber: 19\n    }\n  }, \"Item\"), __jsx(\"h2\", {\n    className: styles.title,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2126,\n      columnNumber: 19\n    }\n  }, savedName || \"Item Details\"), __jsx(\"div\", {\n    className: styles.subtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2129,\n      columnNumber: 19\n    }\n  }, \"Review and update fields, photos, and routing information.\")), __jsx(Form, {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2133,\n      columnNumber: 17\n    }\n  }, __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2135,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2136,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"name\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2137,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2138,\n      columnNumber: 25\n    }\n  }, \"Name\"), __jsx(Form.Control, {\n    type: \"text\",\n    value: items.name,\n    onChange: handleChange(\"name\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2139,\n      columnNumber: 25\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2146,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"pn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2147,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2148,\n      columnNumber: 25\n    }\n  }, \"Product Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2149,\n      columnNumber: 25\n    }\n  }, __jsx(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2150,\n      columnNumber: 27\n    }\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.pn[currentPnIndex] || \"\",\n    onChange: e => handlePnChange(currentPnIndex, e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2151,\n      columnNumber: 29\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowDropdown(!showDropdown),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2158,\n      columnNumber: 29\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2164,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setAddingNewPn(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2165,\n      columnNumber: 31\n    }\n  }, \"+\"))), showDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2174,\n      columnNumber: 29\n    }\n  }, pnOptions.map((pnOption, idx) => __jsx(\"div\", {\n    key: idx,\n    style: {\n      padding: \"8px\",\n      cursor: \"pointer\"\n    },\n    onClick: () => {\n      setCurrentPnIndex(idx);\n      setShowDropdown(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2188,\n      columnNumber: 33\n    }\n  }, pnOption)))), addingNewPn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new PN\",\n    value: newPn,\n    onChange: e => setNewPn(e.target.value),\n    onBlur: handleAddNewPn,\n    onKeyDown: e => e.key === \"Enter\" && handleAddNewPn(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2203,\n      columnNumber: 27\n    }\n  })))), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2218,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2219,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"sn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2220,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2221,\n      columnNumber: 25\n    }\n  }, \"Serial Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2222,\n      columnNumber: 25\n    }\n  }, __jsx(InputGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2223,\n      columnNumber: 27\n    }\n  }, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.sn[currentSnIndex] || \"\",\n    onChange: e => handleSnChange(currentSnIndex, e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2224,\n      columnNumber: 29\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowSnDropdown(!showSnDropdown),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2231,\n      columnNumber: 29\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2237,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setAddingNewSn(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2238,\n      columnNumber: 31\n    }\n  }, \"+\"))), showSnDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2247,\n      columnNumber: 29\n    }\n  }, snOptions.map((snOption, idx) => __jsx(\"div\", {\n    key: idx,\n    style: {\n      padding: \"8px\",\n      cursor: \"pointer\"\n    },\n    onClick: () => {\n      setCurrentSnIndex(idx);\n      setShowSnDropdown(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2261,\n      columnNumber: 33\n    }\n  }, snOption)))), addingNewSn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new SN\",\n    value: newSn,\n    onChange: e => setNewSn(e.target.value),\n    onBlur: handleAddNewSn,\n    onKeyDown: e => e.key === \"Enter\" && handleAddNewSn(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2276,\n      columnNumber: 27\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2289,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"status\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2290,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2291,\n      columnNumber: 25\n    }\n  }, \"Status\"), __jsx(Form.Select, {\n    value: items.status || \"\",\n    onChange: handleChange(\"status\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2292,\n      columnNumber: 25\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2296,\n      columnNumber: 27\n    }\n  }, \"Select status\"), __jsx(\"option\", {\n    value: \"Good\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2297,\n      columnNumber: 27\n    }\n  }, \"Good\"), __jsx(\"option\", {\n    value: \"Bad\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2298,\n      columnNumber: 27\n    }\n  }, \"Bad\"), __jsx(\"option\", {\n    value: \"Unknown\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2299,\n      columnNumber: 27\n    }\n  }, \"Unknown\"))))), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2305,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2306,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"localSN\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2307,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2308,\n      columnNumber: 25\n    }\n  }, \"Local SN\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter Local SN\",\n    value: items.localSN || \"\",\n    onChange: handleChange(\"localSN\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2309,\n      columnNumber: 25\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2317,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"arrivalDate\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2318,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2319,\n      columnNumber: 25\n    }\n  }, \"Arrival Date\"), __jsx(Form.Control, {\n    placeholder: \"Enter Arrival Date\",\n    type: \"date\",\n    value: items.arrival_date,\n    onChange: e => {\n      const value = e.target.value;\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        arrival_date: value\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2320,\n      columnNumber: 25\n    }\n  }))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2334,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"trackingNumber\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2335,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2336,\n      columnNumber: 25\n    }\n  }, \"Tracking Number\"), __jsx(Form.Control, {\n    placeholder: \"Tracking Number\",\n    type: \"text\",\n    value: items.trackingNumber,\n    onChange: handleChange(\"trackingNumber\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2337,\n      columnNumber: 25\n    }\n  })))), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2347,\n      columnNumber: 19\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2348,\n      columnNumber: 21\n    }\n  }, __jsx(MultiSelectDropdown, {\n    label: \"OEM\",\n    placeholder: trackerLoading ? \"Loading...\" : \"Select OEM\",\n    options: oemOptionsForUI,\n    selected: selectedOems,\n    onChange: setSelectedOems,\n    enableDelete: true,\n    onDeleteOption: handleDeleteOemOption,\n    disabled: trackerLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2349,\n      columnNumber: 23\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2360,\n      columnNumber: 21\n    }\n  }, __jsx(MultiSelectDropdown, {\n    label: \"Modality\",\n    placeholder: trackerLoading ? \"Loading...\" : \"Select Modality\",\n    options: modalityOptionsForUI,\n    selected: selectedModalities,\n    onChange: setSelectedModalities,\n    disabled: trackerLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2361,\n      columnNumber: 23\n    }\n  })), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2370,\n      columnNumber: 21\n    }\n  }, __jsx(MultiSelectDropdown, {\n    label: \"Model\",\n    placeholder: selectedModalities.length && selectedOems.length ? \"Select Model\" : \"Select Modality + OEM\",\n    options: modelOptionsForUI,\n    selected: selectedModels,\n    onChange: setSelectedModels,\n    enableDelete: true,\n    onDeleteOption: handleDeleteModelOption,\n    disabled: trackerLoading || !selectedModalities.length || !selectedOems.length,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2371,\n      columnNumber: 23\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\",\n      marginTop: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2392,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex align-items-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2393,\n      columnNumber: 21\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowWoModal,\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2394,\n      columnNumber: 23\n    }\n  }, \"Manage Work Orders\"), workOrders.length > 0 && __jsx(\"div\", {\n    className: \"d-flex flex-column align-items-start\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2402,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2403,\n      columnNumber: 27\n    }\n  }, \"Work Order\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Most Recent Work Order\",\n    value: mostRecentWorkOrder.workOrder,\n    onChange: e => handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"workOrder\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2404,\n      columnNumber: 27\n    }\n  }), __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2417,\n      columnNumber: 27\n    }\n  }, \"Date\"), __jsx(Form.Control, {\n    type: \"date\",\n    placeholder: \"Work Order Date\",\n    value: mostRecentWorkOrder.date,\n    onChange: e => handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"date\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2418,\n      columnNumber: 27\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2434,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"desc\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2435,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: listDescriptions,\n    className: \"mb-2 me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2436,\n      columnNumber: 25\n    }\n  }, \"List Descriptions\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 3,\n    placeholder: \"Enter description\",\n    value: ((_descriptions$selecte3 = descriptions[selectedDesc]) === null || _descriptions$selecte3 === void 0 ? void 0 : _descriptions$selecte3.description) || \"\",\n    onChange: e => handleDescriptionChange(selectedDesc, \"description\", e.target.value),\n    style: {\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2443,\n      columnNumber: 25\n    }\n  }), __jsx(Form.Control, {\n    type: \"date\",\n    value: ((_descriptions$selecte4 = descriptions[selectedDesc]) === null || _descriptions$selecte4 === void 0 ? void 0 : _descriptions$selecte4.date) || \"\",\n    onChange: e => handleDescriptionChange(selectedDesc, \"date\", e.target.value),\n    style: {\n      marginTop: \"0.5rem\",\n      marginBottom: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2457,\n      columnNumber: 25\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2476,\n      columnNumber: 19\n    }\n  }, __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2477,\n      columnNumber: 21\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2478,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => {\n      setMachinePick(true);\n      handleShowClientModal();\n    },\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2479,\n      columnNumber: 25\n    }\n  }, \"Select From\"), selectedClientFrom && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2490,\n      columnNumber: 27\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2498,\n      columnNumber: 29\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2499,\n      columnNumber: 31\n    }\n  }, \"Selected Client (From):\"), \" \", selectedClientFrom.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2502,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowMachineModal(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2503,\n      columnNumber: 31\n    }\n  }, \"Select Machine for \", selectedClientFrom.name), selectedMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2511,\n      columnNumber: 35\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2512,\n      columnNumber: 37\n    }\n  }, \"Selected Machine (From):\"), \" \", selectedMachine.name), showLocalLocFrom && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowNewLocalModalFrom(true),\n    className: \"w-100 mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2517,\n      columnNumber: 39\n    }\n  }, [newLocalFrom.region, ((_newLocalFrom$section = newLocalFrom.section) === null || _newLocalFrom$section === void 0 ? void 0 : _newLocalFrom$section.letter) + ((_newLocalFrom$section2 = newLocalFrom.section) === null || _newLocalFrom$section2 === void 0 ? void 0 : _newLocalFrom$section2.number), newLocalFrom.bin && `B${newLocalFrom.bin}`, newLocalFrom.pallet && `P${newLocalFrom.pallet}`].filter(Boolean).join(\"-\")), __jsx(Modal, {\n    show: showNewLocalModalFrom,\n    onHide: () => setShowNewLocalModalFrom(false),\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2539,\n      columnNumber: 39\n    }\n  }, __jsx(Modal.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2546,\n      columnNumber: 41\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2547,\n      columnNumber: 43\n    }\n  }, \"Edit Local Loc (From)\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2551,\n      columnNumber: 41\n    }\n  }, __jsx(NewLocal, {\n    selectedClient: selectedClientFrom,\n    showLocalLoc: showNewLocalModalFrom,\n    value: newLocalFrom,\n    onChange: setNewLocalFrom,\n    onSave: p => {\n      setNewLocalFrom(p);\n      setShowNewLocalModalFrom(false);\n    },\n    onCancel: () => setShowNewLocalModalFrom(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2552,\n      columnNumber: 43\n    }\n  })))))))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2583,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => {\n      setMachinePick(false);\n      handleShowClientModal();\n    },\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2584,\n      columnNumber: 25\n    }\n  }, \"Select Current\"), selectedClientCurrent && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2595,\n      columnNumber: 27\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2603,\n      columnNumber: 29\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2604,\n      columnNumber: 31\n    }\n  }, \"Selected Client (Current):\"), \" \", selectedClientCurrent.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2607,\n      columnNumber: 29\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowMachineModal(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2608,\n      columnNumber: 31\n    }\n  }, \"Select Machine for \", selectedClientCurrent.name), selectedCurrentMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2616,\n      columnNumber: 35\n    }\n  }, __jsx(\"strong\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2617,\n      columnNumber: 37\n    }\n  }, \"Selected Machine (Current):\"), \" \", selectedCurrentMachine.name), showLocalLocCurrent && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: () => setShowNewLocalModalCurrent(true),\n    className: \"w-100 mb-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2622,\n      columnNumber: 39\n    }\n  }, [newLocalCurrent.region, ((_newLocalCurrent$sect = newLocalCurrent.section) === null || _newLocalCurrent$sect === void 0 ? void 0 : _newLocalCurrent$sect.letter) + ((_newLocalCurrent$sect2 = newLocalCurrent.section) === null || _newLocalCurrent$sect2 === void 0 ? void 0 : _newLocalCurrent$sect2.number), newLocalCurrent.bin && `B${newLocalCurrent.bin}`, newLocalCurrent.pallet && `P${newLocalCurrent.pallet}`].filter(Boolean).join(\"-\")), __jsx(Modal, {\n    show: showNewLocalModalCurrent,\n    onHide: () => setShowNewLocalModalCurrent(false),\n    centered: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2641,\n      columnNumber: 39\n    }\n  }, __jsx(Modal.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2648,\n      columnNumber: 41\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2649,\n      columnNumber: 43\n    }\n  }, \"Edit Local Loc (Current)\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2653,\n      columnNumber: 41\n    }\n  }, __jsx(NewLocal, {\n    selectedClient: selectedClientCurrent,\n    showLocalLoc: showNewLocalModalCurrent,\n    value: newLocalCurrent,\n    onChange: setNewLocalCurrent,\n    onSave: p => {\n      setNewLocalCurrent(p);\n      setShowNewLocalModalCurrent(false);\n    },\n    onCancel: () => setShowNewLocalModalCurrent(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2654,\n      columnNumber: 43\n    }\n  })))))))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2691,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowParentModal,\n    className: \"me-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2692,\n      columnNumber: 25\n    }\n  }, \"Select Parent\"), selectedParent && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Selected Parent\",\n    value: selectedParent.name,\n    readOnly: true,\n    style: {\n      marginTop: \"0.5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2700,\n      columnNumber: 27\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2712,\n      columnNumber: 19\n    }\n  }, __jsx(Row, {\n    className: `mb-3 ${styles.photoActionsRow}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2713,\n      columnNumber: 21\n    }\n  }, __jsx(Col, {\n    xs: 12,\n    md: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2714,\n      columnNumber: 23\n    }\n  }, __jsx(ButtonGroup, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2715,\n      columnNumber: 25\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2716,\n      columnNumber: 27\n    }\n  }, \"Take Photo\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBrowsePhotos,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2722,\n      columnNumber: 27\n    }\n  }, \"Browse\"))), __jsx(Col, {\n    xs: 12,\n    md: 6,\n    className: styles.photoActionsRight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2730,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"success\",\n    onClick: handleSendToInflow,\n    style: {\n      marginLeft: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2731,\n      columnNumber: 25\n    }\n  }, \"Send to inFlow\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleBluefolderButton,\n    style: {\n      marginLeft: \"0.5rem\",\n      marginRight: \".5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2738,\n      columnNumber: 25\n    }\n  }, \"BlueFolder\"), __jsx(Button, {\n    variant: addToWebsite ? \"primary\" : \"outline-primary\",\n    onClick: () => setAddToWebsite(prev => !prev),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2747,\n      columnNumber: 25\n    }\n  }, addToWebsite ? \"✓ Add to Website\" : \"Add to Website\"), __jsx(Form.Check, {\n    type: \"checkbox\",\n    id: \"hide-checkbox\",\n    label: \"Hide\" // box is checked when we want visible = false\n    ,\n    checked: !items.visible,\n    onChange: e => {\n      // grab checked immediately\n      const isHidden = e.currentTarget.checked;\n      setItems(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        visible: !isHidden\n      }));\n    },\n    className: \"ms-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2754,\n      columnNumber: 25\n    }\n  }))), __jsx(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    multiple: true,\n    ref: browseInputRef,\n    style: {\n      display: \"none\"\n    },\n    onChange: handleFilesSelected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2772,\n      columnNumber: 21\n    }\n  })), photos && photos.length > 0 && __jsx(\"div\", {\n    className: \"photo-gallery\",\n    style: {\n      display: \"flex\",\n      flexWrap: \"wrap\",\n      gap: \"10px\",\n      marginBottom: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2783,\n      columnNumber: 21\n    }\n  }, photos.map((photo, index) => __jsx(\"div\", {\n    key: index,\n    style: {\n      position: \"relative\",\n      width: \"100px\",\n      height: \"100px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2793,\n      columnNumber: 25\n    }\n  }, __jsx(\"img\", {\n    src: photo.url,\n    alt: `Photo ${index + 1}`,\n    style: {\n      width: \"100%\",\n      height: \"100%\",\n      objectFit: \"cover\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2801,\n      columnNumber: 27\n    }\n  }), photo.file && __jsx(Button, {\n    variant: \"danger\",\n    size: \"sm\",\n    style: {\n      position: \"absolute\",\n      top: 0,\n      right: 0,\n      padding: \"0 5px\"\n    },\n    onClick: () => removePhoto(index),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2811,\n      columnNumber: 29\n    }\n  }, \"x\")))), __jsx(\"div\", {\n    className: `mt-3 d-flex flex-wrap align-items-center ${styles.actionRow}`,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2830,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    type: \"submit\",\n    style: {\n      marginRight: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2831,\n      columnNumber: 21\n    }\n  }, \"Save\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloneToNewItem,\n    style: {\n      marginRight: \"1rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2838,\n      columnNumber: 21\n    }\n  }, \"Clone\"), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"NewSearch/mainSearch\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2845,\n      columnNumber: 21\n    }\n  }), SHOW_SLACK_BUTTONS && __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      marginLeft: \".5rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2851,\n      columnNumber: 23\n    }\n  }, __jsx(\"span\", {\n    style: {\n      fontSize: 12,\n      lineHeight: \"12px\",\n      textAlign: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2852,\n      columnNumber: 25\n    }\n  }, \"Slack\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      border: \"1px solid #ced4da\",\n      borderRadius: 6,\n      overflow: \"hidden\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2853,\n      columnNumber: 25\n    }\n  }, __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: () => handleAddToSlack(\"receiving\"),\n    style: {\n      border: \"none\",\n      borderRight: \"1px solid #ced4da\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2854,\n      columnNumber: 27\n    }\n  }, \"Receiving\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: () => handleAddToSlack(\"shipping\"),\n    style: {\n      border: \"none\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2861,\n      columnNumber: 27\n    }\n  }, \"Shipping\"))), __jsx(Button, {\n    variant: \"info\",\n    onClick: handlePrint,\n    style: {\n      marginLeft: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2877,\n      columnNumber: 21\n    }\n  }, \"Print Label\")), __jsx(\"div\", {\n    style: {\n      textAlign: \"center\",\n      margin: \"1rem 0\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2885,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"link\",\n    style: {\n      textDecoration: \"none\",\n      color: \"black\",\n      fontSize: \"24px\"\n    },\n    onClick: () => setShowExtra(!showExtra),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2886,\n      columnNumber: 21\n    }\n  }, \"\\u25BC\")), __jsx(Collapse, {\n    in: showExtra,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2898,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    id: \"extra-collapse\",\n    className: \"mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2899,\n      columnNumber: 21\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex justify-content-end mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2900,\n      columnNumber: 23\n    }\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleShowInfoModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2901,\n      columnNumber: 25\n    }\n  }, \"More Info\")), __jsx(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2905,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"dimensions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2906,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2907,\n      columnNumber: 27\n    }\n  }, \"Dimensions\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      alignItems: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2908,\n      columnNumber: 27\n    }\n  }, __jsx(Form.Control, {\n    placeholder: \"Length\",\n    type: \"text\",\n    value: items.length,\n    onChange: handleChange(\"length\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2911,\n      columnNumber: 29\n    }\n  }), __jsx(\"span\", {\n    style: {\n      padding: \"0 5px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2917,\n      columnNumber: 29\n    }\n  }, \"x\"), __jsx(Form.Control, {\n    placeholder: \"Width\",\n    type: \"text\",\n    value: items.width,\n    onChange: handleChange(\"width\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2918,\n      columnNumber: 29\n    }\n  }), __jsx(\"span\", {\n    style: {\n      padding: \"0 5px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2924,\n      columnNumber: 29\n    }\n  }, \"x\"), __jsx(Form.Control, {\n    placeholder: \"Height\",\n    type: \"text\",\n    value: items.height,\n    onChange: handleChange(\"height\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2925,\n      columnNumber: 29\n    }\n  })))), __jsx(Row, {\n    className: \"mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2935,\n      columnNumber: 23\n    }\n  }, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"Price\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2936,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2937,\n      columnNumber: 27\n    }\n  }, \"Price\"), __jsx(Form.Control, {\n    placeholder: \"Price\",\n    type: \"text\",\n    value: items.price,\n    onChange: handleChange(\"price\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2938,\n      columnNumber: 27\n    }\n  })), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"DOM\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2945,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2946,\n      columnNumber: 27\n    }\n  }, \"DOM\"), __jsx(Form.Control, {\n    placeholder: \"Date of Manufacture\",\n    type: \"date\",\n    value: DOM,\n    onChange: e => setDOM(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2947,\n      columnNumber: 27\n    }\n  })), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"poNumber\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2954,\n      columnNumber: 25\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2955,\n      columnNumber: 27\n    }\n  }, \"PO Number\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"PO Number\",\n    value: items.poNumber || \"\",\n    onChange: handleChange(\"poNumber\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2956,\n      columnNumber: 27\n    }\n  }))))))))))), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2972,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2973,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2974,\n      columnNumber: 11\n    }\n  }, \"Take a Photo\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2976,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"camera\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2977,\n      columnNumber: 11\n    }\n  }, !capturedPhoto ? __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2979,\n      columnNumber: 15\n    }\n  }) : __jsx(\"div\", {\n    className: \"photo-preview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2986,\n      columnNumber: 15\n    }\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2987,\n      columnNumber: 17\n    }\n  })))), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2996,\n      columnNumber: 9\n    }\n  }, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 2999,\n      columnNumber: 15\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: () => setCameraFacing(prev => prev === \"environment\" ? \"user\" : \"environment\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 3013,\n      columnNumber: 15\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 3022,\n      columnNumber: 15\n    }\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: () => setCapturedPhoto(null),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 3028,\n      columnNumber: 15\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 3034,\n      columnNumber: 15\n    }\n  }, \"OK\")))));\n}\n\nexport default function DisplayItemPage(props) {\n  var _router$query, _props$initialItem;\n\n  const router = useRouter();\n  const idFromRouter = (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.id;\n  const key = (props === null || props === void 0 ? void 0 : (_props$initialItem = props.initialItem) === null || _props$initialItem === void 0 ? void 0 : _props$initialItem.id) || idFromRouter || \"new-item\";\n  return __jsx(DisplayItemInner, _extends({}, props, {\n    key: key,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 3049,\n      columnNumber: 10\n    }\n  }));\n} // Server-side rendering function\n\nexport async function getServerSideProps(context) {\n  const {\n    id\n  } = context.params;\n\n  try {\n    if (!adminDb) {\n      return {\n        props: {\n          error: \"Firebase Admin not configured for SSR.\"\n        }\n      };\n    }\n\n    const itemDoc = await adminDb.collection(\"Test\").doc(id).get();\n    if (!itemDoc.exists) return {\n      notFound: true\n    };\n    const itemData = itemDoc.data(); // normalize to arrays for consistent client-side handling\n\n    const pnArray = Array.isArray(itemData.pn) ? itemData.pn : itemData.pn ? [itemData.pn] : [];\n    const snArray = Array.isArray(itemData.sn) ? itemData.sn : itemData.sn ? [itemData.sn] : []; // fetch machineData (optional; you already had this)\n\n    let machineData = {};\n\n    if (itemData.Machine && itemData.Machine.path) {\n      try {\n        const machineDoc = await adminDb.doc(itemData.Machine.path).get();\n\n        if (machineDoc.exists) {\n          machineData = machineDoc.data();\n\n          if (machineData.client && machineData.client.path) {\n            const clientDoc = await adminDb.doc(machineData.client.path).get();\n            if (clientDoc.exists) machineData.Client = clientDoc.data().name;\n          }\n        }\n      } catch (e) {\n        console.error(\"Error fetching machine data:\", e);\n      }\n    }\n\n    const serializedItem = {\n      id,\n      name: itemData.name || \"\",\n      pn: pnArray,\n      sn: snArray,\n      price: itemData.price || \"\",\n      status: itemData.status || \"\",\n      length: itemData.length || \"\",\n      width: itemData.width || \"\",\n      height: itemData.height || \"\",\n      poNumber: itemData.poNumber || \"\",\n      trackingNumber: itemData.trackingNumber || \"\",\n      localSN: itemData.localSN || \"\",\n      arrival_date: itemData.arrival_date || \"\",\n      visible: itemData.visible !== undefined ? itemData.visible : true,\n      // add the pieces the UI reads directly\n      descriptions: itemData.descriptions || [],\n      workOrders: itemData.workOrders || [],\n      DOM: itemData.DOM || \"\"\n    };\n    return {\n      props: {\n        initialItem: serializedItem,\n        initialMachineData: machineData\n      }\n    };\n  } catch (error) {\n    console.error(\"Error in getServerSideProps:\", error);\n    return {\n      props: {\n        error: \"Failed to load item data\"\n      }\n    };\n  }\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/item/[id]/index.js"],"names":["React","useEffect","useState","useRef","useCallback","useMemo","Form","Button","Card","Container","Row","Col","Modal","FormControl","Collapse","InputGroup","ButtonGroup","Link","useAuth","firebase","LoggedIn","useRouter","fetchClients","ClientTable","ClientInfoModal","ParentModal","dynamic","InfoModal","MachineSelectionModal","addServiceItem","NewLocal","styles","InflowAPI","buildLocalLocObject","formatLoc","updateMachineFields","buildNameTokens","MultiSelectDropdown","fetchTrackerCatalog","buildAllOems","buildModelsForSelection","syncTrackerFromSelections","deleteTrackerOem","deleteTrackerModel","adminDb","BarcodeScannerComponent","ssr","simulateNetworkRequest","Promise","resolve","setTimeout","LoadingButton","type","name","route","isLoading","setLoading","cancelled","then","handleClick","isValidMachineValue","value","Array","isArray","some","v","trimmed","String","trim","toLowerCase","Boolean","normalizeSelection","map","filter","normalized","uniqueSelection","values","from","Set","selectionToStoredValue","cleaned","length","selectionToPrintValue","mergeOptionsWithSelection","options","selected","Map","forEach","set","DisplayItemInner","initialItem","initialMachineData","error","SHOW_SLACK_BUTTONS","process","env","NEXT_PUBLIC_SHOW_SLACK_BUTTONS","router","signOut","id","idFromRouter","query","initialId","items","setItems","pn","sn","price","status","width","height","poNumber","trackingNumber","localSN","arrival_date","visible","savedName","setSavedName","setDescriptions","descriptions","setWorkOrders","workOrders","setDOM","DOM","prev","newLocalFrom","setNewLocalFrom","region","section","letter","number","bin","pallet","newLocalCurrent","setNewLocalCurrent","selectedClientFrom","setSelectedClientFrom","selectedClientCurrent","setSelectedClientCurrent","selectedMachine","setSelectedMachine","selectedCurrentMachine","setSelectedCurrentMachine","pnOptions","setPnOptions","snOptions","setSnOptions","pnSnLoaded","setPnSnLoaded","pnSnLoading","setPnSnLoading","description","date","workOrder","clients","setClients","clientsLoaded","setClientsLoaded","clientsLoading","setClientsLoading","photos","setPhotos","show","setShow","showErr","setShowErr","Err","setErr","showDescModal","setShowDescModal","showWoModal","setShowWoModal","showClientModal","setShowClientModal","showMachineModal","setShowMachineModal","showParentModal","setShowParentModal","showCameraModal","setShowCameraModal","showSaveModal","setShowSaveModal","showPrintModal","setShowPrintModal","machineSelectionModal","setMachineSelectionModal","selectedDesc","setSelectedDesc","selectedClient","setSelectedClient","selectedParent","setSelectedParent","TheMachine","setTheMachine","machineOptions","setMachineOptions","search","setSearch","capturedPhoto","setCapturedPhoto","cameraFacing","setCameraFacing","addToWebsite","setAddToWebsite","machinePick","setMachinePick","freqItem","setFreqItem","usagePastYear","setUsagePastYear","machineFrequency","setMachineFrequency","showExtra","setShowExtra","trackerCatalog","setTrackerCatalog","modalities","oemsByModality","modelsByModalityOem","meta","trackerLoading","setTrackerLoading","localLocFrom","setLocalLocFrom","localLocCurrent","setLocalLocCurrent","selectedModalities","setSelectedModalities","selectedOems","setSelectedOems","selectedModels","setSelectedModels","applyMergedMachineFields","merged","force","nextOems","oem","nextModalities","modality","nextModels","model","showInfoModal","setShowInfoModal","itemName","setItemName","machineFieldsInitialized","setMachineFieldsInitialized","setIsLoading","showLocalModalFrom","setShowLocalModalFrom","showLocalModalCurrent","setShowLocalModalCurrent","openLocalModalFrom","closeLocalModalFrom","openLocalModalCurrent","closeLocalModalCurrent","showNewLocalModalFrom","setShowNewLocalModalFrom","showNewLocalModalCurrent","setShowNewLocalModalCurrent","handleSendToInflow","alert","imageUrls","p","url","sku","toString","toCSV","arr","join","arrivalISO","Date","toISOString","slice","pnStr","snStr","mostRecentWO","reduce","latest","cur","customFields","custom1","custom2","custom3","custom4","custom5","custom6","custom7","custom8","custom9","custom10","console","log","created","upsertProduct","productId","err","message","setShowLocalLocFrom","setShowLocalLocCurrent","loadClients","clientsData","loadTracker","catalog","allOemOptions","modelOptions","modalityOptionsForUI","oemOptionsForUI","modelOptionsForUI","handleDeleteOemOption","handleDeleteModelOption","ops","modalityValue","oemValue","push","allSettled","loadPnSnOptions","db","firestore","snapshot","collection","orderBy","FieldPath","documentId","limit","get","pnSet","snSet","doc","data","add","fetchData","resolveClientFromMachine","machineRef","setClient","setMachine","isFrom","machineDoc","exists","machineData","clientDoc","client","clientName","isSocalInterior","shouldShow","normalizedPN","normalizedSN","ClientFrom","clientFromDoc","ClientCurrent","clientCurrentDoc","Machine","CurrentMachine","machineFromData","machineCurrentData","MachineFrom","MachineCurrent","nameFrom","nameCurrent","theMachineData","OEM","Modality","Model","Parent","parentDoc","all","fetchPhotos","checkIfAddedToWebsite","calculateItemFrequencyAndUsage","catch","pathname","signal","currentDate","oneYearAgo","setFullYear","getFullYear","undefined","itemsSnapshot","where","size","itemData","workOrderDate","fetchMachine","machineId","machinesSnapshot","docID","storageRef","storage","ref","listRef","child","res","listAll","urls","item","getDownloadURL","file","partsDoc","handleClose","handleShow","handleCloseErr","handleShowErr","handleCloseSaveModal","handleClosePrintModal","handleShowSaveModal","handleShowPrintModal","handleMachineSelectionModal","handleCloseDescModal","handleShowDescModal","handleCloseWoModal","handleShowWoModal","handleCloseClientModal","handleShowClientModal","handleCloseMachineModal","handleShowMachineModal","handleCloseParentModal","handleShowParentModal","handleClientInfo","clientId","clientData","machinePromises","machines","machineDocs","reorderArray","selectedValue","newArr","val","addingNewPn","setAddingNewPn","newPn","setNewPn","addingNewSn","setAddingNewSn","newSn","setNewSn","handlePnSelect","e","target","updatedPn","handleSnSelect","updatedSn","handleAddNewPn","handleAddNewSn","generateCustomID","randomNum","Math","floor","random","shallowClean","obj","newObj","key","hasOwnProperty","toSend","currentUser","auth","userEmail","email","storedOem","storedModality","storedModel","formattedItems","nameLower","nameTokens","addedToWebsite","lastEdited","fromDetails","currentDetails","Object","keys","docId","newDocId","update","associatedParts","FieldValue","arrayUnion","currentMachineRef","currentMachineDoc","delete","cleanFormattedItems","selections","oems","models","updated","uploadPhotos","showLocalLocFrom","showLocalLocCurrent","handleSetSelectedMachine","machine","i","photoRef","metadata","contentType","put","handlePrint","warn","payload","wo","local_sn","dateCreated","response","fetch","method","headers","body","JSON","stringify","result","json","includes","handleSubmit","event","preventDefault","handleChange","field","prevItems","addDescription","removeDescription","index","_","handleDescriptionChange","newDescriptions","desc","addWorkOrder","removeWorkOrder","handleWorkOrderChange","newWorkOrders","listDescriptions","selectDescription","handleShowCameraModal","handleCloseCameraModal","handleCapture","savePhoto","prevPhotos","URL","createObjectURL","removePhoto","mostRecentWorkOrder","current","latestDate","capturePhoto","video","document","querySelector","canvas","createElement","videoWidth","videoHeight","context","getContext","drawImage","toBlob","blob","handleShowInfoModal","handleCloseInfoModal","handleCloneToNewItem","encodeURIComponent","handlePnChange","addPn","handleSnChange","addSn","browseInputRef","handleBrowsePhotos","click","handleFilesSelected","files","newPhotos","currentPnIndex","setCurrentPnIndex","showDropdown","setShowDropdown","currentSnIndex","setCurrentSnIndex","showSnDropdown","setShowSnDropdown","handleAddNewClient","handleBluefolderButton","currentWorkOrder","localsn","handleAddToSlack","which","safeName","title","pn0","sn0","pn_sn","sort","a","b","tracking","photoUrls","resp","listKey","work_order","debug","steps","table","ok","loadingOverlay","loadingLogo","cursor","borderLeft","paddingLeft","marginBottom","borderRadius","position","left","transform","bottom","page","shell","card","cardBody","header","kicker","subtitle","top","right","backgroundColor","border","zIndex","maxHeight","overflowY","pnOption","idx","padding","snOption","marginTop","indexOf","photoActionsRow","photoActionsRight","marginLeft","marginRight","isHidden","currentTarget","checked","display","flexWrap","gap","photo","objectFit","actionRow","flexDirection","fontSize","lineHeight","textAlign","overflow","borderRight","margin","textDecoration","color","alignItems","DisplayItemPage","props","getServerSideProps","params","itemDoc","notFound","pnArray","snArray","path","Client","serializedItem"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef, useCallback, useMemo } from \"react\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport {\r\n  Form,\r\n  Button,\r\n  Card,\r\n  Container,\r\n  Row,\r\n  Col,\r\n  Modal,\r\n  FormControl,\r\n  Collapse,\r\n  InputGroup,\r\n  ButtonGroup,\r\n} from \"react-bootstrap\";\r\n\r\nimport Link from \"next/link\";\r\nimport { useAuth } from \"../../../../context/AuthUserContext\";\r\nimport firebase from \"../../../../context/Firebase\";\r\nimport LoggedIn from \"../../../LoggedIn\";\r\nimport { useRouter } from \"next/router\";\r\nimport { fetchClients } from \"../../../../utils/fetchAssociations\";\r\nimport ClientTable from \"../../../../utils/ClientTable\";\r\nimport ClientInfoModal from \"../../ClientInfoModal\";\r\nimport ParentModal from \"../../AddItem/parentModal\";\r\nimport dynamic from \"next/dynamic\";\r\nimport InfoModal from \"../../InfoModal\";\r\nimport MachineSelectionModal from \"./MachineSelectionModal\";\r\nimport { addServiceItem } from \"../../../../utils/BluefolderService\";\r\n\r\nimport NewLocal from \"./NewLocal\";\r\nimport styles from \"../../AddItem/NewItem.module.css\";\r\n\r\n//inflow API\r\nimport InflowAPI from \"../../../../utils/inflowAPI\";\r\nimport {\r\n  buildLocalLocObject,\r\n  formatLoc,\r\n  updateMachineFields,\r\n  buildNameTokens,\r\n} from \"../../../../utils/itemFormShared\";\r\nimport MultiSelectDropdown from \"../../../../components/MultiSelectDropdown\";\r\nimport {\r\n  fetchTrackerCatalog,\r\n  buildAllOems,\r\n  buildModelsForSelection,\r\n  syncTrackerFromSelections,\r\n  deleteTrackerOem,\r\n  deleteTrackerModel,\r\n} from \"../../../../utils/trackerCatalog\";\r\n\r\n// Import for SSR\r\nimport { adminDb } from \"../../../../context/FirebaseAdmin\";\r\n\r\n// This will only load the component on the client-side.\r\nconst BarcodeScannerComponent = dynamic(\r\n  () => import(\"react-qr-barcode-scanner\"),\r\n  { ssr: false }\r\n);\r\n\r\n// Simulates a network request delay.\r\nfunction simulateNetworkRequest() {\r\n  return new Promise((resolve) => setTimeout(resolve, 2000));\r\n}\r\n\r\n// Custom LoadingButton component.\r\nfunction LoadingButton({ type, name, route }) {\r\n  const [isLoading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (isLoading) {\r\n      let cancelled = false;\r\n      simulateNetworkRequest().then(() => {\r\n        if (!cancelled) setLoading(false);\r\n      });\r\n      return () => {\r\n        cancelled = true;\r\n      };\r\n    }\r\n  }, [isLoading]);\r\n\r\n  const handleClick = () => setLoading(true);\r\n\r\n  return (\r\n    <Link href={`/${route}`}>\r\n      <a\r\n        className={`btn btn-${type}`}\r\n        disabled={isLoading}\r\n        onClick={!isLoading ? handleClick : null}\r\n      >\r\n        {isLoading ? \"Loading…\" : name}\r\n      </a>\r\n    </Link>\r\n  );\r\n}\r\n\r\nfunction isValidMachineValue(value) {\r\n  if (value == null) return false;\r\n  if (Array.isArray(value)) {\r\n    return value.some((v) => {\r\n      const trimmed = String(v || \"\").trim();\r\n      return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\r\n    });\r\n  }\r\n  if (typeof value !== \"string\") return Boolean(value);\r\n  const trimmed = value.trim();\r\n  return trimmed !== \"\" && trimmed.toLowerCase() !== \"n/a\";\r\n}\r\n\r\nfunction normalizeSelection(value) {\r\n  if (Array.isArray(value)) {\r\n    return value\r\n      .map((v) => String(v).trim())\r\n      .filter((v) => v && v.toLowerCase() !== \"n/a\");\r\n  }\r\n  if (value == null) return [];\r\n  const normalized = String(value).trim();\r\n  if (!normalized || normalized.toLowerCase() === \"n/a\") return [];\r\n  return [normalized];\r\n}\r\n\r\nfunction uniqueSelection(values) {\r\n  return Array.from(new Set(values || []));\r\n}\r\n\r\nfunction selectionToStoredValue(values) {\r\n  const cleaned = uniqueSelection(normalizeSelection(values));\r\n  if (cleaned.length === 0) return \"\";\r\n  if (cleaned.length === 1) return cleaned[0];\r\n  return cleaned;\r\n}\r\n\r\nfunction selectionToPrintValue(values) {\r\n  const cleaned = uniqueSelection(normalizeSelection(values));\r\n  if (cleaned.length === 0) return \"\";\r\n  if (cleaned.length === 1) return cleaned[0];\r\n  return \"Multi\";\r\n}\r\n\r\nfunction mergeOptionsWithSelection(options, selected) {\r\n  const map = new Map();\r\n  (options || []).forEach((value) => {\r\n    if (value == null) return;\r\n    const normalized = String(value).trim();\r\n    if (!normalized) return;\r\n    map.set(normalized.toLowerCase(), normalized);\r\n  });\r\n  (selected || []).forEach((value) => {\r\n    if (value == null) return;\r\n    const normalized = String(value).trim();\r\n    if (!normalized) return;\r\n    map.set(normalized.toLowerCase(), normalized);\r\n  });\r\n  return Array.from(map.values());\r\n}\r\n\r\n\r\nfunction DisplayItemInner({ initialItem, initialMachineData, error }) {\r\n  // Feature flag to show/hide the 3 Slack buttons\r\n  const SHOW_SLACK_BUTTONS =\r\n    process.env.NEXT_PUBLIC_SHOW_SLACK_BUTTONS === \"true\";\r\n\r\n  const router = useRouter();\r\n  const { signOut } = useAuth();\r\n  // const { id } = router.query;\r\n  const { id: idFromRouter } = router.query;\r\n  const initialId = initialItem?.id || idFromRouter;\r\n  // Use a single local var everywhere in this component\r\n  const id = initialId;\r\n\r\n  const [items, setItems] = useState({\r\n    name: initialItem?.name || \"\",\r\n    pn: Array.isArray(initialItem?.pn)\r\n      ? initialItem.pn\r\n      : (initialItem?.pn ? [initialItem.pn] : []),\r\n    sn: Array.isArray(initialItem?.sn)\r\n      ? initialItem.sn\r\n      : (initialItem?.sn ? [initialItem.sn] : []),\r\n\r\n    // hydrate these from initialItem so SSR renders fully on deploy\r\n    price: initialItem?.price ?? \"\",\r\n    status: initialItem?.status ?? \"\",\r\n    length: initialItem?.length ?? \"\",\r\n    width: initialItem?.width ?? \"\",\r\n    height: initialItem?.height ?? \"\",\r\n    poNumber: initialItem?.poNumber ?? \"\",\r\n    trackingNumber: initialItem?.trackingNumber ?? \"\",\r\n    localSN: initialItem?.localSN || \"\",\r\n    arrival_date: initialItem?.arrival_date || \"\",\r\n    visible: initialItem?.visible ?? true,\r\n  });\r\n  const [savedName, setSavedName] = useState(initialItem?.name || \"\");\r\n  // ⬇️ put this INSIDE DisplayItem, after the related useState hooks\r\n  useEffect(() => {\r\n    if (!initialItem) return;\r\n\r\n    setDescriptions(initialItem.descriptions || []);\r\n    setWorkOrders(initialItem.workOrders || []);\r\n    setDOM(initialItem.DOM || \"\");\r\n\r\n    setItems(prev => ({\r\n      ...prev,\r\n      // only overwrite if SSR provided a value; otherwise keep what you have\r\n      status: initialItem.status ?? prev.status ?? \"\",\r\n      price: initialItem.price ?? prev.price ?? \"\",\r\n      length: initialItem.length ?? prev.length ?? \"\",\r\n      width: initialItem.width ?? prev.width ?? \"\",\r\n      height: initialItem.height ?? prev.height ?? \"\",\r\n      poNumber: initialItem.poNumber ?? prev.poNumber ?? \"\",\r\n      trackingNumber: initialItem.trackingNumber ?? prev.trackingNumber ?? \"\",\r\n    }));\r\n\r\n    if (initialItem.name) {\r\n      setSavedName(initialItem.name);\r\n    }\r\n  }, [initialItem]);\r\n\r\n\r\n\r\n  const [newLocalFrom, setNewLocalFrom] = useState({\r\n    region: \"\",\r\n    section: { letter: \"\", number: \"\" },\r\n    bin: \"\",\r\n    pallet: \"\",\r\n  });\r\n  const [newLocalCurrent, setNewLocalCurrent] = useState({\r\n    region: \"\",\r\n    section: { letter: \"\", number: \"\" },\r\n    bin: \"\",\r\n    pallet: \"\",\r\n  });\r\n\r\n  // New states for separate client selections:\r\n  const [selectedClientFrom, setSelectedClientFrom] = useState(null);\r\n  const [selectedClientCurrent, setSelectedClientCurrent] = useState(null);\r\n\r\n  const [selectedMachine, setSelectedMachine] = useState(null);\r\n  const [selectedCurrentMachine, setSelectedCurrentMachine] = useState(null);\r\n\r\n  // whenever you pick a new “From” client or machine, clear the old From-loc:\r\n  // useEffect(() => {\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientFrom, selectedMachine]);\r\n  // const didMountFrom = useRef(false);\r\n\r\n  // useEffect(() => {\r\n  //   if (!didMountFrom.current) {\r\n  //     // first time through (the data-load phase), don’t clear\r\n  //     didMountFrom.current = true;\r\n  //     return;\r\n  //   }\r\n  //   // thereafter, when the user picks a new client or machine, clear:\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  //   setLocalLocFrom(\"\");\r\n  // }, [selectedClientFrom, selectedMachine]);\r\n\r\n  // whenever you pick a new “Current” client or machine, clear the old Current-loc:\r\n  // useEffect(() => {\r\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\r\n  // const [didFetch, setDidFetch] = useState(false);\r\n\r\n  // useEffect(() => {\r\n  //   if (!didFetch) {\r\n  //     // we’re in the data-load phase, skip clearing\r\n  //     setDidFetch(true);\r\n  //     return;\r\n  //   }\r\n  //   // only clear on subsequent user changes:\r\n  //   setNewLocalCurrent({ region: \"\", section: {}, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\r\n\r\n  // These arrays will be populated from Firebase.\r\n  const [pnOptions, setPnOptions] = useState([]);\r\n  const [snOptions, setSnOptions] = useState([]);\r\n  const [pnSnLoaded, setPnSnLoaded] = useState(false);\r\n  const [pnSnLoading, setPnSnLoading] = useState(false);\r\n\r\n  const [descriptions, setDescriptions] = useState([\r\n    { description: \"\", date: \"\" },\r\n  ]);\r\n  const [workOrders, setWorkOrders] = useState([{ workOrder: \"\", date: \"\" }]);\r\n  const [clients, setClients] = useState([]);\r\n  const [clientsLoaded, setClientsLoaded] = useState(false);\r\n  const [clientsLoading, setClientsLoading] = useState(false);\r\n  const [photos, setPhotos] = useState([]);\r\n  const [show, setShow] = useState(false);\r\n  const [showErr, setShowErr] = useState(false);\r\n  const [Err, setErr] = useState(\"N/A\");\r\n  const [showDescModal, setShowDescModal] = useState(false);\r\n  const [showWoModal, setShowWoModal] = useState(false);\r\n  const [showClientModal, setShowClientModal] = useState(false);\r\n  const [showMachineModal, setShowMachineModal] = useState(false);\r\n  const [showParentModal, setShowParentModal] = useState(false);\r\n  const [showCameraModal, setShowCameraModal] = useState(false);\r\n  const [showSaveModal, setShowSaveModal] = useState(false);\r\n  const [showPrintModal, setShowPrintModal] = useState(false);\r\n  const [machineSelectionModal, setMachineSelectionModal] = useState(false);\r\n  const [selectedDesc, setSelectedDesc] = useState(0);\r\n  const [selectedClient, setSelectedClient] = useState(null);\r\n\r\n  const [selectedParent, setSelectedParent] = useState(null);\r\n  const [TheMachine, setTheMachine] = useState(null);\r\n  const [machineOptions, setMachineOptions] = useState([]);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [capturedPhoto, setCapturedPhoto] = useState(null);\r\n  const [cameraFacing, setCameraFacing] = useState(\"environment\");\r\n  const [addToWebsite, setAddToWebsite] = useState(false);\r\n  const [machinePick, setMachinePick] = useState(false);\r\n  const [freqItem, setFreqItem] = useState(0);\r\n  const [usagePastYear, setUsagePastYear] = useState(0);\r\n  const [machineFrequency, setMachineFrequency] = useState(0);\r\n  // State for the extra (dimensions/price/DOM/PO Number) section.\r\n  const [showExtra, setShowExtra] = useState(false);\r\n\r\n  const [trackerCatalog, setTrackerCatalog] = useState({\r\n    modalities: [],\r\n    oemsByModality: {},\r\n    modelsByModalityOem: {},\r\n    meta: {},\r\n  });\r\n  const [trackerLoading, setTrackerLoading] = useState(false);\r\n  // State for the local warehouse location inputs.\r\n  const [localLocFrom, setLocalLocFrom] = useState(\"\");\r\n  const [localLocCurrent, setLocalLocCurrent] = useState(\"\");\r\n\r\n  // New state for DOM (Date of Manufacture)\r\n  const [DOM, setDOM] = useState(\"\");\r\n  // New state for OEM, Modality, and Model (multi-select).\r\n  const [selectedModalities, setSelectedModalities] = useState([]);\r\n  const [selectedOems, setSelectedOems] = useState([]);\r\n  const [selectedModels, setSelectedModels] = useState([]);\r\n\r\n  const applyMergedMachineFields = (merged, { force = false } = {}) => {\r\n    if (!merged) return;\r\n    const nextOems = uniqueSelection(normalizeSelection(merged.oem));\r\n    const nextModalities = uniqueSelection(normalizeSelection(merged.modality));\r\n    const nextModels = uniqueSelection(normalizeSelection(merged.model));\r\n\r\n    setSelectedOems((prev) => {\r\n      if (!force && prev.length) return prev;\r\n      return nextOems;\r\n    });\r\n    setSelectedModalities((prev) => {\r\n      if (!force && prev.length) return prev;\r\n      return nextModalities;\r\n    });\r\n    setSelectedModels((prev) => {\r\n      if (!force && prev.length) return prev;\r\n      return nextModels;\r\n    });\r\n  };\r\n\r\n  // More info modal state.\r\n  const [showInfoModal, setShowInfoModal] = useState(false);\r\n  const [itemName, setItemName] = useState(\"\");\r\n\r\n  const [machineFieldsInitialized, setMachineFieldsInitialized] =\r\n    useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // near the top of DisplayItem()\r\n  const [showLocalModalFrom, setShowLocalModalFrom] = useState(false);\r\n  const [showLocalModalCurrent, setShowLocalModalCurrent] = useState(false);\r\n\r\n  const openLocalModalFrom = () => setShowLocalModalFrom(true);\r\n  const closeLocalModalFrom = () => setShowLocalModalFrom(false);\r\n  const openLocalModalCurrent = () => setShowLocalModalCurrent(true);\r\n  const closeLocalModalCurrent = () => setShowLocalModalCurrent(false);\r\n\r\n  // at the top of DisplayItem()\r\n  const [showNewLocalModalFrom, setShowNewLocalModalFrom] = useState(false);\r\n  const [showNewLocalModalCurrent, setShowNewLocalModalCurrent] =\r\n    useState(false);\r\n\r\n  // when the From-client changes, clear any old local-loc\r\n  // useEffect(() => {\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientFrom]);\r\n\r\n  // // when the From-machine changes, clear any old local-loc\r\n  // useEffect(() => {\r\n  //   setNewLocalFrom({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedMachine]);\r\n\r\n  // same for Current:\r\n  // useEffect(() => {\r\n  //   setNewLocalCurrent({ region: \"\", section: { letter: \"\", number: \"\" }, bin: \"\", pallet: \"\" });\r\n  // }, [selectedClientCurrent, selectedCurrentMachine]);\r\n\r\n  // const handleSendToInflow = async () => {\r\n  //   try {\r\n  //     const name = items.name;\r\n  //     const description = descriptions[selectedDesc]?.description || \"\";\r\n  //     // gather every photo URL from Firebase Storage\r\n  //     const imageUrls = photos.map((p) => p.url);\r\n  //     await InflowAPI.upsertProduct({ name, description, imageUrls });\r\n  //     alert(\"Sent to inFlow successfully!\");\r\n  //   } catch (err) {\r\n  //     console.error(err);\r\n  //     alert(\"Error sending to inFlow: \" + err.message);\r\n  //   }\r\n  // };\r\n\r\nconst handleSendToInflow = async () => {\r\n  try {\r\n    const name = (items.name || '').trim();\r\n    if (!name) {\r\n      alert('Item needs a name before sending to inFlow.');\r\n      return;\r\n    }\r\n\r\n    // Regular description (don’t also send a custom “Description” unless you truly have one)\r\n    const description = (descriptions[selectedDesc]?.description || '').trim();\r\n\r\n    // Photos already fetched from storage\r\n    const imageUrls = photos.map(p => p.url).filter(Boolean);\r\n\r\n    // SKU = your item id\r\n    const sku = (id ?? '').toString();\r\n\r\n   \r\n\r\n    // Basic normalizers\r\n    const toCSV = arr => (Array.isArray(arr) ? arr.filter(Boolean).join(', ') : (arr || ''));\r\n\r\n    // YYYY-MM-DD for the date field in inFlow\r\n    const arrivalISO = items.arrival_date\r\n      ? new Date(items.arrival_date).toISOString().slice(0, 10)\r\n      : '';\r\n\r\n    const pnStr = Array.isArray(items.pn) ? items.pn.filter(Boolean).join(', ') : (items.pn || '');\r\n    const snStr = Array.isArray(items.sn) ? items.sn.filter(Boolean).join(', ') : (items.sn || '');\r\n\r\n    // Most recent WO (you already have this)\r\n    const mostRecentWO =\r\n      workOrders?.length\r\n        ? workOrders.reduce((latest, cur) => (new Date(cur.date) > new Date(latest.date) ? cur : latest), workOrders[0])\r\n        : { workOrder: '', date: '' };\r\n\r\n    // Build the numbered fields (match your inFlow “Field 1..10”)\r\n    const customFields = {\r\n      custom1: selectionToPrintValue(selectedOems),                      // OEM   (dropdown)\r\n      custom2: selectionToPrintValue(selectedModalities),                 // Modality (dropdown)\r\n      custom3: selectionToPrintValue(selectedModels),                    // Model (dropdown)\r\n      custom4: (description || '').trim(),              // Description (text) - optional duplicate\r\n      custom5: (mostRecentWO.workOrder || '').trim(),   // Work Order (text)\r\n      custom6: (selectedClientFrom?.name || '').trim(), // From (text)\r\n      custom7: pnStr,                                   // Product Number (text)\r\n      custom8: snStr,                                   // Serial Number (text)\r\n      custom9: arrivalISO,                              // Arrival Date (date)\r\n      custom10: (selectedClientCurrent?.name || '').trim(), // Current (text)\r\n    };\r\n\r\n    console.log('[inFlow] customFields to send (numbered):', customFields);\r\n\r\n\r\n    const created = await InflowAPI.upsertProduct({\r\n      name,\r\n      description,\r\n      sku,\r\n      imageUrls,\r\n      customFields,\r\n    });\r\n\r\n    alert(`Sent to inFlow successfully. ID: ${created?.productId || created?.id || '(unknown)'}`);\r\n  } catch (err) {\r\n    console.error(err);\r\n    alert('Error sending to inFlow: ' + err.message);\r\n  }\r\n};\r\n\r\n\r\n  // const [storedMachine, setStoredMachine] = useState(null);\r\n\r\n  // useEffect(() => {\r\n  //   // once any of these three change, re-merge:\r\n  //   if (TheMachine || selectedCurrentMachine || selectedMachine) {\r\n  //     const merged = updateMachineFields(\r\n  //       TheMachine,\r\n  //       selectedCurrentMachine,\r\n  //       selectedMachine\r\n  //     );\r\n  //     setOem(merged.oem);\r\n  //     setModality(merged.modality);\r\n  //     setModel(merged.model);\r\n  //   }\r\n  // }, [TheMachine, selectedCurrentMachine, selectedMachine]);\r\n\r\n  // whenever the “From” client changes:\r\n  useEffect(() => {\r\n    setShowLocalLocFrom(\r\n      selectedClientFrom?.name?.toLowerCase() === \"socalwarehouse\"\r\n    );\r\n  }, [selectedClientFrom]);\r\n\r\n  // whenever the “Current” client changes:\r\n  useEffect(() => {\r\n    setShowLocalLocCurrent(\r\n      selectedClientCurrent?.name?.toLowerCase() === \"socalwarehouse\"\r\n    );\r\n  }, [selectedClientCurrent]);\r\n\r\n  const loadClients = async () => {\r\n    if (clientsLoaded || clientsLoading) return;\r\n    setClientsLoading(true);\r\n    try {\r\n      const clientsData = await fetchClients();\r\n      setClients(clientsData);\r\n      setClientsLoaded(true);\r\n    } catch (error) {\r\n      console.error(\"Error fetching clients: \", error);\r\n    } finally {\r\n      setClientsLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadTracker = useCallback(\r\n    async (force = false) => {\r\n      if (trackerLoading) return;\r\n      if (!force && trackerCatalog.modalities.length) return;\r\n      setTrackerLoading(true);\r\n      try {\r\n        const catalog = await fetchTrackerCatalog();\r\n        setTrackerCatalog(catalog);\r\n      } catch (error) {\r\n        console.error(\"Failed to load tracker catalog:\", error);\r\n      } finally {\r\n        setTrackerLoading(false);\r\n      }\r\n    },\r\n    [trackerLoading, trackerCatalog.modalities.length]\r\n  );\r\n\r\n  useEffect(() => {\r\n    loadTracker();\r\n  }, [loadTracker]);\r\n\r\n  const allOemOptions = useMemo(\r\n    () => buildAllOems(trackerCatalog),\r\n    [trackerCatalog]\r\n  );\r\n\r\n  const modelOptions = useMemo(\r\n    () =>\r\n      buildModelsForSelection(\r\n        trackerCatalog,\r\n        selectedModalities,\r\n        selectedOems\r\n      ),\r\n    [trackerCatalog, selectedModalities, selectedOems]\r\n  );\r\n\r\n  // Keep selected models even if they are not in the catalog yet.\r\n\r\n  const modalityOptionsForUI = useMemo(\r\n    () => mergeOptionsWithSelection(trackerCatalog.modalities, selectedModalities),\r\n    [trackerCatalog.modalities, selectedModalities]\r\n  );\r\n\r\n  const oemOptionsForUI = useMemo(\r\n    () => mergeOptionsWithSelection(allOemOptions, selectedOems),\r\n    [allOemOptions, selectedOems]\r\n  );\r\n\r\n  const modelOptionsForUI = useMemo(\r\n    () => mergeOptionsWithSelection(modelOptions, selectedModels),\r\n    [modelOptions, selectedModels]\r\n  );\r\n\r\n  // Tracker updates are only performed on Save.\r\n\r\n  const handleDeleteOemOption = useCallback(\r\n    async (oem) => {\r\n      if (!oem) return;\r\n      try {\r\n        await deleteTrackerOem({ oem, catalog: trackerCatalog });\r\n        setSelectedOems((prev) => prev.filter((value) => value !== oem));\r\n        loadTracker(true);\r\n      } catch (error) {\r\n        console.error(\"Failed to delete OEM:\", error);\r\n      }\r\n    },\r\n    [trackerCatalog, loadTracker]\r\n  );\r\n\r\n  const handleDeleteModelOption = useCallback(\r\n    async (model) => {\r\n      if (!model || !selectedModalities.length || !selectedOems.length) return;\r\n      try {\r\n        const ops = [];\r\n        selectedModalities.forEach((modalityValue) => {\r\n          selectedOems.forEach((oemValue) => {\r\n            ops.push(\r\n              deleteTrackerModel({\r\n                modality: modalityValue,\r\n                oem: oemValue,\r\n                model,\r\n                catalog: trackerCatalog,\r\n              })\r\n            );\r\n          });\r\n        });\r\n        await Promise.allSettled(ops);\r\n        setSelectedModels((prev) => prev.filter((value) => value !== model));\r\n        loadTracker(true);\r\n      } catch (error) {\r\n        console.error(\"Failed to delete model:\", error);\r\n      }\r\n    },\r\n    [selectedModalities, selectedOems, trackerCatalog, loadTracker]\r\n  );\r\n\r\n  const loadPnSnOptions = async () => {\r\n    if (pnSnLoaded || pnSnLoading) return;\r\n    setPnSnLoading(true);\r\n    try {\r\n      const db = firebase.firestore();\r\n      const snapshot = await db\r\n        .collection(\"Test\")\r\n        .orderBy(firebase.firestore.FieldPath.documentId())\r\n        .limit(500)\r\n        .get();\r\n      let pnSet = new Set();\r\n      let snSet = new Set();\r\n      snapshot.forEach((doc) => {\r\n        const data = doc.data();\r\n        if (Array.isArray(data.pn)) {\r\n          data.pn.forEach((pn) => pn && pnSet.add(pn));\r\n        } else if (data.pn) {\r\n          pnSet.add(data.pn);\r\n        }\r\n        if (Array.isArray(data.sn)) {\r\n          data.sn.forEach((sn) => sn && snSet.add(sn));\r\n        } else if (data.sn) {\r\n          snSet.add(data.sn);\r\n        }\r\n      });\r\n      setPnOptions([...pnSet]);\r\n      setSnOptions([...snSet]);\r\n      setPnSnLoaded(true);\r\n    } catch (error) {\r\n      console.error(\"Error fetching PN/SN options:\", error);\r\n    } finally {\r\n      setPnSnLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  useEffect(() => {\r\n    if (id) fetchData();           // always hydrate on the client\r\n  }, [id]);\r\n\r\n  async function resolveClientFromMachine(\r\n    machineRef,\r\n    setClient,\r\n    setMachine,\r\n    isFrom = true\r\n  ) {\r\n    const machineDoc = await machineRef.get();\r\n    if (machineDoc.exists) {\r\n      const machineData = machineDoc.data();\r\n      setMachine({ id: machineDoc.id, ...machineData });\r\n\r\n      // Determine if the machine is \"interior socal\"\r\n      // const isSocalInterior = machineData.name && machineData.name.toLowerCase() === \"interior socal\";\r\n      // if (isSocalInterior) {\r\n      //   if (isFrom) {\r\n      //     setShowLocalLocFrom(true);\r\n      //   } else {\r\n      //     setShowLocalLocCurrent(true);\r\n      //   }\r\n      // } else {\r\n      // Optionally clear the flag if it is not \"interior socal\"\r\n      // if (isFrom) {\r\n      //   setShowLocalLocFrom(false);\r\n      // } else {\r\n      //   setShowLocalLocCurrent(false);\r\n      // }\r\n      // }\r\n      // new: fetch client name and combine both checks\r\n      const clientDoc =\r\n        machineData.client && typeof machineData.client.get === \"function\"\r\n          ? await machineData.client.get()\r\n          : null;\r\n      const clientName =\r\n        clientDoc && clientDoc.exists ? clientDoc.data().name : null;\r\n      const isSocalInterior =\r\n        machineData.name?.toLowerCase() === \"interior socal\";\r\n      const shouldShow = isSocalInterior || clientName === \"SoCalWarehouse\";\r\n\r\n      if (isFrom) {\r\n        setShowLocalLocFrom(shouldShow);\r\n      } else {\r\n        setShowLocalLocCurrent(shouldShow);\r\n      }\r\n\r\n      if (machineData.client && typeof machineData.client.get === \"function\") {\r\n        const clientDoc = await machineData.client.get();\r\n        if (clientDoc.exists) {\r\n          setClient({ id: clientDoc.id, ...clientDoc.data() });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const fetchData = async () => {\r\n    const id = initialItem?.id || idFromRouter; // <- make sure id exists here\r\n    if (!id) return;\r\n    setIsLoading(true);\r\n    const db = firebase.firestore();\r\n    try {\r\n      const doc = await db.collection(\"Test\").doc(id).get();\r\n      if (doc.exists) {\r\n        console.log(\"test\");\r\n        const data = doc.data();\r\n        const normalizedPN = Array.isArray(data.pn) ? data.pn : [data.pn];\r\n        const normalizedSN = Array.isArray(data.sn) ? data.sn : [data.sn];\r\n        setItems({\r\n          ...data,\r\n          pn: normalizedPN,\r\n          sn: normalizedSN,\r\n        });\r\n        setSavedName(data.name || \"\");\r\n        setDescriptions(data.descriptions || []);\r\n        setWorkOrders(data.workOrders || []);\r\n        if (data.localLocFrom) setLocalLocFrom(data.localLocFrom);\r\n        if (data.localLocCurrent) setLocalLocCurrent(data.localLocCurrent);\r\n        if (data.DOM) {\r\n          setDOM(data.DOM);\r\n        }\r\n\r\n      // …after you do setItems, setDescriptions, etc.\r\n\r\n      // load the “newLocal” maps\r\n      if (data.newLocalFrom) setNewLocalFrom(data.newLocalFrom);\r\n      if (data.newLocalCurrent) setNewLocalCurrent(data.newLocalCurrent);\r\n\r\n      // Load PO Number if it exists.\r\n      if (data.poNumber) {\r\n        setItems((prev) => ({ ...prev, poNumber: data.poNumber }));\r\n      }\r\n\r\n      if (data.ClientFrom) {\r\n        const clientFromDoc = await data.ClientFrom.get();\r\n        if (clientFromDoc.exists) {\r\n          setSelectedClientFrom({\r\n            id: clientFromDoc.id,\r\n            ...clientFromDoc.data(),\r\n          });\r\n        }\r\n      }\r\n      if (data.ClientCurrent) {\r\n        const clientCurrentDoc = await data.ClientCurrent.get();\r\n        if (clientCurrentDoc.exists) {\r\n          setSelectedClientCurrent({\r\n            id: clientCurrentDoc.id,\r\n            ...clientCurrentDoc.data(),\r\n          });\r\n        }\r\n      }\r\n\r\n      if (\r\n        !data.ClientFrom &&\r\n        data.Machine &&\r\n        typeof data.Machine.get === \"function\"\r\n      ) {\r\n        console.log(\r\n          \"Entered resolveClientFromMachine for Machine (old style for From)\"\r\n        );\r\n        await resolveClientFromMachine(\r\n          data.Machine,\r\n          setSelectedClientFrom,\r\n          setSelectedMachine,\r\n          true\r\n        );\r\n      }\r\n      if (\r\n        !data.ClientCurrent &&\r\n        data.CurrentMachine &&\r\n        typeof data.CurrentMachine.get === \"function\"\r\n      ) {\r\n        console.log(\r\n          \"Entered resolveClientFromMachine for CurrentMachine (old style for Current)\"\r\n        );\r\n        await resolveClientFromMachine(\r\n          data.CurrentMachine,\r\n          setSelectedClientCurrent,\r\n          setSelectedCurrentMachine,\r\n          false\r\n        );\r\n      }\r\n\r\n      let machineFromData = null;\r\n      let machineCurrentData = null;\r\n\r\n      if (data.MachineFrom) {\r\n        const doc = await data.MachineFrom.get();\r\n        machineFromData = doc.exists ? doc.data() : null;\r\n        setSelectedMachine({ id: doc.id, ...doc.data() });\r\n      }\r\n      if (data.MachineCurrent) {\r\n        const doc = await data.MachineCurrent.get();\r\n        machineCurrentData = doc.exists ? doc.data() : null;\r\n        setSelectedCurrentMachine({ id: doc.id, ...doc.data() });\r\n      }\r\n      const nameFrom = machineFromData?.name?.toLowerCase();\r\n      const nameCurrent = machineCurrentData?.name?.toLowerCase();\r\n\r\n      // If the machine’s name is “interior socal”, show that branch:\r\n      // setShowLocalLocFrom(nameFrom === \"interior socal\");\r\n      // // Or if your Firestore already has a value for localLocFrom, show it anyway:\r\n      // if (data.localLocFrom) setShowLocalLocFrom(true);\r\n\r\n      // setShowLocalLocCurrent(nameCurrent === \"interior socal\");\r\n      // if (data.localLocCurrent) setShowLocalLocCurrent(true);\r\n      // new: combine machine-name OR client-name check, keep existing-data\r\n      setShowLocalLocFrom(\r\n        nameFrom === \"interior socal\" ||\r\n          selectedClientFrom?.name?.toLowerCase() === \"socalwarehouse\" ||\r\n          Boolean(data.localLocFrom)\r\n      );\r\n      setShowLocalLocCurrent(\r\n        nameCurrent === \"interior socal\" ||\r\n          selectedClientCurrent?.name?.toLowerCase() === \"socalwarehouse\" ||\r\n          Boolean(data.localLocCurrent)\r\n      );\r\n\r\n      const theMachineData = data.TheMachine || null;\r\n\r\n      setTheMachine(theMachineData);\r\n      if (theMachineData) {\r\n        // pull both variants, prefer lowercase if it exists\r\n        const OEM = theMachineData.oem ?? theMachineData.OEM;\r\n        const Modality = theMachineData.modality ?? theMachineData.Modality;\r\n        const Model = theMachineData.model ?? theMachineData.Model;\r\n        setTheMachine({ ...theMachineData, OEM, Modality, Model });\r\n      }\r\n      // setStoredMachine(theMachineData);\r\n\r\n      // **right here** merge from the three sources you just fetched:\r\n      const merged = updateMachineFields(\r\n        theMachineData,\r\n        machineCurrentData,\r\n        machineFromData\r\n      );\r\n      applyMergedMachineFields(merged);\r\n\r\n      console.log(\r\n        \"SelectedMachine:\",\r\n        selectedMachine,\r\n        \"SelectedCurrentMachine:\",\r\n        selectedCurrentMachine\r\n      );\r\n      // Show local loc inputs if applicable\r\n      // if (\r\n      //   selectedMachine &&\r\n      //   selectedMachine.name &&\r\n      //   selectedMachine.name.toLowerCase() === \"interior socal\"\r\n      // ) {\r\n      //   setShowLocalLocFrom(true);\r\n      // }\r\n      // if (\r\n      //   selectedCurrentMachine &&\r\n      //   selectedCurrentMachine.name &&\r\n      //   selectedCurrentMachine.name.toLowerCase() === \"interior socal\"\r\n      // ) {\r\n      //   setShowLocalLocCurrent(true);\r\n      // }\r\n\r\n      if (data.Parent) {\r\n        const parentDoc = await data.Parent.get();\r\n        setSelectedParent({ id: parentDoc.id, ...parentDoc.data() });\r\n      }\r\n\r\n      // Priority auto‑population of machine fields.\r\n      // const updatedFields = updateMachineFields(storedMachine, selectedCurrentMachine, selectedMachine);\r\n      // // console.log(\"Updated machine fields:\", updatedFields);\r\n      // setOem(updatedFields.oem);\r\n      // setModality(updatedFields.modality);\r\n      // setModel(updatedFields.model);\r\n\r\n        setIsLoading(false);\r\n        Promise.all([\r\n          fetchPhotos(id),\r\n          checkIfAddedToWebsite(id),\r\n          calculateItemFrequencyAndUsage(data.pn),\r\n        ]).catch((err) => {\r\n          console.error(\"Background item loads failed:\", err);\r\n        });\r\n      } else {\r\n        router.push({\r\n          pathname: \"../AddItem/NewItem\",\r\n          query: { signal: id },\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching item:\", error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const calculateItemFrequencyAndUsage = async (pn) => {\r\n    const db = firebase.firestore();\r\n    const currentDate = new Date();\r\n    const oneYearAgo = new Date();\r\n    oneYearAgo.setFullYear(currentDate.getFullYear() - 1);\r\n\r\n    const normalizedPN = pn !== undefined ? pn : \"\";\r\n    const itemsSnapshot = await db\r\n      .collection(\"Test\")\r\n      .where(\"pn\", \"==\", normalizedPN)\r\n      .get();\r\n\r\n    setFreqItem(itemsSnapshot.size);\r\n\r\n    let usagePastYear = 0;\r\n    itemsSnapshot.forEach((doc) => {\r\n      const itemData = doc.data();\r\n      itemData.workOrders.forEach((workOrder) => {\r\n        const workOrderDate = new Date(workOrder.date);\r\n        if (workOrderDate >= oneYearAgo && workOrderDate <= currentDate) {\r\n          usagePastYear++;\r\n        }\r\n      });\r\n    });\r\n    setUsagePastYear(usagePastYear);\r\n  };\r\n\r\n  const fetchMachine = async (machineId) => {\r\n    const db = firebase.firestore();\r\n    const doc = await db.collection(\"Machine\").doc(machineId).get();\r\n    if (doc.exists) {\r\n      const machineData = doc.data();\r\n      setTheMachine(machineData);\r\n      // re-merge all three sources with correct priority:\r\n      const merged = updateMachineFields(\r\n        machineData,\r\n        selectedCurrentMachine,\r\n        selectedMachine\r\n      );\r\n      applyMergedMachineFields(merged, { force: true });\r\n      const machinesSnapshot = await db\r\n        .collection(\"Machine\")\r\n        .where(\"Model\", \"==\", machineData.Model || machineData.model)\r\n        .get();\r\n      setMachineFrequency(machinesSnapshot.size);\r\n    } else {\r\n      console.error(\"Machine not found\");\r\n    }\r\n  };\r\n\r\n  const fetchPhotos = async (docID) => {\r\n    const storageRef = firebase.storage().ref();\r\n    const listRef = storageRef.child(`Parts/${docID}`);\r\n    try {\r\n      const res = await listRef.listAll();\r\n      const urls = await Promise.all(\r\n        res.items.map((item) => item.getDownloadURL())\r\n      );\r\n      setPhotos(urls.map((url) => ({ url, file: null })));\r\n    } catch (error) {\r\n      console.error(\"Error fetching photos: \", error);\r\n    }\r\n  };\r\n\r\n  const checkIfAddedToWebsite = async (docID) => {\r\n    const db = firebase.firestore();\r\n    const partsDoc = await db.collection(\"Parts\").doc(docID).get();\r\n    if (partsDoc.exists) {\r\n      setAddToWebsite(true);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => setShow(false);\r\n  const handleShow = () => setShow(true);\r\n  const handleCloseErr = () => setShowErr(false);\r\n  const handleShowErr = () => setShowErr(true);\r\n  const handleCloseSaveModal = () => setShowSaveModal(false);\r\n  const handleClosePrintModal = () => setShowPrintModal(false);\r\n  const handleShowSaveModal = () => setShowSaveModal(true);\r\n  const handleShowPrintModal = () => setShowPrintModal(true);\r\n  const handleMachineSelectionModal = () => setMachineSelectionModal(false);\r\n  const handleCloseDescModal = () => setShowDescModal(false);\r\n  const handleShowDescModal = () => setShowDescModal(true);\r\n  const handleCloseWoModal = () => setShowWoModal(false);\r\n  const handleShowWoModal = () => setShowWoModal(true);\r\n  const handleCloseClientModal = () => setShowClientModal(false);\r\n  const handleShowClientModal = async () => {\r\n    await loadClients();\r\n    setShowClientModal(true);\r\n  };\r\n  const handleCloseMachineModal = () => setShowMachineModal(false);\r\n  const handleShowMachineModal = () => {\r\n    setShowMachineModal(true);\r\n    setShowClientModal(false);\r\n  };\r\n  const handleCloseParentModal = () => setShowParentModal(false);\r\n  const handleShowParentModal = () => setShowParentModal(true);\r\n\r\n  // When a client is selected from the client table.\r\n  const handleClientInfo = async (clientId) => {\r\n    // Clear any previously selected machine and local loc info for this branch.\r\n    if (machinePick) {\r\n      setSelectedMachine(null);\r\n      setShowLocalLocFrom(false);\r\n    } else {\r\n      setSelectedCurrentMachine(null);\r\n      setShowLocalLocCurrent(false);\r\n    }\r\n\r\n    const db = firebase.firestore();\r\n    const clientDoc = await db.collection(\"Client\").doc(clientId).get();\r\n    if (clientDoc.exists) {\r\n      const clientData = { id: clientDoc.id, ...clientDoc.data() };\r\n      if (machinePick) {\r\n        setSelectedClientFrom(clientData);\r\n      } else {\r\n        setSelectedClientCurrent(clientData);\r\n      }\r\n      // after setting selectedClientFrom/Current:\r\n      if (clientData.name === \"SoCalWarehouse\") {\r\n        if (machinePick) setShowLocalLocFrom(true);\r\n        else setShowLocalLocCurrent(true);\r\n      }\r\n      // Fetch machines for this client:\r\n      const machinePromises = clientData.machines.map((machineRef) =>\r\n        machineRef.get()\r\n      );\r\n      const machineDocs = await Promise.all(machinePromises);\r\n      const machines = machineDocs.map((machineDoc) => ({\r\n        id: machineDoc.id,\r\n        ...machineDoc.data(),\r\n      }));\r\n      setMachineOptions(machines);\r\n      // Close the client modal\r\n      handleCloseClientModal();\r\n    }\r\n  };\r\n\r\n  // Reordering function for dropdowns.\r\n  const reorderArray = (arr, selectedValue) => {\r\n    const newArr = arr.filter((val) => val !== selectedValue);\r\n    return [selectedValue, ...newArr];\r\n  };\r\n\r\n  const [addingNewPn, setAddingNewPn] = useState(false);\r\n  const [newPn, setNewPn] = useState(\"\");\r\n  const [addingNewSn, setAddingNewSn] = useState(false);\r\n  const [newSn, setNewSn] = useState(\"\");\r\n\r\n  const handlePnSelect = (e) => {\r\n    const selected = e.target.value;\r\n    setItems((prev) => {\r\n      let updatedPn = Array.isArray(prev.pn) ? [...prev.pn] : [];\r\n      updatedPn[0] = selected;\r\n      return { ...prev, pn: updatedPn };\r\n    });\r\n  };\r\n\r\n  const handleSnSelect = (e) => {\r\n    const selected = e.target.value;\r\n    setItems((prev) => {\r\n      let updatedSn = Array.isArray(prev.sn) ? [...prev.sn] : [];\r\n      updatedSn[0] = selected;\r\n      return { ...prev, sn: updatedSn };\r\n    });\r\n  };\r\n\r\n  const handleAddNewPn = () => {\r\n    if (newPn.trim() !== \"\") {\r\n      setItems((prev) => ({\r\n        ...prev,\r\n        pn: [...prev.pn, newPn.trim()],\r\n      }));\r\n    }\r\n    setNewPn(\"\");\r\n    setAddingNewPn(false);\r\n  };\r\n\r\n  const handleAddNewSn = () => {\r\n    if (newSn.trim() !== \"\") {\r\n      setItems((prev) => ({\r\n        ...prev,\r\n        sn: [...prev.sn, newSn.trim()],\r\n      }));\r\n    }\r\n    setNewSn(\"\");\r\n    setAddingNewSn(false);\r\n  };\r\n\r\n  // Generate custom document ID if needed.\r\n  const generateCustomID = () => {\r\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\r\n    return `AIS${randomNum}`;\r\n  };\r\n\r\n  function shallowClean(obj) {\r\n    const newObj = {};\r\n    for (const key in obj) {\r\n      console.log(key, obj[key]);\r\n      if (obj.hasOwnProperty(key)) {\r\n        newObj[key] = obj[key] === undefined ? \"\" : obj[key];\r\n      }\r\n    }\r\n    return newObj;\r\n  }\r\n\r\n  async function toSend() {\r\n    const db = firebase.firestore();\r\n    const currentUser = firebase.auth().currentUser;\r\n    const userEmail = currentUser ? currentUser.email : \"unknown\";\r\n\r\n    // Always use the current state values for OEM, modality, and model.\r\n    const storedOem = selectionToStoredValue(selectedOems);\r\n    const storedModality = selectionToStoredValue(selectedModalities);\r\n    const storedModel = selectionToStoredValue(selectedModels);\r\n    const machineData = {\r\n      ...(TheMachine || {}),\r\n      oem: storedOem,\r\n      OEM: storedOem,\r\n      modality: storedModality,\r\n      Modality: storedModality,\r\n      model: storedModel,\r\n      Model: storedModel,\r\n    };\r\n\r\n    const formattedItems = { ...items, descriptions, workOrders };\r\n    // Remove any unused fields.\r\n    formattedItems.status = items.status || \"\";\r\n    formattedItems.nameLower = (items.name || \"\").toLowerCase();\r\n    formattedItems.nameTokens = buildNameTokens(items.name);\r\n    formattedItems.DOM = DOM; // Date of Manufacture\r\n    formattedItems.localLocFrom = localLocFrom || \"\";\r\n    formattedItems.localLocCurrent = localLocCurrent || \"\";\r\n    formattedItems.date = items.date || \"\";\r\n    formattedItems.arrival_date = items.arrival_date || \"\"; // NEW: Arrival Date\r\n    formattedItems.poNumber = items.poNumber || \"\";\r\n    formattedItems.trackingNumber = items.trackingNumber || \"\";\r\n    formattedItems.TheMachine = machineData || {};\r\n    formattedItems.addedToWebsite = addToWebsite;\r\n\r\n    // NEW: Add the user's email under the field \"user\"\r\n    formattedItems.lastEdited = userEmail;\r\n\r\n    // Clean pn and sn arrays to replace undefined values with an empty string.\r\n    formattedItems.pn = (items.pn || []).map((value) =>\r\n      value === undefined ? \"\" : value\r\n    );\r\n    formattedItems.sn = (items.sn || []).map((value) =>\r\n      value === undefined ? \"\" : value\r\n    );\r\n\r\n    const fromDetails = buildLocalLocObject(newLocalFrom);\r\n    const currentDetails = buildLocalLocObject(newLocalCurrent);\r\n\r\n    console.log(\r\n      \"From Details: \" +\r\n        fromDetails.region +\r\n        \" \" +\r\n        fromDetails.section?.letter +\r\n        fromDetails.section?.number +\r\n        \" \" +\r\n        fromDetails.bin +\r\n        \" \" +\r\n        fromDetails.pallet\r\n    );\r\n    console.log(\r\n      \"Current Details: \" +\r\n        currentDetails.region +\r\n        \" \" +\r\n        currentDetails.section?.letter +\r\n        currentDetails.section?.number +\r\n        \" \" +\r\n        currentDetails.bin +\r\n        \" \" +\r\n        currentDetails.pallet\r\n    );\r\n\r\n    if (Object.keys(fromDetails).length) {\r\n      formattedItems.newLocalFrom = fromDetails;\r\n      formattedItems.localLocFrom = formatLoc(newLocalFrom) || \"\";\r\n    } else {\r\n      // all fields empty — force an empty string and remove any stray map\r\n      console.log(\"entered empty fromDetails else\");\r\n      formattedItems.localLocFrom = \"\";\r\n      formattedItems.newLocalFrom = {};\r\n    }\r\n\r\n    if (Object.keys(currentDetails).length) {\r\n      formattedItems.newLocalCurrent = currentDetails;\r\n      formattedItems.localLocCurrent = formatLoc(newLocalCurrent) || \"\";\r\n    } else {\r\n      // all fields empty — force an empty string and remove any stray map\r\n      formattedItems.localLocCurrent = \"\";\r\n      formattedItems.newLocalCurrent = {};\r\n    }\r\n\r\n    if (selectedMachine && selectedMachine.id) {\r\n      formattedItems.MachineFrom = db\r\n        .collection(\"Machine\")\r\n        .doc(selectedMachine.id);\r\n    }\r\n\r\n    if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n      formattedItems.MachineCurrent = db\r\n        .collection(\"Machine\")\r\n        .doc(selectedCurrentMachine.id);\r\n    }\r\n\r\n    if (selectedParent && selectedParent.id) {\r\n      formattedItems.Parent = db.collection(\"Test\").doc(selectedParent.id);\r\n    }\r\n\r\n    // NEW: Set separate client references.\r\n    if (selectedClientFrom && selectedClientFrom.id) {\r\n      formattedItems.ClientFrom = db\r\n        .collection(\"Client\")\r\n        .doc(selectedClientFrom.id);\r\n    }\r\n    if (selectedClientCurrent && selectedClientCurrent.id) {\r\n      formattedItems.ClientCurrent = db\r\n        .collection(\"Client\")\r\n        .doc(selectedClientCurrent.id);\r\n    }\r\n\r\n    // Only attach the richer “newLocal” map when the user actually filled something in\r\n    if (Object.keys(fromDetails).length) {\r\n      formattedItems.newLocalFrom = fromDetails;\r\n    }\r\n    if (Object.keys(currentDetails).length) {\r\n      formattedItems.newLocalCurrent = currentDetails;\r\n    }\r\n\r\n    let docId = id;\r\n    try {\r\n      if (docId) {\r\n        // Check if a localSN is provided and if it differs from the current docId.\r\n        const newDocId =\r\n          items.localSN && items.localSN.trim() !== \"\"\r\n            ? items.localSN.trim()\r\n            : docId;\r\n        if (docId !== newDocId) {\r\n          // Migrate: Create a new document with the newDocId.\r\n          await db.collection(\"Test\").doc(newDocId).set(formattedItems);\r\n\r\n          if (selectedMachine && selectedMachine.id) {\r\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\r\n            const machineDoc = await machineRef.get();\r\n            if (machineDoc.exists) {\r\n              await machineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(newDocId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n\r\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n            const currentMachineRef = db\r\n              .collection(\"Machine\")\r\n              .doc(selectedCurrentMachine.id);\r\n            const currentMachineDoc = await currentMachineRef.get();\r\n            if (currentMachineDoc.exists) {\r\n              await currentMachineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(newDocId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n          // Delete the old document.\r\n          await db.collection(\"Test\").doc(docId).delete();\r\n          // Set docId to the new document ID.\r\n          docId = newDocId;\r\n        } else {\r\n          // Deep-clean the formattedItems to remove any undefined nested values.\r\n          const cleanFormattedItems = shallowClean(formattedItems);\r\n          await db.collection(\"Test\").doc(docId).update(cleanFormattedItems);\r\n\r\n          if (selectedMachine && selectedMachine.id) {\r\n            const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\r\n            const machineDoc = await machineRef.get();\r\n            if (machineDoc.exists) {\r\n              await machineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(docId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n\r\n          if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n            const currentMachineRef = db\r\n              .collection(\"Machine\")\r\n              .doc(selectedCurrentMachine.id);\r\n            const currentMachineDoc = await currentMachineRef.get();\r\n            if (currentMachineDoc.exists) {\r\n              await currentMachineRef.update({\r\n                associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                  db.collection(\"Test\").doc(docId)\r\n                ),\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // For a new item, if localSN is provided, use it; otherwise, generate a custom ID.\r\n        docId =\r\n          items.localSN && items.localSN.trim() !== \"\"\r\n            ? items.localSN.trim()\r\n            : generateCustomID();\r\n        await db.collection(\"Test\").doc(docId).set(formattedItems);\r\n\r\n        if (selectedMachine && selectedMachine.id) {\r\n          const machineRef = db.collection(\"Machine\").doc(selectedMachine.id);\r\n          const machineDoc = await machineRef.get();\r\n          if (machineDoc.exists) {\r\n            await machineRef.update({\r\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                db.collection(\"Test\").doc(docId)\r\n              ),\r\n            });\r\n          }\r\n        }\r\n\r\n        if (selectedCurrentMachine && selectedCurrentMachine.id) {\r\n          const currentMachineRef = db\r\n            .collection(\"Machine\")\r\n            .doc(selectedCurrentMachine.id);\r\n          const currentMachineDoc = await currentMachineRef.get();\r\n          if (currentMachineDoc.exists) {\r\n            await currentMachineRef.update({\r\n              associatedParts: firebase.firestore.FieldValue.arrayUnion(\r\n                db.collection(\"Test\").doc(docId)\r\n              ),\r\n            });\r\n          }\r\n        }\r\n      }\r\n      // Update Tracker only on Save.\r\n      try {\r\n        const selections = {\r\n          modalities: selectedModalities,\r\n          oems: selectedOems,\r\n          models: selectedModels,\r\n        };\r\n        const updated = await syncTrackerFromSelections({\r\n          selections,\r\n          catalog: trackerCatalog,\r\n        });\r\n        if (updated) {\r\n          loadTracker(true);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Failed to sync tracker selections:\", error);\r\n      }\r\n\r\n      // Upload any new photos to Firebase Storage.\r\n      await uploadPhotos(docId);\r\n      console.log(\"Item saved and associatedParts updated!\");\r\n\r\n      setSavedName(items.name || \"\");\r\n\r\n      // Redirect to the new URL using the new document id.\r\n      router.push(`/NewSearch/item/${docId}`);\r\n\r\n      // Optionally, you can also show a save confirmation modal:\r\n      handleShowSaveModal();\r\n    } catch (error) {\r\n      console.error(\"Error saving data:\", error);\r\n    }\r\n  }\r\n\r\n  // Additional state for local warehouse location inputs.\r\n  const [showLocalLocFrom, setShowLocalLocFrom] = useState(false);\r\n  const [showLocalLocCurrent, setShowLocalLocCurrent] = useState(false);\r\n\r\n  // When a machine is selected from the modal.\r\n  const handleSetSelectedMachine = (machine) => {\r\n    // const condition = (name) => name && name.toLowerCase() === \"interior socal\";\r\n    const isSocalInterior = machine.name?.toLowerCase() === \"interior socal\";\r\n\r\n    if (machinePick) {\r\n      setSelectedMachine({ id: machine.id, name: machine.name });\r\n      setShowLocalLocFrom(\r\n        isSocalInterior ||\r\n          selectedClientFrom?.name?.toLowerCase() === \"socalwarehouse\"\r\n      );\r\n    } else {\r\n      setSelectedCurrentMachine({ id: machine.id, name: machine.name });\r\n      setShowLocalLocCurrent(\r\n        isSocalInterior ||\r\n          selectedClientCurrent?.name?.toLowerCase() === \"socalwarehouse\"\r\n      );\r\n    }\r\n    fetchMachine(machine.id);\r\n    // Close the machine modal (assuming you're using showMachineModal to control it)\r\n    setShowMachineModal(false);\r\n  };\r\n\r\n  const uploadPhotos = async (docID) => {\r\n    const storageRef = firebase.storage().ref();\r\n    for (let i = 0; i < photos.length; i++) {\r\n      if (photos[i].file) {\r\n        const photoRef = storageRef.child(\r\n          `Parts/${docID}/${docID}${i === 0 ? \".jpg\" : `.${i + 1}.jpg`}`\r\n        );\r\n        const metadata = {\r\n          contentType: \"image/png\",\r\n        };\r\n        await photoRef.put(photos[i].file, metadata);\r\n        const url = await photoRef.getDownloadURL();\r\n        photos[i].url = url;\r\n      }\r\n    }\r\n  };\r\n\r\n  // Function to handle printing the label.\r\n  const handlePrint = async () => {\r\n    if (!items.name) {\r\n      alert(\"Missing name\");\r\n      return;\r\n    }\r\n\r\n    let clientName = \"\";\r\n\r\n    // Attempt to fetch client name from the Machine document reference.\r\n    if (items.Machine && typeof items.Machine.get === \"function\") {\r\n      try {\r\n        const machineDoc = await items.Machine.get();\r\n        if (machineDoc.exists) {\r\n          const machineData = machineDoc.data();\r\n          if (\r\n            machineData.client &&\r\n            typeof machineData.client.get === \"function\"\r\n          ) {\r\n            const clientDoc = await machineData.client.get();\r\n            if (clientDoc.exists) {\r\n              clientName = clientDoc.data().name || \"\";\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching machine or client:\", error);\r\n      }\r\n    } else {\r\n      console.warn(\"No Machine reference available in the item\");\r\n    }\r\n    console.log(clientName, \":\", items.client);\r\n    // Fallback: if no client name was found, check items.client.\r\n    if (!clientName && items.client) {\r\n      if (typeof items.client.get === \"function\") {\r\n        try {\r\n          const clientDoc = await items.client.get();\r\n          if (clientDoc.exists) {\r\n            clientName = clientDoc.data().name || \"\";\r\n          }\r\n        } catch (error) {\r\n          console.error(\"Error fetching client from items.client:\", error);\r\n        }\r\n      } else {\r\n        clientName = items.client;\r\n      }\r\n    }\r\n    console.log(\"descriptions:\", descriptions[selectedDesc]);\r\n    const payload = {\r\n      name: items.name,\r\n      pn: items.pn,\r\n      sn: items.sn,\r\n      wo: workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\",\r\n      client: clientName,\r\n      status: items.status,\r\n      local_sn: id,\r\n      descriptions: [\r\n        descriptions[selectedDesc] || { description: \"\", date: \"\" },\r\n      ],\r\n      date: items.dateCreated || \"\",\r\n      DOM: DOM,\r\n      oem: selectionToPrintValue(selectedOems),\r\n      modality: selectionToPrintValue(selectedModalities),\r\n      model: selectionToPrintValue(selectedModels),\r\n      poNumber: items.poNumber,\r\n      arrival_date: items.arrival_date, // NEW: Include arrival_date\r\n    };\r\n\r\n    console.log(\"Payload for printing:\", payload);\r\n    try {\r\n      const response = await fetch(\r\n        \"https://9d70-174-76-22-138.ngrok-free.app/print-label\",\r\n        {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(payload),\r\n        }\r\n      );\r\n      const result = await response.json();\r\n      console.log(\"Print result:\", result.status);\r\n\r\n      if (result.status.includes(\"successfully.\")) {\r\n        handleShowPrintModal();\r\n      } else {\r\n        console.error(\"Error printing label:\", result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error printing label:\", error);\r\n    }\r\n  };\r\n\r\n  async function handleSubmit(event) {\r\n    event.preventDefault();\r\n    // Only check that the Name field is filled out.\r\n    if (!items.name) {\r\n      handleShow(); // This shows the \"missing field\" modal.\r\n    } else {\r\n      toSend();\r\n    }\r\n  }\r\n\r\n  // Handlers for input changes.\r\n  const handleChange = (field) => (event) => {\r\n    const value = event.target ? event.target.value : event.value;\r\n    setItems((prevItems) => ({ ...prevItems, [field]: value }));\r\n  };\r\n\r\n  const addDescription = () => {\r\n    setDescriptions([...descriptions, { description: \"\", date: \"\" }]);\r\n  };\r\n\r\n  const removeDescription = (index) => {\r\n    setDescriptions(descriptions.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleDescriptionChange = (index, field, value) => {\r\n    const newDescriptions = descriptions.map((desc, i) =>\r\n      i === index ? { ...desc, [field]: value } : desc\r\n    );\r\n    setDescriptions(newDescriptions);\r\n  };\r\n\r\n  const addWorkOrder = () => {\r\n    setWorkOrders([...workOrders, { workOrder: \"\", date: \"\" }]);\r\n  };\r\n\r\n  const removeWorkOrder = (index) => {\r\n    setWorkOrders(workOrders.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleWorkOrderChange = (index, field, value) => {\r\n    const newWorkOrders = workOrders.map((wo, i) =>\r\n      i === index ? { ...wo, [field]: value } : wo\r\n    );\r\n    setWorkOrders(newWorkOrders);\r\n  };\r\n\r\n  const listDescriptions = () => {\r\n    setShowDescModal(true);\r\n  };\r\n\r\n  const selectDescription = (index) => {\r\n    setSelectedDesc(index);\r\n    setShowDescModal(false);\r\n  };\r\n\r\n  const handleShowCameraModal = () => {\r\n    setShowCameraModal(true);\r\n  };\r\n\r\n  const handleCloseCameraModal = () => {\r\n    setShowCameraModal(false);\r\n    setCapturedPhoto(null);\r\n  };\r\n\r\n  const handleCapture = (err, result) => {\r\n    if (result) {\r\n      setCapturedPhoto(result);\r\n    }\r\n  };\r\n\r\n  const savePhoto = () => {\r\n    setPhotos((prevPhotos) => [\r\n      ...prevPhotos,\r\n      { file: capturedPhoto, url: URL.createObjectURL(capturedPhoto) },\r\n    ]);\r\n    setCapturedPhoto(null);\r\n    handleCloseCameraModal();\r\n  };\r\n\r\n  const removePhoto = (index) => {\r\n    setPhotos(photos.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const mostRecentWorkOrder =\r\n    workOrders && workOrders.length > 0\r\n      ? workOrders.reduce((latest, current) => {\r\n          const latestDate = new Date(latest.date);\r\n          const currentDate = new Date(current.date);\r\n          return currentDate > latestDate ? current : latest;\r\n        }, workOrders[0])\r\n      : {};\r\n\r\n  const capturePhoto = () => {\r\n    const video = document.querySelector(\"video\");\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n    const context = canvas.getContext(\"2d\");\r\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    canvas.toBlob((blob) => {\r\n      setCapturedPhoto(blob);\r\n    }, \"image/png\");\r\n  };\r\n\r\n  const handleShowInfoModal = async () => {\r\n    const db = firebase.firestore();\r\n    try {\r\n      const doc = await db.collection(\"Test\").doc(id).get();\r\n      if (doc.exists) {\r\n        const data = doc.data();\r\n        setItemName(data.name || \"N/A\");\r\n        setShowInfoModal(true);\r\n      } else {\r\n        console.error(\"Item not found\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching item info:\", error);\r\n    }\r\n  };\r\n\r\n  const handleCloseInfoModal = () => setShowInfoModal(false);\r\n  const handleCloneToNewItem = () => {\r\n    if (!id) {\r\n      setErr(\"Item ID not ready yet.\");\r\n      setShowErr(true);\r\n      return;\r\n    }\r\n    router.push(`/NewSearch/AddItem/NewItem?cloneFrom=${encodeURIComponent(id)}`);\r\n  };\r\n\r\n  const handlePnChange = (index, value) => {\r\n    setItems((prev) => {\r\n      const newPn = [...prev.pn];\r\n      newPn[index] = value;\r\n      return { ...prev, pn: newPn };\r\n    });\r\n  };\r\n\r\n  const addPn = () => {\r\n    setItems((prev) => ({\r\n      ...prev,\r\n      pn: [...prev.pn, \"\"],\r\n    }));\r\n  };\r\n\r\n  const handleSnChange = (index, value) => {\r\n    setItems((prev) => {\r\n      const newSn = [...prev.sn];\r\n      newSn[index] = value;\r\n      return { ...prev, sn: newSn };\r\n    });\r\n  };\r\n\r\n  const addSn = () => {\r\n    setItems((prev) => ({\r\n      ...prev,\r\n      sn: [...prev.sn, \"\"],\r\n    }));\r\n  };\r\n\r\n  const browseInputRef = useRef(null);\r\n\r\n  const handleBrowsePhotos = () => {\r\n    if (browseInputRef.current) {\r\n      browseInputRef.current.click();\r\n    }\r\n  };\r\n\r\n  const handleFilesSelected = (e) => {\r\n    const files = e.target.files;\r\n    if (files.length) {\r\n      const newPhotos = [];\r\n      for (let i = 0; i < files.length; i++) {\r\n        newPhotos.push({\r\n          file: files[i],\r\n          url: URL.createObjectURL(files[i]),\r\n        });\r\n      }\r\n      setPhotos((prevPhotos) => [...prevPhotos, ...newPhotos]);\r\n    }\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  const [currentPnIndex, setCurrentPnIndex] = useState(0);\r\n  const [showDropdown, setShowDropdown] = useState(false);\r\n  const [currentSnIndex, setCurrentSnIndex] = useState(0);\r\n  const [showSnDropdown, setShowSnDropdown] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (showDropdown || showSnDropdown) {\r\n      loadPnSnOptions();\r\n    }\r\n  }, [showDropdown, showSnDropdown]);\r\n\r\n  const handleAddNewClient = () => {\r\n    const randomNum = Math.floor(10000 + Math.random() * 90000);\r\n    router.push(\r\n      `../client/AIS${randomNum}/addClient?from=item&itemId=${id || \"\"}`\r\n    );\r\n  };\r\n\r\n  const handleBluefolderButton = async () => {\r\n    // Check that the work order field is filled out (using workOrders[0].workOrder as current)\r\n    const currentWorkOrder =\r\n      workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\";\r\n    if (!currentWorkOrder) {\r\n      alert(\r\n        \"Please fill out the work order field before adding to BlueFolder.\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Build the payload to send to your proxy endpoint.\r\n    const payload = {\r\n      name: items.name,\r\n      pn: items.pn[0] || \"\",\r\n      sn: items.sn[0] || \"\",\r\n      status: items.status,\r\n      description: descriptions[selectedDesc]?.description || \"\",\r\n      workOrder: currentWorkOrder,\r\n      localsn: items.localSN || \"\",\r\n    };\r\n\r\n    try {\r\n      // Replace with your ngrok URL and appropriate endpoint path (e.g., /api/bluefolder)\r\n      const response = await fetch(\r\n        \"https://9d70-174-76-22-138.ngrok-free.app/bluefolder\",\r\n        {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify(payload),\r\n        }\r\n      );\r\n      const result = await response.json();\r\n      alert(\"BlueFolder service item added successfully!\");\r\n      console.log(\"BlueFolder result:\", result);\r\n    } catch (error) {\r\n      console.error(\"BlueFolder error:\", error);\r\n      alert(\"Error adding data to BlueFolder.\");\r\n    }\r\n  };\r\n\r\n// // Slack integration handler.\r\n// const handleAddToSlack = async (which) => {\r\n//   try {\r\n//     const pn0 = Array.isArray(items.pn) ? items.pn[0] : items.pn;\r\n//     const sn0 = Array.isArray(items.sn) ? items.sn[0] : items.sn;\r\n\r\n//     const linkUrl = typeof window !== \"undefined\" ? window.location.href : \"\";\r\n//     const safeName = (items?.name || id || \"Untitled\").trim();\r\n//     const title = `${safeName}${id ? ` (${id})` : \"\"}`;\r\n\r\n//     console.log(\"[SLACK][handleAddToSlack] which:\", which);\r\n//     console.log(\"[SLACK] title:\", title);\r\n//     console.log(\"[SLACK] PN:\", items.pn, \"SN:\", items.sn);\r\n\r\n//     const resp = await fetch(\"/api/slack/add-to-list\", {\r\n//       method: \"POST\",\r\n//       headers: { \"Content-Type\": \"application/json\" },\r\n//       body: JSON.stringify({\r\n//         listKey: which,      // \"shipping\" | \"receiving\" | \"tasks\"\r\n//         title,\r\n//         pn: items.pn,\r\n//         sn: items.sn,\r\n//         // keeping it minimal by design while we stabilize PN/SN\r\n//         linkUrl,\r\n//       }),\r\n//     });\r\n// Slack integration handler (drop-in replacement)\r\n// Slack integration handler (drop-in replacement)\r\n\r\n\r\n// Slack integration handler (client) — replace your existing handleAddToSlack with this\r\nconst handleAddToSlack = async (which = \"shipping\") => {\r\n  try {\r\n    const safeName = (items?.name || id || \"Untitled\").trim();\r\n    const title = `${safeName}${id ? ` (${id})` : \"\"}`;\r\n\r\n    const pn0 = Array.isArray(items?.pn) ? items.pn[0] : items?.pn;\r\n    const sn0 = Array.isArray(items?.sn) ? items.sn[0] : items?.sn;\r\n    const pn_sn = [pn0 && `PN: ${pn0}`, sn0 && `SN: ${sn0}`]\r\n      .filter(Boolean)\r\n      .join(\"  \");\r\n\r\n    const mostRecentWO =\r\n      (workOrders && workOrders.length)\r\n        ? [...workOrders].sort((a,b) => new Date(b?.date||0) - new Date(a?.date||0))[0]?.workOrder\r\n        : \"\";\r\n\r\n    const description =\r\n      (selectedDesc != null && descriptions?.[selectedDesc])\r\n        ? (descriptions[selectedDesc].description || \"\")\r\n        : (items?.description || \"\");\r\n\r\n    const tracking = items?.trackingNumber ?? items?.tracking ?? \"\";\r\n    const local_sn = id || items?.localSN || \"\";\r\n\r\n    const photoUrls = Array.isArray(photos)\r\n      ? photos.map(p => p?.url).filter(Boolean)\r\n      : [];\r\n\r\n    const resp = await fetch(\"/api/slack/add-to-list\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        listKey: which,\r\n        title,\r\n        pn_sn,                 // <— server expects this\r\n        work_order: mostRecentWO || \"\",\r\n        local_sn,\r\n        tracking,\r\n        description: (description || \"\").trim(),\r\n        photoUrls,             // array of https URLs\r\n      }),\r\n    });\r\n\r\n    const json = await resp.json();\r\n    console.log(\"[SLACK][handleAddToSlack] response:\", json);\r\n    if (json?.debug?.steps) console.table(json.debug.steps);\r\n    if (json?.debug?.photos) console.table(json.debug.photos);\r\n\r\n    if (!resp.ok || !json?.ok) {\r\n      setErr(`Slack add failed: ${json?.error || \"unknown error\"}`);\r\n      setShowErr(true);\r\n      return;\r\n    }\r\n\r\n    alert(\r\n      `Added to Slack ${which === \"shipping\" ? \"Shipping\" : which === \"receiving\" ? \"Receiving\" : \"Tasks\"} list.`\r\n    );\r\n  } catch (e) {\r\n    console.error(e);\r\n    setErr(\"Error adding to Slack\");\r\n    setShowErr(true);\r\n  }\r\n};\r\n\r\n\r\n  return (\r\n    <LoggedIn>\r\n      {isLoading && (\r\n        <div className={styles.loadingOverlay}>\r\n          <img\r\n            src=\"/magmo-logo.png\"\r\n            alt=\"Loading Magmo\"\r\n            className={styles.loadingLogo}\r\n          />\r\n        </div>\r\n      )}\r\n      <div>\r\n        <Modal show={show} onHide={handleClose}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Error</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>Missing field</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleClose}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n        <Modal show={showErr} onHide={handleCloseErr}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Error</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>{Err}</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleCloseErr}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n        <Modal show={showSaveModal} onHide={handleCloseSaveModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Save Confirmation</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>Data has been saved successfully.</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleCloseSaveModal}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n        <Modal show={showPrintModal} onHide={handleClosePrintModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Print Confirmation</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>Info has been sent to print.</Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"primary\" onClick={handleClosePrintModal}>\r\n              Ok\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n\r\n        <Modal show={showDescModal} onHide={handleCloseDescModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Descriptions</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Button variant=\"primary\" className=\"mb-3\" onClick={addDescription}>\r\n              Add Description\r\n            </Button>\r\n            {descriptions.map((desc, index) => (\r\n              <Row key={index} className=\"mb-3\">\r\n                <Button\r\n                  variant=\"outline-secondary\"\r\n                  className=\"w-100\"\r\n                  onClick={() => selectDescription(index)}\r\n                  style={{ cursor: \"pointer\" }}\r\n                >\r\n                  <div className=\"d-flex justify-content-between\">\r\n                    <span>{desc.description || \"Description\"}</span>\r\n                    <span\r\n                      style={{\r\n                        borderLeft: \"1px solid #ccc\",\r\n                        paddingLeft: \"10px\",\r\n                      }}\r\n                    >\r\n                      {desc.date || \"Date\"}\r\n                    </span>\r\n                  </div>\r\n                </Button>\r\n              </Row>\r\n            ))}\r\n            <Button variant=\"primary\" onClick={handleCloseDescModal}>\r\n              OK\r\n            </Button>\r\n          </Modal.Body>\r\n        </Modal>\r\n\r\n        <Modal show={showWoModal} onHide={handleCloseWoModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Work Orders</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Button\r\n              variant=\"primary\"\r\n              className=\"mb-3\"\r\n              onClick={addWorkOrder}\r\n              style={{ marginBottom: \"1rem\" }}\r\n            >\r\n              Add Work Order\r\n            </Button>\r\n            {workOrders.map((wo, index) => (\r\n              <Row key={index} className=\"mb-3\">\r\n                <Col>\r\n                  <Form.Control\r\n                    type=\"text\"\r\n                    placeholder=\"Work Order\"\r\n                    value={wo.workOrder}\r\n                    onChange={(e) =>\r\n                      handleWorkOrderChange(index, \"workOrder\", e.target.value)\r\n                    }\r\n                    style={{ marginBottom: \"0.5rem\" }}\r\n                  />\r\n                </Col>\r\n                <Col>\r\n                  <Form.Control\r\n                    type=\"date\"\r\n                    placeholder=\"Date\"\r\n                    value={wo.date}\r\n                    onChange={(e) =>\r\n                      handleWorkOrderChange(index, \"date\", e.target.value)\r\n                    }\r\n                  />\r\n                </Col>\r\n                <Col>\r\n                  <Button\r\n                    variant=\"danger\"\r\n                    onClick={() => removeWorkOrder(index)}\r\n                  >\r\n                    Remove\r\n                  </Button>\r\n                </Col>\r\n              </Row>\r\n            ))}\r\n            <Button variant=\"primary\" onClick={handleCloseWoModal}>\r\n              OK\r\n            </Button>\r\n          </Modal.Body>\r\n        </Modal>\r\n\r\n        <ClientInfoModal\r\n          show={showMachineModal}\r\n          handleClose={handleCloseMachineModal}\r\n          selectedClient={selectedClient}\r\n          machineOptions={machineOptions}\r\n          setSelectedMachine={handleSetSelectedMachine}\r\n        />\r\n\r\n        <Modal show={showClientModal} onHide={handleCloseClientModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Select Client</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <FormControl\r\n              type=\"text\"\r\n              placeholder=\"Search by name\"\r\n              className=\"mb-3\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n            />\r\n            <ClientTable\r\n              clients={clients.filter((client) =>\r\n                (client.name || \"\").toLowerCase().includes(search.toLowerCase())\r\n              )}\r\n              onSelectClient={handleClientInfo}\r\n              onInfoClick={handleClientInfo}\r\n              clearSelection={() => handleClientInfo(null)}\r\n              onAddClient={handleAddNewClient}\r\n            />\r\n          </Modal.Body>\r\n        </Modal>\r\n\r\n        <ParentModal\r\n          show={showParentModal}\r\n          handleClose={handleCloseParentModal}\r\n          setSelectedParent={setSelectedParent}\r\n        />\r\n\r\n        <MachineSelectionModal\r\n          show={machineSelectionModal}\r\n          handleClose={() => setMachineSelectionModal(false)}\r\n          setMachine={setTheMachine}\r\n        />\r\n\r\n        <Modal show={showCameraModal} onHide={handleCloseCameraModal}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Take a Photo</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <div className=\"camera\">\r\n              {!capturedPhoto && (\r\n                <BarcodeScannerComponent\r\n                  width=\"100%\"\r\n                  height={300}\r\n                  onUpdate={handleCapture}\r\n                  facingMode={cameraFacing}\r\n                />\r\n              )}\r\n              {capturedPhoto && (\r\n                <div className=\"photo-preview\">\r\n                  <img\r\n                    src={URL.createObjectURL(capturedPhoto)}\r\n                    alt=\"captured\"\r\n                    style={{ width: \"100%\" }}\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            {!capturedPhoto ? (\r\n              <>\r\n                <Button\r\n                  onClick={capturePhoto}\r\n                  style={{\r\n                    borderRadius: \"50%\",\r\n                    width: \"60px\",\r\n                    height: \"60px\",\r\n                    position: \"absolute\",\r\n                    left: \"50%\",\r\n                    transform: \"translateX(-50%)\",\r\n                    bottom: \"10px\",\r\n                  }}\r\n                >\r\n                  📷\r\n                </Button>\r\n                <Button\r\n                  onClick={() =>\r\n                    setCameraFacing((prev) =>\r\n                      prev === \"environment\" ? \"user\" : \"environment\"\r\n                    )\r\n                  }\r\n                >\r\n                  Flip Camera\r\n                </Button>\r\n                <Button variant=\"secondary\" onClick={handleCloseCameraModal}>\r\n                  Cancel\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  onClick={() => setCapturedPhoto(null)}\r\n                >\r\n                  Retake\r\n                </Button>\r\n                <Button variant=\"primary\" onClick={savePhoto}>\r\n                  OK\r\n                </Button>\r\n              </>\r\n            )}\r\n          </Modal.Footer>\r\n        </Modal>\r\n\r\n        <InfoModal\r\n          show={showInfoModal}\r\n          handleClose={handleCloseInfoModal}\r\n          itemName={items.name}\r\n          dimensions={items.length + \",\" + items.width + \",\" + items.height}\r\n          price={items.price}\r\n          freqI={freqItem}\r\n          freqM={machineFrequency}\r\n          usage={usagePastYear}\r\n        />\r\n\r\n        <Container fluid className={styles.page}>\r\n          <div className={styles.shell}>\r\n            <Card className={styles.card}>\r\n              <Card.Body className={styles.cardBody}>\r\n                <div className={styles.header}>\r\n                  <div className={styles.kicker}>Item</div>\r\n                  <h2 className={styles.title}>\r\n                    {savedName || \"Item Details\"}\r\n                  </h2>\r\n                  <div className={styles.subtitle}>\r\n                    Review and update fields, photos, and routing information.\r\n                  </div>\r\n                </div>\r\n                <Form onSubmit={handleSubmit}>\r\n                  {/* Row for Name and PN */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <Form.Group controlId=\"name\">\r\n                        <Form.Label>Name</Form.Label>\r\n                        <Form.Control\r\n                          type=\"text\"\r\n                          value={items.name}\r\n                          onChange={handleChange(\"name\")}\r\n                        />\r\n                      </Form.Group>\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Group controlId=\"pn\">\r\n                        <Form.Label>Product Number</Form.Label>\r\n                        <div style={{ position: \"relative\" }}>\r\n                          <InputGroup>\r\n                            <Form.Control\r\n                              type=\"text\"\r\n                              value={items.pn[currentPnIndex] || \"\"}\r\n                              onChange={(e) =>\r\n                                handlePnChange(currentPnIndex, e.target.value)\r\n                              }\r\n                            />\r\n                            <Button\r\n                              variant=\"outline-secondary\"\r\n                              onClick={() => setShowDropdown(!showDropdown)}\r\n                            >\r\n                              &#9662;\r\n                            </Button>\r\n                            <InputGroup.Text>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setAddingNewPn(true)}\r\n                              >\r\n                                +\r\n                              </Button>\r\n                            </InputGroup.Text>\r\n                          </InputGroup>\r\n                          {showDropdown && (\r\n                            <div\r\n                              style={{\r\n                                position: \"absolute\",\r\n                                top: \"100%\",\r\n                                left: 0,\r\n                                right: 0,\r\n                                backgroundColor: \"white\",\r\n                                border: \"1px solid #ccc\",\r\n                                zIndex: 1000,\r\n                                maxHeight: \"150px\",\r\n                                overflowY: \"auto\",\r\n                              }}\r\n                            >\r\n                              {pnOptions.map((pnOption, idx) => (\r\n                                <div\r\n                                  key={idx}\r\n                                  style={{ padding: \"8px\", cursor: \"pointer\" }}\r\n                                  onClick={() => {\r\n                                    setCurrentPnIndex(idx);\r\n                                    setShowDropdown(false);\r\n                                  }}\r\n                                >\r\n                                  {pnOption}\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {addingNewPn && (\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Enter new PN\"\r\n                            value={newPn}\r\n                            onChange={(e) => setNewPn(e.target.value)}\r\n                            onBlur={handleAddNewPn}\r\n                            onKeyDown={(e) =>\r\n                              e.key === \"Enter\" && handleAddNewPn()\r\n                            }\r\n                          />\r\n                        )}\r\n                      </Form.Group>\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Row for SN and Status */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <Form.Group controlId=\"sn\">\r\n                        <Form.Label>Serial Number</Form.Label>\r\n                        <div style={{ position: \"relative\" }}>\r\n                          <InputGroup>\r\n                            <Form.Control\r\n                              type=\"text\"\r\n                              value={items.sn[currentSnIndex] || \"\"}\r\n                              onChange={(e) =>\r\n                                handleSnChange(currentSnIndex, e.target.value)\r\n                              }\r\n                            />\r\n                            <Button\r\n                              variant=\"outline-secondary\"\r\n                              onClick={() => setShowSnDropdown(!showSnDropdown)}\r\n                            >\r\n                              &#9662;\r\n                            </Button>\r\n                            <InputGroup.Text>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setAddingNewSn(true)}\r\n                              >\r\n                                +\r\n                              </Button>\r\n                            </InputGroup.Text>\r\n                          </InputGroup>\r\n                          {showSnDropdown && (\r\n                            <div\r\n                              style={{\r\n                                position: \"absolute\",\r\n                                top: \"100%\",\r\n                                left: 0,\r\n                                right: 0,\r\n                                backgroundColor: \"white\",\r\n                                border: \"1px solid #ccc\",\r\n                                zIndex: 1000,\r\n                                maxHeight: \"150px\",\r\n                                overflowY: \"auto\",\r\n                              }}\r\n                            >\r\n                              {snOptions.map((snOption, idx) => (\r\n                                <div\r\n                                  key={idx}\r\n                                  style={{ padding: \"8px\", cursor: \"pointer\" }}\r\n                                  onClick={() => {\r\n                                    setCurrentSnIndex(idx);\r\n                                    setShowSnDropdown(false);\r\n                                  }}\r\n                                >\r\n                                  {snOption}\r\n                                </div>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {addingNewSn && (\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Enter new SN\"\r\n                            value={newSn}\r\n                            onChange={(e) => setNewSn(e.target.value)}\r\n                            onBlur={handleAddNewSn}\r\n                            onKeyDown={(e) =>\r\n                              e.key === \"Enter\" && handleAddNewSn()\r\n                            }\r\n                          />\r\n                        )}\r\n                      </Form.Group>\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Group controlId=\"status\">\r\n                        <Form.Label>Status</Form.Label>\r\n                        <Form.Select\r\n                          value={items.status || \"\"}\r\n                          onChange={handleChange(\"status\")}\r\n                        >\r\n                          <option value=\"\">Select status</option>\r\n                          <option value=\"Good\">Good</option>\r\n                          <option value=\"Bad\">Bad</option>\r\n                          <option value=\"Unknown\">Unknown</option>\r\n                        </Form.Select>\r\n                      </Form.Group>\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Row for Local SN, Arrival Date, Tracking */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <Form.Group controlId=\"localSN\">\r\n                        <Form.Label>Local SN</Form.Label>\r\n                        <Form.Control\r\n                          type=\"text\"\r\n                          placeholder=\"Enter Local SN\"\r\n                          value={items.localSN || \"\"}\r\n                          onChange={handleChange(\"localSN\")}\r\n                        />\r\n                      </Form.Group>\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Group controlId=\"arrivalDate\">\r\n                        <Form.Label>Arrival Date</Form.Label>\r\n                        <Form.Control\r\n                          placeholder=\"Enter Arrival Date\"\r\n                          type=\"date\"\r\n                          value={items.arrival_date}\r\n                          onChange={(e) => {\r\n                            const value = e.target.value;\r\n                            setItems((prev) => ({\r\n                              ...prev,\r\n                              arrival_date: value,\r\n                            }));\r\n                          }}\r\n                        />\r\n                      </Form.Group>\r\n                    </Col>\r\n                    <Col>\r\n                      <Form.Group controlId=\"trackingNumber\">\r\n                        <Form.Label>Tracking Number</Form.Label>\r\n                        <Form.Control\r\n                          placeholder=\"Tracking Number\"\r\n                          type=\"text\"\r\n                          value={items.trackingNumber}\r\n                          onChange={handleChange(\"trackingNumber\")}\r\n                        />\r\n                      </Form.Group>\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Row for OEM, Modality, Model */}\r\n                  <Row className=\"mb-3\">\r\n                    <Col>\r\n                      <MultiSelectDropdown\r\n                        label=\"OEM\"\r\n                        placeholder={trackerLoading ? \"Loading...\" : \"Select OEM\"}\r\n                        options={oemOptionsForUI}\r\n                        selected={selectedOems}\r\n                        onChange={setSelectedOems}\r\n                        enableDelete\r\n                        onDeleteOption={handleDeleteOemOption}\r\n                        disabled={trackerLoading}\r\n                      />\r\n                    </Col>\r\n                    <Col>\r\n                      <MultiSelectDropdown\r\n                        label=\"Modality\"\r\n                        placeholder={trackerLoading ? \"Loading...\" : \"Select Modality\"}\r\n                        options={modalityOptionsForUI}\r\n                        selected={selectedModalities}\r\n                        onChange={setSelectedModalities}\r\n                        disabled={trackerLoading}\r\n                      />\r\n                    </Col>\r\n                    <Col>\r\n                      <MultiSelectDropdown\r\n                        label=\"Model\"\r\n                        placeholder={\r\n                          selectedModalities.length && selectedOems.length\r\n                            ? \"Select Model\"\r\n                            : \"Select Modality + OEM\"\r\n                        }\r\n                        options={modelOptionsForUI}\r\n                        selected={selectedModels}\r\n                        onChange={setSelectedModels}\r\n                        enableDelete\r\n                        onDeleteOption={handleDeleteModelOption}\r\n                        disabled={\r\n                          trackerLoading ||\r\n                          !selectedModalities.length ||\r\n                          !selectedOems.length\r\n                        }\r\n                      />\r\n                    </Col>\r\n                  </Row>\r\n                  {/* Work Orders and Inline Description Section */}\r\n                  <div style={{ marginBottom: \"1rem\", marginTop: \"1rem\" }}>\r\n                    <div className=\"d-flex align-items-center\">\r\n                      <Button\r\n                        variant=\"outline-secondary\"\r\n                        onClick={handleShowWoModal}\r\n                        className=\"me-2\"\r\n                      >\r\n                        Manage Work Orders\r\n                      </Button>\r\n                      {workOrders.length > 0 && (\r\n                        <div className=\"d-flex flex-column align-items-start\">\r\n                          <Form.Label>Work Order</Form.Label>\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Most Recent Work Order\"\r\n                            value={mostRecentWorkOrder.workOrder}\r\n                            onChange={(e) =>\r\n                              handleWorkOrderChange(\r\n                                workOrders.indexOf(mostRecentWorkOrder),\r\n                                \"workOrder\",\r\n                                e.target.value\r\n                              )\r\n                            }\r\n                            style={{ marginBottom: \"0.5rem\" }}\r\n                          />\r\n                          <Form.Label>Date</Form.Label>\r\n                          <Form.Control\r\n                            type=\"date\"\r\n                            placeholder=\"Work Order Date\"\r\n                            value={mostRecentWorkOrder.date}\r\n                            onChange={(e) =>\r\n                              handleWorkOrderChange(\r\n                                workOrders.indexOf(mostRecentWorkOrder),\r\n                                \"date\",\r\n                                e.target.value\r\n                              )\r\n                            }\r\n                            style={{ marginBottom: \"0.5rem\" }}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <div style={{ marginBottom: \"1rem\" }}>\r\n                      <Form.Group controlId=\"desc\">\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={listDescriptions}\r\n                          className=\"mb-2 me-2\"\r\n                        >\r\n                          List Descriptions\r\n                        </Button>\r\n                        <Form.Control\r\n                          as=\"textarea\"\r\n                          rows={3}\r\n                          placeholder=\"Enter description\"\r\n                          value={descriptions[selectedDesc]?.description || \"\"}\r\n                          onChange={(e) =>\r\n                            handleDescriptionChange(\r\n                              selectedDesc,\r\n                              \"description\",\r\n                              e.target.value\r\n                            )\r\n                          }\r\n                          style={{ marginBottom: \"0.5rem\" }}\r\n                        />\r\n                        <Form.Control\r\n                          type=\"date\"\r\n                          value={descriptions[selectedDesc]?.date || \"\"}\r\n                          onChange={(e) =>\r\n                            handleDescriptionChange(\r\n                              selectedDesc,\r\n                              \"date\",\r\n                              e.target.value\r\n                            )\r\n                          }\r\n                          style={{\r\n                            marginTop: \"0.5rem\",\r\n                            marginBottom: \"0.5rem\",\r\n                          }}\r\n                        />\r\n                      </Form.Group>\r\n                    </div>\r\n                  </div>\r\n                  {/* Machine Selection Row */}\r\n                  <div style={{ marginBottom: \"1rem\" }}>\r\n                    <Row className=\"mb-3\">\r\n                      <Col>\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={() => {\r\n                            setMachinePick(true);\r\n                            handleShowClientModal();\r\n                          }}\r\n                          className=\"me-2\"\r\n                        >\r\n                          Select From\r\n                        </Button>\r\n                        {selectedClientFrom && (\r\n                          <div\r\n                            style={{\r\n                              border: \"1px solid #ccc\",\r\n                              padding: \"0.75rem\",\r\n                              borderRadius: \"4px\",\r\n                              marginBottom: \"1rem\",\r\n                            }}\r\n                          >\r\n                            <p>\r\n                              <strong>Selected Client (From):</strong>{\" \"}\r\n                              {selectedClientFrom.name}\r\n                            </p>\r\n                            <div style={{ marginTop: \"0.5rem\" }}>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setShowMachineModal(true)}\r\n                              >\r\n                                Select Machine for {selectedClientFrom.name}\r\n                              </Button>\r\n                              {selectedMachine && (\r\n                                <>\r\n                                  <p style={{ marginTop: \"0.5rem\" }}>\r\n                                    <strong>Selected Machine (From):</strong>{\" \"}\r\n                                    {selectedMachine.name}\r\n                                  </p>\r\n                                  {showLocalLocFrom && (\r\n                                    <>\r\n                                      <Button\r\n                                        variant=\"outline-secondary\"\r\n                                        onClick={() =>\r\n                                          setShowNewLocalModalFrom(true)\r\n                                        }\r\n                                        className=\"w-100 mb-2\"\r\n                                      >\r\n                                        {/* build a little helper inline: region-section-bin-pallet */}\r\n                                        {[\r\n                                          newLocalFrom.region,\r\n                                          newLocalFrom.section?.letter +\r\n                                            newLocalFrom.section?.number,\r\n                                          newLocalFrom.bin &&\r\n                                            `B${newLocalFrom.bin}`,\r\n                                          newLocalFrom.pallet &&\r\n                                            `P${newLocalFrom.pallet}`,\r\n                                        ]\r\n                                          .filter(Boolean)\r\n                                          .join(\"-\")}\r\n                                        {/* e.g. “E-A7-B3-P2” */}\r\n                                      </Button>\r\n\r\n                                      <Modal\r\n                                        show={showNewLocalModalFrom}\r\n                                        onHide={() =>\r\n                                          setShowNewLocalModalFrom(false)\r\n                                        }\r\n                                        centered\r\n                                      >\r\n                                        <Modal.Header>\r\n                                          <Modal.Title>\r\n                                            Edit Local Loc (From)\r\n                                          </Modal.Title>\r\n                                        </Modal.Header>\r\n                                        <Modal.Body>\r\n                                          <NewLocal\r\n                                            selectedClient={selectedClientFrom}\r\n                                            showLocalLoc={showNewLocalModalFrom}\r\n                                            value={newLocalFrom}\r\n                                            onChange={setNewLocalFrom}\r\n                                            onSave={(p) => {\r\n                                              setNewLocalFrom(p);\r\n                                              setShowNewLocalModalFrom(false);\r\n                                            }}\r\n                                            onCancel={() =>\r\n                                              setShowNewLocalModalFrom(false)\r\n                                            }\r\n                                          />\r\n                                        </Modal.Body>\r\n                                        {/* <Modal.Footer>\r\n                                          <Button\r\n                                            variant=\"secondary\"\r\n                                            onClick={() => setShowNewLocalModalFrom(false)}\r\n                                          >\r\n                                            Close\r\n                                          </Button>\r\n                                        </Modal.Footer> */}\r\n                                      </Modal>\r\n                                    </>\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </Col>\r\n                      <Col>\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={() => {\r\n                            setMachinePick(false);\r\n                            handleShowClientModal();\r\n                          }}\r\n                          className=\"me-2\"\r\n                        >\r\n                          Select Current\r\n                        </Button>\r\n                        {selectedClientCurrent && (\r\n                          <div\r\n                            style={{\r\n                              border: \"1px solid #ccc\",\r\n                              padding: \"0.75rem\",\r\n                              borderRadius: \"4px\",\r\n                              marginBottom: \"1rem\",\r\n                            }}\r\n                          >\r\n                            <p>\r\n                              <strong>Selected Client (Current):</strong>{\" \"}\r\n                              {selectedClientCurrent.name}\r\n                            </p>\r\n                            <div style={{ marginTop: \"0.5rem\" }}>\r\n                              <Button\r\n                                variant=\"outline-secondary\"\r\n                                onClick={() => setShowMachineModal(true)}\r\n                              >\r\n                                Select Machine for {selectedClientCurrent.name}\r\n                              </Button>\r\n                              {selectedCurrentMachine && (\r\n                                <>\r\n                                  <p style={{ marginTop: \"0.5rem\" }}>\r\n                                    <strong>Selected Machine (Current):</strong>{\" \"}\r\n                                    {selectedCurrentMachine.name}\r\n                                  </p>\r\n                                  {showLocalLocCurrent && (\r\n                                    <>\r\n                                      <Button\r\n                                        variant=\"outline-secondary\"\r\n                                        onClick={() =>\r\n                                          setShowNewLocalModalCurrent(true)\r\n                                        }\r\n                                        className=\"w-100 mb-2\"\r\n                                      >\r\n                                        {[\r\n                                          newLocalCurrent.region,\r\n                                          newLocalCurrent.section?.letter +\r\n                                            newLocalCurrent.section?.number,\r\n                                          newLocalCurrent.bin &&\r\n                                            `B${newLocalCurrent.bin}`,\r\n                                          newLocalCurrent.pallet &&\r\n                                            `P${newLocalCurrent.pallet}`,\r\n                                        ]\r\n                                          .filter(Boolean)\r\n                                          .join(\"-\")}\r\n                                      </Button>\r\n                                      <Modal\r\n                                        show={showNewLocalModalCurrent}\r\n                                        onHide={() =>\r\n                                          setShowNewLocalModalCurrent(false)\r\n                                        }\r\n                                        centered\r\n                                      >\r\n                                        <Modal.Header>\r\n                                          <Modal.Title>\r\n                                            Edit Local Loc (Current)\r\n                                          </Modal.Title>\r\n                                        </Modal.Header>\r\n                                        <Modal.Body>\r\n                                          <NewLocal\r\n                                            selectedClient={\r\n                                              selectedClientCurrent\r\n                                            }\r\n                                            showLocalLoc={\r\n                                              showNewLocalModalCurrent\r\n                                            }\r\n                                            value={newLocalCurrent}\r\n                                            onChange={setNewLocalCurrent}\r\n                                            onSave={(p) => {\r\n                                              setNewLocalCurrent(p);\r\n                                              setShowNewLocalModalCurrent(\r\n                                                false\r\n                                              );\r\n                                            }}\r\n                                            onCancel={() =>\r\n                                              setShowNewLocalModalCurrent(false)\r\n                                            }\r\n                                          />\r\n                                        </Modal.Body>\r\n                                        {/* <Modal.Footer>\r\n                                          <Button\r\n                                            variant=\"secondary\"\r\n                                            onClick={() => setShowNewLocalModalCurrent(false)}\r\n                                          >\r\n                                            Close\r\n                                          </Button>\r\n                                        </Modal.Footer> */}\r\n                                      </Modal>\r\n                                    </>\r\n                                  )}\r\n                                </>\r\n                              )}\r\n                            </div>\r\n                          </div>\r\n                        )}\r\n                      </Col>\r\n                      <Col>\r\n                        <Button\r\n                          variant=\"outline-secondary\"\r\n                          onClick={handleShowParentModal}\r\n                          className=\"me-2\"\r\n                        >\r\n                          Select Parent\r\n                        </Button>\r\n                        {selectedParent && (\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"Selected Parent\"\r\n                            value={selectedParent.name}\r\n                            readOnly\r\n                            style={{ marginTop: \"0.5rem\" }}\r\n                          />\r\n                        )}\r\n                      </Col>\r\n                    </Row>\r\n                  </div>\r\n                  {/* Photo and Website Options */}\r\n                  <div style={{ marginBottom: \"1rem\" }}>\r\n                    <Row className={`mb-3 ${styles.photoActionsRow}`}>\r\n                      <Col xs={12} md={6}>\r\n                        <ButtonGroup>\r\n                          <Button\r\n                            variant=\"outline-secondary\"\r\n                            onClick={handleShowCameraModal}\r\n                          >\r\n                            Take Photo\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"outline-secondary\"\r\n                            onClick={handleBrowsePhotos}\r\n                          >\r\n                            Browse\r\n                          </Button>\r\n                        </ButtonGroup>\r\n                      </Col>\r\n                      <Col xs={12} md={6} className={styles.photoActionsRight}>\r\n                        <Button\r\n                          variant=\"success\"\r\n                          onClick={handleSendToInflow}\r\n                          style={{ marginLeft: \"auto\" }}\r\n                        >\r\n                          Send to inFlow\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"secondary\"\r\n                          onClick={handleBluefolderButton}\r\n                          style={{ marginLeft: \"0.5rem\", marginRight: \".5rem\" }}\r\n                        >\r\n                          BlueFolder\r\n                        </Button>\r\n                        \r\n\r\n                        <Button\r\n                          variant={addToWebsite ? \"primary\" : \"outline-primary\"}\r\n                          onClick={() => setAddToWebsite((prev) => !prev)}\r\n                        >\r\n                          {addToWebsite ? \"✓ Add to Website\" : \"Add to Website\"}\r\n                        </Button>\r\n\r\n                        <Form.Check\r\n                          type=\"checkbox\"\r\n                          id=\"hide-checkbox\"\r\n                          label=\"Hide\"\r\n                          // box is checked when we want visible = false\r\n                          checked={!items.visible}\r\n                          onChange={(e) => {\r\n                            // grab checked immediately\r\n                            const isHidden = e.currentTarget.checked;\r\n                            setItems((prev) => ({\r\n                              ...prev,\r\n                              visible: !isHidden,\r\n                            }));\r\n                          }}\r\n                          className=\"ms-3\"\r\n                        />\r\n                      </Col>\r\n                    </Row>\r\n                    <input\r\n                      type=\"file\"\r\n                      accept=\"image/*\"\r\n                      multiple\r\n                      ref={browseInputRef}\r\n                      style={{ display: \"none\" }}\r\n                      onChange={handleFilesSelected}\r\n                    />\r\n                  </div>\r\n                  {/* Photo Gallery */}\r\n                  {photos && photos.length > 0 && (\r\n                    <div\r\n                      className=\"photo-gallery\"\r\n                      style={{\r\n                        display: \"flex\",\r\n                        flexWrap: \"wrap\",\r\n                        gap: \"10px\",\r\n                        marginBottom: \"1rem\",\r\n                      }}\r\n                    >\r\n                      {photos.map((photo, index) => (\r\n                        <div\r\n                          key={index}\r\n                          style={{\r\n                            position: \"relative\",\r\n                            width: \"100px\",\r\n                            height: \"100px\",\r\n                          }}\r\n                        >\r\n                          <img\r\n                            src={photo.url}\r\n                            alt={`Photo ${index + 1}`}\r\n                            style={{\r\n                              width: \"100%\",\r\n                              height: \"100%\",\r\n                              objectFit: \"cover\",\r\n                            }}\r\n                          />\r\n                          {photo.file && (\r\n                            <Button\r\n                              variant=\"danger\"\r\n                              size=\"sm\"\r\n                              style={{\r\n                                position: \"absolute\",\r\n                                top: 0,\r\n                                right: 0,\r\n                                padding: \"0 5px\",\r\n                              }}\r\n                              onClick={() => removePhoto(index)}\r\n                            >\r\n                              x\r\n                            </Button>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                  {/* Action Buttons */}\r\n                  <div className={`mt-3 d-flex flex-wrap align-items-center ${styles.actionRow}`}>\r\n                    <Button\r\n                      variant=\"primary\"\r\n                      type=\"submit\"\r\n                      style={{ marginRight: \"1rem\" }}\r\n                    >\r\n                      Save\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"secondary\"\r\n                      onClick={handleCloneToNewItem}\r\n                      style={{ marginRight: \"1rem\" }}\r\n                    >\r\n                      Clone\r\n                    </Button>\r\n                    <LoadingButton\r\n                      type=\"primary\"\r\n                      name=\"Back\"\r\n                      route=\"NewSearch/mainSearch\"\r\n                    />\r\n                    {SHOW_SLACK_BUTTONS && (\r\n                      <div style={{ display: \"flex\", flexDirection: \"column\", marginLeft: \".5rem\" }}>\r\n                        <span style={{ fontSize: 12, lineHeight: \"12px\", textAlign: \"center\" }}>Slack</span>\r\n                        <div style={{ display: \"flex\", border: \"1px solid #ced4da\", borderRadius: 6, overflow: \"hidden\" }}>\r\n                          <Button\r\n                            variant=\"outline-primary\"\r\n                            onClick={() => handleAddToSlack(\"receiving\")}\r\n                            style={{ border: \"none\", borderRight: \"1px solid #ced4da\" }}\r\n                          >\r\n                            Receiving\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"outline-primary\"\r\n                            onClick={() => handleAddToSlack(\"shipping\")}\r\n                            style={{ border: \"none\" }}\r\n                          >\r\n                            Shipping\r\n                          </Button>\r\n                          {/* <Button\r\n                            variant=\"outline-primary\"\r\n                            onClick={() => handleAddToSlack(\"tasks\")}\r\n                          >\r\n                            Tasks\r\n                          </Button> */}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                    <Button\r\n                      variant=\"info\"\r\n                      onClick={handlePrint}\r\n                      style={{ marginLeft: \"auto\" }}\r\n                    >\r\n                      Print Label\r\n                    </Button>\r\n                  </div>\r\n                  <div style={{ textAlign: \"center\", margin: \"1rem 0\" }}>\r\n                    <Button\r\n                      variant=\"link\"\r\n                      style={{\r\n                        textDecoration: \"none\",\r\n                        color: \"black\",\r\n                        fontSize: \"24px\",\r\n                      }}\r\n                      onClick={() => setShowExtra(!showExtra)}\r\n                    >\r\n                      ▼\r\n                    </Button>\r\n                  </div>\r\n                  <Collapse in={showExtra}>\r\n                    <div id=\"extra-collapse\" className=\"mt-3\">\r\n                      <div className=\"d-flex justify-content-end mb-3\">\r\n                        <Button variant=\"secondary\" onClick={handleShowInfoModal}>\r\n                          More Info\r\n                        </Button>\r\n                      </div>\r\n                      <Row>\r\n                        <Form.Group as={Col} controlId=\"dimensions\">\r\n                          <Form.Label>Dimensions</Form.Label>\r\n                          <div\r\n                            style={{ display: \"flex\", alignItems: \"center\" }}\r\n                          >\r\n                            <Form.Control\r\n                              placeholder=\"Length\"\r\n                              type=\"text\"\r\n                              value={items.length}\r\n                              onChange={handleChange(\"length\")}\r\n                            />\r\n                            <span style={{ padding: \"0 5px\" }}>x</span>\r\n                            <Form.Control\r\n                              placeholder=\"Width\"\r\n                              type=\"text\"\r\n                              value={items.width}\r\n                              onChange={handleChange(\"width\")}\r\n                            />\r\n                            <span style={{ padding: \"0 5px\" }}>x</span>\r\n                            <Form.Control\r\n                              placeholder=\"Height\"\r\n                              type=\"text\"\r\n                              value={items.height}\r\n                              onChange={handleChange(\"height\")}\r\n                            />\r\n                          </div>\r\n                        </Form.Group>\r\n                      </Row>\r\n\r\n                      <Row className=\"mt-3\">\r\n                        <Form.Group as={Col} controlId=\"Price\">\r\n                          <Form.Label>Price</Form.Label>\r\n                          <Form.Control\r\n                            placeholder=\"Price\"\r\n                            type=\"text\"\r\n                            value={items.price}\r\n                            onChange={handleChange(\"price\")}\r\n                          />\r\n                        </Form.Group>\r\n                        <Form.Group as={Col} controlId=\"DOM\">\r\n                          <Form.Label>DOM</Form.Label>\r\n                          <Form.Control\r\n                            placeholder=\"Date of Manufacture\"\r\n                            type=\"date\"\r\n                            value={DOM}\r\n                            onChange={(e) => setDOM(e.target.value)}\r\n                          />\r\n                        </Form.Group>\r\n                        <Form.Group as={Col} controlId=\"poNumber\">\r\n                          <Form.Label>PO Number</Form.Label>\r\n                          <Form.Control\r\n                            type=\"text\"\r\n                            placeholder=\"PO Number\"\r\n                            value={items.poNumber || \"\"}\r\n                            onChange={handleChange(\"poNumber\")}\r\n                          />\r\n                        </Form.Group>\r\n                      </Row></div>\r\n                  </Collapse>\r\n                </Form>\r\n              </Card.Body>\r\n            </Card>\r\n          </div>\r\n        </Container>\r\n      </div>\r\n      {/* Camera Modal */}\r\n      <Modal show={showCameraModal} onHide={handleCloseCameraModal}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Take a Photo</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <div className=\"camera\">\r\n            {!capturedPhoto ? (\r\n              <BarcodeScannerComponent\r\n                width=\"100%\"\r\n                height={300}\r\n                onUpdate={handleCapture}\r\n                facingMode={cameraFacing}\r\n              />\r\n            ) : (\r\n              <div className=\"photo-preview\">\r\n                <img\r\n                  src={URL.createObjectURL(capturedPhoto)}\r\n                  alt=\"captured\"\r\n                  style={{ width: \"100%\" }}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          {!capturedPhoto ? (\r\n            <>\r\n              <Button\r\n                onClick={capturePhoto}\r\n                style={{\r\n                  borderRadius: \"50%\",\r\n                  width: \"60px\",\r\n                  height: \"60px\",\r\n                  position: \"absolute\",\r\n                  left: \"50%\",\r\n                  transform: \"translateX(-50%)\",\r\n                  bottom: \"10px\",\r\n                }}\r\n              >\r\n                📷\r\n              </Button>\r\n              <Button\r\n                onClick={() =>\r\n                  setCameraFacing((prev) =>\r\n                    prev === \"environment\" ? \"user\" : \"environment\"\r\n                  )\r\n                }\r\n              >\r\n                Flip Camera\r\n              </Button>\r\n              <Button variant=\"secondary\" onClick={handleCloseCameraModal}>\r\n                Cancel\r\n              </Button>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Button\r\n                variant=\"secondary\"\r\n                onClick={() => setCapturedPhoto(null)}\r\n              >\r\n                Retake\r\n              </Button>\r\n              <Button variant=\"primary\" onClick={savePhoto}>\r\n                OK\r\n              </Button>\r\n            </>\r\n          )}\r\n        </Modal.Footer>\r\n      </Modal>\r\n    </LoggedIn>\r\n  );\r\n}\r\n\r\nexport default function DisplayItemPage(props) {\r\n  const router = useRouter();\r\n  const idFromRouter = router.query?.id;\r\n  const key = props?.initialItem?.id || idFromRouter || \"new-item\";\r\n  return <DisplayItemInner {...props} key={key} />;\r\n}\r\n\r\n// Server-side rendering function\r\nexport async function getServerSideProps(context) {\r\n  const { id } = context.params;\r\n\r\n  try {\r\n    if (!adminDb) {\r\n      return { props: { error: \"Firebase Admin not configured for SSR.\" } };\r\n    }\r\n    const itemDoc = await adminDb.collection(\"Test\").doc(id).get();\r\n    if (!itemDoc.exists) return { notFound: true };\r\n\r\n    const itemData = itemDoc.data();\r\n\r\n    // normalize to arrays for consistent client-side handling\r\n    const pnArray = Array.isArray(itemData.pn)\r\n      ? itemData.pn\r\n      : (itemData.pn ? [itemData.pn] : []);\r\n    const snArray = Array.isArray(itemData.sn)\r\n      ? itemData.sn\r\n      : (itemData.sn ? [itemData.sn] : []);\r\n\r\n    // fetch machineData (optional; you already had this)\r\n    let machineData = {};\r\n    if (itemData.Machine && itemData.Machine.path) {\r\n      try {\r\n        const machineDoc = await adminDb.doc(itemData.Machine.path).get();\r\n        if (machineDoc.exists) {\r\n          machineData = machineDoc.data();\r\n          if (machineData.client && machineData.client.path) {\r\n            const clientDoc = await adminDb.doc(machineData.client.path).get();\r\n            if (clientDoc.exists) machineData.Client = clientDoc.data().name;\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error(\"Error fetching machine data:\", e);\r\n      }\r\n    }\r\n\r\n    const serializedItem = {\r\n      id,\r\n      name: itemData.name || \"\",\r\n      pn: pnArray,\r\n      sn: snArray,\r\n      price: itemData.price || \"\",\r\n      status: itemData.status || \"\",\r\n      length: itemData.length || \"\",\r\n      width: itemData.width || \"\",\r\n      height: itemData.height || \"\",\r\n      poNumber: itemData.poNumber || \"\",\r\n      trackingNumber: itemData.trackingNumber || \"\",\r\n      localSN: itemData.localSN || \"\",\r\n      arrival_date: itemData.arrival_date || \"\",\r\n      visible: itemData.visible !== undefined ? itemData.visible : true,\r\n\r\n      // add the pieces the UI reads directly\r\n      descriptions: itemData.descriptions || [],\r\n      workOrders: itemData.workOrders || [],\r\n      DOM: itemData.DOM || \"\",\r\n    };\r\n\r\n    return {\r\n      props: {\r\n        initialItem: serializedItem,\r\n        initialMachineData: machineData,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error in getServerSideProps:\", error);\r\n    return { props: { error: \"Failed to load item data\" } };\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}