{"ast":null,"code":"import _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Form, Button, Card, Container, Row, Col, Modal, FormControl, Collapse, InputGroup, ButtonGroup, Spinner } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport dynamic from \"next/dynamic\";\nimport { useAuth } from \"../../../context/AuthUserContext\";\nimport firebase from \"../../../context/Firebase\";\nimport LoggedIn from \"../../LoggedIn\";\nimport { useRouter } from \"next/router\";\nimport { fetchClients } from \"../../../utils/fetchAssociations\";\nimport ClientTable from \"../../../utils/ClientTable\";\nimport ClientInfoModal from \"../ClientInfoModal\";\nimport ParentModal from \"./parentModal\";\nimport MachineSelectionModal from \"../item/[id]/MachineSelectionModal\";\nimport InfoModal from \"../InfoModal\";\nimport InflowAPI from \"../../../utils/inflowAPI\";\nimport NewLocal from \"../item/[id]/NewLocal\";\nimport { buildLocalLocObject, formatLoc, updateMachineFields, buildNameTokens } from \"../../../utils/itemFormShared\";\nimport styles from \"./NewItem.module.css\"; // Load BarcodeScannerComponent only on the client-side.\n\nvar BarcodeScannerComponent = dynamic(function () {\n  return import(\"react-qr-barcode-scanner\");\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak(\"react-qr-barcode-scanner\")];\n    },\n    modules: [\"NewSearch\\\\AddItem\\\\NewItem.js -> \" + \"react-qr-barcode-scanner\"]\n  }\n}); // Simulate network delay.\n\nfunction simulateNetworkRequest() {\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, 2000);\n  });\n} // Custom LoadingButton component.\n\n\nfunction LoadingButton(_ref) {\n  var type = _ref.type,\n      name = _ref.name,\n      route = _ref.route;\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setLoading = _useState[1];\n\n  useEffect(function () {\n    if (isLoading) {\n      var cancelled = false;\n      simulateNetworkRequest().then(function () {\n        if (!cancelled) setLoading(false);\n      });\n      return function () {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\n  var handleClick = function handleClick() {\n    return setLoading(true);\n  };\n\n  return __jsx(Link, {\n    href: \"/\".concat(route)\n  }, __jsx(\"a\", {\n    className: \"btn btn-\".concat(type),\n    disabled: isLoading,\n    onClick: !isLoading ? handleClick : null\n  }, isLoading ? \"Loading…\" : name));\n}\n\nexport default function NewItem() {\n  var _descriptions$selecte, _descriptions$selecte4, _descriptions$selecte5, _newLocalFrom$section, _newLocalFrom$section2, _newLocalCurrent$sect, _newLocalCurrent$sect2;\n\n  var router = useRouter();\n\n  var _useAuth = useAuth(),\n      signOut = _useAuth.signOut;\n\n  var SHOW_SLACK_BUTTONS = process.env.NEXT_PUBLIC_SHOW_SLACK_BUTTONS === \"true\"; // Initialize item state – for a new item, these start empty.\n  // We store PN and SN as arrays.\n\n  var _useState2 = useState({\n    name: \"\",\n    pn: [\"\"],\n    sn: [\"\"],\n    // This will be overridden on submit.\n    localSN: \"\",\n    // NEW FIELD: holds user input for a local serial number.\n    date: new Date().toISOString().split(\"T\")[0],\n    // auto-fill current date\n    price: \"\",\n    status: \"\",\n    poNumber: \"\",\n    trackingNumber: \"\",\n    length: \"\",\n    width: \"\",\n    height: \"\",\n    arrival_date: \"\",\n    // NEW FIELD: Arrival Date\n    visible: true\n  }),\n      items = _useState2[0],\n      setItems = _useState2[1];\n\n  var _useState3 = useState(true),\n      editingPn = _useState3[0],\n      setEditingPn = _useState3[1]; // const [newPn, setNewPn] = useState(\"\"); // for the input value when editing\n\n\n  var _useState4 = useState(true),\n      editingSn = _useState4[0],\n      setEditingSn = _useState4[1]; // const [newSn, setNewSn] = useState(\"\");\n  // DOM is the Date of Manufacture input (user provided).\n\n\n  var _useState5 = useState(\"\"),\n      DOM = _useState5[0],\n      setDOM = _useState5[1]; // OEM, Modality, Model fields.\n\n\n  var _useState6 = useState(\"\"),\n      oem = _useState6[0],\n      setOem = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      modality = _useState7[0],\n      setModality = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      model = _useState8[0],\n      setModel = _useState8[1]; // Local location states.\n\n\n  var _useState9 = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  }),\n      newLocalFrom = _useState9[0],\n      setNewLocalFrom = _useState9[1];\n\n  var _useState10 = useState({\n    region: \"\",\n    section: {\n      letter: \"\",\n      number: \"\"\n    },\n    bin: \"\",\n    pallet: \"\"\n  }),\n      newLocalCurrent = _useState10[0],\n      setNewLocalCurrent = _useState10[1]; // Other states.\n\n\n  var _useState11 = useState([]),\n      pnOptions = _useState11[0],\n      setPnOptions = _useState11[1];\n\n  var _useState12 = useState([]),\n      snOptions = _useState12[0],\n      setSnOptions = _useState12[1];\n\n  var _useState13 = useState(false),\n      pnSnLoaded = _useState13[0],\n      setPnSnLoaded = _useState13[1];\n\n  var _useState14 = useState(false),\n      pnSnLoading = _useState14[0],\n      setPnSnLoading = _useState14[1];\n\n  var _useState15 = useState([{\n    description: \"\",\n    date: \"\"\n  }]),\n      descriptions = _useState15[0],\n      setDescriptions = _useState15[1];\n\n  var _useState16 = useState([{\n    workOrder: \"\",\n    date: \"\"\n  }]),\n      workOrders = _useState16[0],\n      setWorkOrders = _useState16[1];\n\n  var _useState17 = useState([]),\n      clients = _useState17[0],\n      setClients = _useState17[1];\n\n  var _useState18 = useState([]),\n      photos = _useState18[0],\n      setPhotos = _useState18[1];\n\n  var _useState19 = useState(false),\n      show = _useState19[0],\n      setShow = _useState19[1]; // error modal for missing required fields\n\n\n  var _useState20 = useState(false),\n      showErr = _useState20[0],\n      setShowErr = _useState20[1];\n\n  var _useState21 = useState(\"Missing required field: Name and Description\"),\n      Err = _useState21[0],\n      setErr = _useState21[1];\n\n  var _useState22 = useState(false),\n      showDescModal = _useState22[0],\n      setShowDescModal = _useState22[1];\n\n  var _useState23 = useState(false),\n      showWoModal = _useState23[0],\n      setShowWoModal = _useState23[1];\n\n  var _useState24 = useState(false),\n      showClientModal = _useState24[0],\n      setShowClientModal = _useState24[1];\n\n  var _useState25 = useState(false),\n      showMachineModal = _useState25[0],\n      setShowMachineModal = _useState25[1];\n\n  var _useState26 = useState(false),\n      showParentModal = _useState26[0],\n      setShowParentModal = _useState26[1];\n\n  var _useState27 = useState(false),\n      showCameraModal = _useState27[0],\n      setShowCameraModal = _useState27[1];\n\n  var _useState28 = useState(false),\n      showSaveModal = _useState28[0],\n      setShowSaveModal = _useState28[1];\n\n  var _useState29 = useState(false),\n      machineSelectionModal = _useState29[0],\n      setMachineSelectionModal = _useState29[1];\n\n  var _useState30 = useState(0),\n      selectedDesc = _useState30[0],\n      setSelectedDesc = _useState30[1];\n\n  var _useState31 = useState(null),\n      selectedClient = _useState31[0],\n      setSelectedClient = _useState31[1];\n\n  var _useState32 = useState(null),\n      selectedMachine = _useState32[0],\n      setSelectedMachine = _useState32[1];\n\n  var _useState33 = useState(null),\n      selectedCurrentMachine = _useState33[0],\n      setSelectedCurrentMachine = _useState33[1];\n\n  var _useState34 = useState(null),\n      selectedParent = _useState34[0],\n      setSelectedParent = _useState34[1];\n\n  var _useState35 = useState(null),\n      TheMachine = _useState35[0],\n      setTheMachine = _useState35[1];\n\n  var _useState36 = useState([]),\n      machineOptions = _useState36[0],\n      setMachineOptions = _useState36[1];\n\n  var _useState37 = useState(\"\"),\n      search = _useState37[0],\n      setSearch = _useState37[1];\n\n  var _useState38 = useState(null),\n      capturedPhoto = _useState38[0],\n      setCapturedPhoto = _useState38[1];\n\n  var _useState39 = useState(\"environment\"),\n      cameraFacing = _useState39[0],\n      setCameraFacing = _useState39[1];\n\n  var _useState40 = useState(false),\n      addToWebsite = _useState40[0],\n      setAddToWebsite = _useState40[1];\n\n  var _useState41 = useState(false),\n      machinePick = _useState41[0],\n      setMachinePick = _useState41[1];\n\n  var _useState42 = useState(0),\n      freqItem = _useState42[0],\n      setFreqItem = _useState42[1];\n\n  var _useState43 = useState(0),\n      usagePastYear = _useState43[0],\n      setUsagePastYear = _useState43[1];\n\n  var _useState44 = useState(0),\n      machineFrequency = _useState44[0],\n      setMachineFrequency = _useState44[1]; // For extra (dimensions/price/DOM) section collapse.\n\n\n  var _useState45 = useState(false),\n      showExtra = _useState45[0],\n      setShowExtra = _useState45[1]; // For PN/SN \"add new\" functionality.\n\n\n  var _useState46 = useState(false),\n      addingNewPn = _useState46[0],\n      setAddingNewPn = _useState46[1];\n\n  var _useState47 = useState(\"\"),\n      newPn = _useState47[0],\n      setNewPn = _useState47[1];\n\n  var _useState48 = useState(false),\n      addingNewSn = _useState48[0],\n      setAddingNewSn = _useState48[1];\n\n  var _useState49 = useState(\"\"),\n      newSn = _useState49[0],\n      setNewSn = _useState49[1]; // For browsing photos.\n\n\n  var browseInputRef = useRef(null);\n  var cloneSeedRef = useRef(null); // Inside your NewItem component:\n\n  var _useState50 = useState(false),\n      loading = _useState50[0],\n      setLoading = _useState50[1];\n\n  var _useState51 = useState(null),\n      savedDocId = _useState51[0],\n      setSavedDocId = _useState51[1];\n\n  var isMountedRef = useRef(true);\n  useEffect(function () {\n    return function () {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  var safeSetLoading = function safeSetLoading(value) {\n    if (isMountedRef.current) setLoading(value);\n  };\n\n  var withTimeout = function withTimeout(promise, ms) {\n    var label = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"Operation\";\n    return new Promise(function (resolve, reject) {\n      var timer = setTimeout(function () {\n        reject(new Error(\"\".concat(label, \" timed out after \").concat(Math.ceil(ms / 1000), \"s\")));\n      }, ms);\n      promise.then(function (result) {\n        clearTimeout(timer);\n        resolve(result);\n      })[\"catch\"](function (err) {\n        clearTimeout(timer);\n        reject(err);\n      });\n    });\n  };\n\n  var shallowClean = function shallowClean(obj) {\n    var newObj = {};\n    Object.keys(obj || {}).forEach(function (key) {\n      newObj[key] = obj[key] === undefined ? \"\" : obj[key];\n    });\n    return newObj;\n  };\n\n  useEffect(function () {\n    if (!router.isReady) return;\n    var cloneFrom = router.query.cloneFrom;\n    if (!cloneFrom || cloneSeedRef.current === cloneFrom) return;\n    cloneSeedRef.current = cloneFrom;\n    var cancelled = false;\n    var db = firebase.firestore();\n\n    var toArray = function toArray(value) {\n      if (Array.isArray(value)) return value;\n      if (value === null || value === undefined || value === \"\") return [\"\"];\n      return [value];\n    };\n\n    var toDateString = function toDateString(value) {\n      if (!value) return \"\";\n\n      if (value !== null && value !== void 0 && value.toDate) {\n        var d = value.toDate();\n        return isNaN(d.getTime()) ? \"\" : d.toISOString().slice(0, 10);\n      }\n\n      if (value instanceof Date) {\n        return isNaN(value.getTime()) ? \"\" : value.toISOString().slice(0, 10);\n      }\n\n      if (typeof value === \"string\") {\n        if (/^\\d{4}-\\d{2}-\\d{2}/.test(value)) return value.slice(0, 10);\n        var parsed = Date.parse(value);\n        if (!isNaN(parsed)) return new Date(parsed).toISOString().slice(0, 10);\n      }\n\n      return \"\";\n    };\n\n    var resolveDoc = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ref, collection) {\n        var doc, _doc, _doc2, _doc3;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (ref) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\", null);\n\n              case 2:\n                _context.prev = 2;\n\n                if (!(typeof ref.get === \"function\")) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 6;\n                return ref.get();\n\n              case 6:\n                doc = _context.sent;\n                return _context.abrupt(\"return\", doc.exists ? _objectSpread({\n                  id: doc.id\n                }, doc.data()) : null);\n\n              case 8:\n                if (!(typeof ref === \"string\")) {\n                  _context.next = 13;\n                  break;\n                }\n\n                _context.next = 11;\n                return db.collection(collection).doc(ref).get();\n\n              case 11:\n                _doc = _context.sent;\n                return _context.abrupt(\"return\", _doc.exists ? _objectSpread({\n                  id: _doc.id\n                }, _doc.data()) : null);\n\n              case 13:\n                if (!(ref !== null && ref !== void 0 && ref.id)) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _context.next = 16;\n                return db.collection(collection).doc(ref.id).get();\n\n              case 16:\n                _doc2 = _context.sent;\n                return _context.abrupt(\"return\", _doc2.exists ? _objectSpread({\n                  id: _doc2.id\n                }, _doc2.data()) : null);\n\n              case 18:\n                if (!(ref !== null && ref !== void 0 && ref.path)) {\n                  _context.next = 23;\n                  break;\n                }\n\n                _context.next = 21;\n                return db.doc(ref.path).get();\n\n              case 21:\n                _doc3 = _context.sent;\n                return _context.abrupt(\"return\", _doc3.exists ? _objectSpread({\n                  id: _doc3.id\n                }, _doc3.data()) : null);\n\n              case 23:\n                _context.next = 28;\n                break;\n\n              case 25:\n                _context.prev = 25;\n                _context.t0 = _context[\"catch\"](2);\n                console.error(\"Clone ref lookup failed (\".concat(collection, \")\"), _context.t0);\n\n              case 28:\n                return _context.abrupt(\"return\", null);\n\n              case 29:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 25]]);\n      }));\n\n      return function resolveDoc(_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var doc, data, dateValue, arrivalValue, parentDoc, clientFromDoc, clientCurrentDoc, machineFromDoc, machineCurrentDoc;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return db.collection(\"Test\").doc(cloneFrom).get();\n\n            case 3:\n              doc = _context2.sent;\n\n              if (doc.exists) {\n                _context2.next = 7;\n                break;\n              }\n\n              if (!cancelled) {\n                setErr(\"Clone source not found.\");\n                setShowErr(true);\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 7:\n              data = doc.data() || {};\n              dateValue = toDateString(data.date);\n              arrivalValue = toDateString(data.arrival_date) || (typeof data.arrival_date === \"string\" ? data.arrival_date : \"\");\n\n              if (!cancelled) {\n                setItems(function (prev) {\n                  var _data$price, _data$status, _data$poNumber, _data$trackingNumber, _data$length, _data$width, _data$height;\n\n                  return _objectSpread(_objectSpread({}, prev), {}, {\n                    name: data.name || \"\",\n                    pn: toArray(data.pn),\n                    sn: toArray(data.sn),\n                    localSN: \"\",\n                    date: dateValue || prev.date || \"\",\n                    price: (_data$price = data.price) !== null && _data$price !== void 0 ? _data$price : \"\",\n                    status: (_data$status = data.status) !== null && _data$status !== void 0 ? _data$status : \"\",\n                    poNumber: (_data$poNumber = data.poNumber) !== null && _data$poNumber !== void 0 ? _data$poNumber : \"\",\n                    trackingNumber: (_data$trackingNumber = data.trackingNumber) !== null && _data$trackingNumber !== void 0 ? _data$trackingNumber : \"\",\n                    length: (_data$length = data.length) !== null && _data$length !== void 0 ? _data$length : \"\",\n                    width: (_data$width = data.width) !== null && _data$width !== void 0 ? _data$width : \"\",\n                    height: (_data$height = data.height) !== null && _data$height !== void 0 ? _data$height : \"\",\n                    arrival_date: arrivalValue || \"\",\n                    visible: data.visible !== undefined ? data.visible : true\n                  });\n                });\n                setDescriptions(Array.isArray(data.descriptions) && data.descriptions.length ? data.descriptions : [{\n                  description: \"\",\n                  date: \"\"\n                }]);\n                setWorkOrders(Array.isArray(data.workOrders) && data.workOrders.length ? data.workOrders : [{\n                  workOrder: \"\",\n                  date: \"\"\n                }]);\n                setDOM(data.DOM || \"\");\n                setNewLocalFrom(data.newLocalFrom || {\n                  region: \"\",\n                  section: {\n                    letter: \"\",\n                    number: \"\"\n                  },\n                  bin: \"\",\n                  pallet: \"\"\n                });\n                setNewLocalCurrent(data.newLocalCurrent || {\n                  region: \"\",\n                  section: {\n                    letter: \"\",\n                    number: \"\"\n                  },\n                  bin: \"\",\n                  pallet: \"\"\n                });\n                setAddToWebsite(Boolean(data.addedToWebsite));\n                setSavedDocId(null);\n                setSelectedDesc(0);\n              }\n\n              if (data.TheMachine && !cancelled) {\n                setTheMachine(data.TheMachine);\n                setMachineFieldsInitialized(false);\n                if (!oem || oem === \"N/A\") setOem(data.TheMachine.oem || data.TheMachine.OEM || \"\");\n                if (!modality || modality === \"N/A\") setModality(data.TheMachine.modality || data.TheMachine.Modality || \"\");\n                if (!model || model === \"N/A\") setModel(data.TheMachine.model || data.TheMachine.Model || \"\");\n              }\n\n              _context2.next = 14;\n              return resolveDoc(data.Parent, \"Test\");\n\n            case 14:\n              parentDoc = _context2.sent;\n\n              if (parentDoc && !cancelled) {\n                setSelectedParent({\n                  id: parentDoc.id,\n                  name: parentDoc.name || \"\"\n                });\n              }\n\n              _context2.next = 18;\n              return resolveDoc(data.ClientFrom, \"Client\");\n\n            case 18:\n              clientFromDoc = _context2.sent;\n\n              if (clientFromDoc && !cancelled) {\n                setSelectedClientFrom(_objectSpread({\n                  id: clientFromDoc.id\n                }, clientFromDoc));\n              }\n\n              _context2.next = 22;\n              return resolveDoc(data.ClientCurrent, \"Client\");\n\n            case 22:\n              clientCurrentDoc = _context2.sent;\n\n              if (clientCurrentDoc && !cancelled) {\n                setSelectedClientCurrent(_objectSpread({\n                  id: clientCurrentDoc.id\n                }, clientCurrentDoc));\n              }\n\n              _context2.next = 26;\n              return resolveDoc(data.MachineFrom || data.Machine, \"Machine\");\n\n            case 26:\n              machineFromDoc = _context2.sent;\n\n              if (machineFromDoc && !cancelled) {\n                setSelectedMachine({\n                  id: machineFromDoc.id,\n                  name: machineFromDoc.name || machineFromDoc.Model || \"\"\n                });\n\n                if (!data.TheMachine) {\n                  setTheMachine(machineFromDoc);\n                  setMachineFieldsInitialized(false);\n                }\n              }\n\n              _context2.next = 30;\n              return resolveDoc(data.MachineCurrent || data.CurrentMachine, \"Machine\");\n\n            case 30:\n              machineCurrentDoc = _context2.sent;\n\n              if (machineCurrentDoc && !cancelled) {\n                setSelectedCurrentMachine({\n                  id: machineCurrentDoc.id,\n                  name: machineCurrentDoc.name || machineCurrentDoc.Model || \"\"\n                });\n\n                if (!data.TheMachine && !machineFromDoc) {\n                  setTheMachine(machineCurrentDoc);\n                  setMachineFieldsInitialized(false);\n                }\n              }\n\n              _context2.next = 38;\n              break;\n\n            case 34:\n              _context2.prev = 34;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error(\"Clone load failed:\", _context2.t0);\n\n              if (!cancelled) {\n                setErr(\"Failed to load clone data.\");\n                setShowErr(true);\n              }\n\n            case 38:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 34]]);\n    }))();\n\n    return function () {\n      cancelled = true;\n    };\n  }, [router.isReady, router.query.cloneFrom, oem, modality, model]); // -------------------- Since this is \"add\" mode, we do not fetch an existing document.\n  // However, we still fetch global PN and SN options and clients for selection.\n\n  useEffect(function () {\n    function fetchClientsData() {\n      return _fetchClientsData.apply(this, arguments);\n    }\n\n    function _fetchClientsData() {\n      _fetchClientsData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var clientsData;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return fetchClients();\n\n              case 3:\n                clientsData = _context3.sent;\n                console.log(\"Clients:\", clientsData);\n                setClients(clientsData);\n                _context3.next = 11;\n                break;\n\n              case 8:\n                _context3.prev = 8;\n                _context3.t0 = _context3[\"catch\"](0);\n                console.error(\"Error fetching clients: \", _context3.t0);\n\n              case 11:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[0, 8]]);\n      }));\n      return _fetchClientsData.apply(this, arguments);\n    }\n\n    fetchClientsData();\n  }, []);\n\n  var loadPnSnOptions = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var db, snapshot, pnSet, snSet;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (!(pnSnLoaded || pnSnLoading)) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 2:\n              setPnSnLoading(true);\n              _context4.prev = 3;\n              db = firebase.firestore();\n              _context4.next = 7;\n              return db.collection(\"Test\").orderBy(firebase.firestore.FieldPath.documentId()).limit(500).get();\n\n            case 7:\n              snapshot = _context4.sent;\n              pnSet = new Set();\n              snSet = new Set();\n              snapshot.forEach(function (doc) {\n                var data = doc.data();\n\n                if (Array.isArray(data.pn)) {\n                  data.pn.forEach(function (pn) {\n                    return pn && pnSet.add(pn);\n                  });\n                } else if (data.pn) {\n                  pnSet.add(data.pn);\n                }\n\n                if (Array.isArray(data.sn)) {\n                  data.sn.forEach(function (sn) {\n                    return sn && snSet.add(sn);\n                  });\n                } else if (data.sn) {\n                  snSet.add(data.sn);\n                }\n              });\n              setPnOptions(_toConsumableArray(pnSet));\n              setSnOptions(_toConsumableArray(snSet));\n              setPnSnLoaded(true);\n              _context4.next = 19;\n              break;\n\n            case 16:\n              _context4.prev = 16;\n              _context4.t0 = _context4[\"catch\"](3);\n              console.error(\"Error fetching PN/SN options:\", _context4.t0);\n\n            case 19:\n              _context4.prev = 19;\n              setPnSnLoading(false);\n              return _context4.finish(19);\n\n            case 22:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[3, 16, 19, 22]]);\n    }));\n\n    return function loadPnSnOptions() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var _useState52 = useState(false),\n      machineFieldsInitialized = _useState52[0],\n      setMachineFieldsInitialized = _useState52[1];\n\n  useEffect(function () {\n    if (!machineFieldsInitialized && (TheMachine || selectedCurrentMachine || selectedMachine)) {\n      var updatedFields = updateMachineFields(TheMachine, selectedCurrentMachine, selectedMachine); // Only set fields if they are empty or \"N/A\"\n\n      if (!oem || oem === \"N/A\") setOem(updatedFields.oem);\n      if (!modality || modality === \"N/A\") setModality(updatedFields.modality);\n      if (!model || model === \"N/A\") setModel(updatedFields.model);\n      setMachineFieldsInitialized(true);\n    }\n  }, [TheMachine, selectedCurrentMachine, selectedMachine, machineFieldsInitialized]);\n\n  var _useState53 = useState(null),\n      signal = _useState53[0],\n      setSignal = _useState53[1];\n\n  useEffect(function () {\n    if (router.isReady) {\n      setSignal(router.query.signal || null);\n    }\n  }, [router.isReady, router.query.signal]); // -------------------- Handlers for PN and SN dropdowns\n  // PN: when a user selects an existing PN value.\n\n  var handlePnSelect = function handlePnSelect(e) {\n    var selected = e.target.value;\n    setItems(function (prev) {\n      var updatedPn = Array.isArray(prev.pn) ? _toConsumableArray(prev.pn) : [];\n      updatedPn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: updatedPn\n      });\n    });\n  };\n\n  var handlePnChange = function handlePnChange(index, value) {\n    setItems(function (prev) {\n      var newPn = _toConsumableArray(prev.pn);\n\n      newPn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        pn: newPn\n      });\n    });\n  };\n\n  var addPn = function addPn() {\n    if (newPn.trim() !== \"\") {\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          pn: [].concat(_toConsumableArray(prev.pn), [newPn.trim()])\n        });\n      });\n    }\n\n    setNewPn(\"\");\n    setAddingNewPn(false);\n  }; // SN: when a user selects an existing SN value.\n\n\n  var handleSnSelect = function handleSnSelect(e) {\n    var selected = e.target.value;\n    setItems(function (prev) {\n      var updatedSn = Array.isArray(prev.sn) ? _toConsumableArray(prev.sn) : [];\n      updatedSn[0] = selected;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: updatedSn\n      });\n    });\n  };\n\n  var handleSnChange = function handleSnChange(index, value) {\n    setItems(function (prev) {\n      var newSn = _toConsumableArray(prev.sn);\n\n      newSn[index] = value;\n      return _objectSpread(_objectSpread({}, prev), {}, {\n        sn: newSn\n      });\n    });\n  };\n\n  var addSn = function addSn() {\n    if (newSn.trim() !== \"\") {\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          sn: [].concat(_toConsumableArray(prev.sn), [newSn.trim()])\n        });\n      });\n    }\n\n    setNewSn(\"\");\n    setAddingNewSn(false);\n  }; // -------------------- Photo Browse Handlers\n\n\n  var handleBrowsePhotos = function handleBrowsePhotos() {\n    if (browseInputRef.current) {\n      browseInputRef.current.click();\n    }\n  };\n\n  var handleFilesSelected = function handleFilesSelected(e) {\n    var files = e.target.files;\n\n    if (files.length) {\n      var newPhotos = [];\n\n      for (var i = 0; i < files.length; i++) {\n        newPhotos.push({\n          file: files[i],\n          url: URL.createObjectURL(files[i])\n        });\n      }\n\n      setPhotos(function (prevPhotos) {\n        return [].concat(_toConsumableArray(prevPhotos), newPhotos);\n      });\n    }\n\n    e.target.value = \"\";\n  }; // -------------------- Photo Capture Handlers remain as in your index.js\n\n\n  var handleCapture = function handleCapture(err, result) {\n    if (result) {\n      setCapturedPhoto(result);\n    }\n  };\n\n  var capturePhoto = function capturePhoto() {\n    var video = document.querySelector(\"video\");\n    var canvas = document.createElement(\"canvas\");\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    var context = canvas.getContext(\"2d\");\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob(function (blob) {\n      setCapturedPhoto(blob);\n    }, \"image/png\");\n  };\n\n  var savePhoto = function savePhoto() {\n    setPhotos(function (prevPhotos) {\n      return [].concat(_toConsumableArray(prevPhotos), [{\n        file: capturedPhoto,\n        url: URL.createObjectURL(capturedPhoto)\n      }]);\n    });\n    setCapturedPhoto(null);\n    setShowCameraModal(false);\n  };\n\n  var removePhoto = function removePhoto(index) {\n    setPhotos(photos.filter(function (_, i) {\n      return i !== index;\n    }));\n  }; // -------------------- Modal Handlers\n\n\n  var handleClose = function handleClose() {\n    return setShow(false);\n  };\n\n  var handleShow = function handleShow() {\n    return setShow(true);\n  };\n\n  var handleCloseErr = function handleCloseErr() {\n    return setShowErr(false);\n  };\n\n  var handleShowErr = function handleShowErr() {\n    return setShowErr(true);\n  };\n\n  var handleCloseSaveModal = function handleCloseSaveModal() {\n    return setShowSaveModal(false);\n  };\n\n  var handleShowSaveModal = function handleShowSaveModal() {\n    return setShowSaveModal(true);\n  };\n\n  var handleCloseDescModal = function handleCloseDescModal() {\n    return setShowDescModal(false);\n  };\n\n  var handleShowDescModal = function handleShowDescModal() {\n    return setShowDescModal(true);\n  };\n\n  var handleCloseWoModal = function handleCloseWoModal() {\n    return setShowWoModal(false);\n  };\n\n  var handleShowWoModal = function handleShowWoModal() {\n    return setShowWoModal(true);\n  };\n\n  var handleCloseClientModal = function handleCloseClientModal() {\n    return setShowClientModal(false);\n  };\n\n  var handleShowClientModal = function handleShowClientModal() {\n    return setShowClientModal(true);\n  };\n\n  var handleCloseMachineModal = function handleCloseMachineModal() {\n    return setShowMachineModal(false);\n  };\n\n  var handleShowMachineModal = function handleShowMachineModal() {\n    setShowMachineModal(true);\n    setShowClientModal(false);\n  };\n\n  var handleCloseParentModal = function handleCloseParentModal() {\n    return setShowParentModal(false);\n  };\n\n  var handleShowParentModal = function handleShowParentModal() {\n    return setShowParentModal(true);\n  }; // -------------------- Work Orders / Descriptions Handlers (unchanged)\n\n\n  var addDescription = function addDescription() {\n    setDescriptions([].concat(_toConsumableArray(descriptions), [{\n      description: \"\",\n      date: \"\"\n    }]));\n  };\n\n  var removeDescription = function removeDescription(index) {\n    setDescriptions(descriptions.filter(function (_, i) {\n      return i !== index;\n    }));\n  };\n\n  var handleDescriptionChange = function handleDescriptionChange(index, field, value) {\n    var newDescriptions = descriptions.map(function (desc, i) {\n      return i === index ? _objectSpread(_objectSpread({}, desc), {}, _defineProperty({}, field, value)) : desc;\n    });\n    setDescriptions(newDescriptions);\n  };\n\n  var addWorkOrder = function addWorkOrder() {\n    setWorkOrders([].concat(_toConsumableArray(workOrders), [{\n      workOrder: \"\",\n      date: \"\"\n    }]));\n  };\n\n  var removeWorkOrder = function removeWorkOrder(index) {\n    setWorkOrders(workOrders.filter(function (_, i) {\n      return i !== index;\n    }));\n  };\n\n  var handleWorkOrderChange = function handleWorkOrderChange(index, field, value) {\n    var newWorkOrders = workOrders.map(function (wo, i) {\n      return i === index ? _objectSpread(_objectSpread({}, wo), {}, _defineProperty({}, field, value)) : wo;\n    });\n    setWorkOrders(newWorkOrders);\n  };\n\n  var listDescriptions = function listDescriptions() {\n    setShowDescModal(true);\n  };\n\n  var selectDescription = function selectDescription(index) {\n    setSelectedDesc(index);\n    setShowDescModal(false);\n  }; // -------------------- Machine Selection (unchanged)\n\n\n  var handleClientInfo = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(clientId) {\n      var db, clientDoc, clientData, machinePromises, machineDocs, machines;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              // Clear any previously selected machine/local loc for the branch\n              if (machinePick) {\n                setSelectedMachine(null);\n                setShowLocalLocFrom(false);\n              } else {\n                setSelectedCurrentMachine(null);\n                setShowLocalLocCurrent(false);\n              }\n\n              db = firebase.firestore();\n              _context5.next = 4;\n              return db.collection(\"Client\").doc(clientId).get();\n\n            case 4:\n              clientDoc = _context5.sent;\n\n              if (!clientDoc.exists) {\n                _context5.next = 16;\n                break;\n              }\n\n              clientData = clientDoc.data();\n\n              if (machinePick) {\n                setSelectedClientFrom(_objectSpread({\n                  id: clientDoc.id\n                }, clientData));\n              } else {\n                setSelectedClientCurrent(_objectSpread({\n                  id: clientDoc.id\n                }, clientData));\n              }\n\n              if (clientData.name === \"SoCalWarehouse\") {\n                if (machinePick) setShowLocalLocFrom(true);else setShowLocalLocCurrent(true);\n              } // Fetch machines for this client:\n\n\n              machinePromises = clientData.machines.map(function (machineRef) {\n                return machineRef.get();\n              });\n              _context5.next = 12;\n              return Promise.all(machinePromises);\n\n            case 12:\n              machineDocs = _context5.sent;\n              machines = machineDocs.map(function (machineDoc) {\n                return _objectSpread({\n                  id: machineDoc.id\n                }, machineDoc.data());\n              });\n              setMachineOptions(machines);\n              handleCloseClientModal();\n\n            case 16:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function handleClientInfo(_x3) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var fetchMachine = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(machineId) {\n      var db, doc, machineData, machinesSnapshot;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              db = firebase.firestore();\n              _context6.next = 3;\n              return db.collection(\"Machine\").doc(machineId).get();\n\n            case 3:\n              doc = _context6.sent;\n\n              if (!doc.exists) {\n                _context6.next = 16;\n                break;\n              }\n\n              machineData = doc.data();\n              setTheMachine(machineData); // Ensure OEM, Modality, and Model update properly only if necessary\n\n              if (!oem || oem === \"N/A\") setOem(machineData.oem || machineData.OEM || \"\");\n              if (!modality || modality === \"N/A\") setModality(machineData.modality || machineData.Modality || \"\");\n              if (!model || model === \"N/A\") setModel(machineData.model || machineData.Model || \"\"); // Set machine frequency count\n\n              _context6.next = 12;\n              return db.collection(\"Machine\").where(\"Model\", \"==\", machineData.Model || machineData.model).get();\n\n            case 12:\n              machinesSnapshot = _context6.sent;\n              setMachineFrequency(machinesSnapshot.size);\n              _context6.next = 17;\n              break;\n\n            case 16:\n              console.error(\"Machine not found\");\n\n            case 17:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function fetchMachine(_x4) {\n      return _ref6.apply(this, arguments);\n    };\n  }(); // -------------------- Frequency/Usage (unchanged)\n\n\n  var calculateItemFrequencyAndUsage = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(pn) {\n      var db, currentDate, oneYearAgo, itemsSnapshot, usagePastYear;\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              db = firebase.firestore();\n              currentDate = new Date();\n              oneYearAgo = new Date();\n              oneYearAgo.setFullYear(currentDate.getFullYear() - 1);\n              _context7.next = 6;\n              return db.collection(\"Test\").where(\"pn\", \"==\", pn).get();\n\n            case 6:\n              itemsSnapshot = _context7.sent;\n              setFreqItem(itemsSnapshot.size);\n              usagePastYear = 0;\n              itemsSnapshot.forEach(function (doc) {\n                var itemData = doc.data();\n                itemData.workOrders.forEach(function (workOrder) {\n                  var workOrderDate = new Date(workOrder.date);\n\n                  if (workOrderDate >= oneYearAgo && workOrderDate <= currentDate) {\n                    usagePastYear++;\n                  }\n                });\n              });\n              setUsagePastYear(usagePastYear);\n\n            case 11:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n\n    return function calculateItemFrequencyAndUsage(_x5) {\n      return _ref7.apply(this, arguments);\n    };\n  }(); // -------------------- Photo Upload (unchanged)\n\n\n  var uploadPhotos = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(docID) {\n      var storageRef, i, photoRef, metadata, url;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              storageRef = firebase.storage().ref();\n              i = 0;\n\n            case 2:\n              if (!(i < photos.length)) {\n                _context8.next = 15;\n                break;\n              }\n\n              if (!photos[i].file) {\n                _context8.next = 12;\n                break;\n              }\n\n              photoRef = storageRef.child(\"Parts/\".concat(docID, \"/\").concat(docID).concat(i === 0 ? \".jpg\" : \".\".concat(i + 1, \".jpg\")));\n              metadata = {\n                contentType: \"image/png\"\n              };\n              _context8.next = 8;\n              return photoRef.put(photos[i].file, metadata);\n\n            case 8:\n              _context8.next = 10;\n              return photoRef.getDownloadURL();\n\n            case 10:\n              url = _context8.sent;\n              photos[i].url = url;\n\n            case 12:\n              i++;\n              _context8.next = 2;\n              break;\n\n            case 15:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    return function uploadPhotos(_x6) {\n      return _ref8.apply(this, arguments);\n    };\n  }(); // -------------------- Submission Handler\n  // For NewItem, only require Name and Description.\n\n\n  function handleSubmit(_x7) {\n    return _handleSubmit.apply(this, arguments);\n  }\n\n  function _handleSubmit() {\n    _handleSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee16(event) {\n      var docId;\n      return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n        while (1) {\n          switch (_context16.prev = _context16.next) {\n            case 0:\n              event.preventDefault();\n\n              if (isReadyForActions) {\n                _context16.next = 5;\n                break;\n              }\n\n              handleShow();\n              _context16.next = 21;\n              break;\n\n            case 5:\n              safeSetLoading(true); // start loading before async work\n\n              _context16.prev = 6;\n              _context16.next = 9;\n              return toSend();\n\n            case 9:\n              docId = _context16.sent;\n\n              if (!docId) {\n                setErr(\"Save failed. Please try again.\");\n                setShowErr(true);\n              }\n\n              _context16.next = 18;\n              break;\n\n            case 13:\n              _context16.prev = 13;\n              _context16.t0 = _context16[\"catch\"](6);\n              console.error(_context16.t0);\n              setErr((_context16.t0 === null || _context16.t0 === void 0 ? void 0 : _context16.t0.message) || \"Save failed.\");\n              setShowErr(true);\n\n            case 18:\n              _context16.prev = 18;\n              safeSetLoading(false); // end loading after async work completes\n\n              return _context16.finish(18);\n\n            case 21:\n            case \"end\":\n              return _context16.stop();\n          }\n        }\n      }, _callee16, null, [[6, 13, 18, 21]]);\n    }));\n    return _handleSubmit.apply(this, arguments);\n  }\n\n  function toSend() {\n    return _toSend.apply(this, arguments);\n  }\n\n  function _toSend() {\n    _toSend = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee17() {\n      var redirect,\n          options,\n          id,\n          db,\n          _options$forceNew,\n          forceNew,\n          existingId,\n          currentUser,\n          userEmail,\n          machineData,\n          formattedItems,\n          fromDetails,\n          currentDetails,\n          docId,\n          queueAssociationUpdates,\n          queuePhotoUpload,\n          newDocId,\n          cleanFormattedItems,\n          _args17 = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n        while (1) {\n          switch (_context17.prev = _context17.next) {\n            case 0:\n              redirect = _args17.length > 0 && _args17[0] !== undefined ? _args17[0] : true;\n              options = _args17.length > 1 && _args17[1] !== undefined ? _args17[1] : {};\n              id = router.query.id;\n              db = firebase.firestore();\n              _options$forceNew = options.forceNew, forceNew = _options$forceNew === void 0 ? false : _options$forceNew;\n              existingId = forceNew ? null : savedDocId || id || null; // Get the current authenticated user\n\n              currentUser = firebase.auth().currentUser;\n              userEmail = currentUser ? currentUser.email : \"unknown\"; // Always use the current state values for OEM, modality, and model.\n\n              machineData = _objectSpread(_objectSpread({}, TheMachine || {}), {}, {\n                oem: oem,\n                modality: modality,\n                model: model\n              });\n              formattedItems = _objectSpread(_objectSpread({}, items), {}, {\n                descriptions: descriptions,\n                workOrders: workOrders\n              }); // Remove any unused fields.\n\n              formattedItems.status = items.status || \"\";\n              formattedItems.nameLower = (items.name || \"\").toLowerCase();\n              formattedItems.nameTokens = buildNameTokens(items.name);\n              formattedItems.DOM = DOM; // Date of Manufacture\n\n              fromDetails = buildLocalLocObject(newLocalFrom);\n              currentDetails = buildLocalLocObject(newLocalCurrent);\n\n              if (Object.keys(fromDetails).length) {\n                formattedItems.newLocalFrom = fromDetails;\n                formattedItems.localLocFrom = formatLoc(newLocalFrom) || \"\";\n              } else {\n                formattedItems.localLocFrom = \"\";\n                formattedItems.newLocalFrom = {};\n              }\n\n              if (Object.keys(currentDetails).length) {\n                formattedItems.newLocalCurrent = currentDetails;\n                formattedItems.localLocCurrent = formatLoc(newLocalCurrent) || \"\";\n              } else {\n                formattedItems.localLocCurrent = \"\";\n                formattedItems.newLocalCurrent = {};\n              }\n\n              formattedItems.date = items.date || \"\";\n              formattedItems.arrival_date = items.arrival_date || \"\"; // NEW: Arrival Date\n\n              formattedItems.poNumber = items.poNumber || \"\";\n              formattedItems.trackingNumber = items.trackingNumber || \"\";\n              formattedItems.TheMachine = machineData || {};\n              formattedItems.addedToWebsite = addToWebsite;\n              formattedItems.visible = items.visible; // Add the current user's email under the \"user\" field\n\n              formattedItems.user = userEmail;\n              formattedItems.lastEdited = userEmail; // Clean pn and sn arrays to replace undefined values with an empty string.\n\n              formattedItems.pn = (items.pn || []).map(function (value) {\n                return value === undefined ? \"\" : value;\n              });\n              formattedItems.sn = (items.sn || []).map(function (value) {\n                return value === undefined ? \"\" : value;\n              }); // Set machine references for each branch.\n\n              if (selectedMachine && selectedMachine.id) {\n                formattedItems.MachineFrom = db.collection(\"Machine\").doc(selectedMachine.id);\n              }\n\n              if (selectedCurrentMachine && selectedCurrentMachine.id) {\n                formattedItems.MachineCurrent = db.collection(\"Machine\").doc(selectedCurrentMachine.id);\n              } // ***** NEW: Set client references for each branch *****\n\n\n              if (selectedClientFrom && selectedClientFrom.id) {\n                formattedItems.ClientFrom = db.collection(\"Client\").doc(selectedClientFrom.id);\n              }\n\n              if (selectedClientCurrent && selectedClientCurrent.id) {\n                formattedItems.ClientCurrent = db.collection(\"Client\").doc(selectedClientCurrent.id);\n              } // ******************************************************\n\n\n              if (selectedParent && selectedParent.id) {\n                formattedItems.Parent = db.collection(\"Test\").doc(selectedParent.id);\n              } // Only add dateCreated if this is a new document\n\n\n              if (!existingId) {\n                formattedItems.dateCreated = new Date().toISOString().split(\"T\")[0]; // \"YYYY-MM-DD\"\n              } // --- LOCAL SN LOGIC ---\n\n\n              docId = existingId;\n\n              queueAssociationUpdates = function queueAssociationUpdates(targetDocId) {\n                var updates = [];\n\n                if (selectedMachine && selectedMachine.id) {\n                  updates.push(db.collection(\"Machine\").doc(selectedMachine.id).update({\n                    associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(targetDocId))\n                  }));\n                }\n\n                if (selectedCurrentMachine && selectedCurrentMachine.id) {\n                  updates.push(db.collection(\"Machine\").doc(selectedCurrentMachine.id).update({\n                    associatedParts: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Test\").doc(targetDocId))\n                  }));\n                }\n\n                if (updates.length) {\n                  Promise.allSettled(updates).then(function (results) {\n                    results.forEach(function (result) {\n                      if (result.status === \"rejected\") {\n                        console.error(\"Error updating associatedParts:\", result.reason);\n                      }\n                    });\n                  });\n                }\n              };\n\n              queuePhotoUpload = function queuePhotoUpload(targetDocId) {\n                var hasNewPhotos = photos.some(function (photo) {\n                  return photo && photo.file;\n                });\n                if (!hasNewPhotos) return;\n                uploadPhotos(targetDocId)[\"catch\"](function (error) {\n                  console.error(\"Error uploading photos:\", error);\n                });\n              };\n\n              _context17.prev = 38;\n\n              if (!docId) {\n                _context17.next = 64;\n                break;\n              }\n\n              // Check if a localSN is provided and if it differs from the current docId.\n              newDocId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : docId;\n\n              if (!(docId !== newDocId)) {\n                _context17.next = 57;\n                break;\n              }\n\n              _context17.next = 44;\n              return withTimeout(db.collection(\"Test\").doc(newDocId).set(formattedItems), 45000, \"Firestore save\");\n\n            case 44:\n              queueAssociationUpdates(newDocId);\n              queuePhotoUpload(newDocId); // Delete the old document.\n\n              _context17.prev = 46;\n              _context17.next = 49;\n              return withTimeout(db.collection(\"Test\").doc(docId)[\"delete\"](), 20000, \"Delete old item\");\n\n            case 49:\n              _context17.next = 54;\n              break;\n\n            case 51:\n              _context17.prev = 51;\n              _context17.t0 = _context17[\"catch\"](46);\n              console.error(\"Error deleting old item:\", _context17.t0);\n\n            case 54:\n              // Set docId to the new document ID.\n              docId = newDocId;\n              _context17.next = 62;\n              break;\n\n            case 57:\n              // Deep-clean the formattedItems to remove any undefined nested values.\n              cleanFormattedItems = shallowClean(formattedItems);\n              _context17.next = 60;\n              return withTimeout(db.collection(\"Test\").doc(docId).update(cleanFormattedItems), 45000, \"Firestore save\");\n\n            case 60:\n              queueAssociationUpdates(docId);\n              queuePhotoUpload(docId);\n\n            case 62:\n              _context17.next = 69;\n              break;\n\n            case 64:\n              // For a new item, if localSN is provided, use it; otherwise, generate a custom ID.\n              docId = items.localSN && items.localSN.trim() !== \"\" ? items.localSN.trim() : generateCustomID();\n              _context17.next = 67;\n              return withTimeout(db.collection(\"Test\").doc(docId).set(formattedItems), 45000, \"Firestore save\");\n\n            case 67:\n              queueAssociationUpdates(docId);\n              queuePhotoUpload(docId);\n\n            case 69:\n              console.log(\"Item saved!\");\n\n              if (!forceNew) {\n                setSavedDocId(docId);\n              } // Redirect to the new URL using the new document id.\n\n\n              if (redirect) {\n                router.push(\"/NewSearch/item/\".concat(docId));\n              } else {\n                // Optionally, show a save confirmation modal.\n                handleShowSaveModal();\n              }\n\n              return _context17.abrupt(\"return\", docId);\n\n            case 75:\n              _context17.prev = 75;\n              _context17.t1 = _context17[\"catch\"](38);\n              console.error(\"Error saving data:\", _context17.t1);\n              return _context17.abrupt(\"return\", null);\n\n            case 79:\n            case \"end\":\n              return _context17.stop();\n          }\n        }\n      }, _callee17, null, [[38, 75], [46, 51]]);\n    }));\n    return _toSend.apply(this, arguments);\n  }\n\n  var isReadyForActions = (items.name || \"\").trim() !== \"\" && (((_descriptions$selecte = descriptions[selectedDesc]) === null || _descriptions$selecte === void 0 ? void 0 : _descriptions$selecte.description) || \"\").trim() !== \"\";\n\n  var ensureSaved = /*#__PURE__*/function () {\n    var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n      var docId;\n      return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              if (isReadyForActions) {\n                _context9.next = 3;\n                break;\n              }\n\n              handleShow();\n              return _context9.abrupt(\"return\", null);\n\n            case 3:\n              if (!savedDocId) {\n                _context9.next = 5;\n                break;\n              }\n\n              return _context9.abrupt(\"return\", savedDocId);\n\n            case 5:\n              _context9.next = 7;\n              return toSend(false);\n\n            case 7:\n              docId = _context9.sent;\n\n              if (!docId) {\n                setErr(\"Failed to save item before action.\");\n                setShowErr(true);\n              }\n\n              return _context9.abrupt(\"return\", docId);\n\n            case 10:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee9);\n    }));\n\n    return function ensureSaved() {\n      return _ref9.apply(this, arguments);\n    };\n  }(); // -------------------- Info Modal Handlers (unchanged)\n\n\n  var _useState54 = useState(false),\n      showInfoModal = _useState54[0],\n      setShowInfoModal = _useState54[1];\n\n  var _useState55 = useState(\"\"),\n      itemName = _useState55[0],\n      setItemName = _useState55[1];\n\n  var handleShowInfoModal = /*#__PURE__*/function () {\n    var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n      var db, docId, doc, data;\n      return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              db = firebase.firestore();\n              _context10.prev = 1;\n              docId = savedDocId || router.query.id;\n\n              if (docId) {\n                _context10.next = 7;\n                break;\n              }\n\n              setErr(\"Save the item before viewing info.\");\n              setShowErr(true);\n              return _context10.abrupt(\"return\");\n\n            case 7:\n              _context10.next = 9;\n              return db.collection(\"Test\").doc(docId).get();\n\n            case 9:\n              doc = _context10.sent;\n\n              if (doc.exists) {\n                data = doc.data();\n                setItemName(data.name || \"N/A\");\n                setShowInfoModal(true);\n              } else {\n                console.error(\"Item not found\");\n              }\n\n              _context10.next = 16;\n              break;\n\n            case 13:\n              _context10.prev = 13;\n              _context10.t0 = _context10[\"catch\"](1);\n              console.error(\"Error fetching item info:\", _context10.t0);\n\n            case 16:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10, null, [[1, 13]]);\n    }));\n\n    return function handleShowInfoModal() {\n      return _ref10.apply(this, arguments);\n    };\n  }();\n\n  var handleCloseInfoModal = function handleCloseInfoModal() {\n    return setShowInfoModal(false);\n  };\n\n  var handleCloseCameraModal = function handleCloseCameraModal() {\n    setShowCameraModal(false);\n    setCapturedPhoto(null);\n  };\n\n  var handleChange = function handleChange(field) {\n    return function (event) {\n      var value = event.target ? event.target.value : event.value;\n      setItems(function (prevItems) {\n        return _objectSpread(_objectSpread({}, prevItems), {}, _defineProperty({}, field, value));\n      });\n    };\n  };\n\n  var mostRecentWorkOrder = workOrders && workOrders.length > 0 ? workOrders.reduce(function (latest, current) {\n    var latestDate = new Date(latest.date);\n    var currentDate = new Date(current.date);\n    return currentDate > latestDate ? current : latest;\n  }, workOrders[0]) : {};\n\n  var handleShowCameraModal = function handleShowCameraModal() {\n    setShowCameraModal(true);\n  };\n\n  var generateCustomID = function generateCustomID() {\n    var randomNum = Math.floor(10000 + Math.random() * 90000);\n    return \"AIS\".concat(randomNum);\n  };\n\n  var handlePrint = /*#__PURE__*/function () {\n    var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n      var docId, payload, response, result;\n      return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              _context11.next = 2;\n              return ensureSaved();\n\n            case 2:\n              docId = _context11.sent;\n\n              if (docId) {\n                _context11.next = 5;\n                break;\n              }\n\n              return _context11.abrupt(\"return\");\n\n            case 5:\n              payload = {\n                name: items.name,\n                pn: items.pn,\n                sn: items.sn,\n                wo: workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\",\n                status: items.status,\n                local_sn: docId,\n                descriptions: descriptions,\n                date: items.date || new Date().toISOString().split(\"T\")[0],\n                DOM: DOM,\n                oem: oem,\n                modality: modality,\n                model: model,\n                poNumber: items.poNumber,\n                arrival_date: items.arrival_date,\n                trackingNumber: items.trackingNumber\n              };\n              console.log(\"Payload for printing:\", payload);\n              _context11.prev = 7;\n              _context11.next = 10;\n              return fetch(\"https://9d70-174-76-22-138.ngrok-free.app/print-label\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 10:\n              response = _context11.sent;\n              _context11.next = 13;\n              return response.json();\n\n            case 13:\n              result = _context11.sent;\n              console.log(\"Print result:\", result);\n              _context11.next = 20;\n              break;\n\n            case 17:\n              _context11.prev = 17;\n              _context11.t0 = _context11[\"catch\"](7);\n              console.error(\"Error printing label:\", _context11.t0);\n\n            case 20:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, _callee11, null, [[7, 17]]);\n    }));\n\n    return function handlePrint() {\n      return _ref11.apply(this, arguments);\n    };\n  }();\n\n  var handleSendToInflow = /*#__PURE__*/function () {\n    var _ref12 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n      var _descriptions$selecte2, docId, name, description, imageUrls, sku, arrivalISO, pnStr, snStr, mostRecentWO, customFields, created;\n\n      return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n        while (1) {\n          switch (_context12.prev = _context12.next) {\n            case 0:\n              _context12.prev = 0;\n              _context12.next = 3;\n              return ensureSaved();\n\n            case 3:\n              docId = _context12.sent;\n\n              if (docId) {\n                _context12.next = 6;\n                break;\n              }\n\n              return _context12.abrupt(\"return\");\n\n            case 6:\n              name = (items.name || \"\").trim();\n\n              if (name) {\n                _context12.next = 10;\n                break;\n              }\n\n              alert(\"Item needs a name before sending to inFlow.\");\n              return _context12.abrupt(\"return\");\n\n            case 10:\n              description = (((_descriptions$selecte2 = descriptions[selectedDesc]) === null || _descriptions$selecte2 === void 0 ? void 0 : _descriptions$selecte2.description) || \"\").trim();\n              imageUrls = photos.map(function (p) {\n                return p.url;\n              }).filter(Boolean);\n              sku = docId.toString();\n              arrivalISO = items.arrival_date ? new Date(items.arrival_date).toISOString().slice(0, 10) : \"\";\n              pnStr = Array.isArray(items.pn) ? items.pn.filter(Boolean).join(\", \") : items.pn || \"\";\n              snStr = Array.isArray(items.sn) ? items.sn.filter(Boolean).join(\", \") : items.sn || \"\";\n              mostRecentWO = workOrders !== null && workOrders !== void 0 && workOrders.length ? workOrders.reduce(function (latest, cur) {\n                return new Date(cur.date) > new Date(latest.date) ? cur : latest;\n              }) : {\n                workOrder: \"\",\n                date: \"\"\n              };\n              customFields = {\n                custom1: (oem || \"\").trim(),\n                custom2: (modality || \"\").trim(),\n                custom3: (model || \"\").trim(),\n                custom4: (description || \"\").trim(),\n                custom5: (mostRecentWO.workOrder || \"\").trim(),\n                custom6: ((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : selectedClientFrom.name) || \"\").trim(),\n                custom7: pnStr,\n                custom8: snStr,\n                custom9: arrivalISO,\n                custom10: ((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : selectedClientCurrent.name) || \"\").trim()\n              };\n              _context12.next = 20;\n              return InflowAPI.upsertProduct({\n                name: name,\n                description: description,\n                sku: sku,\n                imageUrls: imageUrls,\n                customFields: customFields\n              });\n\n            case 20:\n              created = _context12.sent;\n              alert(\"Sent to inFlow successfully. ID: \".concat((created === null || created === void 0 ? void 0 : created.productId) || (created === null || created === void 0 ? void 0 : created.id) || \"(unknown)\"));\n              _context12.next = 28;\n              break;\n\n            case 24:\n              _context12.prev = 24;\n              _context12.t0 = _context12[\"catch\"](0);\n              console.error(_context12.t0);\n              alert(\"Error sending to inFlow: \" + _context12.t0.message);\n\n            case 28:\n            case \"end\":\n              return _context12.stop();\n          }\n        }\n      }, _callee12, null, [[0, 24]]);\n    }));\n\n    return function handleSendToInflow() {\n      return _ref12.apply(this, arguments);\n    };\n  }();\n\n  var handleBluefolderButton = /*#__PURE__*/function () {\n    var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n      var _descriptions$selecte3;\n\n      var docId, currentWorkOrder, payload, response, result;\n      return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              _context13.next = 2;\n              return ensureSaved();\n\n            case 2:\n              docId = _context13.sent;\n\n              if (docId) {\n                _context13.next = 5;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 5:\n              currentWorkOrder = workOrders && workOrders.length > 0 ? workOrders[0].workOrder : \"\";\n\n              if (currentWorkOrder) {\n                _context13.next = 9;\n                break;\n              }\n\n              alert(\"Please fill out the work order field before adding to BlueFolder.\");\n              return _context13.abrupt(\"return\");\n\n            case 9:\n              payload = {\n                name: items.name,\n                pn: items.pn[0] || \"\",\n                sn: items.sn[0] || \"\",\n                status: items.status,\n                description: ((_descriptions$selecte3 = descriptions[selectedDesc]) === null || _descriptions$selecte3 === void 0 ? void 0 : _descriptions$selecte3.description) || \"\",\n                workOrder: currentWorkOrder,\n                localsn: docId\n              };\n              _context13.prev = 10;\n              _context13.next = 13;\n              return fetch(\"https://9d70-174-76-22-138.ngrok-free.app/bluefolder\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 13:\n              response = _context13.sent;\n              _context13.next = 16;\n              return response.json();\n\n            case 16:\n              result = _context13.sent;\n              alert(\"BlueFolder service item added successfully!\");\n              console.log(\"BlueFolder result:\", result);\n              _context13.next = 25;\n              break;\n\n            case 21:\n              _context13.prev = 21;\n              _context13.t0 = _context13[\"catch\"](10);\n              console.error(\"BlueFolder error:\", _context13.t0);\n              alert(\"Error adding data to BlueFolder.\");\n\n            case 25:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee13, null, [[10, 21]]);\n    }));\n\n    return function handleBluefolderButton() {\n      return _ref13.apply(this, arguments);\n    };\n  }();\n\n  var handleAddToSlack = /*#__PURE__*/function () {\n    var _ref14 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14() {\n      var which,\n          _sort$,\n          _ref15,\n          _items$trackingNumber,\n          _json$debug,\n          _json$debug2,\n          docId,\n          safeName,\n          title,\n          pn0,\n          sn0,\n          pn_sn,\n          mostRecentWO,\n          description,\n          tracking,\n          local_sn,\n          photoUrls,\n          resp,\n          json,\n          _args14 = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n        while (1) {\n          switch (_context14.prev = _context14.next) {\n            case 0:\n              which = _args14.length > 0 && _args14[0] !== undefined ? _args14[0] : \"shipping\";\n              _context14.prev = 1;\n              _context14.next = 4;\n              return ensureSaved();\n\n            case 4:\n              docId = _context14.sent;\n\n              if (docId) {\n                _context14.next = 7;\n                break;\n              }\n\n              return _context14.abrupt(\"return\");\n\n            case 7:\n              safeName = ((items === null || items === void 0 ? void 0 : items.name) || docId || \"Untitled\").trim();\n              title = \"\".concat(safeName).concat(docId ? \" (\".concat(docId, \")\") : \"\");\n              pn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.pn) ? items.pn[0] : items === null || items === void 0 ? void 0 : items.pn;\n              sn0 = Array.isArray(items === null || items === void 0 ? void 0 : items.sn) ? items.sn[0] : items === null || items === void 0 ? void 0 : items.sn;\n              pn_sn = [pn0 && \"PN: \".concat(pn0), sn0 && \"SN: \".concat(sn0)].filter(Boolean).join(\"  \");\n              mostRecentWO = workOrders && workOrders.length ? (_sort$ = _toConsumableArray(workOrders).sort(function (a, b) {\n                return new Date((b === null || b === void 0 ? void 0 : b.date) || 0) - new Date((a === null || a === void 0 ? void 0 : a.date) || 0);\n              })[0]) === null || _sort$ === void 0 ? void 0 : _sort$.workOrder : \"\";\n              description = selectedDesc != null && descriptions !== null && descriptions !== void 0 && descriptions[selectedDesc] ? descriptions[selectedDesc].description || \"\" : (items === null || items === void 0 ? void 0 : items.description) || \"\";\n              tracking = (_ref15 = (_items$trackingNumber = items === null || items === void 0 ? void 0 : items.trackingNumber) !== null && _items$trackingNumber !== void 0 ? _items$trackingNumber : items === null || items === void 0 ? void 0 : items.tracking) !== null && _ref15 !== void 0 ? _ref15 : \"\";\n              local_sn = docId || (items === null || items === void 0 ? void 0 : items.localSN) || \"\";\n              photoUrls = Array.isArray(photos) ? photos.map(function (p) {\n                return p === null || p === void 0 ? void 0 : p.url;\n              }).filter(Boolean) : [];\n              _context14.next = 19;\n              return fetch(\"/api/slack/add-to-list\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                  listKey: which,\n                  title: title,\n                  pn_sn: pn_sn,\n                  work_order: mostRecentWO || \"\",\n                  local_sn: local_sn,\n                  tracking: tracking,\n                  description: (description || \"\").trim(),\n                  photoUrls: photoUrls\n                })\n              });\n\n            case 19:\n              resp = _context14.sent;\n              _context14.next = 22;\n              return resp.json();\n\n            case 22:\n              json = _context14.sent;\n              console.log(\"[SLACK][handleAddToSlack] response:\", json);\n              if (json !== null && json !== void 0 && (_json$debug = json.debug) !== null && _json$debug !== void 0 && _json$debug.steps) console.table(json.debug.steps);\n              if (json !== null && json !== void 0 && (_json$debug2 = json.debug) !== null && _json$debug2 !== void 0 && _json$debug2.photos) console.table(json.debug.photos);\n\n              if (!(!resp.ok || !(json !== null && json !== void 0 && json.ok))) {\n                _context14.next = 30;\n                break;\n              }\n\n              setErr(\"Slack add failed: \".concat((json === null || json === void 0 ? void 0 : json.error) || \"unknown error\"));\n              setShowErr(true);\n              return _context14.abrupt(\"return\");\n\n            case 30:\n              alert(\"Added to Slack \".concat(which === \"shipping\" ? \"Shipping\" : which === \"receiving\" ? \"Receiving\" : \"Tasks\", \" list.\"));\n              _context14.next = 38;\n              break;\n\n            case 33:\n              _context14.prev = 33;\n              _context14.t0 = _context14[\"catch\"](1);\n              console.error(_context14.t0);\n              setErr(\"Error adding to Slack\");\n              setShowErr(true);\n\n            case 38:\n            case \"end\":\n              return _context14.stop();\n          }\n        }\n      }, _callee14, null, [[1, 33]]);\n    }));\n\n    return function handleAddToSlack() {\n      return _ref14.apply(this, arguments);\n    };\n  }();\n\n  var handleToggleAddToWebsite = /*#__PURE__*/function () {\n    var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n      var docId, next;\n      return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n        while (1) {\n          switch (_context15.prev = _context15.next) {\n            case 0:\n              _context15.next = 2;\n              return ensureSaved();\n\n            case 2:\n              docId = _context15.sent;\n\n              if (docId) {\n                _context15.next = 5;\n                break;\n              }\n\n              return _context15.abrupt(\"return\");\n\n            case 5:\n              next = !addToWebsite;\n              setAddToWebsite(next);\n              _context15.prev = 7;\n              _context15.next = 10;\n              return firebase.firestore().collection(\"Test\").doc(docId).update({\n                addedToWebsite: next\n              });\n\n            case 10:\n              _context15.next = 15;\n              break;\n\n            case 12:\n              _context15.prev = 12;\n              _context15.t0 = _context15[\"catch\"](7);\n              console.error(\"Error updating addedToWebsite:\", _context15.t0);\n\n            case 15:\n            case \"end\":\n              return _context15.stop();\n          }\n        }\n      }, _callee15, null, [[7, 12]]);\n    }));\n\n    return function handleToggleAddToWebsite() {\n      return _ref16.apply(this, arguments);\n    };\n  }();\n\n  var handleAddNewPn = function handleAddNewPn() {\n    if (newPn.trim() !== \"\") {\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          pn: [].concat(_toConsumableArray(prev.pn), [newPn.trim()])\n        });\n      });\n    }\n\n    setNewPn(\"\");\n    setAddingNewPn(false);\n  };\n\n  var handleAddNewSn = function handleAddNewSn() {\n    if (newSn.trim() !== \"\") {\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          sn: [].concat(_toConsumableArray(prev.sn), [newSn.trim()])\n        });\n      });\n    }\n\n    setNewSn(\"\");\n    setAddingNewSn(false);\n  };\n\n  var _useState56 = useState(false),\n      showLocalLocFrom = _useState56[0],\n      setShowLocalLocFrom = _useState56[1];\n\n  var _useState57 = useState(false),\n      showLocalLocCurrent = _useState57[0],\n      setShowLocalLocCurrent = _useState57[1];\n\n  var _useState58 = useState(false),\n      showNewLocalModalFrom = _useState58[0],\n      setShowNewLocalModalFrom = _useState58[1];\n\n  var _useState59 = useState(false),\n      showNewLocalModalCurrent = _useState59[0],\n      setShowNewLocalModalCurrent = _useState59[1];\n\n  function handleClone(_x8) {\n    return _handleClone.apply(this, arguments);\n  }\n\n  function _handleClone() {\n    _handleClone = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee18(event) {\n      var docId;\n      return _regeneratorRuntime.wrap(function _callee18$(_context18) {\n        while (1) {\n          switch (_context18.prev = _context18.next) {\n            case 0:\n              event.preventDefault();\n\n              if (isReadyForActions) {\n                _context18.next = 4;\n                break;\n              }\n\n              handleShow(); // your existing error modal\n\n              return _context18.abrupt(\"return\");\n\n            case 4:\n              safeSetLoading(true);\n              _context18.prev = 5;\n              _context18.next = 8;\n              return toSend(false, {\n                forceNew: true\n              });\n\n            case 8:\n              docId = _context18.sent;\n\n              if (!docId) {\n                setErr(\"Save failed. Please try again.\");\n                setShowErr(true);\n              } else {\n                // Prepare for the next clone without overwriting the last one.\n                setSavedDocId(null);\n                setItems(function (prev) {\n                  return _objectSpread(_objectSpread({}, prev), {}, {\n                    localSN: \"\"\n                  });\n                });\n              }\n\n              _context18.next = 17;\n              break;\n\n            case 12:\n              _context18.prev = 12;\n              _context18.t0 = _context18[\"catch\"](5);\n              console.error(_context18.t0);\n              setErr((_context18.t0 === null || _context18.t0 === void 0 ? void 0 : _context18.t0.message) || \"Save failed.\");\n              setShowErr(true);\n\n            case 17:\n              _context18.prev = 17;\n              safeSetLoading(false);\n              return _context18.finish(17);\n\n            case 20:\n            case \"end\":\n              return _context18.stop();\n          }\n        }\n      }, _callee18, null, [[5, 12, 17, 20]]);\n    }));\n    return _handleClone.apply(this, arguments);\n  }\n\n  var condition = function condition(name) {\n    return name && name.toLowerCase() === \"interior socal\";\n  };\n\n  var handleSetSelectedMachine = function handleSetSelectedMachine(machine) {\n    var _machine$name;\n\n    var isSocalInterior = ((_machine$name = machine.name) === null || _machine$name === void 0 ? void 0 : _machine$name.toLowerCase()) === \"interior socal\";\n\n    if (machinePick) {\n      var _selectedClientFrom$n;\n\n      setSelectedMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocFrom(isSocalInterior || (selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n = selectedClientFrom.name) === null || _selectedClientFrom$n === void 0 ? void 0 : _selectedClientFrom$n.toLowerCase()) === \"socalwarehouse\");\n    } else {\n      var _selectedClientCurren;\n\n      setSelectedCurrentMachine({\n        id: machine.id,\n        name: machine.name\n      });\n      setShowLocalLocCurrent(isSocalInterior || (selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren = selectedClientCurrent.name) === null || _selectedClientCurren === void 0 ? void 0 : _selectedClientCurren.toLowerCase()) === \"socalwarehouse\");\n    }\n\n    fetchMachine(machine.id);\n    setShowMachineModal(false);\n  };\n\n  var _useState60 = useState(0),\n      currentPnIndex = _useState60[0],\n      setCurrentPnIndex = _useState60[1];\n\n  var _useState61 = useState(false),\n      showDropdown = _useState61[0],\n      setShowDropdown = _useState61[1];\n\n  var _useState62 = useState(0),\n      currentSnIndex = _useState62[0],\n      setCurrentSnIndex = _useState62[1];\n\n  var _useState63 = useState(false),\n      showSnDropdown = _useState63[0],\n      setShowSnDropdown = _useState63[1];\n\n  useEffect(function () {\n    if (showDropdown || showSnDropdown) {\n      loadPnSnOptions();\n    }\n  }, [showDropdown, showSnDropdown]);\n\n  var handleAddNewClient = function handleAddNewClient() {\n    // Generate a random client number as part of the URL.\n    var randomNum = Math.floor(10000 + Math.random() * 90000); // When pushing, include a query parameter (from=item) and the current item id if available.\n\n    router.push(\"/NewSearch/client/AIS\".concat(randomNum, \"/addClient?from=addItem\"));\n  };\n\n  var _useState64 = useState(false),\n      showMachineSelect = _useState64[0],\n      setShowMachineSelect = _useState64[1];\n\n  var _useState65 = useState(null),\n      selectedClientFrom = _useState65[0],\n      setSelectedClientFrom = _useState65[1];\n\n  var _useState66 = useState(null),\n      selectedClientCurrent = _useState66[0],\n      setSelectedClientCurrent = _useState66[1];\n\n  useEffect(function () {\n    var _selectedClientFrom$n2;\n\n    setShowLocalLocFrom((selectedClientFrom === null || selectedClientFrom === void 0 ? void 0 : (_selectedClientFrom$n2 = selectedClientFrom.name) === null || _selectedClientFrom$n2 === void 0 ? void 0 : _selectedClientFrom$n2.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientFrom]);\n  useEffect(function () {\n    var _selectedClientCurren2;\n\n    setShowLocalLocCurrent((selectedClientCurrent === null || selectedClientCurrent === void 0 ? void 0 : (_selectedClientCurren2 = selectedClientCurrent.name) === null || _selectedClientCurren2 === void 0 ? void 0 : _selectedClientCurren2.toLowerCase()) === \"socalwarehouse\");\n  }, [selectedClientCurrent]);\n  return __jsx(LoggedIn, null, __jsx(MachineSelectionModal, {\n    show: machineSelectionModal,\n    handleClose: function handleClose() {\n      return setMachineSelectionModal(false);\n    },\n    setMachine: handleSetSelectedMachine,\n    machineOptions: machineOptions // if your modal needs the list of machines\n\n  }), __jsx(Modal, {\n    show: show,\n    onHide: handleClose\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Error\")), __jsx(Modal.Body, null, \"Missing required field: Name and Description\"), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleClose\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showErr,\n    onHide: handleCloseErr\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Error\")), __jsx(Modal.Body, null, Err), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseErr\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showSaveModal,\n    onHide: handleCloseSaveModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Save Confirmation\")), __jsx(Modal.Body, null, \"Data has been saved successfully.\"), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseSaveModal\n  }, \"Ok\"))), __jsx(Modal, {\n    show: showDescModal,\n    onHide: handleCloseDescModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Descriptions\")), __jsx(Modal.Body, null, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addDescription\n  }, \"Add Description\"), descriptions.map(function (desc, index) {\n    return __jsx(Row, {\n      key: index,\n      className: \"mb-3\"\n    }, __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: \"w-100\",\n      onClick: function onClick() {\n        return selectDescription(index);\n      },\n      style: {\n        cursor: \"pointer\"\n      }\n    }, __jsx(\"div\", {\n      className: \"d-flex justify-content-between\"\n    }, __jsx(\"span\", null, desc.description || \"Description\"), __jsx(\"span\", {\n      style: {\n        borderLeft: \"1px solid #ccc\",\n        paddingLeft: \"10px\"\n      }\n    }, desc.date || \"Date\"))));\n  }), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseDescModal\n  }, \"OK\"))), __jsx(Modal, {\n    show: showWoModal,\n    onHide: handleCloseWoModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Work Orders\")), __jsx(Modal.Body, null, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addWorkOrder,\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, \"Add Work Order\"), workOrders.map(function (wo, index) {\n    return __jsx(Row, {\n      key: index,\n      className: \"mb-3\"\n    }, __jsx(Col, null, __jsx(Form.Control, {\n      type: \"text\",\n      placeholder: \"Work Order\",\n      value: wo.workOrder,\n      onChange: function onChange(e) {\n        return handleWorkOrderChange(index, \"workOrder\", e.target.value);\n      },\n      style: {\n        marginBottom: \"0.5rem\"\n      }\n    })), __jsx(Col, null, __jsx(Form.Control, {\n      type: \"date\",\n      placeholder: \"Date\",\n      value: wo.date,\n      onChange: function onChange(e) {\n        return handleWorkOrderChange(index, \"date\", e.target.value);\n      }\n    })), __jsx(Col, null, __jsx(Button, {\n      variant: \"danger\",\n      onClick: function onClick() {\n        return removeWorkOrder(index);\n      }\n    }, \"Remove\")));\n  }), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseWoModal\n  }, \"OK\"))), __jsx(ClientInfoModal, {\n    show: showMachineModal,\n    handleClose: handleCloseMachineModal,\n    selectedClient: selectedClient,\n    machineOptions: machineOptions,\n    setSelectedMachine: handleSetSelectedMachine\n  }), __jsx(Modal, {\n    show: showClientModal,\n    onHide: handleCloseClientModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Select Client\")), __jsx(Modal.Body, null, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: search,\n    onChange: function onChange(e) {\n      return setSearch(e.target.value);\n    }\n  }), __jsx(ClientTable, {\n    clients: clients.filter(function (client) {\n      return client.name.toLowerCase().includes(search.toLowerCase());\n    }),\n    onSelectClient: handleClientInfo,\n    onInfoClick: handleClientInfo,\n    clearSelection: function clearSelection() {\n      return handleClientInfo(null);\n    },\n    onAddClient: handleAddNewClient // new prop\n\n  }))), __jsx(ParentModal, {\n    show: showParentModal,\n    handleClose: handleCloseParentModal,\n    setSelectedParent: setSelectedParent\n  }), __jsx(MachineSelectionModal, {\n    show: machineSelectionModal,\n    handleClose: function handleClose() {\n      return setMachineSelectionModal(false);\n    },\n    setMachine: setTheMachine\n  }), __jsx(Modal, {\n    show: showCameraModal,\n    onHide: handleCloseCameraModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Take a Photo\")), __jsx(Modal.Body, null, __jsx(\"div\", {\n    className: \"camera\"\n  }, !capturedPhoto ? __jsx(BarcodeScannerComponent, {\n    width: \"100%\",\n    height: 300,\n    onUpdate: handleCapture,\n    facingMode: cameraFacing\n  }) : __jsx(\"div\", {\n    className: \"photo-preview\"\n  }, __jsx(\"img\", {\n    src: URL.createObjectURL(capturedPhoto),\n    alt: \"captured\",\n    style: {\n      width: \"100%\"\n    }\n  })))), __jsx(Modal.Footer, null, !capturedPhoto ? __jsx(React.Fragment, null, __jsx(Button, {\n    onClick: capturePhoto,\n    style: {\n      borderRadius: \"50%\",\n      width: \"60px\",\n      height: \"60px\",\n      position: \"absolute\",\n      left: \"50%\",\n      transform: \"translateX(-50%)\",\n      bottom: \"10px\"\n    }\n  }, \"\\uD83D\\uDCF7\"), __jsx(Button, {\n    onClick: function onClick() {\n      return setCameraFacing(function (prev) {\n        return prev === \"environment\" ? \"user\" : \"environment\";\n      });\n    }\n  }, \"Flip Camera\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseCameraModal\n  }, \"Cancel\")) : __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"secondary\",\n    onClick: function onClick() {\n      return setCapturedPhoto(null);\n    }\n  }, \"Retake\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: savePhoto\n  }, \"OK\")))), __jsx(Modal, {\n    show: showDescModal,\n    onHide: handleCloseDescModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Descriptions\")), __jsx(Modal.Body, null, __jsx(Button, {\n    variant: \"primary\",\n    className: \"mb-3\",\n    onClick: addDescription\n  }, \"Add Description\"), descriptions.map(function (desc, index) {\n    return __jsx(Row, {\n      key: index,\n      className: \"mb-3\"\n    }, __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: \"w-100\",\n      onClick: function onClick() {\n        return selectDescription(index);\n      },\n      style: {\n        cursor: \"pointer\"\n      }\n    }, __jsx(\"div\", {\n      className: \"d-flex justify-content-between\"\n    }, __jsx(\"span\", null, desc.description || \"Description\"), __jsx(\"span\", {\n      style: {\n        borderLeft: \"1px solid #ccc\",\n        paddingLeft: \"10px\"\n      }\n    }, desc.date || \"Date\"))));\n  }), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleCloseDescModal\n  }, \"OK\"))), __jsx(InfoModal, {\n    show: showInfoModal,\n    handleClose: handleCloseInfoModal,\n    itemName: items.name,\n    dimensions: \"\".concat(items.length, \",\").concat(items.width, \",\").concat(items.height),\n    price: items.price,\n    freqI: freqItem,\n    freqM: machineFrequency,\n    usage: usagePastYear\n  }), loading && __jsx(\"div\", {\n    style: {\n      position: \"fixed\",\n      top: 0,\n      left: 0,\n      width: \"100%\",\n      height: \"100%\",\n      backgroundColor: \"rgba(255, 255, 255, 0.7)\",\n      backdropFilter: \"blur(5px)\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      zIndex: 9999 // Make sure it's above everything else\n\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    variant: \"primary\",\n    role: \"status\"\n  }, __jsx(\"span\", {\n    className: \"visually-hidden\"\n  }, \"Loading...\"))), __jsx(Container, {\n    fluid: true,\n    className: styles.page\n  }, __jsx(\"div\", {\n    className: styles.shell\n  }, __jsx(Card, {\n    className: styles.card\n  }, __jsx(Card.Body, {\n    className: styles.cardBody\n  }, __jsx(\"div\", {\n    className: styles.header\n  }, __jsx(\"div\", {\n    className: styles.kicker\n  }, \"New Item\"), __jsx(\"h2\", {\n    className: styles.title\n  }, \"Add New Item\"), __jsx(\"div\", {\n    className: styles.subtitle\n  }, \"Capture details, photos, and routing before saving.\")), __jsx(Form, {\n    onSubmit: handleSubmit\n  }, __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"name\"\n  }, __jsx(Form.Label, null, \"Name\"), __jsx(Form.Control, {\n    type: \"text\",\n    value: items.name,\n    onChange: handleChange(\"name\")\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"pn\"\n  }, __jsx(Form.Label, null, \"Product Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    }\n  }, __jsx(InputGroup, null, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.pn[currentPnIndex] || \"\",\n    onChange: function onChange(e) {\n      return handlePnChange(currentPnIndex, e.target.value);\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowDropdown(!showDropdown);\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setAddingNewPn(true);\n    }\n  }, \"+\"))), showDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    }\n  }, items.pn.map(function (pnOption, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      style: {\n        padding: \"8px\",\n        cursor: \"pointer\"\n      },\n      onClick: function onClick() {\n        setCurrentPnIndex(idx);\n        setShowDropdown(false);\n      }\n    }, pnOption);\n  }))), addingNewPn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new PN\",\n    value: newPn,\n    onChange: function onChange(e) {\n      return setNewPn(e.target.value);\n    },\n    onBlur: handleAddNewPn,\n    onKeyDown: function onKeyDown(e) {\n      if (e.key === \"Enter\") {\n        handleAddNewPn();\n      }\n    }\n  })))), __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"sn\"\n  }, __jsx(Form.Label, null, \"Serial Number\"), __jsx(\"div\", {\n    style: {\n      position: \"relative\"\n    }\n  }, __jsx(InputGroup, null, __jsx(Form.Control, {\n    type: \"text\",\n    value: items.sn[currentSnIndex] || \"\",\n    onChange: function onChange(e) {\n      return handleSnChange(currentSnIndex, e.target.value);\n    }\n  }), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowSnDropdown(!showSnDropdown);\n    }\n  }, \"\\u25BE\"), __jsx(InputGroup.Text, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setAddingNewSn(true);\n    }\n  }, \"+\"))), showSnDropdown && __jsx(\"div\", {\n    style: {\n      position: \"absolute\",\n      top: \"100%\",\n      left: 0,\n      right: 0,\n      backgroundColor: \"white\",\n      border: \"1px solid #ccc\",\n      zIndex: 1000,\n      maxHeight: \"150px\",\n      overflowY: \"auto\"\n    }\n  }, items.sn.map(function (snOption, idx) {\n    return __jsx(\"div\", {\n      key: idx,\n      style: {\n        padding: \"8px\",\n        cursor: \"pointer\"\n      },\n      onClick: function onClick() {\n        setCurrentSnIndex(idx);\n        setShowSnDropdown(false);\n      }\n    }, snOption);\n  }))), addingNewSn && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter new SN\",\n    value: newSn,\n    onChange: function onChange(e) {\n      return setNewSn(e.target.value);\n    },\n    onBlur: handleAddNewSn,\n    onKeyDown: function onKeyDown(e) {\n      if (e.key === \"Enter\") {\n        handleAddNewSn();\n      }\n    }\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"status\"\n  }, __jsx(Form.Label, null, \"Status\"), __jsx(Form.Select, {\n    value: items.status || \"\",\n    onChange: handleChange(\"status\")\n  }, __jsx(\"option\", {\n    value: \"\"\n  }, \"Select status\"), __jsx(\"option\", {\n    value: \"Good\"\n  }, \"Good\"), __jsx(\"option\", {\n    value: \"Bad\"\n  }, \"Bad\"), __jsx(\"option\", {\n    value: \"Unknown\"\n  }, \"Unknown\"))))), __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"localSN\"\n  }, __jsx(Form.Label, null, \"Local SN\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter Local SN\",\n    value: items.localSN || \"\",\n    onChange: handleChange(\"localSN\")\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"arrivalDate\"\n  }, __jsx(Form.Label, null, \"Arrival Date\"), __jsx(Form.Control, {\n    placeholder: \"Enter Arrival Date\",\n    type: \"date\",\n    value: items.arrival_date,\n    onChange: function onChange(e) {\n      var value = e.target.value;\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          arrival_date: value\n        });\n      });\n    }\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"trackingNumber\"\n  }, __jsx(Form.Label, null, \"Tracking Number\"), __jsx(Form.Control, {\n    placeholder: \"Tracking Number\",\n    type: \"text\",\n    value: items.trackingNumber,\n    onChange: handleChange(\"trackingNumber\")\n  })))), __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"oem\"\n  }, __jsx(Form.Label, null, \"OEM\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"OEM\",\n    value: oem,\n    onChange: function onChange(e) {\n      return setOem(e.target.value);\n    }\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"modality\"\n  }, __jsx(Form.Label, null, \"Modality\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Modality\",\n    value: modality,\n    onChange: function onChange(e) {\n      return setModality(e.target.value);\n    }\n  }))), __jsx(Col, null, __jsx(Form.Group, {\n    controlId: \"model\"\n  }, __jsx(Form.Label, null, \"Model\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Model\",\n    value: model,\n    onChange: function onChange(e) {\n      return setModel(e.target.value);\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\",\n      marginTop: \"1rem\"\n    }\n  }, __jsx(\"div\", {\n    className: \"d-flex align-items-center\"\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowWoModal,\n    className: \"me-2\"\n  }, \"Manage Work Orders\"), workOrders.length > 0 && __jsx(\"div\", {\n    className: \"d-flex flex-column align-items-start\"\n  }, __jsx(Form.Label, null, \"Work Order\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Most Recent Work Order\",\n    value: (mostRecentWorkOrder === null || mostRecentWorkOrder === void 0 ? void 0 : mostRecentWorkOrder.workOrder) || \"\",\n    onChange: function onChange(e) {\n      return handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"workOrder\", e.target.value);\n    },\n    style: {\n      marginBottom: \"0.5rem\"\n    }\n  }), __jsx(Form.Label, null, \"Date\"), __jsx(Form.Control, {\n    type: \"date\",\n    placeholder: \"Work Order Date\",\n    value: (mostRecentWorkOrder === null || mostRecentWorkOrder === void 0 ? void 0 : mostRecentWorkOrder.date) || \"\",\n    onChange: function onChange(e) {\n      return handleWorkOrderChange(workOrders.indexOf(mostRecentWorkOrder), \"date\", e.target.value);\n    },\n    style: {\n      marginBottom: \"0.5rem\"\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"desc\"\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: listDescriptions,\n    className: \"mb-2 me-2\"\n  }, \"List Descriptions\"), __jsx(Form.Control, {\n    as: \"textarea\",\n    rows: 3,\n    placeholder: \"Enter description\",\n    value: ((_descriptions$selecte4 = descriptions[selectedDesc]) === null || _descriptions$selecte4 === void 0 ? void 0 : _descriptions$selecte4.description) || \"\",\n    onChange: function onChange(e) {\n      return handleDescriptionChange(selectedDesc, \"description\", e.target.value);\n    },\n    style: {\n      marginBottom: \"0.5rem\"\n    }\n  }), __jsx(Form.Control, {\n    type: \"date\",\n    value: ((_descriptions$selecte5 = descriptions[selectedDesc]) === null || _descriptions$selecte5 === void 0 ? void 0 : _descriptions$selecte5.date) || \"\",\n    onChange: function onChange(e) {\n      return handleDescriptionChange(selectedDesc, \"date\", e.target.value);\n    },\n    style: {\n      marginTop: \"0.5rem\",\n      marginBottom: \"0.5rem\"\n    }\n  }))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(Row, {\n    className: \"mb-3\"\n  }, __jsx(Col, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      setMachinePick(true);\n      handleShowClientModal();\n    },\n    className: \"me-2\"\n  }, \"Select From\"), selectedClientFrom && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(\"p\", null, __jsx(\"strong\", null, \"Selected Client (From):\"), \" \", selectedClientFrom.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowMachineModal(true);\n    }\n  }, \"Select Machine for \", selectedClientFrom.name), selectedMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(\"strong\", null, \"Selected Machine (From):\"), \" \", selectedMachine.name), showLocalLocFrom && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowNewLocalModalFrom(true);\n    },\n    className: \"w-100 mb-2\"\n  }, [newLocalFrom.region, ((_newLocalFrom$section = newLocalFrom.section) === null || _newLocalFrom$section === void 0 ? void 0 : _newLocalFrom$section.letter) + ((_newLocalFrom$section2 = newLocalFrom.section) === null || _newLocalFrom$section2 === void 0 ? void 0 : _newLocalFrom$section2.number), newLocalFrom.bin && \"B\".concat(newLocalFrom.bin), newLocalFrom.pallet && \"P\".concat(newLocalFrom.pallet)].filter(Boolean).join(\"-\") || \"Set Local Location\"), __jsx(Modal, {\n    show: showNewLocalModalFrom,\n    onHide: function onHide() {\n      return setShowNewLocalModalFrom(false);\n    },\n    centered: true\n  }, __jsx(Modal.Header, null, __jsx(Modal.Title, null, \"Edit Local Loc (From)\")), __jsx(Modal.Body, null, __jsx(NewLocal, {\n    selectedClient: selectedClientFrom,\n    showLocalLoc: showNewLocalModalFrom,\n    value: newLocalFrom,\n    onChange: setNewLocalFrom,\n    onSave: function onSave(p) {\n      setNewLocalFrom(p);\n      setShowNewLocalModalFrom(false);\n    },\n    onCancel: function onCancel() {\n      return setShowNewLocalModalFrom(false);\n    }\n  })))))))), __jsx(Col, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      setMachinePick(false);\n      handleShowClientModal();\n    },\n    className: \"me-2\"\n  }, \"Select Current\"), selectedClientCurrent && __jsx(\"div\", {\n    style: {\n      border: \"1px solid #ccc\",\n      padding: \"0.75rem\",\n      borderRadius: \"4px\",\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(\"p\", null, __jsx(\"strong\", null, \"Selected Client (Current):\"), \" \", selectedClientCurrent.name), __jsx(\"div\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowMachineModal(true);\n    }\n  }, \"Select Machine for \", selectedClientCurrent.name), selectedCurrentMachine && __jsx(React.Fragment, null, __jsx(\"p\", {\n    style: {\n      marginTop: \"0.5rem\"\n    }\n  }, __jsx(\"strong\", null, \"Selected Machine (Current):\"), \" \", selectedCurrentMachine.name), showLocalLocCurrent && __jsx(React.Fragment, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowNewLocalModalCurrent(true);\n    },\n    className: \"w-100 mb-2\"\n  }, [newLocalCurrent.region, ((_newLocalCurrent$sect = newLocalCurrent.section) === null || _newLocalCurrent$sect === void 0 ? void 0 : _newLocalCurrent$sect.letter) + ((_newLocalCurrent$sect2 = newLocalCurrent.section) === null || _newLocalCurrent$sect2 === void 0 ? void 0 : _newLocalCurrent$sect2.number), newLocalCurrent.bin && \"B\".concat(newLocalCurrent.bin), newLocalCurrent.pallet && \"P\".concat(newLocalCurrent.pallet)].filter(Boolean).join(\"-\") || \"Set Local Location\"), __jsx(Modal, {\n    show: showNewLocalModalCurrent,\n    onHide: function onHide() {\n      return setShowNewLocalModalCurrent(false);\n    },\n    centered: true\n  }, __jsx(Modal.Header, null, __jsx(Modal.Title, null, \"Edit Local Loc (Current)\")), __jsx(Modal.Body, null, __jsx(NewLocal, {\n    selectedClient: selectedClientCurrent,\n    showLocalLoc: showNewLocalModalCurrent,\n    value: newLocalCurrent,\n    onChange: setNewLocalCurrent,\n    onSave: function onSave(p) {\n      setNewLocalCurrent(p);\n      setShowNewLocalModalCurrent(false);\n    },\n    onCancel: function onCancel() {\n      return setShowNewLocalModalCurrent(false);\n    }\n  })))))))), __jsx(Col, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowParentModal,\n    className: \"me-2\"\n  }, \"Select Parent\"), selectedParent && __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Selected Parent\",\n    value: selectedParent.name,\n    readOnly: true,\n    style: {\n      cursor: \"default\",\n      marginTop: \"0.5rem\"\n    }\n  })))), __jsx(\"div\", {\n    style: {\n      marginBottom: \"1rem\"\n    }\n  }, __jsx(Row, {\n    className: \"mb-3 \".concat(styles.photoActionsRow)\n  }, __jsx(Col, {\n    xs: 12,\n    md: 6\n  }, __jsx(ButtonGroup, null, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleShowCameraModal\n  }, \"Take Photo\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBrowsePhotos\n  }, \"Browse\"))), __jsx(Col, {\n    xs: 12,\n    md: 6,\n    className: styles.photoActionsRight\n  }, __jsx(Button, {\n    variant: \"success\",\n    onClick: handleSendToInflow,\n    disabled: !isReadyForActions,\n    style: {\n      marginLeft: \"auto\"\n    }\n  }, \"Send to inFlow\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleBluefolderButton,\n    disabled: !isReadyForActions,\n    style: {\n      marginLeft: \"0.5rem\",\n      marginRight: \".5rem\"\n    }\n  }, \"BlueFolder\"), __jsx(Button, {\n    variant: addToWebsite ? \"primary\" : \"outline-primary\",\n    onClick: handleToggleAddToWebsite,\n    disabled: !isReadyForActions\n  }, addToWebsite ? \"Added to Website\" : \"Add to Website\"), __jsx(Form.Check, {\n    type: \"checkbox\",\n    id: \"hide-checkbox\",\n    label: \"Hide\",\n    checked: !items.visible,\n    onChange: function onChange(e) {\n      var isHidden = e.currentTarget.checked;\n      setItems(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, {\n          visible: !isHidden\n        });\n      });\n    },\n    className: \"ms-3\"\n  }))), __jsx(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    multiple: true,\n    ref: browseInputRef,\n    style: {\n      display: \"none\"\n    },\n    onChange: handleFilesSelected\n  })), __jsx(\"div\", {\n    className: \"mt-3 d-flex flex-wrap\"\n  }, photos.map(function (photo, index) {\n    return __jsx(\"div\", {\n      key: index,\n      className: \"d-flex flex-column align-items-center mb-2 me-2\",\n      style: {\n        width: \"100px\",\n        height: \"100px\",\n        position: \"relative\"\n      }\n    }, __jsx(\"img\", {\n      src: photo.url,\n      alt: \"Photo \".concat(index + 1),\n      style: {\n        width: \"100%\",\n        height: \"100%\",\n        objectFit: \"cover\"\n      }\n    }), photo.file && __jsx(Button, {\n      variant: \"danger\",\n      size: \"sm\",\n      style: {\n        position: \"absolute\",\n        top: 0,\n        right: 0,\n        padding: \"0 5px\"\n      },\n      onClick: function onClick() {\n        return removePhoto(index);\n      }\n    }, \"X\"));\n  })), __jsx(\"div\", {\n    className: \"mt-3 d-flex flex-wrap align-items-center \".concat(styles.actionRow)\n  }, __jsx(Button, {\n    variant: \"primary\",\n    type: \"submit\",\n    style: {\n      marginRight: \"1rem\"\n    }\n  }, \"Save\"), __jsx(Button, {\n    variant: \"info\",\n    onClick: handleClone,\n    style: {\n      marginRight: \"1rem\"\n    }\n  }, \"Clone\"), __jsx(LoadingButton, {\n    type: \"secondary\",\n    name: \"Back\",\n    route: \"NewSearch/mainSearch\"\n  }), SHOW_SLACK_BUTTONS && __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      flexDirection: \"column\",\n      marginLeft: \".5rem\"\n    }\n  }, __jsx(\"span\", {\n    style: {\n      fontSize: 12,\n      lineHeight: \"12px\",\n      textAlign: \"center\"\n    }\n  }, \"Slack\"), __jsx(\"div\", {\n    style: {\n      display: \"flex\",\n      border: \"1px solid #ced4da\",\n      borderRadius: 6,\n      overflow: \"hidden\"\n    }\n  }, __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: function onClick() {\n      return handleAddToSlack(\"receiving\");\n    },\n    disabled: !isReadyForActions,\n    style: {\n      border: \"none\",\n      borderRight: \"1px solid #ced4da\"\n    }\n  }, \"Receiving\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: function onClick() {\n      return handleAddToSlack(\"shipping\");\n    },\n    disabled: !isReadyForActions,\n    style: {\n      border: \"none\"\n    }\n  }, \"Shipping\"))), __jsx(Button, {\n    variant: \"info\",\n    onClick: handlePrint,\n    disabled: !isReadyForActions,\n    style: {\n      marginLeft: \"auto\"\n    }\n  }, \"Print Label\")), __jsx(\"div\", {\n    style: {\n      textAlign: \"center\",\n      margin: \"1rem 0\"\n    }\n  }, __jsx(Button, {\n    variant: \"link\",\n    style: {\n      textDecoration: \"none\",\n      color: \"black\",\n      fontSize: \"24px\"\n    },\n    onClick: function onClick() {\n      return setShowExtra(!showExtra);\n    }\n  }, \"\\u25BC\")), __jsx(Collapse, {\n    \"in\": showExtra\n  }, __jsx(\"div\", {\n    id: \"extra-collapse\",\n    className: \"mt-3\"\n  }, __jsx(Row, null, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"dimensions\"\n  }, __jsx(Form.Label, null, \"Dimensions (L x W x H)\"), __jsx(Row, null, __jsx(Col, null, __jsx(Form.Control, {\n    placeholder: \"Length\",\n    type: \"text\",\n    value: items.length,\n    onChange: handleChange(\"length\")\n  })), \"x\", __jsx(Col, null, __jsx(Form.Control, {\n    placeholder: \"Width\",\n    type: \"text\",\n    value: items.width,\n    onChange: handleChange(\"width\")\n  })), \"x\", __jsx(Col, null, __jsx(Form.Control, {\n    placeholder: \"Height\",\n    type: \"text\",\n    value: items.height,\n    onChange: handleChange(\"height\")\n  })))), __jsx(Form.Group, {\n    as: Col,\n    controlId: \"price\"\n  }, __jsx(Form.Label, null, \"Price\"), __jsx(Form.Control, {\n    placeholder: \"Price\",\n    type: \"text\",\n    value: items.price,\n    onChange: handleChange(\"price\")\n  }))), __jsx(Row, {\n    className: \"mt-3\"\n  }, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"DOM\"\n  }, __jsx(Form.Label, null, \"DOM (Date of Manufacture)\"), __jsx(Form.Control, {\n    placeholder: \"Enter DOM\",\n    type: \"date\",\n    value: DOM,\n    onChange: function onChange(e) {\n      return setDOM(e.target.value);\n    }\n  }))), __jsx(Row, null, __jsx(Form.Group, {\n    as: Col,\n    controlId: \"poNumber\"\n  }, __jsx(Form.Label, null, \"PO Number\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"PO Number\",\n    value: items.poNumber || \"\",\n    onChange: handleChange(\"poNumber\")\n  })))))))))));\n}","map":null,"metadata":{},"sourceType":"module"}