{"ast":null,"code":"import _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\mainSearch.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport { InputGroup, Dropdown, FormControl, Button, NavDropdown, Form, Modal, Spinner, Pagination, Offcanvas } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { fetchPartsWithMachineDataPage, fetchClients, fetchModels } from \"../../utils/fetchAssociations\";\nimport { useAuth } from \"../../context/AuthUserContext\";\nimport LoggedIn from \"../LoggedIn\";\nimport ClientTable from \"../../utils/ClientTable\";\nimport ModelTable from \"../../utils/ModelTable\";\nimport PartTable from \"../../utils/PartTable\";\nimport styles from \"../../styles/MainSearch.module.css\";\nimport firebase from \"../../context/Firebase\";\nimport { buildNameTokens } from \"../../utils/itemFormShared\"; // Predefined warehouse client IDs and display names\n\nvar SOCAL_CLIENT_ID = \"AIS17182\";\nvar NORCAL_CLIENT_ID = \"AIS25097\";\nvar UNASSIGNED_CLIENT_ID = \"AIS00404\";\nvar DEFAULT_PAGE_SIZE = 25; // Simulates a network request delay\n\nfunction simulateNetworkRequest() {\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, 2000);\n  });\n} // Custom LoadingButton component\n\n\nfunction LoadingButton(_ref) {\n  _s();\n\n  var type = _ref.type,\n      name = _ref.name,\n      route = _ref.route,\n      className = _ref.className;\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setLoading = _useState[1];\n\n  useEffect(function () {\n    if (isLoading) {\n      var cancelled = false;\n      simulateNetworkRequest().then(function () {\n        if (!cancelled) setLoading(false);\n      });\n      return function () {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n  return __jsx(Link, {\n    href: \"/\".concat(route),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 5\n    }\n  }, __jsx(\"a\", {\n    className: \"btn btn-\".concat(type, \" \").concat(className || \"\"),\n    disabled: isLoading,\n    onClick: function onClick() {\n      return !isLoading && setLoading(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }\n  }, isLoading ? \"Loading…\" : name));\n} // ---- DATE HELPERS (top-level scope) ----\n// Convert anything date-ish into a timestamp (ms since epoch).\n\n\n_s(LoadingButton, \"LHJkidtbt8bk0SOCXf2Y2viet6g=\");\n\n_c = LoadingButton;\n\nfunction toTime(value) {\n  if (!value) return null; // Firestore Timestamp { seconds, nanoseconds }\n\n  if (typeof value === \"object\" && value !== null && value.seconds != null) {\n    try {\n      return value.seconds * 1000;\n    } catch (_unused) {\n      /* ignore */\n    }\n  } // Native Date\n\n\n  if (value instanceof Date) {\n    var _t = value.getTime();\n\n    return isNaN(_t) ? null : _t;\n  } // Strings\n\n\n  if (typeof value === \"string\") {\n    // ISO / yyyy-mm-dd\n    var iso = Date.parse(value);\n    if (!isNaN(iso)) return iso; // mm/dd/yyyy\n\n    var parts = value.split(\"/\");\n\n    if (parts.length === 3) {\n      var _parts = _slicedToArray(parts, 3),\n          mm = _parts[0],\n          dd = _parts[1],\n          yyyy = _parts[2];\n\n      var alt = Date.parse(\"\".concat(yyyy, \"-\").concat(mm, \"-\").concat(dd));\n      if (!isNaN(alt)) return alt;\n    }\n  } // Last resort\n\n\n  var t = Date.parse(value);\n  return isNaN(t) ? null : t;\n} // Canonicalize to 'yyyy-mm-dd' (matches <input type=\"date\">)\n\n\nfunction toYMD(value) {\n  var t = toTime(value);\n  if (t == null) return null;\n  var d = new Date(t);\n  var yyyy = d.getFullYear();\n  var mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  var dd = String(d.getDate()).padStart(2, \"0\");\n  return \"\".concat(yyyy, \"-\").concat(mm, \"-\").concat(dd);\n}\n\nfunction normalizeText(value) {\n  if (value == null) return \"\";\n  return String(value).toLowerCase().trim();\n}\n\nfunction getMachineField(item, key) {\n  var _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _item$machineData$key, _item$machineData, _item$machineData2, _item$currentMachineD, _item$currentMachineD2, _item$theMachineData, _item$theMachineData2, _item$TheMachine, _item$TheMachine2;\n\n  if (!item) return null;\n  var lower = key.toLowerCase();\n  return (_ref2 = (_ref3 = (_ref4 = (_ref5 = (_ref6 = (_ref7 = (_ref8 = (_item$machineData$key = item === null || item === void 0 ? void 0 : (_item$machineData = item.machineData) === null || _item$machineData === void 0 ? void 0 : _item$machineData[key]) !== null && _item$machineData$key !== void 0 ? _item$machineData$key : item === null || item === void 0 ? void 0 : (_item$machineData2 = item.machineData) === null || _item$machineData2 === void 0 ? void 0 : _item$machineData2[lower]) !== null && _ref8 !== void 0 ? _ref8 : item === null || item === void 0 ? void 0 : (_item$currentMachineD = item.currentMachineData) === null || _item$currentMachineD === void 0 ? void 0 : _item$currentMachineD[key]) !== null && _ref7 !== void 0 ? _ref7 : item === null || item === void 0 ? void 0 : (_item$currentMachineD2 = item.currentMachineData) === null || _item$currentMachineD2 === void 0 ? void 0 : _item$currentMachineD2[lower]) !== null && _ref6 !== void 0 ? _ref6 : item === null || item === void 0 ? void 0 : (_item$theMachineData = item.theMachineData) === null || _item$theMachineData === void 0 ? void 0 : _item$theMachineData[key]) !== null && _ref5 !== void 0 ? _ref5 : item === null || item === void 0 ? void 0 : (_item$theMachineData2 = item.theMachineData) === null || _item$theMachineData2 === void 0 ? void 0 : _item$theMachineData2[lower]) !== null && _ref4 !== void 0 ? _ref4 : item === null || item === void 0 ? void 0 : (_item$TheMachine = item.TheMachine) === null || _item$TheMachine === void 0 ? void 0 : _item$TheMachine[key]) !== null && _ref3 !== void 0 ? _ref3 : item === null || item === void 0 ? void 0 : (_item$TheMachine2 = item.TheMachine) === null || _item$TheMachine2 === void 0 ? void 0 : _item$TheMachine2[lower]) !== null && _ref2 !== void 0 ? _ref2 : null;\n}\n\nexport default function MainSearch() {\n  _s2();\n\n  var _this = this;\n\n  var _useAuth = useAuth(),\n      signOut = _useAuth.signOut;\n\n  var _useState2 = useState([]),\n      info = _useState2[0],\n      setInfo = _useState2[1];\n\n  var _useState3 = useState([]),\n      backupInfo = _useState3[0],\n      setBackupInfo = _useState3[1];\n\n  var _useState4 = useState([]),\n      augmentedInfo = _useState4[0],\n      setAugmentedInfo = _useState4[1]; // items with clientFromId/currentId added\n\n\n  var _useState5 = useState(true),\n      isLoading = _useState5[0],\n      setIsLoading = _useState5[1];\n\n  var _useState6 = useState([]),\n      ids = _useState6[0],\n      setID = _useState6[1];\n\n  var _useState7 = useState(false),\n      show = _useState7[0],\n      setShow = _useState7[1];\n\n  var _useState8 = useState(false),\n      showFilters = _useState8[0],\n      setShowFilters = _useState8[1];\n\n  var _useState9 = useState(DEFAULT_PAGE_SIZE),\n      pageSize = _useState9[0],\n      setPageSize = _useState9[1];\n\n  var _useState10 = useState(),\n      dItem = _useState10[0],\n      setDItem = _useState10[1];\n\n  var _useState11 = useState(\"Name\"),\n      select = _useState11[0],\n      setSelect = _useState11[1];\n\n  var _useState12 = useState(false),\n      showList = _useState12[0],\n      setShowList = _useState12[1];\n\n  var _useState13 = useState(\"text\"),\n      showListSearch = _useState13[0],\n      setShowListSearch = _useState13[1];\n\n  var _useState14 = useState(\"\"),\n      search = _useState14[0],\n      setSearch = _useState14[1];\n\n  var _useState15 = useState(null),\n      selectedOEM = _useState15[0],\n      setSelectedOEM = _useState15[1];\n\n  var _useState16 = useState(null),\n      selectedModality = _useState16[0],\n      setSelectedModality = _useState16[1]; // Replace the old single client state with two sets:\n\n\n  var _useState17 = useState(null),\n      selectedClientFrom = _useState17[0],\n      setSelectedClientFrom = _useState17[1];\n\n  var _useState18 = useState(\"Select Option\"),\n      clientFromButtonText = _useState18[0],\n      setClientFromButtonText = _useState18[1];\n\n  var _useState19 = useState(null),\n      selectedClientCurrent = _useState19[0],\n      setSelectedClientCurrent = _useState19[1];\n\n  var _useState20 = useState(\"Select Option\"),\n      clientCurrentButtonText = _useState20[0],\n      setClientCurrentButtonText = _useState20[1];\n\n  var _useState21 = useState([]),\n      clients = _useState21[0],\n      setClients = _useState21[1];\n\n  var _useState22 = useState(false),\n      showClientModal = _useState22[0],\n      setShowClientModal = _useState22[1]; // This state tells the modal which client box is being updated: \"from\" or \"current\"\n\n\n  var _useState23 = useState(null),\n      clientSelectionType = _useState23[0],\n      setClientSelectionType = _useState23[1];\n\n  var router = useRouter();\n  var labelBase = [\"name\", \"date\", \"w/o\", \"p/n\", \"s/n\"];\n  var labelBaseNames = [\"name\", \"date\", \"wo\", \"pn\", \"sn\"];\n  var sortCheckBase = [false, false, false, false, false, false];\n\n  function withSortIcon(baseLabels, activeIndex, isDesc) {\n    return baseLabels.map(function (text, i) {\n      if (i !== activeIndex) return text; // untouched\n\n      var arrow = isDesc ? \" ▼\" : \" ▲\";\n      return \"\".concat(text).concat(arrow);\n    });\n  }\n\n  var _useState24 = useState(labelBase),\n      labels = _useState24[0],\n      setLabels = _useState24[1];\n\n  var _useState25 = useState(sortCheckBase),\n      sortCheck = _useState25[0],\n      setSortCheck = _useState25[1];\n\n  var _useState26 = useState(null),\n      hoverIndex = _useState26[0],\n      setHoverIndex = _useState26[1];\n\n  var _useState27 = useState(null),\n      selectedModel = _useState27[0],\n      setSelectedModel = _useState27[1];\n\n  var _useState28 = useState(null),\n      gPos = _useState28[0],\n      setGPos = _useState28[1];\n\n  var _useState29 = useState(null),\n      gIde = _useState29[0],\n      setGIde = _useState29[1];\n\n  var _useState30 = useState(false),\n      isDeleting = _useState30[0],\n      setIsDeleting = _useState30[1];\n\n  var _useState31 = useState(1),\n      page = _useState31[0],\n      setPage = _useState31[1];\n\n  var _useState32 = useState([]),\n      pageCursors = _useState32[0],\n      setPageCursors = _useState32[1];\n\n  var _useState33 = useState(false),\n      hasNextPage = _useState33[0],\n      setHasNextPage = _useState33[1];\n\n  var fetchSeq = useRef(0);\n  var backfillInFlight = useRef(false);\n\n  var _useState34 = useState(0),\n      queryEpoch = _useState34[0],\n      setQueryEpoch = _useState34[1];\n\n  var _useState35 = useState(null),\n      loadError = _useState35[0],\n      setLoadError = _useState35[1];\n\n  var tableBodyRef = useRef(null);\n  var rowHeightRef = useRef(46);\n  var headerHeightRef = useRef(38);\n  var LOAD_TIMEOUT_MS = 30000;\n  var startNameTokenBackfill = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var reason,\n        lastRun,\n        db,\n        lastDoc,\n        tokensEqual,\n        _loop,\n        _ret,\n        _args2 = arguments;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            reason = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : \"\";\n\n            if (!backfillInFlight.current) {\n              _context2.next = 3;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 3:\n            if (!true) {\n              _context2.next = 7;\n              break;\n            }\n\n            lastRun = window.localStorage.getItem(\"nameTokensBackfillAt\");\n\n            if (!(lastRun && Date.now() - Number(lastRun) < 24 * 60 * 60 * 1000)) {\n              _context2.next = 7;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 7:\n            backfillInFlight.current = true;\n            db = firebase.firestore();\n            lastDoc = null;\n\n            tokensEqual = function tokensEqual(a, b) {\n              if (a.length !== b.length) return false;\n              var setA = new Set(a);\n              var setB = new Set(b);\n              if (setA.size !== setB.size) return false;\n\n              var _iterator = _createForOfIteratorHelper(setA),\n                  _step;\n\n              try {\n                for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                  var v = _step.value;\n                  if (!setB.has(v)) return false;\n                }\n              } catch (err) {\n                _iterator.e(err);\n              } finally {\n                _iterator.f();\n              }\n\n              return true;\n            };\n\n            _context2.prev = 11;\n            _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop() {\n              var query, snap, batch, writes;\n              return _regeneratorRuntime.wrap(function _loop$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      query = db.collection(\"Test\").orderBy(firebase.firestore.FieldPath.documentId()).limit(200);\n                      if (lastDoc) query = query.startAfter(lastDoc);\n                      _context.next = 4;\n                      return query.get();\n\n                    case 4:\n                      snap = _context.sent;\n\n                      if (!snap.empty) {\n                        _context.next = 7;\n                        break;\n                      }\n\n                      return _context.abrupt(\"return\", \"break\");\n\n                    case 7:\n                      batch = db.batch();\n                      writes = 0;\n                      snap.docs.forEach(function (doc) {\n                        var data = doc.data() || {};\n                        var name = typeof data.name === \"string\" ? data.name : \"\";\n                        var nameLower = name.toLowerCase();\n                        var nameTokens = buildNameTokens(name);\n                        var existingTokens = Array.isArray(data.nameTokens) ? Array.from(new Set(data.nameTokens.map(function (v) {\n                          return String(v);\n                        }))) : [];\n                        var needsUpdate = data.nameLower !== nameLower || !tokensEqual(existingTokens, nameTokens);\n\n                        if (needsUpdate) {\n                          batch.update(doc.ref, {\n                            nameLower: nameLower,\n                            nameTokens: nameTokens\n                          });\n                          writes += 1;\n                        }\n                      });\n\n                      if (!(writes > 0)) {\n                        _context.next = 13;\n                        break;\n                      }\n\n                      _context.next = 13;\n                      return batch.commit();\n\n                    case 13:\n                      lastDoc = snap.docs[snap.docs.length - 1];\n                      _context.next = 16;\n                      return new Promise(function (resolve) {\n                        return setTimeout(resolve, 25);\n                      });\n\n                    case 16:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _loop);\n            });\n\n          case 13:\n            if (!true) {\n              _context2.next = 20;\n              break;\n            }\n\n            return _context2.delegateYield(_loop(), \"t0\", 15);\n\n          case 15:\n            _ret = _context2.t0;\n\n            if (!(_ret === \"break\")) {\n              _context2.next = 18;\n              break;\n            }\n\n            return _context2.abrupt(\"break\", 20);\n\n          case 18:\n            _context2.next = 13;\n            break;\n\n          case 20:\n            if (true) {\n              window.localStorage.setItem(\"nameTokensBackfillAt\", String(Date.now()));\n            }\n\n            _context2.next = 26;\n            break;\n\n          case 23:\n            _context2.prev = 23;\n            _context2.t1 = _context2[\"catch\"](11);\n            console.error(\"Name token backfill failed:\", reason, _context2.t1);\n\n          case 26:\n            _context2.prev = 26;\n            backfillInFlight.current = false;\n            return _context2.finish(26);\n\n          case 29:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee, null, [[11, 23, 26, 29]]);\n  })), []);\n  var searchLower = (search || \"\").toLowerCase().trim();\n  var hasActiveFilters = Boolean(selectedOEM) || Boolean(selectedModality) || Boolean(selectedModel) || Boolean(selectedClientFrom) || Boolean(selectedClientCurrent) || Boolean(searchLower);\n\n  var valueMatches = function valueMatches(value, s) {\n    if (!value) return false;\n\n    if (Array.isArray(value)) {\n      return value.some(function (v) {\n        return valueMatches(v, s);\n      });\n    }\n\n    return String(value).toLowerCase().includes(s);\n  };\n\n  var matchesFilters = useCallback(function (item) {\n    // hide explicitly hidden items\n    if ((item === null || item === void 0 ? void 0 : item.visible) === false) return false; // OEM / Modality / Model filtering\n\n    var OEM = getMachineField(item, \"OEM\");\n    var Modality = getMachineField(item, \"Modality\");\n    var Model = getMachineField(item, \"Model\");\n\n    if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n      return false;\n    }\n\n    if (selectedModality && normalizeText(Modality) !== normalizeText(selectedModality)) {\n      return false;\n    }\n\n    if (selectedModel && normalizeText(Model) !== normalizeText(selectedModel)) {\n      return false;\n    } // Client filters\n\n\n    if (selectedClientFrom && (item === null || item === void 0 ? void 0 : item.clientFromId) !== selectedClientFrom) {\n      return false;\n    }\n\n    if (selectedClientCurrent && (item === null || item === void 0 ? void 0 : item.clientCurrentId) !== selectedClientCurrent) {\n      return false;\n    } // Search\n\n\n    if (searchLower) {\n      if (select === \"Name\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.name, searchLower);\n      }\n\n      if (select === \"Date\") {\n        var wantedDay = searchLower; // yyyy-mm-dd from input\n\n        var itemYMD = toYMD(item === null || item === void 0 ? void 0 : item.date);\n        if (itemYMD && itemYMD === wantedDay) return true;\n\n        if (Array.isArray(item === null || item === void 0 ? void 0 : item.descriptions)) {\n          if (item.descriptions.some(function (d) {\n            return toYMD(d === null || d === void 0 ? void 0 : d.date) === wantedDay;\n          })) {\n            return true;\n          }\n        }\n\n        if (Array.isArray(item === null || item === void 0 ? void 0 : item.workOrders)) {\n          if (item.workOrders.some(function (w) {\n            return toYMD(w === null || w === void 0 ? void 0 : w.date) === wantedDay;\n          })) {\n            return true;\n          }\n        }\n\n        return false;\n      }\n\n      if (select === \"Work Order\") {\n        return Array.isArray(item === null || item === void 0 ? void 0 : item.workOrders) && item.workOrders.some(function (wo) {\n          return valueMatches(wo === null || wo === void 0 ? void 0 : wo.workOrder, searchLower);\n        });\n      }\n\n      if (select === \"Product Number\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.pn, searchLower);\n      }\n\n      if (select === \"Serial Number\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.sn, searchLower);\n      }\n\n      if (select === \"Description\") {\n        if (valueMatches(item === null || item === void 0 ? void 0 : item.desc, searchLower)) return true;\n        if (valueMatches(item === null || item === void 0 ? void 0 : item.description, searchLower)) return true;\n\n        if (Array.isArray(item === null || item === void 0 ? void 0 : item.descriptions)) {\n          return item.descriptions.some(function (d) {\n            return valueMatches(d === null || d === void 0 ? void 0 : d.description, searchLower);\n          });\n        }\n\n        return false;\n      }\n\n      if (select === \"SKU\") {\n        return valueMatches(item === null || item === void 0 ? void 0 : item.id, searchLower) || valueMatches(item === null || item === void 0 ? void 0 : item.localSN, searchLower) || valueMatches(item === null || item === void 0 ? void 0 : item.local_sn, searchLower);\n      }\n    }\n\n    return true;\n  }, [selectedOEM, selectedModality, selectedModel, selectedClientFrom, selectedClientCurrent, searchLower, select]);\n\n  var resetPagination = function resetPagination() {\n    setPage(1);\n    setPageCursors([]);\n    setHasNextPage(false);\n  }; // Reset pagination on route/query change (prevents stale pages like “starting at 6”)\n\n\n  useEffect(function () {\n    resetPagination();\n    setQueryEpoch(function (v) {\n      return v + 1;\n    });\n  }, [router.asPath]); // Reset and refetch when filters/search change\n\n  useEffect(function () {\n    resetPagination();\n    setQueryEpoch(function (v) {\n      return v + 1;\n    });\n  }, [selectedOEM, selectedModality, selectedModel, selectedClientFrom, selectedClientCurrent, search, select]); // Fetch data on component mount and route change\n\n  useEffect(function () {\n    fetchData(page);\n  }, [page, queryEpoch]);\n\n  function fetchData() {\n    return _fetchData.apply(this, arguments);\n  }\n\n  function _fetchData() {\n    _fetchData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n      var requestedPage,\n          seq,\n          timedOut,\n          timeoutId,\n          startAfterDoc,\n          effectiveSelect,\n          effectiveSearch,\n          effectiveSearchLower,\n          load,\n          _yield$load,\n          data,\n          lastDoc,\n          nextPage,\n          hasNameSearch,\n          augmented,\n          code,\n          _args10 = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee9$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              requestedPage = _args10.length > 0 && _args10[0] !== undefined ? _args10[0] : 1;\n              seq = ++fetchSeq.current;\n              timedOut = false;\n              setIsLoading(true);\n              setLoadError(null);\n              timeoutId = setTimeout(function () {\n                timedOut = true;\n\n                if (seq === fetchSeq.current) {\n                  setLoadError({\n                    code: \"timeout\",\n                    message: \"Loading is taking longer than \".concat(Math.round(LOAD_TIMEOUT_MS / 1000), \"s. This is likely due to very selective filters.\")\n                  });\n                  setIsLoading(false);\n                }\n              }, LOAD_TIMEOUT_MS);\n              _context10.prev = 6;\n\n              if (router.query.inputText && router.query.selectedType) {\n                setSelect(router.query.selectedType);\n                setSearch(router.query.inputText);\n              }\n\n              startAfterDoc = requestedPage > 1 ? pageCursors[requestedPage - 2] : null;\n\n              if (!(requestedPage > 1 && !startAfterDoc)) {\n                _context10.next = 13;\n                break;\n              }\n\n              setPage(1);\n\n              if (seq === fetchSeq.current) {\n                clearTimeout(timeoutId);\n                setIsLoading(false);\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 13:\n              effectiveSelect = router.query.selectedType || select;\n              effectiveSearch = router.query.inputText || search;\n              effectiveSearchLower = (effectiveSearch || \"\").toLowerCase().trim(); // light retry for transient Firestore hiccups\n\n              load = /*#__PURE__*/function () {\n                var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n                  var attempt,\n                      _args9 = arguments;\n                  return _regeneratorRuntime.wrap(function _callee8$(_context9) {\n                    while (1) {\n                      switch (_context9.prev = _context9.next) {\n                        case 0:\n                          attempt = _args9.length > 0 && _args9[0] !== undefined ? _args9[0] : 1;\n                          _context9.prev = 1;\n                          _context9.next = 4;\n                          return fetchPartsWithMachineDataPage({\n                            pageSize: pageSize,\n                            startAfterDoc: startAfterDoc,\n                            visibleOnly: true,\n                            filterFn: hasActiveFilters ? matchesFilters : null,\n                            search: effectiveSearchLower ? {\n                              type: effectiveSelect,\n                              raw: effectiveSearch,\n                              lower: effectiveSearchLower\n                            } : null,\n                            needsMachineData: Boolean(selectedOEM) || Boolean(selectedModality) || Boolean(selectedModel) || Boolean(selectedClientFrom) || Boolean(selectedClientCurrent)\n                          });\n\n                        case 4:\n                          return _context9.abrupt(\"return\", _context9.sent);\n\n                        case 7:\n                          _context9.prev = 7;\n                          _context9.t0 = _context9[\"catch\"](1);\n\n                          if (!(attempt >= 3)) {\n                            _context9.next = 11;\n                            break;\n                          }\n\n                          throw _context9.t0;\n\n                        case 11:\n                          _context9.next = 13;\n                          return new Promise(function (r) {\n                            return setTimeout(r, 250 * Math.pow(2, attempt - 1));\n                          });\n\n                        case 13:\n                          return _context9.abrupt(\"return\", load(attempt + 1));\n\n                        case 14:\n                        case \"end\":\n                          return _context9.stop();\n                      }\n                    }\n                  }, _callee8, null, [[1, 7]]);\n                }));\n\n                return function load() {\n                  return _ref16.apply(this, arguments);\n                };\n              }();\n\n              _context10.next = 19;\n              return load();\n\n            case 19:\n              _yield$load = _context10.sent;\n              data = _yield$load.parts;\n              lastDoc = _yield$load.lastDoc;\n              nextPage = _yield$load.hasNextPage;\n\n              if (!(timedOut || seq !== fetchSeq.current)) {\n                _context10.next = 25;\n                break;\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 25:\n              hasNameSearch = Boolean(effectiveSearchLower) && effectiveSelect === \"Name\";\n\n              if (hasNameSearch && (data.length === 0 || data.some(function (item) {\n                return !Array.isArray(item === null || item === void 0 ? void 0 : item.nameTokens) || item.nameTokens.length === 0;\n              }))) {\n                startNameTokenBackfill(\"name-search\");\n              }\n\n              if (requestedPage === 1 && data.length === 0) {\n                setPageCursors([]);\n                setHasNextPage(false);\n              }\n\n              setBackupInfo(data);\n              setLabels(labelBase); // <-- add this line after setBackupInfo(data)\n\n              setID(data.map(function (item) {\n                return item.id;\n              }));\n\n              if (!(requestedPage > 1 && data.length === 0)) {\n                _context10.next = 35;\n                break;\n              }\n\n              setHasNextPage(false);\n              setPage(1);\n              return _context10.abrupt(\"return\");\n\n            case 35:\n              setHasNextPage(nextPage);\n              setPageCursors(function (prev) {\n                var next = requestedPage === 1 ? [] : _toConsumableArray(prev);\n\n                if (lastDoc) {\n                  next[requestedPage - 1] = lastDoc;\n                }\n\n                return next;\n              });\n              setSelectedItems([]); // Normalize client ids for filtering\n\n              augmented = data.map(function (item) {\n                var _ref17, _ref18, _item$clientFromId, _item$ClientFrom, _ref19, _ref20, _item$clientCurrentId, _item$ClientCurrent;\n\n                return _objectSpread(_objectSpread({}, item), {}, {\n                  clientFromId: (_ref17 = (_ref18 = (_item$clientFromId = item === null || item === void 0 ? void 0 : item.clientFromId) !== null && _item$clientFromId !== void 0 ? _item$clientFromId : typeof (item === null || item === void 0 ? void 0 : item.ClientFrom) === \"string\" ? item.ClientFrom : null) !== null && _ref18 !== void 0 ? _ref18 : item === null || item === void 0 ? void 0 : (_item$ClientFrom = item.ClientFrom) === null || _item$ClientFrom === void 0 ? void 0 : _item$ClientFrom.id) !== null && _ref17 !== void 0 ? _ref17 : null,\n                  clientCurrentId: (_ref19 = (_ref20 = (_item$clientCurrentId = item === null || item === void 0 ? void 0 : item.clientCurrentId) !== null && _item$clientCurrentId !== void 0 ? _item$clientCurrentId : typeof (item === null || item === void 0 ? void 0 : item.ClientCurrent) === \"string\" ? item.ClientCurrent : null) !== null && _ref20 !== void 0 ? _ref20 : item === null || item === void 0 ? void 0 : (_item$ClientCurrent = item.ClientCurrent) === null || _item$ClientCurrent === void 0 ? void 0 : _item$ClientCurrent.id) !== null && _ref19 !== void 0 ? _ref19 : null\n                });\n              });\n              setAugmentedInfo(augmented); // default view = filtered (keeps pagination and filters consistent)\n\n              setInfo(augmented.filter(matchesFilters));\n              _context10.next = 52;\n              break;\n\n            case 43:\n              _context10.prev = 43;\n              _context10.t0 = _context10[\"catch\"](6);\n\n              if (!(seq !== fetchSeq.current)) {\n                _context10.next = 47;\n                break;\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 47:\n              console.error(\"Error fetching data:\", _context10.t0);\n              code = (_context10.t0 === null || _context10.t0 === void 0 ? void 0 : _context10.t0.code) || \"unknown\";\n              setLoadError({\n                code: code,\n                message: (_context10.t0 === null || _context10.t0 === void 0 ? void 0 : _context10.t0.message) || \"Failed to load items.\"\n              });\n              setInfo([]);\n              setAugmentedInfo([]);\n\n            case 52:\n              _context10.prev = 52;\n              clearTimeout(timeoutId);\n              if (seq === fetchSeq.current && !timedOut) setIsLoading(false);\n              return _context10.finish(52);\n\n            case 56:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee9, null, [[6, 43, 52, 56]]);\n    }));\n    return _fetchData.apply(this, arguments);\n  }\n\n  var searchChangeHandler = function searchChangeHandler(event) {\n    return setSearch(event.target.value);\n  }; // Filter the currently loaded items (now consistent with paged filtering)\n\n\n  useEffect(function () {\n    var base = augmentedInfo || [];\n    setInfo(base.filter(matchesFilters));\n  }, [augmentedInfo, matchesFilters]);\n\n  function sortCheckAll(pos) {\n    // Determine next direction: toggle the clicked column only\n    var nextSortCheck = sortCheck.map(function (v, i) {\n      return i === pos ? !v : v;\n    });\n    var isDesc = nextSortCheck[pos]; // true means descending\n\n    var sortedInfo = _toConsumableArray(info).sort(function (a, b) {\n      var key = labelBaseNames[pos];\n\n      if (pos === 1) {\n        // DATE column\n        var ta = toTime(a[key]);\n        var tb = toTime(b[key]); // Put missing dates at the end for ascending, at the start for descending\n\n        if (ta === null && tb === null) return 0;\n        if (ta === null) return isDesc ? -1 : 1;\n        if (tb === null) return isDesc ? 1 : -1;\n        return isDesc ? tb - ta : ta - tb;\n      } // NAME or SKU (string-y columns): indexes 0 or 5 in your original logic\n\n\n      if (pos === 0 || pos === 5) {\n        var _a$key, _b$key;\n\n        var av = ((_a$key = a[key]) !== null && _a$key !== void 0 ? _a$key : \"\").toString();\n        var bv = ((_b$key = b[key]) !== null && _b$key !== void 0 ? _b$key : \"\").toString();\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\n      } // Numeric-ish columns (wo, pn, sn) — fall back to string compare if NaN\n\n\n      var an = Number(a[key]);\n      var bn = Number(b[key]);\n\n      if (!isNaN(an) && !isNaN(bn)) {\n        return isDesc ? bn - an : an - bn;\n      } else {\n        var _a$key2, _b$key2;\n\n        var _av = ((_a$key2 = a[key]) !== null && _a$key2 !== void 0 ? _a$key2 : \"\").toString();\n\n        var _bv = ((_b$key2 = b[key]) !== null && _b$key2 !== void 0 ? _b$key2 : \"\").toString();\n\n        return isDesc ? _bv.localeCompare(_av) : _av.localeCompare(_bv);\n      }\n    });\n\n    setInfo(sortedInfo);\n    setSortCheck(nextSortCheck); // Update header labels to show the little arrow on the active column\n\n    setLabels(withSortIcon(labelBase, pos, isDesc));\n  }\n\n  var rowSelect = function rowSelect(item) {\n    if (item && item.id) {\n      console.log(\"Selected item:\", item);\n      router.push(\"./item/\" + item.id);\n    } else {\n      console.error(\"Unable to determine the selected item’s ID: \", item);\n    }\n  };\n\n  var _useState36 = useState([]),\n      selectedItems = _useState36[0],\n      setSelectedItems = _useState36[1];\n\n  var _useState37 = useState(false),\n      showDeleteModal = _useState37[0],\n      setShowDeleteModal = _useState37[1];\n\n  var handleSelectItem = function handleSelectItem(id) {\n    setSelectedItems(function (prev) {\n      return prev.includes(id) ? prev.filter(function (x) {\n        return x !== id;\n      }) : [].concat(_toConsumableArray(prev), [id]);\n    });\n  }; // setSelectedItems((prev) => {\n  //   const newSelection = prev.includes(id)\n  //     ? prev.filter((itemId) => itemId !== id)\n  //     : [...prev, id];\n  //   console.log(\"Selected items:\", newSelection);\n  //   return newSelection; // <- important\n  // });\n\n\n  var handleShowDeleteModal = function handleShowDeleteModal() {\n    return setShowDeleteModal(true);\n  };\n\n  var handleCloseDeleteModal = function handleCloseDeleteModal() {\n    return setShowDeleteModal(false);\n  };\n\n  var handleDeleteSelected = /*#__PURE__*/function () {\n    var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var db, _iterator2, _step2, itemId;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setIsDeleting(true);\n              db = firebase.firestore();\n              _context3.prev = 2;\n              // Loop over each selected item one at a time\n              _iterator2 = _createForOfIteratorHelper(selectedItems);\n              _context3.prev = 4;\n\n              _iterator2.s();\n\n            case 6:\n              if ((_step2 = _iterator2.n()).done) {\n                _context3.next = 35;\n                break;\n              }\n\n              itemId = _step2.value;\n              console.log(itemId);\n              _context3.prev = 9;\n              _context3.next = 12;\n              return db.collection(\"Test\").doc(itemId)[\"delete\"]();\n\n            case 12:\n              _context3.next = 17;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](9);\n              console.error(\"Error deleting document \".concat(itemId, \" from Test:\"), _context3.t0);\n\n            case 17:\n              _context3.prev = 17;\n              _context3.next = 20;\n              return db.collection(\"Parts\").doc(itemId)[\"delete\"]();\n\n            case 20:\n              _context3.next = 25;\n              break;\n\n            case 22:\n              _context3.prev = 22;\n              _context3.t1 = _context3[\"catch\"](17);\n              console.error(\"Error deleting document \".concat(itemId, \" from Parts:\"), _context3.t1);\n\n            case 25:\n              _context3.prev = 25;\n              _context3.next = 28;\n              return deleteFromStorage(itemId);\n\n            case 28:\n              _context3.next = 33;\n              break;\n\n            case 30:\n              _context3.prev = 30;\n              _context3.t2 = _context3[\"catch\"](25);\n              console.error(\"Error deleting storage for \".concat(itemId, \":\"), _context3.t2);\n\n            case 33:\n              _context3.next = 6;\n              break;\n\n            case 35:\n              _context3.next = 40;\n              break;\n\n            case 37:\n              _context3.prev = 37;\n              _context3.t3 = _context3[\"catch\"](4);\n\n              _iterator2.e(_context3.t3);\n\n            case 40:\n              _context3.prev = 40;\n\n              _iterator2.f();\n\n              return _context3.finish(40);\n\n            case 43:\n              // Update local state by filtering out the deleted items\n              setInfo(info.filter(function (item) {\n                return !selectedItems.includes(item.id);\n              }));\n              setSelectedItems([]);\n              _context3.next = 50;\n              break;\n\n            case 47:\n              _context3.prev = 47;\n              _context3.t4 = _context3[\"catch\"](2);\n              console.error(\"Error deleting items:\", _context3.t4);\n\n            case 50:\n              _context3.prev = 50;\n              setIsDeleting(false);\n              handleCloseDeleteModal(); // Optionally, reload the page\n              // router.reload();\n\n              return _context3.finish(50);\n\n            case 54:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee2, null, [[2, 47, 50, 54], [4, 37, 40, 43], [9, 14], [17, 22], [25, 30]]);\n    }));\n\n    return function handleDeleteSelected() {\n      return _ref10.apply(this, arguments);\n    };\n  }();\n\n  var handleClose = function handleClose() {\n    return setShow(false);\n  };\n\n  var handleShow = function handleShow() {\n    return setShow(true);\n  };\n\n  var checkDelete = function checkDelete(event, pos, idsToDelete, name) {\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    console.log(\"Selected IDs to delete:\", idsToDelete);\n    setSelectedItems(idsToDelete);\n    setDItem(name);\n    setShowDeleteModal(true);\n  }; // const handleDelete = async () => {\n  //   let itemId = gIde;\n  //   try {\n  //     setIsDeleting(true);\n  //     const db = firebase.firestore();\n  //     await db.collection(\"Test\").doc(itemId).delete();\n  //     await deleteFromPartsCollection(itemId);\n  //     await deleteFromStorage(itemId);\n  //     setInfo(info.filter((_, i) => gPos !== i));\n  //     console.log(`Deleted item: ${itemId}`);\n  //   } catch (error) {\n  //     console.error(\"Error deleting item:\", error);\n  //   } finally {\n  //     setIsDeleting(false);\n  //   }\n  //   handleClose();\n  // };\n\n\n  var hoverStyle = function hoverStyle(index) {\n    return {\n      backgroundColor: hoverIndex === index ? \"#ddd\" : \"transparent\",\n      textAlign: \"center\",\n      cursor: \"default\"\n    };\n  };\n\n  var _useState38 = useState(\"Select Option\"),\n      dropdown1Text = _useState38[0],\n      setDropdown1Text = _useState38[1];\n\n  var _useState39 = useState(\"Select Option\"),\n      dropdown2Text = _useState39[0],\n      setDropdown2Text = _useState39[1];\n\n  var handleSelect1 = function handleSelect1(eventKey, event) {\n    if (eventKey === \"unassigned\") {\n      setDropdown1Text(\"Select Option\");\n      setSelectedOEM(null);\n    } else {\n      setDropdown1Text(event.target.textContent);\n      setSelectedOEM(event.target.textContent);\n    }\n  };\n\n  var handleSelect2 = function handleSelect2(eventKey, event) {\n    if (eventKey === \"unassigned\") {\n      setDropdown2Text(\"Select Option\");\n      setSelectedModality(null);\n    } else {\n      setDropdown2Text(event.target.textContent);\n      setSelectedModality(event.target.textContent);\n    }\n  }; // Build a unique list of clients from the items currently loaded, filtered by OEM/Modality.\n  // `type` is \"from\" or \"current\" to decide which client ref to read.\n\n\n  function buildClientsFromItems(_x) {\n    return _buildClientsFromItems.apply(this, arguments);\n  } // --------------------\n  // CLIENT SELECTION HANDLING\n  // --------------------\n  // This function fetches clients and opens the client modal.\n\n\n  function _buildClientsFromItems() {\n    _buildClientsFromItems = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(type) {\n      var db, ids, filtered, _iterator3, _step3, it, id, out, idArray, i, chunk, snap;\n\n      return _regeneratorRuntime.wrap(function _callee10$(_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              db = firebase.firestore();\n              ids = new Set(); // Respect current OEM / Modality filters when deriving client options\n\n              filtered = augmentedInfo.filter(function (item) {\n                var OEM = getMachineField(item, \"OEM\");\n                var Modality = getMachineField(item, \"Modality\");\n\n                if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n                  return false;\n                }\n\n                if (selectedModality && normalizeText(Modality) !== normalizeText(selectedModality)) {\n                  return false;\n                }\n\n                return true;\n              });\n              _iterator3 = _createForOfIteratorHelper(filtered);\n\n              try {\n                for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                  it = _step3.value;\n                  id = type === \"from\" ? it.clientFromId : it.clientCurrentId;\n                  if (id) ids.add(id);\n                }\n              } catch (err) {\n                _iterator3.e(err);\n              } finally {\n                _iterator3.f();\n              }\n\n              out = [];\n              idArray = _toConsumableArray(ids);\n              i = 0;\n\n            case 8:\n              if (!(i < idArray.length)) {\n                _context11.next = 17;\n                break;\n              }\n\n              chunk = idArray.slice(i, i + 10);\n              _context11.next = 12;\n              return db.collection(\"Client\").where(firebase.firestore.FieldPath.documentId(), \"in\", chunk).get();\n\n            case 12:\n              snap = _context11.sent;\n              snap.forEach(function (doc) {\n                var d = doc.data() || {};\n                out.push({\n                  id: doc.id,\n                  name: d.name || doc.id\n                });\n              });\n\n            case 14:\n              i += 10;\n              _context11.next = 8;\n              break;\n\n            case 17:\n              // sort by name for nicer UX\n              out.sort(function (a, b) {\n                return (a.name || \"\").localeCompare(b.name || \"\");\n              });\n              return _context11.abrupt(\"return\", out);\n\n            case 19:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, _callee10);\n    }));\n    return _buildClientsFromItems.apply(this, arguments);\n  }\n\n  var handleClientClick = /*#__PURE__*/function () {\n    var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var safeClients, clientsData, derived;\n      return _regeneratorRuntime.wrap(function _callee3$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              safeClients = [];\n              _context4.prev = 1;\n              _context4.next = 4;\n              return fetchClients(selectedOEM, selectedModality);\n\n            case 4:\n              clientsData = _context4.sent;\n              safeClients = Array.isArray(clientsData) ? clientsData : [];\n              _context4.next = 11;\n              break;\n\n            case 8:\n              _context4.prev = 8;\n              _context4.t0 = _context4[\"catch\"](1);\n              console.error(\"fetchClients failed:\", _context4.t0);\n\n            case 11:\n              if (!(safeClients.length === 0)) {\n                _context4.next = 24;\n                break;\n              }\n\n              _context4.prev = 12;\n\n              if (!clientSelectionType) {\n                // if somehow not set yet, default to \"from\"\n                setClientSelectionType(\"from\");\n              }\n\n              _context4.next = 16;\n              return buildClientsFromItems(clientSelectionType || \"from\");\n\n            case 16:\n              derived = _context4.sent;\n              safeClients = derived;\n              _context4.next = 24;\n              break;\n\n            case 20:\n              _context4.prev = 20;\n              _context4.t1 = _context4[\"catch\"](12);\n              console.error(\"Fallback buildClientsFromItems failed:\", _context4.t1);\n              safeClients = [];\n\n            case 24:\n              setClients(safeClients);\n              setClientSearchTerm(\"\");\n              setShowClientModal(true);\n\n            case 27:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee3, null, [[1, 8], [12, 20]]);\n    }));\n\n    return function handleClientClick() {\n      return _ref11.apply(this, arguments);\n    };\n  }(); // When a client is selected in the modal, we now assume the parameter is a client ID.\n  // If the passed value is null, we clear the selection.\n\n\n  var handleClientSelect = /*#__PURE__*/function () {\n    var _ref12 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(clientId) {\n      var clientSnap, clientData;\n      return _regeneratorRuntime.wrap(function _callee4$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              console.log(\"User selected client id:\", clientId);\n\n              if (clientId) {\n                _context5.next = 5;\n                break;\n              }\n\n              if (clientSelectionType === \"from\") {\n                setClientFromButtonText(\"Select Option\");\n                setSelectedClientFrom(null);\n              } else if (clientSelectionType === \"current\") {\n                setClientCurrentButtonText(\"Select Option\");\n                setSelectedClientCurrent(null);\n              }\n\n              setShowClientModal(false);\n              return _context5.abrupt(\"return\");\n\n            case 5:\n              _context5.prev = 5;\n              _context5.next = 8;\n              return firebase.firestore().collection(\"Client\").doc(clientId).get();\n\n            case 8:\n              clientSnap = _context5.sent;\n\n              if (clientSnap.exists) {\n                clientData = clientSnap.data();\n\n                if (clientSelectionType === \"from\") {\n                  setClientFromButtonText(clientData.name);\n                  setSelectedClientFrom(clientId);\n                } else if (clientSelectionType === \"current\") {\n                  setClientCurrentButtonText(clientData.name);\n                  setSelectedClientCurrent(clientId);\n                }\n              } else {\n                console.error(\"No client document found for id:\", clientId);\n              }\n\n              _context5.next = 15;\n              break;\n\n            case 12:\n              _context5.prev = 12;\n              _context5.t0 = _context5[\"catch\"](5);\n              console.error(\"Error fetching client data:\", _context5.t0);\n\n            case 15:\n              setShowClientModal(false);\n\n            case 16:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee4, null, [[5, 12]]);\n    }));\n\n    return function handleClientSelect(_x2) {\n      return _ref12.apply(this, arguments);\n    };\n  }();\n\n  var handleClientInfo = function handleClientInfo(clientId, clientName) {\n    console.log(\"Client ID: \".concat(clientId, \", Client Name: \").concat(clientName));\n    router.push(\"client/\" + clientId);\n  };\n\n  var handleClearClientSelection = function handleClearClientSelection() {\n    if (clientSelectionType === \"from\") {\n      setClientFromButtonText(\"Select Option\");\n      setSelectedClientFrom(null);\n    } else if (clientSelectionType === \"current\") {\n      setClientCurrentButtonText(\"Select Option\");\n      setSelectedClientCurrent(null);\n    }\n\n    setShowClientModal(false);\n  }; // --------------------\n  // MODEL SELECTION HANDLING\n  // --------------------\n\n\n  var _useState40 = useState([]),\n      models = _useState40[0],\n      setModels = _useState40[1];\n\n  var _useState41 = useState(false),\n      showModelModal = _useState41[0],\n      setShowModelModal = _useState41[1];\n\n  var _useState42 = useState(\"Select Option\"),\n      modelButtonText = _useState42[0],\n      setModelButtonText = _useState42[1];\n\n  var handleModelClick = /*#__PURE__*/function () {\n    var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var modelsData;\n      return _regeneratorRuntime.wrap(function _callee5$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return fetchModels(selectedOEM, selectedModality, selectedClientFrom);\n\n            case 2:\n              modelsData = _context6.sent;\n              setModels(modelsData);\n              setModelSearchTerm(\"\");\n              setShowModelModal(true);\n\n            case 6:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function handleModelClick() {\n      return _ref13.apply(this, arguments);\n    };\n  }();\n\n  var handleModelSelect = function handleModelSelect(modelName) {\n    setModelButtonText(modelName || \"Select Option\");\n    setSelectedModel(modelName || null);\n    setShowModelModal(false);\n  };\n\n  var handleClearModelSelection = function handleClearModelSelection() {\n    setModelButtonText(\"Select Option\");\n    setSelectedModel(null);\n    setShowModelModal(false);\n  }; // --------------------\n  // WAREHOUSE BUTTONS (for Client Current)\n  // --------------------\n\n\n  var handleSoCalWarehouseClick = function handleSoCalWarehouseClick() {\n    setClientCurrentButtonText(\"SoCal Warehouse\");\n    setSelectedClientCurrent(SOCAL_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", SOCAL_CLIENT_ID);\n  };\n\n  var handleNorCalWarehouseClick = function handleNorCalWarehouseClick() {\n    setClientCurrentButtonText(\"NorCal Warehouse\");\n    setSelectedClientCurrent(NORCAL_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", NORCAL_CLIENT_ID);\n  };\n\n  var handleWarehouseUnassignedClick = function handleWarehouseUnassignedClick() {\n    setClientCurrentButtonText(\"Unassigned\");\n    setSelectedClientCurrent(UNASSIGNED_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", UNASSIGNED_CLIENT_ID);\n  };\n\n  var _useState43 = useState(\"\"),\n      clientSearchTerm = _useState43[0],\n      setClientSearchTerm = _useState43[1];\n\n  var _useState44 = useState(\"\"),\n      modelSearchTerm = _useState44[0],\n      setModelSearchTerm = _useState44[1];\n\n  var deleteFromStorage = /*#__PURE__*/function () {\n    var _ref14 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(itemId) {\n      var storageRef, folderRef, listResult, deletePromises;\n      return _regeneratorRuntime.wrap(function _callee6$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              storageRef = firebase.storage().ref();\n              folderRef = storageRef.child(\"Parts/\".concat(itemId, \"/\"));\n              _context7.prev = 2;\n              _context7.next = 5;\n              return folderRef.listAll();\n\n            case 5:\n              listResult = _context7.sent;\n              deletePromises = listResult.items.map(function (item) {\n                return item[\"delete\"]();\n              });\n              _context7.next = 9;\n              return Promise.all(deletePromises);\n\n            case 9:\n              _context7.next = 14;\n              break;\n\n            case 11:\n              _context7.prev = 11;\n              _context7.t0 = _context7[\"catch\"](2);\n              console.error(\"Error deleting from storage:\", _context7.t0);\n\n            case 14:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee6, null, [[2, 11]]);\n    }));\n\n    return function deleteFromStorage(_x3) {\n      return _ref14.apply(this, arguments);\n    };\n  }();\n\n  var deleteFromPartsCollection = /*#__PURE__*/function () {\n    var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(itemId) {\n      var db;\n      return _regeneratorRuntime.wrap(function _callee7$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              db = firebase.firestore();\n              _context8.prev = 1;\n              _context8.next = 4;\n              return db.collection(\"Parts\").doc(itemId)[\"delete\"]();\n\n            case 4:\n              console.log(\"Deleted item from Parts collection: \".concat(itemId));\n              _context8.next = 10;\n              break;\n\n            case 7:\n              _context8.prev = 7;\n              _context8.t0 = _context8[\"catch\"](1);\n              console.error(\"Error deleting from Parts collection:\", _context8.t0);\n\n            case 10:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee7, null, [[1, 7]]);\n    }));\n\n    return function deleteFromPartsCollection(_x4) {\n      return _ref15.apply(this, arguments);\n    };\n  }(); //   // Safely convert any date-ish value into a comparable timestamp (ms since epoch).\n  // function toTime(value) {\n  //   if (!value) return null;\n  //   // Firestore Timestamp: { seconds, nanoseconds }\n  //   if (typeof value === \"object\" && value.seconds) {\n  //     try {\n  //       return value.seconds * 1000;\n  //     } catch { /* fallthrough */ }\n  //   }\n  //   // If already a Date\n  //   if (value instanceof Date) return isNaN(value.getTime()) ? null : value.getTime();\n  //   // If string: try ISO first\n  //   if (typeof value === \"string\") {\n  //     // yyyy-mm-dd (from your form inputs)\n  //     const iso = Date.parse(value);\n  //     if (!isNaN(iso)) return iso;\n  //     // mm/dd/yyyy fallback (older items)\n  //     const parts = value.split(\"/\");\n  //     if (parts.length === 3) {\n  //       const [mm, dd, yyyy] = parts;\n  //       const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\n  //       if (!isNaN(alt)) return alt;\n  //     }\n  //   }\n  //   // Canonicalize any date-ish value to 'yyyy-mm-dd' so it matches <input type=\"date\"> values\n  //   function toYMD(value) {\n  //     const t = toTime(value);\n  //     if (t == null) return null;\n  //     const d = new Date(t);\n  //     const yyyy = d.getFullYear();\n  //     const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  //     const dd = String(d.getDate()).padStart(2, \"0\");\n  //     return `${yyyy}-${mm}-${dd}`;\n  //   }\n  //   // Last resort\n  //   const t = Date.parse(value);\n  //   return isNaN(t) ? null : t;\n  // }\n\n\n  var totalKnownPages = Math.max(1, pageCursors.filter(Boolean).length + (hasNextPage ? 1 : 0));\n\n  var pageButtons = function () {\n    var buttons = [];\n    var maxVisible = 7;\n\n    var pushPage = function pushPage(p) {\n      return buttons.push(__jsx(Pagination.Item, {\n        key: \"page-\".concat(p),\n        active: p === page,\n        onClick: function onClick() {\n          return setPage(p);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1018,\n          columnNumber: 9\n        }\n      }, p));\n    };\n\n    var pushEllipsis = function pushEllipsis(key) {\n      return buttons.push(__jsx(Pagination.Ellipsis, {\n        key: key,\n        disabled: true,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 1028,\n          columnNumber: 20\n        }\n      }));\n    };\n\n    if (totalKnownPages <= maxVisible) {\n      for (var i = 1; i <= totalKnownPages; i += 1) {\n        pushPage(i);\n      }\n\n      return buttons;\n    }\n\n    var windowSize = 3;\n    var start = Math.max(2, page - 1);\n    var end = Math.min(totalKnownPages - 1, page + 1);\n    var desiredWindow = maxVisible - 2;\n    var currentWindow = end - start + 1;\n    var remaining = desiredWindow - currentWindow;\n\n    while (remaining > 0) {\n      if (start > 2) {\n        start -= 1;\n        remaining -= 1;\n      }\n\n      if (remaining > 0 && end < totalKnownPages - 1) {\n        end += 1;\n        remaining -= 1;\n      }\n\n      if (start === 2 && end === totalKnownPages - 1) break;\n    }\n\n    pushPage(1);\n    if (start > 2) pushEllipsis(\"start-ellipsis\");\n\n    for (var _i = start; _i <= end; _i += 1) {\n      pushPage(_i);\n    }\n\n    if (end < totalKnownPages - 1) pushEllipsis(\"end-ellipsis\");\n    pushPage(totalKnownPages);\n    if (hasNextPage) pushEllipsis(\"more-ellipsis\");\n    return buttons;\n  }();\n\n  var recalcPageSize = useCallback(function () {\n    if (false) return;\n    if (page !== 1) return;\n    if (!tableBodyRef.current) return;\n    var containerHeight = tableBodyRef.current.getBoundingClientRect().height || 0;\n    if (!containerHeight) return;\n    var headerRow = tableBodyRef.current.querySelector(\"table thead tr\") || tableBodyRef.current.querySelector(\"thead tr\");\n    var bodyRow = tableBodyRef.current.querySelector(\"table tbody tr\") || tableBodyRef.current.querySelector(\"tbody tr\");\n\n    if (headerRow) {\n      var h = headerRow.getBoundingClientRect().height;\n      if (h) headerHeightRef.current = h;\n    }\n\n    if (bodyRow) {\n      var r = bodyRow.getBoundingClientRect().height;\n      if (r) rowHeightRef.current = r;\n    }\n\n    var verticalPadding = 24;\n    var available = containerHeight - headerHeightRef.current - verticalPadding;\n    var estimated = Math.floor(available / rowHeightRef.current);\n    var clamped = Math.max(5, Math.min(50, estimated));\n\n    if (clamped > 0 && clamped !== pageSize) {\n      setPageSize(clamped);\n      resetPagination();\n      setQueryEpoch(function (v) {\n        return v + 1;\n      });\n    }\n  }, [page, pageSize]);\n  useEffect(function () {\n    if (false) return;\n    recalcPageSize();\n\n    var onResize = function onResize() {\n      return recalcPageSize();\n    };\n\n    window.addEventListener(\"resize\", onResize);\n    return function () {\n      return window.removeEventListener(\"resize\", onResize);\n    };\n  }, [recalcPageSize]);\n  useEffect(function () {\n    if (isLoading || page !== 1) return;\n    recalcPageSize();\n  }, [page, isLoading, recalcPageSize]);\n\n  var renderFilters = function renderFilters(idPrefix) {\n    return __jsx(\"div\", {\n      className: styles.filtersPanel,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1115,\n        columnNumber: 5\n      }\n    }, __jsx(\"div\", {\n      className: styles.filtersHeader,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1116,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1117,\n        columnNumber: 9\n      }\n    }, __jsx(\"div\", {\n      className: styles.filtersTitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1118,\n        columnNumber: 11\n      }\n    }, \"Filters\"), __jsx(\"div\", {\n      className: styles.filtersSubtitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1119,\n        columnNumber: 11\n      }\n    }, \"Narrow results by machine, client, or warehouse.\")), hasActiveFilters ? __jsx(\"span\", {\n      className: styles.filtersBadge,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1124,\n        columnNumber: 11\n      }\n    }, \"Active\") : null), __jsx(\"div\", {\n      className: styles.filterSection,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1128,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: styles.filterSectionTitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1129,\n        columnNumber: 9\n      }\n    }, \"Machine\"), __jsx(InputGroup, {\n      className: styles.inputGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1130,\n        columnNumber: 9\n      }\n    }, __jsx(InputGroup.Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1131,\n        columnNumber: 11\n      }\n    }, \"OEM\"), __jsx(Dropdown, {\n      onSelect: handleSelect1,\n      className: \"w-100\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1132,\n        columnNumber: 11\n      }\n    }, __jsx(Dropdown.Toggle, {\n      variant: \"outline-secondary\",\n      id: \"\".concat(idPrefix, \"-oem\"),\n      className: \"w-100 \".concat(styles.inputButton),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1133,\n        columnNumber: 13\n      }\n    }, dropdown1Text), __jsx(Dropdown.Menu, {\n      className: \"w-100\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1140,\n        columnNumber: 13\n      }\n    }, __jsx(Dropdown.Item, {\n      eventKey: \"unassigned\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1141,\n        columnNumber: 15\n      }\n    }, \"Select Option\"), __jsx(Dropdown.Item, {\n      eventKey: \"GE\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1142,\n        columnNumber: 15\n      }\n    }, \"GE\"), __jsx(Dropdown.Item, {\n      eventKey: \"Toshiba\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1143,\n        columnNumber: 15\n      }\n    }, \"Toshiba\"), __jsx(Dropdown.Item, {\n      eventKey: \"Siemens\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1144,\n        columnNumber: 15\n      }\n    }, \"Siemens\"), __jsx(Dropdown.Item, {\n      eventKey: \"Philips\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1145,\n        columnNumber: 15\n      }\n    }, \"Philips\")))), __jsx(InputGroup, {\n      className: styles.inputGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1150,\n        columnNumber: 9\n      }\n    }, __jsx(InputGroup.Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1151,\n        columnNumber: 11\n      }\n    }, \"Modality\"), __jsx(Dropdown, {\n      onSelect: handleSelect2,\n      className: \"w-100\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1152,\n        columnNumber: 11\n      }\n    }, __jsx(Dropdown.Toggle, {\n      variant: \"outline-secondary\",\n      id: \"\".concat(idPrefix, \"-modality\"),\n      className: \"w-100 \".concat(styles.inputButton),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1153,\n        columnNumber: 13\n      }\n    }, dropdown2Text), __jsx(Dropdown.Menu, {\n      className: \"w-100\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1160,\n        columnNumber: 13\n      }\n    }, __jsx(Dropdown.Item, {\n      eventKey: \"unassigned\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1161,\n        columnNumber: 15\n      }\n    }, \"Select Option\"), __jsx(Dropdown.Item, {\n      eventKey: \"CT\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1162,\n        columnNumber: 15\n      }\n    }, \"CT\"), __jsx(Dropdown.Item, {\n      eventKey: \"MRI\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1163,\n        columnNumber: 15\n      }\n    }, \"MRI\")))), __jsx(InputGroup, {\n      className: styles.inputGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1168,\n        columnNumber: 9\n      }\n    }, __jsx(InputGroup.Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1169,\n        columnNumber: 11\n      }\n    }, \"Model\"), __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: \"w-100 \".concat(styles.inputButton),\n      onClick: handleModelClick,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1170,\n        columnNumber: 11\n      }\n    }, modelButtonText))), __jsx(\"div\", {\n      className: styles.filterSection,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1180,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: styles.filterSectionTitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1181,\n        columnNumber: 9\n      }\n    }, \"Client\"), __jsx(InputGroup, {\n      className: styles.inputGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1182,\n        columnNumber: 9\n      }\n    }, __jsx(InputGroup.Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1183,\n        columnNumber: 11\n      }\n    }, \"Client From\"), __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: \"w-100 \".concat(styles.inputButton),\n      onClick: function onClick() {\n        return handleClientClick(\"from\");\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1184,\n        columnNumber: 11\n      }\n    }, clientFromButtonText)), __jsx(InputGroup, {\n      className: styles.inputGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1193,\n        columnNumber: 9\n      }\n    }, __jsx(InputGroup.Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1194,\n        columnNumber: 11\n      }\n    }, \"Client Current\"), __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: \"w-100 \".concat(styles.inputButton),\n      onClick: function onClick() {\n        return handleClientClick(\"current\");\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1195,\n        columnNumber: 11\n      }\n    }, clientCurrentButtonText))), __jsx(\"div\", {\n      className: styles.filterSection,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1205,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: styles.filterSectionTitle,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1206,\n        columnNumber: 9\n      }\n    }, \"Warehouse\"), __jsx(InputGroup, {\n      className: styles.inputGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1207,\n        columnNumber: 9\n      }\n    }, __jsx(InputGroup.Text, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1208,\n        columnNumber: 11\n      }\n    }, \"Quick\"), __jsx(\"div\", {\n      className: styles.buttonGroup,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1209,\n        columnNumber: 11\n      }\n    }, __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: styles.flexButton,\n      onClick: handleSoCalWarehouseClick,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1210,\n        columnNumber: 13\n      }\n    }, \"SoCal Warehouse\"), __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: styles.flexButton,\n      onClick: handleNorCalWarehouseClick,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1217,\n        columnNumber: 13\n      }\n    }, \"NorCal Warehouse\"), __jsx(Button, {\n      variant: \"outline-secondary\",\n      className: styles.flexButton,\n      onClick: handleWarehouseUnassignedClick,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 1224,\n        columnNumber: 13\n      }\n    }, \"Unassigned\")))));\n  };\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1239,\n      columnNumber: 5\n    }\n  }, isDeleting && __jsx(\"div\", {\n    className: styles.loadingOverlay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1241,\n      columnNumber: 9\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    className: styles.spinnerCenter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1242,\n      columnNumber: 11\n    }\n  }, __jsx(\"span\", {\n    className: \"sr-only\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1243,\n      columnNumber: 13\n    }\n  }, \"Loading...\"))), __jsx(Modal, {\n    show: showDeleteModal,\n    onHide: handleCloseDeleteModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1247,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1248,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1249,\n      columnNumber: 11\n    }\n  }, \"Confirm Deletion\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1251,\n      columnNumber: 9\n    }\n  }, \"Are you sure you want to delete \", selectedItems.length, \" item\", selectedItems.length > 1 ? \"s\" : \"\", \"?\"), __jsx(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1255,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    variant: \"danger\",\n    onClick: handleDeleteSelected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1256,\n      columnNumber: 11\n    }\n  }, \"Yes, delete\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseDeleteModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1259,\n      columnNumber: 11\n    }\n  }, \"Cancel\"))), __jsx(Modal, {\n    show: showClientModal,\n    onHide: function onHide() {\n      return setShowClientModal(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1265,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1266,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1267,\n      columnNumber: 11\n    }\n  }, \"Select \", clientSelectionType === \"from\" ? \"Client From\" : \"Client Current\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1271,\n      columnNumber: 9\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: clientSearchTerm,\n    onChange: function onChange(e) {\n      return setClientSearchTerm(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1272,\n      columnNumber: 11\n    }\n  }), __jsx(ClientTable, {\n    clients: (Array.isArray(clients) ? clients : []).filter(function (client) {\n      var _client$name;\n\n      return ((_client$name = client === null || client === void 0 ? void 0 : client.name) !== null && _client$name !== void 0 ? _client$name : \"\").toLowerCase().includes(clientSearchTerm.toLowerCase());\n    }),\n    onSelectClient: handleClientSelect,\n    onInfoClick: handleClientInfo,\n    isClientSearch: false,\n    clearSelection: function clearSelection() {\n      return handleClientSelect(null);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1279,\n      columnNumber: 11\n    }\n  }))), __jsx(Modal, {\n    show: showModelModal,\n    onHide: function onHide() {\n      return setShowModelModal(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1291,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1292,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1293,\n      columnNumber: 11\n    }\n  }, \"Select Model\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1295,\n      columnNumber: 9\n    }\n  }, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: modelSearchTerm,\n    onChange: function onChange(e) {\n      return setModelSearchTerm(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1296,\n      columnNumber: 11\n    }\n  }), __jsx(ModelTable, {\n    models: models.filter(function (model) {\n      return typeof model === \"string\" ? model.toLowerCase().includes(modelSearchTerm.toLowerCase()) : false;\n    }),\n    onSelectModel: handleModelSelect,\n    clearSelection: function clearSelection() {\n      return handleModelSelect(null);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1303,\n      columnNumber: 11\n    }\n  }))), __jsx(\"div\", {\n    className: styles.page,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1315,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: styles.pageInner,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1316,\n      columnNumber: 9\n    }\n  }, __jsx(\"header\", {\n    className: styles.header,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1317,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.headerLeft,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1318,\n      columnNumber: 13\n    }\n  }, __jsx(\"button\", {\n    type: \"button\",\n    className: styles.burger,\n    onClick: function onClick() {\n      return setShowFilters(true);\n    },\n    \"aria-label\": \"Open filters\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1319,\n      columnNumber: 15\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1325,\n      columnNumber: 17\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1326,\n      columnNumber: 17\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1327,\n      columnNumber: 17\n    }\n  })), __jsx(\"div\", {\n    className: styles.brand,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1329,\n      columnNumber: 15\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Magmo\",\n    className: styles.brandLogo,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1330,\n      columnNumber: 17\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1335,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.brandName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1336,\n      columnNumber: 19\n    }\n  }, \"Magmo\"), __jsx(\"div\", {\n    className: styles.brandSub,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1337,\n      columnNumber: 19\n    }\n  }, \"Inventory Search\")))), __jsx(\"div\", {\n    className: styles.headerRight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1341,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.headerStatus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1342,\n      columnNumber: 15\n    }\n  }, hasActiveFilters ? \"Filters active\" : \"All items\"))), __jsx(\"div\", {\n    className: styles.content,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1348,\n      columnNumber: 11\n    }\n  }, __jsx(\"aside\", {\n    className: styles.sidebar,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1349,\n      columnNumber: 13\n    }\n  }, renderFilters(\"sidebar\")), __jsx(\"main\", {\n    className: styles.main,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1350,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableCard,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1351,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableHeader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1352,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1353,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1354,\n      columnNumber: 21\n    }\n  }, \"Items\"), __jsx(\"div\", {\n    className: styles.tableSubtitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1355,\n      columnNumber: 21\n    }\n  }, isLoading ? \"Loading items\" : \"\".concat(info.length, \" items on this page\"))), __jsx(\"div\", {\n    className: styles.tableMeta,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1359,\n      columnNumber: 19\n    }\n  }, \"Page \", page, \" \", hasNextPage ? \"of \".concat(totalKnownPages, \"+\") : \"of \".concat(totalKnownPages))), __jsx(\"div\", {\n    className: styles.tableBody,\n    ref: tableBodyRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1364,\n      columnNumber: 17\n    }\n  }, isLoading ? __jsx(\"div\", {\n    className: \"jsx-301448069\" + \" \" + (styles.loadingState || \"\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1366,\n      columnNumber: 21\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Loading Magmo\",\n    className: \"jsx-301448069\" + \" \" + (styles.loadingLogo || \"\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1367,\n      columnNumber: 23\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-301448069\" + \" \" + (styles.loadingText || \"\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1372,\n      columnNumber: 23\n    }\n  }, \"Loading\"), __jsx(_JSXStyle, {\n    id: \"301448069\",\n    __self: this,\n    __source: void 0\n  }, \"@-webkit-keyframes magmo-spin{from{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}to{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}@keyframes magmo-spin{from{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}to{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcbWFjazJcXERlc2t0b3BcXGNvZGVcXHBhZ2VzXFxOZXdTZWFyY2hcXG1haW5TZWFyY2guanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBNDFDeUMsQUFJb0QsQUFHRSxpRkFGM0IsTUFHQSIsImZpbGUiOiJDOlxcVXNlcnNcXG1hY2syXFxEZXNrdG9wXFxjb2RlXFxwYWdlc1xcTmV3U2VhcmNoXFxtYWluU2VhcmNoLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUsIHVzZVJlZiwgdXNlQ2FsbGJhY2sgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7XG4gIElucHV0R3JvdXAsXG4gIERyb3Bkb3duLFxuICBGb3JtQ29udHJvbCxcbiAgQnV0dG9uLFxuICBOYXZEcm9wZG93bixcbiAgRm9ybSxcbiAgTW9kYWwsXG4gIFNwaW5uZXIsXG4gIFBhZ2luYXRpb24sXG4gIE9mZmNhbnZhcyxcbn0gZnJvbSBcInJlYWN0LWJvb3RzdHJhcFwiO1xuaW1wb3J0IExpbmsgZnJvbSBcIm5leHQvbGlua1wiO1xuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSBcIm5leHQvcm91dGVyXCI7XG5pbXBvcnQge1xuICBmZXRjaFBhcnRzV2l0aE1hY2hpbmVEYXRhUGFnZSxcbiAgZmV0Y2hDbGllbnRzLFxuICBmZXRjaE1vZGVscyxcbn0gZnJvbSBcIi4uLy4uL3V0aWxzL2ZldGNoQXNzb2NpYXRpb25zXCI7XG5pbXBvcnQgeyB1c2VBdXRoIH0gZnJvbSBcIi4uLy4uL2NvbnRleHQvQXV0aFVzZXJDb250ZXh0XCI7XHJcbmltcG9ydCBMb2dnZWRJbiBmcm9tIFwiLi4vTG9nZ2VkSW5cIjtcclxuaW1wb3J0IENsaWVudFRhYmxlIGZyb20gXCIuLi8uLi91dGlscy9DbGllbnRUYWJsZVwiO1xyXG5pbXBvcnQgTW9kZWxUYWJsZSBmcm9tIFwiLi4vLi4vdXRpbHMvTW9kZWxUYWJsZVwiO1xyXG5pbXBvcnQgUGFydFRhYmxlIGZyb20gXCIuLi8uLi91dGlscy9QYXJ0VGFibGVcIjtcbmltcG9ydCBzdHlsZXMgZnJvbSBcIi4uLy4uL3N0eWxlcy9NYWluU2VhcmNoLm1vZHVsZS5jc3NcIjtcbmltcG9ydCBmaXJlYmFzZSBmcm9tIFwiLi4vLi4vY29udGV4dC9GaXJlYmFzZVwiO1xuaW1wb3J0IHsgYnVpbGROYW1lVG9rZW5zIH0gZnJvbSBcIi4uLy4uL3V0aWxzL2l0ZW1Gb3JtU2hhcmVkXCI7XG5cclxuLy8gUHJlZGVmaW5lZCB3YXJlaG91c2UgY2xpZW50IElEcyBhbmQgZGlzcGxheSBuYW1lc1xyXG5jb25zdCBTT0NBTF9DTElFTlRfSUQgPSBcIkFJUzE3MTgyXCI7XHJcbmNvbnN0IE5PUkNBTF9DTElFTlRfSUQgPSBcIkFJUzI1MDk3XCI7XG5jb25zdCBVTkFTU0lHTkVEX0NMSUVOVF9JRCA9IFwiQUlTMDA0MDRcIjtcbmNvbnN0IERFRkFVTFRfUEFHRV9TSVpFID0gMjU7XG5cclxuXHJcbi8vIFNpbXVsYXRlcyBhIG5ldHdvcmsgcmVxdWVzdCBkZWxheVxyXG5mdW5jdGlvbiBzaW11bGF0ZU5ldHdvcmtSZXF1ZXN0KCkge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSk7XHJcbn1cclxuXHJcbi8vIEN1c3RvbSBMb2FkaW5nQnV0dG9uIGNvbXBvbmVudFxyXG5mdW5jdGlvbiBMb2FkaW5nQnV0dG9uKHsgdHlwZSwgbmFtZSwgcm91dGUsIGNsYXNzTmFtZSB9KSB7XG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldExvYWRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgbGV0IGNhbmNlbGxlZCA9IGZhbHNlO1xuICAgICAgc2ltdWxhdGVOZXR3b3JrUmVxdWVzdCgpLnRoZW4oKCkgPT4ge1xuICAgICAgICBpZiAoIWNhbmNlbGxlZCkgc2V0TG9hZGluZyhmYWxzZSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGNhbmNlbGxlZCA9IHRydWU7XG4gICAgICB9O1xuICAgIH1cbiAgfSwgW2lzTG9hZGluZ10pO1xuXHJcbiAgcmV0dXJuIChcbiAgICA8TGluayBocmVmPXtgLyR7cm91dGV9YH0+XG4gICAgICA8YVxuICAgICAgICBjbGFzc05hbWU9e2BidG4gYnRuLSR7dHlwZX0gJHtjbGFzc05hbWUgfHwgXCJcIn1gfVxuICAgICAgICBkaXNhYmxlZD17aXNMb2FkaW5nfVxuICAgICAgICBvbkNsaWNrPXsoKSA9PiAhaXNMb2FkaW5nICYmIHNldExvYWRpbmcodHJ1ZSl9XG4gICAgICA+XG4gICAgICAgIHtpc0xvYWRpbmcgPyBcIkxvYWRpbmfigKZcIiA6IG5hbWV9XHJcbiAgICAgIDwvYT5cclxuICAgIDwvTGluaz5cclxuICApO1xyXG59XHJcblxyXG4vLyAtLS0tIERBVEUgSEVMUEVSUyAodG9wLWxldmVsIHNjb3BlKSAtLS0tXHJcblxyXG4vLyBDb252ZXJ0IGFueXRoaW5nIGRhdGUtaXNoIGludG8gYSB0aW1lc3RhbXAgKG1zIHNpbmNlIGVwb2NoKS5cclxuZnVuY3Rpb24gdG9UaW1lKHZhbHVlKSB7XHJcbiAgaWYgKCF2YWx1ZSkgcmV0dXJuIG51bGw7XHJcblxyXG4gIC8vIEZpcmVzdG9yZSBUaW1lc3RhbXAgeyBzZWNvbmRzLCBuYW5vc2Vjb25kcyB9XHJcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZS5zZWNvbmRzICE9IG51bGwpIHtcclxuICAgIHRyeSB7IHJldHVybiB2YWx1ZS5zZWNvbmRzICogMTAwMDsgfSBjYXRjaCB7IC8qIGlnbm9yZSAqLyB9XHJcbiAgfVxyXG5cclxuICAvLyBOYXRpdmUgRGF0ZVxyXG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHtcclxuICAgIGNvbnN0IHQgPSB2YWx1ZS5nZXRUaW1lKCk7XHJcbiAgICByZXR1cm4gaXNOYU4odCkgPyBudWxsIDogdDtcclxuICB9XHJcblxyXG4gIC8vIFN0cmluZ3NcclxuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAvLyBJU08gLyB5eXl5LW1tLWRkXHJcbiAgICBjb25zdCBpc28gPSBEYXRlLnBhcnNlKHZhbHVlKTtcclxuICAgIGlmICghaXNOYU4oaXNvKSkgcmV0dXJuIGlzbztcclxuXHJcbiAgICAvLyBtbS9kZC95eXl5XHJcbiAgICBjb25zdCBwYXJ0cyA9IHZhbHVlLnNwbGl0KFwiL1wiKTtcclxuICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHtcclxuICAgICAgY29uc3QgW21tLCBkZCwgeXl5eV0gPSBwYXJ0cztcclxuICAgICAgY29uc3QgYWx0ID0gRGF0ZS5wYXJzZShgJHt5eXl5fS0ke21tfS0ke2RkfWApO1xyXG4gICAgICBpZiAoIWlzTmFOKGFsdCkpIHJldHVybiBhbHQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBMYXN0IHJlc29ydFxyXG4gIGNvbnN0IHQgPSBEYXRlLnBhcnNlKHZhbHVlKTtcclxuICByZXR1cm4gaXNOYU4odCkgPyBudWxsIDogdDtcclxufVxyXG5cclxuLy8gQ2Fub25pY2FsaXplIHRvICd5eXl5LW1tLWRkJyAobWF0Y2hlcyA8aW5wdXQgdHlwZT1cImRhdGVcIj4pXHJcbmZ1bmN0aW9uIHRvWU1EKHZhbHVlKSB7XG4gIGNvbnN0IHQgPSB0b1RpbWUodmFsdWUpO1xuICBpZiAodCA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgY29uc3QgZCA9IG5ldyBEYXRlKHQpO1xuICBjb25zdCB5eXl5ID0gZC5nZXRGdWxsWWVhcigpO1xuICBjb25zdCBtbSA9IFN0cmluZyhkLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gIGNvbnN0IGRkID0gU3RyaW5nKGQuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCBcIjBcIik7XG4gIHJldHVybiBgJHt5eXl5fS0ke21tfS0ke2RkfWA7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVRleHQodmFsdWUpIHtcbiAgaWYgKHZhbHVlID09IG51bGwpIHJldHVybiBcIlwiO1xuICByZXR1cm4gU3RyaW5nKHZhbHVlKS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gZ2V0TWFjaGluZUZpZWxkKGl0ZW0sIGtleSkge1xuICBpZiAoIWl0ZW0pIHJldHVybiBudWxsO1xuICBjb25zdCBsb3dlciA9IGtleS50b0xvd2VyQ2FzZSgpO1xuICByZXR1cm4gKFxuICAgIGl0ZW0/Lm1hY2hpbmVEYXRhPy5ba2V5XSA/P1xuICAgIGl0ZW0/Lm1hY2hpbmVEYXRhPy5bbG93ZXJdID8/XG4gICAgaXRlbT8uY3VycmVudE1hY2hpbmVEYXRhPy5ba2V5XSA/P1xuICAgIGl0ZW0/LmN1cnJlbnRNYWNoaW5lRGF0YT8uW2xvd2VyXSA/P1xuICAgIGl0ZW0/LnRoZU1hY2hpbmVEYXRhPy5ba2V5XSA/P1xuICAgIGl0ZW0/LnRoZU1hY2hpbmVEYXRhPy5bbG93ZXJdID8/XG4gICAgaXRlbT8uVGhlTWFjaGluZT8uW2tleV0gPz9cbiAgICBpdGVtPy5UaGVNYWNoaW5lPy5bbG93ZXJdID8/XG4gICAgbnVsbFxuICApO1xufVxuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE1haW5TZWFyY2goKSB7XG4gIGNvbnN0IHsgc2lnbk91dCB9ID0gdXNlQXV0aCgpO1xyXG4gIGNvbnN0IFtpbmZvLCBzZXRJbmZvXSA9IHVzZVN0YXRlKFtdKTtcclxuICBjb25zdCBbYmFja3VwSW5mbywgc2V0QmFja3VwSW5mb10gPSB1c2VTdGF0ZShbXSk7XHJcbiAgY29uc3QgW2F1Z21lbnRlZEluZm8sIHNldEF1Z21lbnRlZEluZm9dID0gdXNlU3RhdGUoW10pOyAvLyBpdGVtcyB3aXRoIGNsaWVudEZyb21JZC9jdXJyZW50SWQgYWRkZWRcclxuICBjb25zdCBbaXNMb2FkaW5nLCBzZXRJc0xvYWRpbmddID0gdXNlU3RhdGUodHJ1ZSk7XHJcbiAgY29uc3QgW2lkcywgc2V0SURdID0gdXNlU3RhdGUoW10pO1xyXG4gIGNvbnN0IFtzaG93LCBzZXRTaG93XSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW3Nob3dGaWx0ZXJzLCBzZXRTaG93RmlsdGVyc10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtwYWdlU2l6ZSwgc2V0UGFnZVNpemVdID0gdXNlU3RhdGUoREVGQVVMVF9QQUdFX1NJWkUpO1xuICBjb25zdCBbZEl0ZW0sIHNldERJdGVtXSA9IHVzZVN0YXRlKCk7XHJcbiAgY29uc3QgW3NlbGVjdCwgc2V0U2VsZWN0XSA9IHVzZVN0YXRlKFwiTmFtZVwiKTtcclxuICBjb25zdCBbc2hvd0xpc3QsIHNldFNob3dMaXN0XSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICBjb25zdCBbc2hvd0xpc3RTZWFyY2gsIHNldFNob3dMaXN0U2VhcmNoXSA9IHVzZVN0YXRlKFwidGV4dFwiKTtcclxuICBjb25zdCBbc2VhcmNoLCBzZXRTZWFyY2hdID0gdXNlU3RhdGUoXCJcIik7XHJcbiAgY29uc3QgW3NlbGVjdGVkT0VNLCBzZXRTZWxlY3RlZE9FTV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbc2VsZWN0ZWRNb2RhbGl0eSwgc2V0U2VsZWN0ZWRNb2RhbGl0eV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICAvLyBSZXBsYWNlIHRoZSBvbGQgc2luZ2xlIGNsaWVudCBzdGF0ZSB3aXRoIHR3byBzZXRzOlxyXG4gIGNvbnN0IFtzZWxlY3RlZENsaWVudEZyb20sIHNldFNlbGVjdGVkQ2xpZW50RnJvbV0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbY2xpZW50RnJvbUJ1dHRvblRleHQsIHNldENsaWVudEZyb21CdXR0b25UZXh0XSA9IHVzZVN0YXRlKFwiU2VsZWN0IE9wdGlvblwiKTtcclxuICBjb25zdCBbc2VsZWN0ZWRDbGllbnRDdXJyZW50LCBzZXRTZWxlY3RlZENsaWVudEN1cnJlbnRdID0gdXNlU3RhdGUobnVsbCk7XHJcbiAgY29uc3QgW2NsaWVudEN1cnJlbnRCdXR0b25UZXh0LCBzZXRDbGllbnRDdXJyZW50QnV0dG9uVGV4dF0gPSB1c2VTdGF0ZShcIlNlbGVjdCBPcHRpb25cIik7XHJcblxyXG4gIGNvbnN0IFtjbGllbnRzLCBzZXRDbGllbnRzXSA9IHVzZVN0YXRlKFtdKTtcclxuICBjb25zdCBbc2hvd0NsaWVudE1vZGFsLCBzZXRTaG93Q2xpZW50TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG4gIC8vIFRoaXMgc3RhdGUgdGVsbHMgdGhlIG1vZGFsIHdoaWNoIGNsaWVudCBib3ggaXMgYmVpbmcgdXBkYXRlZDogXCJmcm9tXCIgb3IgXCJjdXJyZW50XCJcclxuICBjb25zdCBbY2xpZW50U2VsZWN0aW9uVHlwZSwgc2V0Q2xpZW50U2VsZWN0aW9uVHlwZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuXHJcbiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7XHJcbiAgY29uc3QgbGFiZWxCYXNlID0gW1wibmFtZVwiLCBcImRhdGVcIiwgXCJ3L29cIiwgXCJwL25cIiwgXCJzL25cIl07XHJcbiAgY29uc3QgbGFiZWxCYXNlTmFtZXMgPSBbXCJuYW1lXCIsIFwiZGF0ZVwiLCBcIndvXCIsIFwicG5cIiwgXCJzblwiXTtcclxuICBjb25zdCBzb3J0Q2hlY2tCYXNlID0gW2ZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2VdO1xyXG5cclxuICBmdW5jdGlvbiB3aXRoU29ydEljb24oYmFzZUxhYmVscywgYWN0aXZlSW5kZXgsIGlzRGVzYykge1xyXG4gICAgcmV0dXJuIGJhc2VMYWJlbHMubWFwKCh0ZXh0LCBpKSA9PiB7XHJcbiAgICAgIGlmIChpICE9PSBhY3RpdmVJbmRleCkgcmV0dXJuIHRleHQ7IC8vIHVudG91Y2hlZFxyXG4gICAgICBjb25zdCBhcnJvdyA9IGlzRGVzYyA/IFwiIOKWvFwiIDogXCIg4payXCI7XHJcbiAgICAgIHJldHVybiBgJHt0ZXh0fSR7YXJyb3d9YDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcblxyXG4gIGNvbnN0IFtsYWJlbHMsIHNldExhYmVsc10gPSB1c2VTdGF0ZShsYWJlbEJhc2UpO1xyXG4gIGNvbnN0IFtzb3J0Q2hlY2ssIHNldFNvcnRDaGVja10gPSB1c2VTdGF0ZShzb3J0Q2hlY2tCYXNlKTtcclxuICBjb25zdCBbaG92ZXJJbmRleCwgc2V0SG92ZXJJbmRleF0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbc2VsZWN0ZWRNb2RlbCwgc2V0U2VsZWN0ZWRNb2RlbF0gPSB1c2VTdGF0ZShudWxsKTtcclxuICBjb25zdCBbZ1Bvcywgc2V0R1Bvc10gPSB1c2VTdGF0ZShudWxsKTtcbiAgY29uc3QgW2dJZGUsIHNldEdJZGVdID0gdXNlU3RhdGUobnVsbCk7XG4gIGNvbnN0IFtpc0RlbGV0aW5nLCBzZXRJc0RlbGV0aW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW3BhZ2UsIHNldFBhZ2VdID0gdXNlU3RhdGUoMSk7XG4gIGNvbnN0IFtwYWdlQ3Vyc29ycywgc2V0UGFnZUN1cnNvcnNdID0gdXNlU3RhdGUoW10pO1xuICBjb25zdCBbaGFzTmV4dFBhZ2UsIHNldEhhc05leHRQYWdlXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgZmV0Y2hTZXEgPSB1c2VSZWYoMCk7XG4gIGNvbnN0IGJhY2tmaWxsSW5GbGlnaHQgPSB1c2VSZWYoZmFsc2UpO1xuICBjb25zdCBbcXVlcnlFcG9jaCwgc2V0UXVlcnlFcG9jaF0gPSB1c2VTdGF0ZSgwKTtcbiAgY29uc3QgW2xvYWRFcnJvciwgc2V0TG9hZEVycm9yXSA9IHVzZVN0YXRlKG51bGwpO1xuICBjb25zdCB0YWJsZUJvZHlSZWYgPSB1c2VSZWYobnVsbCk7XG4gIGNvbnN0IHJvd0hlaWdodFJlZiA9IHVzZVJlZig0Nik7XG4gIGNvbnN0IGhlYWRlckhlaWdodFJlZiA9IHVzZVJlZigzOCk7XG5cbiAgY29uc3QgTE9BRF9USU1FT1VUX01TID0gMzAwMDA7XG5cbiAgY29uc3Qgc3RhcnROYW1lVG9rZW5CYWNrZmlsbCA9IHVzZUNhbGxiYWNrKGFzeW5jIChyZWFzb24gPSBcIlwiKSA9PiB7XG4gICAgaWYgKGJhY2tmaWxsSW5GbGlnaHQuY3VycmVudCkgcmV0dXJuO1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBjb25zdCBsYXN0UnVuID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibmFtZVRva2Vuc0JhY2tmaWxsQXRcIik7XG4gICAgICBpZiAobGFzdFJ1biAmJiBEYXRlLm5vdygpIC0gTnVtYmVyKGxhc3RSdW4pIDwgMjQgKiA2MCAqIDYwICogMTAwMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuXG4gICAgYmFja2ZpbGxJbkZsaWdodC5jdXJyZW50ID0gdHJ1ZTtcbiAgICBjb25zdCBkYiA9IGZpcmViYXNlLmZpcmVzdG9yZSgpO1xuICAgIGxldCBsYXN0RG9jID0gbnVsbDtcblxuICAgIGNvbnN0IHRva2Vuc0VxdWFsID0gKGEsIGIpID0+IHtcbiAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgIGNvbnN0IHNldEEgPSBuZXcgU2V0KGEpO1xuICAgICAgY29uc3Qgc2V0QiA9IG5ldyBTZXQoYik7XG4gICAgICBpZiAoc2V0QS5zaXplICE9PSBzZXRCLnNpemUpIHJldHVybiBmYWxzZTtcbiAgICAgIGZvciAoY29uc3QgdiBvZiBzZXRBKSBpZiAoIXNldEIuaGFzKHYpKSByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGxldCBxdWVyeSA9IGRiXG4gICAgICAgICAgLmNvbGxlY3Rpb24oXCJUZXN0XCIpXG4gICAgICAgICAgLm9yZGVyQnkoZmlyZWJhc2UuZmlyZXN0b3JlLkZpZWxkUGF0aC5kb2N1bWVudElkKCkpXG4gICAgICAgICAgLmxpbWl0KDIwMCk7XG4gICAgICAgIGlmIChsYXN0RG9jKSBxdWVyeSA9IHF1ZXJ5LnN0YXJ0QWZ0ZXIobGFzdERvYyk7XG5cbiAgICAgICAgY29uc3Qgc25hcCA9IGF3YWl0IHF1ZXJ5LmdldCgpO1xuICAgICAgICBpZiAoc25hcC5lbXB0eSkgYnJlYWs7XG5cbiAgICAgICAgY29uc3QgYmF0Y2ggPSBkYi5iYXRjaCgpO1xuICAgICAgICBsZXQgd3JpdGVzID0gMDtcblxuICAgICAgICBzbmFwLmRvY3MuZm9yRWFjaCgoZG9jKSA9PiB7XG4gICAgICAgICAgY29uc3QgZGF0YSA9IGRvYy5kYXRhKCkgfHwge307XG4gICAgICAgICAgY29uc3QgbmFtZSA9IHR5cGVvZiBkYXRhLm5hbWUgPT09IFwic3RyaW5nXCIgPyBkYXRhLm5hbWUgOiBcIlwiO1xuICAgICAgICAgIGNvbnN0IG5hbWVMb3dlciA9IG5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBjb25zdCBuYW1lVG9rZW5zID0gYnVpbGROYW1lVG9rZW5zKG5hbWUpO1xuICAgICAgICAgIGNvbnN0IGV4aXN0aW5nVG9rZW5zID0gQXJyYXkuaXNBcnJheShkYXRhLm5hbWVUb2tlbnMpXG4gICAgICAgICAgICA/IEFycmF5LmZyb20obmV3IFNldChkYXRhLm5hbWVUb2tlbnMubWFwKCh2KSA9PiBTdHJpbmcodikpKSlcbiAgICAgICAgICAgIDogW107XG5cbiAgICAgICAgICBjb25zdCBuZWVkc1VwZGF0ZSA9XG4gICAgICAgICAgICBkYXRhLm5hbWVMb3dlciAhPT0gbmFtZUxvd2VyIHx8XG4gICAgICAgICAgICAhdG9rZW5zRXF1YWwoZXhpc3RpbmdUb2tlbnMsIG5hbWVUb2tlbnMpO1xuXG4gICAgICAgICAgaWYgKG5lZWRzVXBkYXRlKSB7XG4gICAgICAgICAgICBiYXRjaC51cGRhdGUoZG9jLnJlZiwgeyBuYW1lTG93ZXIsIG5hbWVUb2tlbnMgfSk7XG4gICAgICAgICAgICB3cml0ZXMgKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICh3cml0ZXMgPiAwKSB7XG4gICAgICAgICAgYXdhaXQgYmF0Y2guY29tbWl0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBsYXN0RG9jID0gc25hcC5kb2NzW3NuYXAuZG9jcy5sZW5ndGggLSAxXTtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjUpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKFxuICAgICAgICAgIFwibmFtZVRva2Vuc0JhY2tmaWxsQXRcIixcbiAgICAgICAgICBTdHJpbmcoRGF0ZS5ub3coKSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIk5hbWUgdG9rZW4gYmFja2ZpbGwgZmFpbGVkOlwiLCByZWFzb24sIGVycm9yKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYmFja2ZpbGxJbkZsaWdodC5jdXJyZW50ID0gZmFsc2U7XG4gICAgfVxuICB9LCBbXSk7XG5cbiAgY29uc3Qgc2VhcmNoTG93ZXIgPSAoc2VhcmNoIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICBjb25zdCBoYXNBY3RpdmVGaWx0ZXJzID1cbiAgICBCb29sZWFuKHNlbGVjdGVkT0VNKSB8fFxuICAgIEJvb2xlYW4oc2VsZWN0ZWRNb2RhbGl0eSkgfHxcbiAgICBCb29sZWFuKHNlbGVjdGVkTW9kZWwpIHx8XG4gICAgQm9vbGVhbihzZWxlY3RlZENsaWVudEZyb20pIHx8XG4gICAgQm9vbGVhbihzZWxlY3RlZENsaWVudEN1cnJlbnQpIHx8XG4gICAgQm9vbGVhbihzZWFyY2hMb3dlcik7XG5cbiAgY29uc3QgdmFsdWVNYXRjaGVzID0gKHZhbHVlLCBzKSA9PiB7XG4gICAgaWYgKCF2YWx1ZSkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgcmV0dXJuIHZhbHVlLnNvbWUoKHYpID0+IHZhbHVlTWF0Y2hlcyh2LCBzKSk7XG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcodmFsdWUpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocyk7XG4gIH07XG5cbiAgY29uc3QgbWF0Y2hlc0ZpbHRlcnMgPSB1c2VDYWxsYmFjayhcbiAgICAoaXRlbSkgPT4ge1xuICAgICAgLy8gaGlkZSBleHBsaWNpdGx5IGhpZGRlbiBpdGVtc1xuICAgICAgaWYgKGl0ZW0/LnZpc2libGUgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIC8vIE9FTSAvIE1vZGFsaXR5IC8gTW9kZWwgZmlsdGVyaW5nXG4gICAgICBjb25zdCBPRU0gPSBnZXRNYWNoaW5lRmllbGQoaXRlbSwgXCJPRU1cIik7XG4gICAgICBjb25zdCBNb2RhbGl0eSA9IGdldE1hY2hpbmVGaWVsZChpdGVtLCBcIk1vZGFsaXR5XCIpO1xuICAgICAgY29uc3QgTW9kZWwgPSBnZXRNYWNoaW5lRmllbGQoaXRlbSwgXCJNb2RlbFwiKTtcblxuICAgICAgaWYgKHNlbGVjdGVkT0VNICYmIG5vcm1hbGl6ZVRleHQoT0VNKSAhPT0gbm9ybWFsaXplVGV4dChzZWxlY3RlZE9FTSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICBzZWxlY3RlZE1vZGFsaXR5ICYmXG4gICAgICAgIG5vcm1hbGl6ZVRleHQoTW9kYWxpdHkpICE9PSBub3JtYWxpemVUZXh0KHNlbGVjdGVkTW9kYWxpdHkpXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHNlbGVjdGVkTW9kZWwgJiYgbm9ybWFsaXplVGV4dChNb2RlbCkgIT09IG5vcm1hbGl6ZVRleHQoc2VsZWN0ZWRNb2RlbCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBDbGllbnQgZmlsdGVyc1xuICAgICAgaWYgKHNlbGVjdGVkQ2xpZW50RnJvbSAmJiBpdGVtPy5jbGllbnRGcm9tSWQgIT09IHNlbGVjdGVkQ2xpZW50RnJvbSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIHNlbGVjdGVkQ2xpZW50Q3VycmVudCAmJlxuICAgICAgICBpdGVtPy5jbGllbnRDdXJyZW50SWQgIT09IHNlbGVjdGVkQ2xpZW50Q3VycmVudFxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gU2VhcmNoXG4gICAgICBpZiAoc2VhcmNoTG93ZXIpIHtcbiAgICAgICAgaWYgKHNlbGVjdCA9PT0gXCJOYW1lXCIpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWVNYXRjaGVzKGl0ZW0/Lm5hbWUsIHNlYXJjaExvd2VyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZWN0ID09PSBcIkRhdGVcIikge1xuICAgICAgICAgIGNvbnN0IHdhbnRlZERheSA9IHNlYXJjaExvd2VyOyAvLyB5eXl5LW1tLWRkIGZyb20gaW5wdXRcbiAgICAgICAgICBjb25zdCBpdGVtWU1EID0gdG9ZTUQoaXRlbT8uZGF0ZSk7XG4gICAgICAgICAgaWYgKGl0ZW1ZTUQgJiYgaXRlbVlNRCA9PT0gd2FudGVkRGF5KSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtPy5kZXNjcmlwdGlvbnMpKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5kZXNjcmlwdGlvbnMuc29tZSgoZCkgPT4gdG9ZTUQoZD8uZGF0ZSkgPT09IHdhbnRlZERheSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0/LndvcmtPcmRlcnMpKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS53b3JrT3JkZXJzLnNvbWUoKHcpID0+IHRvWU1EKHc/LmRhdGUpID09PSB3YW50ZWREYXkpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdCA9PT0gXCJXb3JrIE9yZGVyXCIpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShpdGVtPy53b3JrT3JkZXJzKSAmJlxuICAgICAgICAgICAgaXRlbS53b3JrT3JkZXJzLnNvbWUoKHdvKSA9PlxuICAgICAgICAgICAgICB2YWx1ZU1hdGNoZXMod28/LndvcmtPcmRlciwgc2VhcmNoTG93ZXIpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZWN0ID09PSBcIlByb2R1Y3QgTnVtYmVyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWVNYXRjaGVzKGl0ZW0/LnBuLCBzZWFyY2hMb3dlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdCA9PT0gXCJTZXJpYWwgTnVtYmVyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdmFsdWVNYXRjaGVzKGl0ZW0/LnNuLCBzZWFyY2hMb3dlcik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdCA9PT0gXCJEZXNjcmlwdGlvblwiKSB7XG4gICAgICAgICAgaWYgKHZhbHVlTWF0Y2hlcyhpdGVtPy5kZXNjLCBzZWFyY2hMb3dlcikpIHJldHVybiB0cnVlO1xuICAgICAgICAgIGlmICh2YWx1ZU1hdGNoZXMoaXRlbT8uZGVzY3JpcHRpb24sIHNlYXJjaExvd2VyKSkgcmV0dXJuIHRydWU7XG4gICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbT8uZGVzY3JpcHRpb25zKSkge1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGVzY3JpcHRpb25zLnNvbWUoKGQpID0+XG4gICAgICAgICAgICAgIHZhbHVlTWF0Y2hlcyhkPy5kZXNjcmlwdGlvbiwgc2VhcmNoTG93ZXIpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdCA9PT0gXCJTS1VcIikge1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB2YWx1ZU1hdGNoZXMoaXRlbT8uaWQsIHNlYXJjaExvd2VyKSB8fFxuICAgICAgICAgICAgdmFsdWVNYXRjaGVzKGl0ZW0/LmxvY2FsU04sIHNlYXJjaExvd2VyKSB8fFxuICAgICAgICAgICAgdmFsdWVNYXRjaGVzKGl0ZW0/LmxvY2FsX3NuLCBzZWFyY2hMb3dlcilcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgW1xuICAgICAgc2VsZWN0ZWRPRU0sXG4gICAgICBzZWxlY3RlZE1vZGFsaXR5LFxuICAgICAgc2VsZWN0ZWRNb2RlbCxcbiAgICAgIHNlbGVjdGVkQ2xpZW50RnJvbSxcbiAgICAgIHNlbGVjdGVkQ2xpZW50Q3VycmVudCxcbiAgICAgIHNlYXJjaExvd2VyLFxuICAgICAgc2VsZWN0LFxuICAgIF1cbiAgKTtcblxuICBjb25zdCByZXNldFBhZ2luYXRpb24gPSAoKSA9PiB7XG4gICAgc2V0UGFnZSgxKTtcbiAgICBzZXRQYWdlQ3Vyc29ycyhbXSk7XG4gICAgc2V0SGFzTmV4dFBhZ2UoZmFsc2UpO1xuICB9O1xuXG4gIC8vIFJlc2V0IHBhZ2luYXRpb24gb24gcm91dGUvcXVlcnkgY2hhbmdlIChwcmV2ZW50cyBzdGFsZSBwYWdlcyBsaWtlIOKAnHN0YXJ0aW5nIGF0IDbigJ0pXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgc2V0UXVlcnlFcG9jaCgodikgPT4gdiArIDEpO1xuICB9LCBbcm91dGVyLmFzUGF0aF0pO1xuXG4gIC8vIFJlc2V0IGFuZCByZWZldGNoIHdoZW4gZmlsdGVycy9zZWFyY2ggY2hhbmdlXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmVzZXRQYWdpbmF0aW9uKCk7XG4gICAgc2V0UXVlcnlFcG9jaCgodikgPT4gdiArIDEpO1xuICB9LCBbXG4gICAgc2VsZWN0ZWRPRU0sXG4gICAgc2VsZWN0ZWRNb2RhbGl0eSxcbiAgICBzZWxlY3RlZE1vZGVsLFxuICAgIHNlbGVjdGVkQ2xpZW50RnJvbSxcbiAgICBzZWxlY3RlZENsaWVudEN1cnJlbnQsXG4gICAgc2VhcmNoLFxuICAgIHNlbGVjdCxcbiAgXSk7XG5cblxuICAvLyBGZXRjaCBkYXRhIG9uIGNvbXBvbmVudCBtb3VudCBhbmQgcm91dGUgY2hhbmdlXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZmV0Y2hEYXRhKHBhZ2UpO1xuICB9LCBbcGFnZSwgcXVlcnlFcG9jaF0pO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIGZldGNoRGF0YShyZXF1ZXN0ZWRQYWdlID0gMSkge1xuICAgIGNvbnN0IHNlcSA9ICsrZmV0Y2hTZXEuY3VycmVudDtcbiAgICBsZXQgdGltZWRPdXQgPSBmYWxzZTtcbiAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgc2V0TG9hZEVycm9yKG51bGwpO1xuICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGltZWRPdXQgPSB0cnVlO1xuICAgICAgaWYgKHNlcSA9PT0gZmV0Y2hTZXEuY3VycmVudCkge1xuICAgICAgICBzZXRMb2FkRXJyb3Ioe1xuICAgICAgICAgIGNvZGU6IFwidGltZW91dFwiLFxuICAgICAgICAgIG1lc3NhZ2U6IGBMb2FkaW5nIGlzIHRha2luZyBsb25nZXIgdGhhbiAke01hdGgucm91bmQoXG4gICAgICAgICAgICBMT0FEX1RJTUVPVVRfTVMgLyAxMDAwXG4gICAgICAgICAgKX1zLiBUaGlzIGlzIGxpa2VseSBkdWUgdG8gdmVyeSBzZWxlY3RpdmUgZmlsdGVycy5gLFxuICAgICAgICB9KTtcbiAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICAgIH1cbiAgICB9LCBMT0FEX1RJTUVPVVRfTVMpO1xuICAgIHRyeSB7XG4gICAgICBpZiAocm91dGVyLnF1ZXJ5LmlucHV0VGV4dCAmJiByb3V0ZXIucXVlcnkuc2VsZWN0ZWRUeXBlKSB7XG4gICAgICAgIHNldFNlbGVjdChyb3V0ZXIucXVlcnkuc2VsZWN0ZWRUeXBlKTtcbiAgICAgICAgc2V0U2VhcmNoKHJvdXRlci5xdWVyeS5pbnB1dFRleHQpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3RhcnRBZnRlckRvYyA9XG4gICAgICAgIHJlcXVlc3RlZFBhZ2UgPiAxID8gcGFnZUN1cnNvcnNbcmVxdWVzdGVkUGFnZSAtIDJdIDogbnVsbDtcbiAgICAgIGlmIChyZXF1ZXN0ZWRQYWdlID4gMSAmJiAhc3RhcnRBZnRlckRvYykge1xuICAgICAgICBzZXRQYWdlKDEpO1xuICAgICAgICBpZiAoc2VxID09PSBmZXRjaFNlcS5jdXJyZW50KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBlZmZlY3RpdmVTZWxlY3QgPSByb3V0ZXIucXVlcnkuc2VsZWN0ZWRUeXBlIHx8IHNlbGVjdDtcbiAgICAgIGNvbnN0IGVmZmVjdGl2ZVNlYXJjaCA9IHJvdXRlci5xdWVyeS5pbnB1dFRleHQgfHwgc2VhcmNoO1xuICAgICAgY29uc3QgZWZmZWN0aXZlU2VhcmNoTG93ZXIgPSAoZWZmZWN0aXZlU2VhcmNoIHx8IFwiXCIpXG4gICAgICAgIC50b0xvd2VyQ2FzZSgpXG4gICAgICAgIC50cmltKCk7XG5cbiAgICAgIC8vIGxpZ2h0IHJldHJ5IGZvciB0cmFuc2llbnQgRmlyZXN0b3JlIGhpY2N1cHNcbiAgICAgIGNvbnN0IGxvYWQgPSBhc3luYyAoYXR0ZW1wdCA9IDEpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgZmV0Y2hQYXJ0c1dpdGhNYWNoaW5lRGF0YVBhZ2Uoe1xuICAgICAgICAgICAgcGFnZVNpemUsXG4gICAgICAgICAgICBzdGFydEFmdGVyRG9jLFxuICAgICAgICAgICAgdmlzaWJsZU9ubHk6IHRydWUsXG4gICAgICAgICAgICBmaWx0ZXJGbjogaGFzQWN0aXZlRmlsdGVycyA/IG1hdGNoZXNGaWx0ZXJzIDogbnVsbCxcbiAgICAgICAgICAgIHNlYXJjaDogZWZmZWN0aXZlU2VhcmNoTG93ZXJcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBlZmZlY3RpdmVTZWxlY3QsXG4gICAgICAgICAgICAgICAgICByYXc6IGVmZmVjdGl2ZVNlYXJjaCxcbiAgICAgICAgICAgICAgICAgIGxvd2VyOiBlZmZlY3RpdmVTZWFyY2hMb3dlcixcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIDogbnVsbCxcbiAgICAgICAgICAgIG5lZWRzTWFjaGluZURhdGE6XG4gICAgICAgICAgICAgIEJvb2xlYW4oc2VsZWN0ZWRPRU0pIHx8XG4gICAgICAgICAgICAgIEJvb2xlYW4oc2VsZWN0ZWRNb2RhbGl0eSkgfHxcbiAgICAgICAgICAgICAgQm9vbGVhbihzZWxlY3RlZE1vZGVsKSB8fFxuICAgICAgICAgICAgICBCb29sZWFuKHNlbGVjdGVkQ2xpZW50RnJvbSkgfHxcbiAgICAgICAgICAgICAgQm9vbGVhbihzZWxlY3RlZENsaWVudEN1cnJlbnQpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKGF0dGVtcHQgPj0gMykgdGhyb3cgZTtcbiAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyID0+IHNldFRpbWVvdXQociwgMjUwICogTWF0aC5wb3coMiwgYXR0ZW1wdCAtIDEpKSk7XG4gICAgICAgICAgcmV0dXJuIGxvYWQoYXR0ZW1wdCArIDEpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY29uc3QgeyBwYXJ0czogZGF0YSwgbGFzdERvYywgaGFzTmV4dFBhZ2U6IG5leHRQYWdlIH0gPSBhd2FpdCBsb2FkKCk7XG4gICAgICBpZiAodGltZWRPdXQgfHwgc2VxICE9PSBmZXRjaFNlcS5jdXJyZW50KSByZXR1cm47XG4gICAgICBjb25zdCBoYXNOYW1lU2VhcmNoID1cbiAgICAgICAgQm9vbGVhbihlZmZlY3RpdmVTZWFyY2hMb3dlcikgJiYgZWZmZWN0aXZlU2VsZWN0ID09PSBcIk5hbWVcIjtcbiAgICAgIGlmIChcbiAgICAgICAgaGFzTmFtZVNlYXJjaCAmJlxuICAgICAgICAoZGF0YS5sZW5ndGggPT09IDAgfHxcbiAgICAgICAgICBkYXRhLnNvbWUoXG4gICAgICAgICAgICAoaXRlbSkgPT5cbiAgICAgICAgICAgICAgIUFycmF5LmlzQXJyYXkoaXRlbT8ubmFtZVRva2VucykgfHwgaXRlbS5uYW1lVG9rZW5zLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICkpXG4gICAgICApIHtcbiAgICAgICAgc3RhcnROYW1lVG9rZW5CYWNrZmlsbChcIm5hbWUtc2VhcmNoXCIpO1xuICAgICAgfVxuICAgICAgaWYgKHJlcXVlc3RlZFBhZ2UgPT09IDEgJiYgZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgc2V0UGFnZUN1cnNvcnMoW10pO1xuICAgICAgICBzZXRIYXNOZXh0UGFnZShmYWxzZSk7XG4gICAgICB9XG4gICAgICBzZXRCYWNrdXBJbmZvKGRhdGEpO1xuICAgICAgc2V0TGFiZWxzKGxhYmVsQmFzZSk7IC8vIDwtLSBhZGQgdGhpcyBsaW5lIGFmdGVyIHNldEJhY2t1cEluZm8oZGF0YSlcbiAgICAgIHNldElEKGRhdGEubWFwKChpdGVtKSA9PiBpdGVtLmlkKSk7XG4gICAgICBpZiAocmVxdWVzdGVkUGFnZSA+IDEgJiYgZGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgc2V0SGFzTmV4dFBhZ2UoZmFsc2UpO1xuICAgICAgICBzZXRQYWdlKDEpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBzZXRIYXNOZXh0UGFnZShuZXh0UGFnZSk7XG4gICAgICBzZXRQYWdlQ3Vyc29ycygocHJldikgPT4ge1xuICAgICAgICBjb25zdCBuZXh0ID0gcmVxdWVzdGVkUGFnZSA9PT0gMSA/IFtdIDogWy4uLnByZXZdO1xuICAgICAgICBpZiAobGFzdERvYykge1xuICAgICAgICAgIG5leHRbcmVxdWVzdGVkUGFnZSAtIDFdID0gbGFzdERvYztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgIH0pO1xuICAgICAgc2V0U2VsZWN0ZWRJdGVtcyhbXSk7XG5cbiAgICAgIC8vIE5vcm1hbGl6ZSBjbGllbnQgaWRzIGZvciBmaWx0ZXJpbmdcbiAgICAgIGNvbnN0IGF1Z21lbnRlZCA9IGRhdGEubWFwKChpdGVtKSA9PiAoe1xuICAgICAgICAuLi5pdGVtLFxuICAgICAgICBjbGllbnRGcm9tSWQ6XG4gICAgICAgICAgaXRlbT8uY2xpZW50RnJvbUlkID8/XG4gICAgICAgICAgKHR5cGVvZiBpdGVtPy5DbGllbnRGcm9tID09PSBcInN0cmluZ1wiID8gaXRlbS5DbGllbnRGcm9tIDogbnVsbCkgPz9cbiAgICAgICAgICBpdGVtPy5DbGllbnRGcm9tPy5pZCA/P1xuICAgICAgICAgIG51bGwsXG4gICAgICAgIGNsaWVudEN1cnJlbnRJZDpcbiAgICAgICAgICBpdGVtPy5jbGllbnRDdXJyZW50SWQgPz9cbiAgICAgICAgICAodHlwZW9mIGl0ZW0/LkNsaWVudEN1cnJlbnQgPT09IFwic3RyaW5nXCIgPyBpdGVtLkNsaWVudEN1cnJlbnQgOiBudWxsKSA/P1xuICAgICAgICAgIGl0ZW0/LkNsaWVudEN1cnJlbnQ/LmlkID8/XG4gICAgICAgICAgbnVsbCxcbiAgICAgIH0pKTtcblxyXG4gICAgICBzZXRBdWdtZW50ZWRJbmZvKGF1Z21lbnRlZCk7XG4gICAgICAvLyBkZWZhdWx0IHZpZXcgPSBmaWx0ZXJlZCAoa2VlcHMgcGFnaW5hdGlvbiBhbmQgZmlsdGVycyBjb25zaXN0ZW50KVxuICAgICAgc2V0SW5mbyhhdWdtZW50ZWQuZmlsdGVyKG1hdGNoZXNGaWx0ZXJzKSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoc2VxICE9PSBmZXRjaFNlcS5jdXJyZW50KSByZXR1cm47XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgZGF0YTpcIiwgZXJyKTtcbiAgICAgIGNvbnN0IGNvZGUgPSBlcnI/LmNvZGUgfHwgXCJ1bmtub3duXCI7XG4gICAgICBzZXRMb2FkRXJyb3Ioe1xuICAgICAgICBjb2RlLFxuICAgICAgICBtZXNzYWdlOiBlcnI/Lm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gbG9hZCBpdGVtcy5cIixcbiAgICAgIH0pO1xuICAgICAgc2V0SW5mbyhbXSk7XG4gICAgICBzZXRBdWdtZW50ZWRJbmZvKFtdKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICBpZiAoc2VxID09PSBmZXRjaFNlcS5jdXJyZW50ICYmICF0aW1lZE91dCkgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICB9XG4gIH1cblxyXG4gIGNvbnN0IHNlYXJjaENoYW5nZUhhbmRsZXIgPSAoZXZlbnQpID0+IHNldFNlYXJjaChldmVudC50YXJnZXQudmFsdWUpO1xyXG5cclxuICAvLyBGaWx0ZXIgdGhlIGN1cnJlbnRseSBsb2FkZWQgaXRlbXMgKG5vdyBjb25zaXN0ZW50IHdpdGggcGFnZWQgZmlsdGVyaW5nKVxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGJhc2UgPSBhdWdtZW50ZWRJbmZvIHx8IFtdO1xuICAgIHNldEluZm8oYmFzZS5maWx0ZXIobWF0Y2hlc0ZpbHRlcnMpKTtcbiAgfSwgW2F1Z21lbnRlZEluZm8sIG1hdGNoZXNGaWx0ZXJzXSk7XG5cclxuICBmdW5jdGlvbiBzb3J0Q2hlY2tBbGwocG9zKSB7XHJcbiAgICAvLyBEZXRlcm1pbmUgbmV4dCBkaXJlY3Rpb246IHRvZ2dsZSB0aGUgY2xpY2tlZCBjb2x1bW4gb25seVxyXG4gICAgY29uc3QgbmV4dFNvcnRDaGVjayA9IHNvcnRDaGVjay5tYXAoKHYsIGkpID0+IChpID09PSBwb3MgPyAhdiA6IHYpKTtcclxuICAgIGNvbnN0IGlzRGVzYyA9IG5leHRTb3J0Q2hlY2tbcG9zXTsgLy8gdHJ1ZSBtZWFucyBkZXNjZW5kaW5nXHJcblxyXG4gICAgY29uc3Qgc29ydGVkSW5mbyA9IFsuLi5pbmZvXS5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGNvbnN0IGtleSA9IGxhYmVsQmFzZU5hbWVzW3Bvc107XHJcblxyXG4gICAgICBpZiAocG9zID09PSAxKSB7XHJcbiAgICAgICAgLy8gREFURSBjb2x1bW5cclxuICAgICAgICBjb25zdCB0YSA9IHRvVGltZShhW2tleV0pO1xyXG4gICAgICAgIGNvbnN0IHRiID0gdG9UaW1lKGJba2V5XSk7XHJcblxyXG4gICAgICAgIC8vIFB1dCBtaXNzaW5nIGRhdGVzIGF0IHRoZSBlbmQgZm9yIGFzY2VuZGluZywgYXQgdGhlIHN0YXJ0IGZvciBkZXNjZW5kaW5nXHJcbiAgICAgICAgaWYgKHRhID09PSBudWxsICYmIHRiID09PSBudWxsKSByZXR1cm4gMDtcclxuICAgICAgICBpZiAodGEgPT09IG51bGwpIHJldHVybiBpc0Rlc2MgPyAtMSA6IDE7XHJcbiAgICAgICAgaWYgKHRiID09PSBudWxsKSByZXR1cm4gaXNEZXNjID8gMSA6IC0xO1xyXG5cclxuICAgICAgICByZXR1cm4gaXNEZXNjID8gKHRiIC0gdGEpIDogKHRhIC0gdGIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBOQU1FIG9yIFNLVSAoc3RyaW5nLXkgY29sdW1ucyk6IGluZGV4ZXMgMCBvciA1IGluIHlvdXIgb3JpZ2luYWwgbG9naWNcclxuICAgICAgaWYgKHBvcyA9PT0gMCB8fCBwb3MgPT09IDUpIHtcclxuICAgICAgICBjb25zdCBhdiA9IChhW2tleV0gPz8gXCJcIikudG9TdHJpbmcoKTtcclxuICAgICAgICBjb25zdCBidiA9IChiW2tleV0gPz8gXCJcIikudG9TdHJpbmcoKTtcclxuICAgICAgICByZXR1cm4gaXNEZXNjID8gYnYubG9jYWxlQ29tcGFyZShhdikgOiBhdi5sb2NhbGVDb21wYXJlKGJ2KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTnVtZXJpYy1pc2ggY29sdW1ucyAod28sIHBuLCBzbikg4oCUIGZhbGwgYmFjayB0byBzdHJpbmcgY29tcGFyZSBpZiBOYU5cclxuICAgICAgY29uc3QgYW4gPSBOdW1iZXIoYVtrZXldKTtcclxuICAgICAgY29uc3QgYm4gPSBOdW1iZXIoYltrZXldKTtcclxuXHJcbiAgICAgIGlmICghaXNOYU4oYW4pICYmICFpc05hTihibikpIHtcclxuICAgICAgICByZXR1cm4gaXNEZXNjID8gKGJuIC0gYW4pIDogKGFuIC0gYm4pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IGF2ID0gKGFba2V5XSA/PyBcIlwiKS50b1N0cmluZygpO1xyXG4gICAgICAgIGNvbnN0IGJ2ID0gKGJba2V5XSA/PyBcIlwiKS50b1N0cmluZygpO1xyXG4gICAgICAgIHJldHVybiBpc0Rlc2MgPyBidi5sb2NhbGVDb21wYXJlKGF2KSA6IGF2LmxvY2FsZUNvbXBhcmUoYnYpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBzZXRJbmZvKHNvcnRlZEluZm8pO1xyXG4gICAgc2V0U29ydENoZWNrKG5leHRTb3J0Q2hlY2spO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBoZWFkZXIgbGFiZWxzIHRvIHNob3cgdGhlIGxpdHRsZSBhcnJvdyBvbiB0aGUgYWN0aXZlIGNvbHVtblxyXG4gICAgc2V0TGFiZWxzKHdpdGhTb3J0SWNvbihsYWJlbEJhc2UsIHBvcywgaXNEZXNjKSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgY29uc3Qgcm93U2VsZWN0ID0gKGl0ZW0pID0+IHtcclxuICAgIGlmIChpdGVtICYmIGl0ZW0uaWQpIHtcclxuICAgICAgY29uc29sZS5sb2coXCJTZWxlY3RlZCBpdGVtOlwiLCBpdGVtKTtcclxuICAgICAgcm91dGVyLnB1c2goXCIuL2l0ZW0vXCIgKyBpdGVtLmlkKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gZGV0ZXJtaW5lIHRoZSBzZWxlY3RlZCBpdGVt4oCZcyBJRDogXCIsIGl0ZW0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IFtzZWxlY3RlZEl0ZW1zLCBzZXRTZWxlY3RlZEl0ZW1zXSA9IHVzZVN0YXRlKFtdKTtcclxuICBjb25zdCBbc2hvd0RlbGV0ZU1vZGFsLCBzZXRTaG93RGVsZXRlTW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG5cclxuICBjb25zdCBoYW5kbGVTZWxlY3RJdGVtID0gKGlkKSA9PiB7XHJcbiAgICBzZXRTZWxlY3RlZEl0ZW1zKHByZXYgPT5cclxuICAgICAgcHJldi5pbmNsdWRlcyhpZCkgPyBwcmV2LmZpbHRlcih4ID0+IHggIT09IGlkKSA6IFsuLi5wcmV2LCBpZF1cclxuICAgICk7XHJcbiAgfTtcclxuXHJcblxyXG4gIC8vIHNldFNlbGVjdGVkSXRlbXMoKHByZXYpID0+IHtcclxuICAvLyAgIGNvbnN0IG5ld1NlbGVjdGlvbiA9IHByZXYuaW5jbHVkZXMoaWQpXHJcbiAgLy8gICAgID8gcHJldi5maWx0ZXIoKGl0ZW1JZCkgPT4gaXRlbUlkICE9PSBpZClcclxuICAvLyAgICAgOiBbLi4ucHJldiwgaWRdO1xyXG4gIC8vICAgY29uc29sZS5sb2coXCJTZWxlY3RlZCBpdGVtczpcIiwgbmV3U2VsZWN0aW9uKTtcclxuICAvLyAgIHJldHVybiBuZXdTZWxlY3Rpb247IC8vIDwtIGltcG9ydGFudFxyXG4gIC8vIH0pO1xyXG5cclxuICBjb25zdCBoYW5kbGVTaG93RGVsZXRlTW9kYWwgPSAoKSA9PiBzZXRTaG93RGVsZXRlTW9kYWwodHJ1ZSk7XHJcbiAgY29uc3QgaGFuZGxlQ2xvc2VEZWxldGVNb2RhbCA9ICgpID0+IHNldFNob3dEZWxldGVNb2RhbChmYWxzZSk7XHJcblxyXG4gIGNvbnN0IGhhbmRsZURlbGV0ZVNlbGVjdGVkID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgc2V0SXNEZWxldGluZyh0cnVlKTtcclxuICAgIGNvbnN0IGRiID0gZmlyZWJhc2UuZmlyZXN0b3JlKCk7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBMb29wIG92ZXIgZWFjaCBzZWxlY3RlZCBpdGVtIG9uZSBhdCBhIHRpbWVcclxuICAgICAgZm9yIChjb25zdCBpdGVtSWQgb2Ygc2VsZWN0ZWRJdGVtcykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGl0ZW1JZClcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgLy8gRGVsZXRlIGZyb20gXCJUZXN0XCIgY29sbGVjdGlvblxyXG4gICAgICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbihcIlRlc3RcIikuZG9jKGl0ZW1JZCkuZGVsZXRlKCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBkZWxldGluZyBkb2N1bWVudCAke2l0ZW1JZH0gZnJvbSBUZXN0OmAsIGVycik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAvLyBEZWxldGUgZnJvbSBcIlBhcnRzXCIgY29sbGVjdGlvblxyXG4gICAgICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbihcIlBhcnRzXCIpLmRvYyhpdGVtSWQpLmRlbGV0ZSgpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZGVsZXRpbmcgZG9jdW1lbnQgJHtpdGVtSWR9IGZyb20gUGFydHM6YCwgZXJyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIC8vIERlbGV0ZSBhc3NvY2lhdGVkIHBob3RvcyBmcm9tIHN0b3JhZ2VcclxuICAgICAgICAgIGF3YWl0IGRlbGV0ZUZyb21TdG9yYWdlKGl0ZW1JZCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBkZWxldGluZyBzdG9yYWdlIGZvciAke2l0ZW1JZH06YCwgZXJyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgLy8gVXBkYXRlIGxvY2FsIHN0YXRlIGJ5IGZpbHRlcmluZyBvdXQgdGhlIGRlbGV0ZWQgaXRlbXNcclxuICAgICAgc2V0SW5mbyhpbmZvLmZpbHRlcigoaXRlbSkgPT4gIXNlbGVjdGVkSXRlbXMuaW5jbHVkZXMoaXRlbS5pZCkpKTtcclxuICAgICAgc2V0U2VsZWN0ZWRJdGVtcyhbXSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgaXRlbXM6XCIsIGVycm9yKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldElzRGVsZXRpbmcoZmFsc2UpO1xyXG4gICAgICBoYW5kbGVDbG9zZURlbGV0ZU1vZGFsKCk7XHJcbiAgICAgIC8vIE9wdGlvbmFsbHksIHJlbG9hZCB0aGUgcGFnZVxyXG4gICAgICAvLyByb3V0ZXIucmVsb2FkKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcblxyXG4gIGNvbnN0IGhhbmRsZUNsb3NlID0gKCkgPT4gc2V0U2hvdyhmYWxzZSk7XHJcbiAgY29uc3QgaGFuZGxlU2hvdyA9ICgpID0+IHNldFNob3codHJ1ZSk7XHJcblxyXG4gIGNvbnN0IGNoZWNrRGVsZXRlID0gKGV2ZW50LCBwb3MsIGlkc1RvRGVsZXRlLCBuYW1lKSA9PiB7XHJcbiAgICBpZiAoZXZlbnQpIHtcclxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmxvZyhcIlNlbGVjdGVkIElEcyB0byBkZWxldGU6XCIsIGlkc1RvRGVsZXRlKTtcclxuICAgIHNldFNlbGVjdGVkSXRlbXMoaWRzVG9EZWxldGUpO1xyXG4gICAgc2V0REl0ZW0obmFtZSk7XHJcbiAgICBzZXRTaG93RGVsZXRlTW9kYWwodHJ1ZSk7XHJcbiAgfTtcclxuXHJcbiAgLy8gY29uc3QgaGFuZGxlRGVsZXRlID0gYXN5bmMgKCkgPT4ge1xyXG4gIC8vICAgbGV0IGl0ZW1JZCA9IGdJZGU7XHJcbiAgLy8gICB0cnkge1xyXG4gIC8vICAgICBzZXRJc0RlbGV0aW5nKHRydWUpO1xyXG4gIC8vICAgICBjb25zdCBkYiA9IGZpcmViYXNlLmZpcmVzdG9yZSgpO1xyXG4gIC8vICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uKFwiVGVzdFwiKS5kb2MoaXRlbUlkKS5kZWxldGUoKTtcclxuICAvLyAgICAgYXdhaXQgZGVsZXRlRnJvbVBhcnRzQ29sbGVjdGlvbihpdGVtSWQpO1xyXG4gIC8vICAgICBhd2FpdCBkZWxldGVGcm9tU3RvcmFnZShpdGVtSWQpO1xyXG4gIC8vICAgICBzZXRJbmZvKGluZm8uZmlsdGVyKChfLCBpKSA9PiBnUG9zICE9PSBpKSk7XHJcbiAgLy8gICAgIGNvbnNvbGUubG9nKGBEZWxldGVkIGl0ZW06ICR7aXRlbUlkfWApO1xyXG4gIC8vICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAvLyAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGl0ZW06XCIsIGVycm9yKTtcclxuICAvLyAgIH0gZmluYWxseSB7XHJcbiAgLy8gICAgIHNldElzRGVsZXRpbmcoZmFsc2UpO1xyXG4gIC8vICAgfVxyXG4gIC8vICAgaGFuZGxlQ2xvc2UoKTtcclxuICAvLyB9O1xyXG5cclxuICBjb25zdCBob3ZlclN0eWxlID0gKGluZGV4KSA9PiAoe1xyXG4gICAgYmFja2dyb3VuZENvbG9yOiBob3ZlckluZGV4ID09PSBpbmRleCA/IFwiI2RkZFwiIDogXCJ0cmFuc3BhcmVudFwiLFxyXG4gICAgdGV4dEFsaWduOiBcImNlbnRlclwiLFxyXG4gICAgY3Vyc29yOiBcImRlZmF1bHRcIixcclxuICB9KTtcclxuXHJcbiAgY29uc3QgW2Ryb3Bkb3duMVRleHQsIHNldERyb3Bkb3duMVRleHRdID0gdXNlU3RhdGUoXCJTZWxlY3QgT3B0aW9uXCIpO1xyXG4gIGNvbnN0IFtkcm9wZG93bjJUZXh0LCBzZXREcm9wZG93bjJUZXh0XSA9IHVzZVN0YXRlKFwiU2VsZWN0IE9wdGlvblwiKTtcclxuXHJcbiAgY29uc3QgaGFuZGxlU2VsZWN0MSA9IChldmVudEtleSwgZXZlbnQpID0+IHtcclxuICAgIGlmIChldmVudEtleSA9PT0gXCJ1bmFzc2lnbmVkXCIpIHtcclxuICAgICAgc2V0RHJvcGRvd24xVGV4dChcIlNlbGVjdCBPcHRpb25cIik7XHJcbiAgICAgIHNldFNlbGVjdGVkT0VNKG51bGwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0RHJvcGRvd24xVGV4dChldmVudC50YXJnZXQudGV4dENvbnRlbnQpO1xyXG4gICAgICBzZXRTZWxlY3RlZE9FTShldmVudC50YXJnZXQudGV4dENvbnRlbnQpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZVNlbGVjdDIgPSAoZXZlbnRLZXksIGV2ZW50KSA9PiB7XHJcbiAgICBpZiAoZXZlbnRLZXkgPT09IFwidW5hc3NpZ25lZFwiKSB7XHJcbiAgICAgIHNldERyb3Bkb3duMlRleHQoXCJTZWxlY3QgT3B0aW9uXCIpO1xyXG4gICAgICBzZXRTZWxlY3RlZE1vZGFsaXR5KG51bGwpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2V0RHJvcGRvd24yVGV4dChldmVudC50YXJnZXQudGV4dENvbnRlbnQpO1xyXG4gICAgICBzZXRTZWxlY3RlZE1vZGFsaXR5KGV2ZW50LnRhcmdldC50ZXh0Q29udGVudCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLy8gQnVpbGQgYSB1bmlxdWUgbGlzdCBvZiBjbGllbnRzIGZyb20gdGhlIGl0ZW1zIGN1cnJlbnRseSBsb2FkZWQsIGZpbHRlcmVkIGJ5IE9FTS9Nb2RhbGl0eS5cclxuICAvLyBgdHlwZWAgaXMgXCJmcm9tXCIgb3IgXCJjdXJyZW50XCIgdG8gZGVjaWRlIHdoaWNoIGNsaWVudCByZWYgdG8gcmVhZC5cclxuICBhc3luYyBmdW5jdGlvbiBidWlsZENsaWVudHNGcm9tSXRlbXModHlwZSkge1xuICAgIGNvbnN0IGRiID0gZmlyZWJhc2UuZmlyZXN0b3JlKCk7XG4gICAgY29uc3QgaWRzID0gbmV3IFNldCgpO1xuXG4gICAgLy8gUmVzcGVjdCBjdXJyZW50IE9FTSAvIE1vZGFsaXR5IGZpbHRlcnMgd2hlbiBkZXJpdmluZyBjbGllbnQgb3B0aW9uc1xuICAgIGNvbnN0IGZpbHRlcmVkID0gYXVnbWVudGVkSW5mby5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICAgIGNvbnN0IE9FTSA9IGdldE1hY2hpbmVGaWVsZChpdGVtLCBcIk9FTVwiKTtcbiAgICAgIGNvbnN0IE1vZGFsaXR5ID0gZ2V0TWFjaGluZUZpZWxkKGl0ZW0sIFwiTW9kYWxpdHlcIik7XG4gICAgICBpZiAoc2VsZWN0ZWRPRU0gJiYgbm9ybWFsaXplVGV4dChPRU0pICE9PSBub3JtYWxpemVUZXh0KHNlbGVjdGVkT0VNKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIHNlbGVjdGVkTW9kYWxpdHkgJiZcbiAgICAgICAgbm9ybWFsaXplVGV4dChNb2RhbGl0eSkgIT09IG5vcm1hbGl6ZVRleHQoc2VsZWN0ZWRNb2RhbGl0eSlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcblxyXG4gICAgZm9yIChjb25zdCBpdCBvZiBmaWx0ZXJlZCkge1xyXG4gICAgICBjb25zdCBpZCA9IHR5cGUgPT09IFwiZnJvbVwiID8gaXQuY2xpZW50RnJvbUlkIDogaXQuY2xpZW50Q3VycmVudElkO1xyXG4gICAgICBpZiAoaWQpIGlkcy5hZGQoaWQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG91dCA9IFtdO1xyXG4gICAgY29uc3QgaWRBcnJheSA9IFsuLi5pZHNdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpZEFycmF5Lmxlbmd0aDsgaSArPSAxMCkge1xyXG4gICAgICBjb25zdCBjaHVuayA9IGlkQXJyYXkuc2xpY2UoaSwgaSArIDEwKTtcclxuICAgICAgY29uc3Qgc25hcCA9IGF3YWl0IGRiXHJcbiAgICAgICAgLmNvbGxlY3Rpb24oXCJDbGllbnRcIilcclxuICAgICAgICAud2hlcmUoZmlyZWJhc2UuZmlyZXN0b3JlLkZpZWxkUGF0aC5kb2N1bWVudElkKCksIFwiaW5cIiwgY2h1bmspXHJcbiAgICAgICAgLmdldCgpO1xyXG4gICAgICBzbmFwLmZvckVhY2goKGRvYykgPT4ge1xyXG4gICAgICAgIGNvbnN0IGQgPSBkb2MuZGF0YSgpIHx8IHt9O1xyXG4gICAgICAgIG91dC5wdXNoKHsgaWQ6IGRvYy5pZCwgbmFtZTogZC5uYW1lIHx8IGRvYy5pZCB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gc29ydCBieSBuYW1lIGZvciBuaWNlciBVWFxyXG4gICAgb3V0LnNvcnQoKGEsIGIpID0+IChhLm5hbWUgfHwgXCJcIikubG9jYWxlQ29tcGFyZShiLm5hbWUgfHwgXCJcIikpO1xyXG4gICAgcmV0dXJuIG91dDtcclxuICB9XHJcblxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIENMSUVOVCBTRUxFQ1RJT04gSEFORExJTkdcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vIFRoaXMgZnVuY3Rpb24gZmV0Y2hlcyBjbGllbnRzIGFuZCBvcGVucyB0aGUgY2xpZW50IG1vZGFsLlxyXG4gIGNvbnN0IGhhbmRsZUNsaWVudENsaWNrID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgbGV0IHNhZmVDbGllbnRzID0gW107XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBjbGllbnRzRGF0YSA9IGF3YWl0IGZldGNoQ2xpZW50cyhzZWxlY3RlZE9FTSwgc2VsZWN0ZWRNb2RhbGl0eSk7XHJcbiAgICAgIHNhZmVDbGllbnRzID0gQXJyYXkuaXNBcnJheShjbGllbnRzRGF0YSkgPyBjbGllbnRzRGF0YSA6IFtdO1xyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiZmV0Y2hDbGllbnRzIGZhaWxlZDpcIiwgZSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRmFsbGJhY2sgdG8gYnVpbGRpbmcgZnJvbSBsb2FkZWQgaXRlbXMgaWYgQVBJIGdhdmUgdXMgbm90aGluZ1xyXG4gICAgaWYgKHNhZmVDbGllbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGlmICghY2xpZW50U2VsZWN0aW9uVHlwZSkge1xyXG4gICAgICAgICAgLy8gaWYgc29tZWhvdyBub3Qgc2V0IHlldCwgZGVmYXVsdCB0byBcImZyb21cIlxyXG4gICAgICAgICAgc2V0Q2xpZW50U2VsZWN0aW9uVHlwZShcImZyb21cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IGRlcml2ZWQgPSBhd2FpdCBidWlsZENsaWVudHNGcm9tSXRlbXMoY2xpZW50U2VsZWN0aW9uVHlwZSB8fCBcImZyb21cIik7XHJcbiAgICAgICAgc2FmZUNsaWVudHMgPSBkZXJpdmVkO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhbGxiYWNrIGJ1aWxkQ2xpZW50c0Zyb21JdGVtcyBmYWlsZWQ6XCIsIGUpO1xyXG4gICAgICAgIHNhZmVDbGllbnRzID0gW107XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRDbGllbnRzKHNhZmVDbGllbnRzKTtcclxuICAgIHNldENsaWVudFNlYXJjaFRlcm0oXCJcIik7XHJcbiAgICBzZXRTaG93Q2xpZW50TW9kYWwodHJ1ZSk7XHJcbiAgfTtcclxuXHJcblxyXG5cclxuICAvLyBXaGVuIGEgY2xpZW50IGlzIHNlbGVjdGVkIGluIHRoZSBtb2RhbCwgd2Ugbm93IGFzc3VtZSB0aGUgcGFyYW1ldGVyIGlzIGEgY2xpZW50IElELlxyXG4gIC8vIElmIHRoZSBwYXNzZWQgdmFsdWUgaXMgbnVsbCwgd2UgY2xlYXIgdGhlIHNlbGVjdGlvbi5cclxuICBjb25zdCBoYW5kbGVDbGllbnRTZWxlY3QgPSBhc3luYyAoY2xpZW50SWQpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKFwiVXNlciBzZWxlY3RlZCBjbGllbnQgaWQ6XCIsIGNsaWVudElkKTtcclxuICAgIGlmICghY2xpZW50SWQpIHtcclxuICAgICAgaWYgKGNsaWVudFNlbGVjdGlvblR5cGUgPT09IFwiZnJvbVwiKSB7XHJcbiAgICAgICAgc2V0Q2xpZW50RnJvbUJ1dHRvblRleHQoXCJTZWxlY3QgT3B0aW9uXCIpO1xyXG4gICAgICAgIHNldFNlbGVjdGVkQ2xpZW50RnJvbShudWxsKTtcclxuICAgICAgfSBlbHNlIGlmIChjbGllbnRTZWxlY3Rpb25UeXBlID09PSBcImN1cnJlbnRcIikge1xyXG4gICAgICAgIHNldENsaWVudEN1cnJlbnRCdXR0b25UZXh0KFwiU2VsZWN0IE9wdGlvblwiKTtcclxuICAgICAgICBzZXRTZWxlY3RlZENsaWVudEN1cnJlbnQobnVsbCk7XHJcbiAgICAgIH1cclxuICAgICAgc2V0U2hvd0NsaWVudE1vZGFsKGZhbHNlKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgY2xpZW50U25hcCA9IGF3YWl0IGZpcmViYXNlLmZpcmVzdG9yZSgpLmNvbGxlY3Rpb24oXCJDbGllbnRcIikuZG9jKGNsaWVudElkKS5nZXQoKTtcclxuICAgICAgaWYgKGNsaWVudFNuYXAuZXhpc3RzKSB7XHJcbiAgICAgICAgY29uc3QgY2xpZW50RGF0YSA9IGNsaWVudFNuYXAuZGF0YSgpO1xyXG4gICAgICAgIGlmIChjbGllbnRTZWxlY3Rpb25UeXBlID09PSBcImZyb21cIikge1xyXG4gICAgICAgICAgc2V0Q2xpZW50RnJvbUJ1dHRvblRleHQoY2xpZW50RGF0YS5uYW1lKTtcclxuICAgICAgICAgIHNldFNlbGVjdGVkQ2xpZW50RnJvbShjbGllbnRJZCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChjbGllbnRTZWxlY3Rpb25UeXBlID09PSBcImN1cnJlbnRcIikge1xyXG4gICAgICAgICAgc2V0Q2xpZW50Q3VycmVudEJ1dHRvblRleHQoY2xpZW50RGF0YS5uYW1lKTtcclxuICAgICAgICAgIHNldFNlbGVjdGVkQ2xpZW50Q3VycmVudChjbGllbnRJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJObyBjbGllbnQgZG9jdW1lbnQgZm91bmQgZm9yIGlkOlwiLCBjbGllbnRJZCk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBjbGllbnQgZGF0YTpcIiwgZXJyb3IpO1xyXG4gICAgfVxyXG4gICAgc2V0U2hvd0NsaWVudE1vZGFsKGZhbHNlKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVDbGllbnRJbmZvID0gKGNsaWVudElkLCBjbGllbnROYW1lKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhgQ2xpZW50IElEOiAke2NsaWVudElkfSwgQ2xpZW50IE5hbWU6ICR7Y2xpZW50TmFtZX1gKTtcclxuICAgIHJvdXRlci5wdXNoKFwiY2xpZW50L1wiICsgY2xpZW50SWQpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZUNsZWFyQ2xpZW50U2VsZWN0aW9uID0gKCkgPT4ge1xyXG4gICAgaWYgKGNsaWVudFNlbGVjdGlvblR5cGUgPT09IFwiZnJvbVwiKSB7XHJcbiAgICAgIHNldENsaWVudEZyb21CdXR0b25UZXh0KFwiU2VsZWN0IE9wdGlvblwiKTtcclxuICAgICAgc2V0U2VsZWN0ZWRDbGllbnRGcm9tKG51bGwpO1xyXG4gICAgfSBlbHNlIGlmIChjbGllbnRTZWxlY3Rpb25UeXBlID09PSBcImN1cnJlbnRcIikge1xyXG4gICAgICBzZXRDbGllbnRDdXJyZW50QnV0dG9uVGV4dChcIlNlbGVjdCBPcHRpb25cIik7XHJcbiAgICAgIHNldFNlbGVjdGVkQ2xpZW50Q3VycmVudChudWxsKTtcclxuICAgIH1cclxuICAgIHNldFNob3dDbGllbnRNb2RhbChmYWxzZSk7XHJcbiAgfTtcclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvLyBNT0RFTCBTRUxFQ1RJT04gSEFORExJTkdcclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIGNvbnN0IFttb2RlbHMsIHNldE1vZGVsc10gPSB1c2VTdGF0ZShbXSk7XHJcbiAgY29uc3QgW3Nob3dNb2RlbE1vZGFsLCBzZXRTaG93TW9kZWxNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgW21vZGVsQnV0dG9uVGV4dCwgc2V0TW9kZWxCdXR0b25UZXh0XSA9IHVzZVN0YXRlKFwiU2VsZWN0IE9wdGlvblwiKTtcclxuXHJcbiAgY29uc3QgaGFuZGxlTW9kZWxDbGljayA9IGFzeW5jICgpID0+IHtcclxuICAgIGNvbnN0IG1vZGVsc0RhdGEgPSBhd2FpdCBmZXRjaE1vZGVscyhcclxuICAgICAgc2VsZWN0ZWRPRU0sXHJcbiAgICAgIHNlbGVjdGVkTW9kYWxpdHksXHJcbiAgICAgIHNlbGVjdGVkQ2xpZW50RnJvbVxyXG4gICAgKTtcclxuICAgIHNldE1vZGVscyhtb2RlbHNEYXRhKTtcclxuICAgIHNldE1vZGVsU2VhcmNoVGVybShcIlwiKTtcclxuICAgIHNldFNob3dNb2RlbE1vZGFsKHRydWUpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZU1vZGVsU2VsZWN0ID0gKG1vZGVsTmFtZSkgPT4ge1xyXG4gICAgc2V0TW9kZWxCdXR0b25UZXh0KG1vZGVsTmFtZSB8fCBcIlNlbGVjdCBPcHRpb25cIik7XHJcbiAgICBzZXRTZWxlY3RlZE1vZGVsKG1vZGVsTmFtZSB8fCBudWxsKTtcclxuICAgIHNldFNob3dNb2RlbE1vZGFsKGZhbHNlKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBoYW5kbGVDbGVhck1vZGVsU2VsZWN0aW9uID0gKCkgPT4ge1xyXG4gICAgc2V0TW9kZWxCdXR0b25UZXh0KFwiU2VsZWN0IE9wdGlvblwiKTtcclxuICAgIHNldFNlbGVjdGVkTW9kZWwobnVsbCk7XHJcbiAgICBzZXRTaG93TW9kZWxNb2RhbChmYWxzZSk7XHJcbiAgfTtcclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvLyBXQVJFSE9VU0UgQlVUVE9OUyAoZm9yIENsaWVudCBDdXJyZW50KVxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgY29uc3QgaGFuZGxlU29DYWxXYXJlaG91c2VDbGljayA9ICgpID0+IHtcclxuICAgIHNldENsaWVudEN1cnJlbnRCdXR0b25UZXh0KFwiU29DYWwgV2FyZWhvdXNlXCIpO1xyXG4gICAgc2V0U2VsZWN0ZWRDbGllbnRDdXJyZW50KFNPQ0FMX0NMSUVOVF9JRCk7XHJcbiAgICBjb25zb2xlLmxvZyhcIldhcmVob3VzZSBidXR0b24gY2xpY2tlZDogc2V0dGluZyBDbGllbnQgQ3VycmVudCB0b1wiLCBTT0NBTF9DTElFTlRfSUQpO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGhhbmRsZU5vckNhbFdhcmVob3VzZUNsaWNrID0gKCkgPT4ge1xyXG4gICAgc2V0Q2xpZW50Q3VycmVudEJ1dHRvblRleHQoXCJOb3JDYWwgV2FyZWhvdXNlXCIpO1xyXG4gICAgc2V0U2VsZWN0ZWRDbGllbnRDdXJyZW50KE5PUkNBTF9DTElFTlRfSUQpO1xyXG4gICAgY29uc29sZS5sb2coXCJXYXJlaG91c2UgYnV0dG9uIGNsaWNrZWQ6IHNldHRpbmcgQ2xpZW50IEN1cnJlbnQgdG9cIiwgTk9SQ0FMX0NMSUVOVF9JRCk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaGFuZGxlV2FyZWhvdXNlVW5hc3NpZ25lZENsaWNrID0gKCkgPT4ge1xyXG4gICAgc2V0Q2xpZW50Q3VycmVudEJ1dHRvblRleHQoXCJVbmFzc2lnbmVkXCIpO1xyXG4gICAgc2V0U2VsZWN0ZWRDbGllbnRDdXJyZW50KFVOQVNTSUdORURfQ0xJRU5UX0lEKTtcclxuICAgIGNvbnNvbGUubG9nKFwiV2FyZWhvdXNlIGJ1dHRvbiBjbGlja2VkOiBzZXR0aW5nIENsaWVudCBDdXJyZW50IHRvXCIsIFVOQVNTSUdORURfQ0xJRU5UX0lEKTtcclxuICB9O1xyXG5cclxuICBjb25zdCBbY2xpZW50U2VhcmNoVGVybSwgc2V0Q2xpZW50U2VhcmNoVGVybV0gPSB1c2VTdGF0ZShcIlwiKTtcclxuICBjb25zdCBbbW9kZWxTZWFyY2hUZXJtLCBzZXRNb2RlbFNlYXJjaFRlcm1dID0gdXNlU3RhdGUoXCJcIik7XHJcblxyXG4gIGNvbnN0IGRlbGV0ZUZyb21TdG9yYWdlID0gYXN5bmMgKGl0ZW1JZCkgPT4ge1xyXG4gICAgY29uc3Qgc3RvcmFnZVJlZiA9IGZpcmViYXNlLnN0b3JhZ2UoKS5yZWYoKTtcclxuICAgIGNvbnN0IGZvbGRlclJlZiA9IHN0b3JhZ2VSZWYuY2hpbGQoYFBhcnRzLyR7aXRlbUlkfS9gKTtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGxpc3RSZXN1bHQgPSBhd2FpdCBmb2xkZXJSZWYubGlzdEFsbCgpO1xyXG4gICAgICBjb25zdCBkZWxldGVQcm9taXNlcyA9IGxpc3RSZXN1bHQuaXRlbXMubWFwKChpdGVtKSA9PiBpdGVtLmRlbGV0ZSgpKTtcclxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoZGVsZXRlUHJvbWlzZXMpO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGZyb20gc3RvcmFnZTpcIiwgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGRlbGV0ZUZyb21QYXJ0c0NvbGxlY3Rpb24gPSBhc3luYyAoaXRlbUlkKSA9PiB7XHJcbiAgICBjb25zdCBkYiA9IGZpcmViYXNlLmZpcmVzdG9yZSgpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgYXdhaXQgZGIuY29sbGVjdGlvbihcIlBhcnRzXCIpLmRvYyhpdGVtSWQpLmRlbGV0ZSgpO1xyXG4gICAgICBjb25zb2xlLmxvZyhgRGVsZXRlZCBpdGVtIGZyb20gUGFydHMgY29sbGVjdGlvbjogJHtpdGVtSWR9YCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgZnJvbSBQYXJ0cyBjb2xsZWN0aW9uOlwiLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLy8gICAvLyBTYWZlbHkgY29udmVydCBhbnkgZGF0ZS1pc2ggdmFsdWUgaW50byBhIGNvbXBhcmFibGUgdGltZXN0YW1wIChtcyBzaW5jZSBlcG9jaCkuXHJcbiAgLy8gZnVuY3Rpb24gdG9UaW1lKHZhbHVlKSB7XHJcbiAgLy8gICBpZiAoIXZhbHVlKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgLy8gICAvLyBGaXJlc3RvcmUgVGltZXN0YW1wOiB7IHNlY29uZHMsIG5hbm9zZWNvbmRzIH1cclxuICAvLyAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUuc2Vjb25kcykge1xyXG4gIC8vICAgICB0cnkge1xyXG4gIC8vICAgICAgIHJldHVybiB2YWx1ZS5zZWNvbmRzICogMTAwMDtcclxuICAvLyAgICAgfSBjYXRjaCB7IC8qIGZhbGx0aHJvdWdoICovIH1cclxuICAvLyAgIH1cclxuXHJcbiAgLy8gICAvLyBJZiBhbHJlYWR5IGEgRGF0ZVxyXG4gIC8vICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIGlzTmFOKHZhbHVlLmdldFRpbWUoKSkgPyBudWxsIDogdmFsdWUuZ2V0VGltZSgpO1xyXG5cclxuICAvLyAgIC8vIElmIHN0cmluZzogdHJ5IElTTyBmaXJzdFxyXG4gIC8vICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gIC8vICAgICAvLyB5eXl5LW1tLWRkIChmcm9tIHlvdXIgZm9ybSBpbnB1dHMpXHJcbiAgLy8gICAgIGNvbnN0IGlzbyA9IERhdGUucGFyc2UodmFsdWUpO1xyXG4gIC8vICAgICBpZiAoIWlzTmFOKGlzbykpIHJldHVybiBpc287XHJcblxyXG4gIC8vICAgICAvLyBtbS9kZC95eXl5IGZhbGxiYWNrIChvbGRlciBpdGVtcylcclxuICAvLyAgICAgY29uc3QgcGFydHMgPSB2YWx1ZS5zcGxpdChcIi9cIik7XHJcbiAgLy8gICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHtcclxuICAvLyAgICAgICBjb25zdCBbbW0sIGRkLCB5eXl5XSA9IHBhcnRzO1xyXG4gIC8vICAgICAgIGNvbnN0IGFsdCA9IERhdGUucGFyc2UoYCR7eXl5eX0tJHttbX0tJHtkZH1gKTtcclxuICAvLyAgICAgICBpZiAoIWlzTmFOKGFsdCkpIHJldHVybiBhbHQ7XHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH1cclxuXHJcbiAgLy8gICAvLyBDYW5vbmljYWxpemUgYW55IGRhdGUtaXNoIHZhbHVlIHRvICd5eXl5LW1tLWRkJyBzbyBpdCBtYXRjaGVzIDxpbnB1dCB0eXBlPVwiZGF0ZVwiPiB2YWx1ZXNcclxuICAvLyAgIGZ1bmN0aW9uIHRvWU1EKHZhbHVlKSB7XHJcbiAgLy8gICAgIGNvbnN0IHQgPSB0b1RpbWUodmFsdWUpO1xyXG4gIC8vICAgICBpZiAodCA9PSBudWxsKSByZXR1cm4gbnVsbDtcclxuICAvLyAgICAgY29uc3QgZCA9IG5ldyBEYXRlKHQpO1xyXG4gIC8vICAgICBjb25zdCB5eXl5ID0gZC5nZXRGdWxsWWVhcigpO1xyXG4gIC8vICAgICBjb25zdCBtbSA9IFN0cmluZyhkLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgLy8gICAgIGNvbnN0IGRkID0gU3RyaW5nKGQuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCBcIjBcIik7XHJcbiAgLy8gICAgIHJldHVybiBgJHt5eXl5fS0ke21tfS0ke2RkfWA7XHJcbiAgLy8gICB9XHJcblxyXG5cclxuICAvLyAgIC8vIExhc3QgcmVzb3J0XG4gIC8vICAgY29uc3QgdCA9IERhdGUucGFyc2UodmFsdWUpO1xuICAvLyAgIHJldHVybiBpc05hTih0KSA/IG51bGwgOiB0O1xuICAvLyB9XG5cbiAgY29uc3QgdG90YWxLbm93blBhZ2VzID0gTWF0aC5tYXgoXG4gICAgMSxcbiAgICBwYWdlQ3Vyc29ycy5maWx0ZXIoQm9vbGVhbikubGVuZ3RoICsgKGhhc05leHRQYWdlID8gMSA6IDApXG4gICk7XG4gIGNvbnN0IHBhZ2VCdXR0b25zID0gKCgpID0+IHtcbiAgICBjb25zdCBidXR0b25zID0gW107XG4gICAgY29uc3QgbWF4VmlzaWJsZSA9IDc7XG5cbiAgICBjb25zdCBwdXNoUGFnZSA9IChwKSA9PlxuICAgICAgYnV0dG9ucy5wdXNoKFxuICAgICAgICA8UGFnaW5hdGlvbi5JdGVtXG4gICAgICAgICAga2V5PXtgcGFnZS0ke3B9YH1cbiAgICAgICAgICBhY3RpdmU9e3AgPT09IHBhZ2V9XG4gICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0UGFnZShwKX1cbiAgICAgICAgPlxuICAgICAgICAgIHtwfVxuICAgICAgICA8L1BhZ2luYXRpb24uSXRlbT5cbiAgICAgICk7XG5cbiAgICBjb25zdCBwdXNoRWxsaXBzaXMgPSAoa2V5KSA9PlxuICAgICAgYnV0dG9ucy5wdXNoKDxQYWdpbmF0aW9uLkVsbGlwc2lzIGtleT17a2V5fSBkaXNhYmxlZCAvPik7XG5cbiAgICBpZiAodG90YWxLbm93blBhZ2VzIDw9IG1heFZpc2libGUpIHtcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHRvdGFsS25vd25QYWdlczsgaSArPSAxKSBwdXNoUGFnZShpKTtcbiAgICAgIHJldHVybiBidXR0b25zO1xuICAgIH1cblxuICAgIGNvbnN0IHdpbmRvd1NpemUgPSAzO1xuICAgIGxldCBzdGFydCA9IE1hdGgubWF4KDIsIHBhZ2UgLSAxKTtcbiAgICBsZXQgZW5kID0gTWF0aC5taW4odG90YWxLbm93blBhZ2VzIC0gMSwgcGFnZSArIDEpO1xuXG4gICAgY29uc3QgZGVzaXJlZFdpbmRvdyA9IG1heFZpc2libGUgLSAyO1xuICAgIGxldCBjdXJyZW50V2luZG93ID0gZW5kIC0gc3RhcnQgKyAxO1xuICAgIGxldCByZW1haW5pbmcgPSBkZXNpcmVkV2luZG93IC0gY3VycmVudFdpbmRvdztcblxuICAgIHdoaWxlIChyZW1haW5pbmcgPiAwKSB7XG4gICAgICBpZiAoc3RhcnQgPiAyKSB7XG4gICAgICAgIHN0YXJ0IC09IDE7XG4gICAgICAgIHJlbWFpbmluZyAtPSAxO1xuICAgICAgfVxuICAgICAgaWYgKHJlbWFpbmluZyA+IDAgJiYgZW5kIDwgdG90YWxLbm93blBhZ2VzIC0gMSkge1xuICAgICAgICBlbmQgKz0gMTtcbiAgICAgICAgcmVtYWluaW5nIC09IDE7XG4gICAgICB9XG4gICAgICBpZiAoc3RhcnQgPT09IDIgJiYgZW5kID09PSB0b3RhbEtub3duUGFnZXMgLSAxKSBicmVhaztcbiAgICB9XG5cbiAgICBwdXNoUGFnZSgxKTtcbiAgICBpZiAoc3RhcnQgPiAyKSBwdXNoRWxsaXBzaXMoXCJzdGFydC1lbGxpcHNpc1wiKTtcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpICs9IDEpIHB1c2hQYWdlKGkpO1xuICAgIGlmIChlbmQgPCB0b3RhbEtub3duUGFnZXMgLSAxKSBwdXNoRWxsaXBzaXMoXCJlbmQtZWxsaXBzaXNcIik7XG4gICAgcHVzaFBhZ2UodG90YWxLbm93blBhZ2VzKTtcbiAgICBpZiAoaGFzTmV4dFBhZ2UpIHB1c2hFbGxpcHNpcyhcIm1vcmUtZWxsaXBzaXNcIik7XG5cbiAgICByZXR1cm4gYnV0dG9ucztcbiAgfSkoKTtcblxuICBjb25zdCByZWNhbGNQYWdlU2l6ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gXCJ1bmRlZmluZWRcIikgcmV0dXJuO1xuICAgIGlmIChwYWdlICE9PSAxKSByZXR1cm47XG4gICAgaWYgKCF0YWJsZUJvZHlSZWYuY3VycmVudCkgcmV0dXJuO1xuICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9XG4gICAgICB0YWJsZUJvZHlSZWYuY3VycmVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgfHwgMDtcbiAgICBpZiAoIWNvbnRhaW5lckhlaWdodCkgcmV0dXJuO1xuXG4gICAgY29uc3QgaGVhZGVyUm93ID1cbiAgICAgIHRhYmxlQm9keVJlZi5jdXJyZW50LnF1ZXJ5U2VsZWN0b3IoXCJ0YWJsZSB0aGVhZCB0clwiKSB8fFxuICAgICAgdGFibGVCb2R5UmVmLmN1cnJlbnQucXVlcnlTZWxlY3RvcihcInRoZWFkIHRyXCIpO1xuICAgIGNvbnN0IGJvZHlSb3cgPVxuICAgICAgdGFibGVCb2R5UmVmLmN1cnJlbnQucXVlcnlTZWxlY3RvcihcInRhYmxlIHRib2R5IHRyXCIpIHx8XG4gICAgICB0YWJsZUJvZHlSZWYuY3VycmVudC5xdWVyeVNlbGVjdG9yKFwidGJvZHkgdHJcIik7XG5cbiAgICBpZiAoaGVhZGVyUm93KSB7XG4gICAgICBjb25zdCBoID0gaGVhZGVyUm93LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodDtcbiAgICAgIGlmIChoKSBoZWFkZXJIZWlnaHRSZWYuY3VycmVudCA9IGg7XG4gICAgfVxuICAgIGlmIChib2R5Um93KSB7XG4gICAgICBjb25zdCByID0gYm9keVJvdy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQ7XG4gICAgICBpZiAocikgcm93SGVpZ2h0UmVmLmN1cnJlbnQgPSByO1xuICAgIH1cblxuICAgIGNvbnN0IHZlcnRpY2FsUGFkZGluZyA9IDI0O1xuICAgIGNvbnN0IGF2YWlsYWJsZSA9XG4gICAgICBjb250YWluZXJIZWlnaHQgLSBoZWFkZXJIZWlnaHRSZWYuY3VycmVudCAtIHZlcnRpY2FsUGFkZGluZztcbiAgICBjb25zdCBlc3RpbWF0ZWQgPSBNYXRoLmZsb29yKGF2YWlsYWJsZSAvIHJvd0hlaWdodFJlZi5jdXJyZW50KTtcbiAgICBjb25zdCBjbGFtcGVkID0gTWF0aC5tYXgoNSwgTWF0aC5taW4oNTAsIGVzdGltYXRlZCkpO1xuICAgIGlmIChjbGFtcGVkID4gMCAmJiBjbGFtcGVkICE9PSBwYWdlU2l6ZSkge1xuICAgICAgc2V0UGFnZVNpemUoY2xhbXBlZCk7XG4gICAgICByZXNldFBhZ2luYXRpb24oKTtcbiAgICAgIHNldFF1ZXJ5RXBvY2goKHYpID0+IHYgKyAxKTtcbiAgICB9XG4gIH0sIFtwYWdlLCBwYWdlU2l6ZV0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09IFwidW5kZWZpbmVkXCIpIHJldHVybjtcbiAgICByZWNhbGNQYWdlU2l6ZSgpO1xuICAgIGNvbnN0IG9uUmVzaXplID0gKCkgPT4gcmVjYWxjUGFnZVNpemUoKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCBvblJlc2l6ZSk7XG4gICAgcmV0dXJuICgpID0+IHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIG9uUmVzaXplKTtcbiAgfSwgW3JlY2FsY1BhZ2VTaXplXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoaXNMb2FkaW5nIHx8IHBhZ2UgIT09IDEpIHJldHVybjtcbiAgICByZWNhbGNQYWdlU2l6ZSgpO1xuICB9LCBbcGFnZSwgaXNMb2FkaW5nLCByZWNhbGNQYWdlU2l6ZV0pO1xuXG4gIGNvbnN0IHJlbmRlckZpbHRlcnMgPSAoaWRQcmVmaXgpID0+IChcbiAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmZpbHRlcnNQYW5lbH0+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmZpbHRlcnNIZWFkZXJ9PlxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMuZmlsdGVyc1RpdGxlfT5GaWx0ZXJzPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5maWx0ZXJzU3VidGl0bGV9PlxuICAgICAgICAgICAgTmFycm93IHJlc3VsdHMgYnkgbWFjaGluZSwgY2xpZW50LCBvciB3YXJlaG91c2UuXG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICB7aGFzQWN0aXZlRmlsdGVycyA/IChcbiAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9e3N0eWxlcy5maWx0ZXJzQmFkZ2V9PkFjdGl2ZTwvc3Bhbj5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5maWx0ZXJTZWN0aW9ufT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5maWx0ZXJTZWN0aW9uVGl0bGV9Pk1hY2hpbmU8L2Rpdj5cbiAgICAgICAgPElucHV0R3JvdXAgY2xhc3NOYW1lPXtzdHlsZXMuaW5wdXRHcm91cH0+XG4gICAgICAgICAgPElucHV0R3JvdXAuVGV4dD5PRU08L0lucHV0R3JvdXAuVGV4dD5cbiAgICAgICAgICA8RHJvcGRvd24gb25TZWxlY3Q9e2hhbmRsZVNlbGVjdDF9IGNsYXNzTmFtZT1cInctMTAwXCI+XG4gICAgICAgICAgICA8RHJvcGRvd24uVG9nZ2xlXG4gICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lLXNlY29uZGFyeVwiXG4gICAgICAgICAgICAgIGlkPXtgJHtpZFByZWZpeH0tb2VtYH1cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgdy0xMDAgJHtzdHlsZXMuaW5wdXRCdXR0b259YH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2Ryb3Bkb3duMVRleHR9XG4gICAgICAgICAgICA8L0Ryb3Bkb3duLlRvZ2dsZT5cbiAgICAgICAgICAgIDxEcm9wZG93bi5NZW51IGNsYXNzTmFtZT1cInctMTAwXCI+XG4gICAgICAgICAgICAgIDxEcm9wZG93bi5JdGVtIGV2ZW50S2V5PVwidW5hc3NpZ25lZFwiPlNlbGVjdCBPcHRpb248L0Ryb3Bkb3duLkl0ZW0+XG4gICAgICAgICAgICAgIDxEcm9wZG93bi5JdGVtIGV2ZW50S2V5PVwiR0VcIj5HRTwvRHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgICAgPERyb3Bkb3duLkl0ZW0gZXZlbnRLZXk9XCJUb3NoaWJhXCI+VG9zaGliYTwvRHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgICAgPERyb3Bkb3duLkl0ZW0gZXZlbnRLZXk9XCJTaWVtZW5zXCI+U2llbWVuczwvRHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgICAgPERyb3Bkb3duLkl0ZW0gZXZlbnRLZXk9XCJQaGlsaXBzXCI+UGhpbGlwczwvRHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgIDwvRHJvcGRvd24uTWVudT5cbiAgICAgICAgICA8L0Ryb3Bkb3duPlxuICAgICAgICA8L0lucHV0R3JvdXA+XG5cbiAgICAgICAgPElucHV0R3JvdXAgY2xhc3NOYW1lPXtzdHlsZXMuaW5wdXRHcm91cH0+XG4gICAgICAgICAgPElucHV0R3JvdXAuVGV4dD5Nb2RhbGl0eTwvSW5wdXRHcm91cC5UZXh0PlxuICAgICAgICAgIDxEcm9wZG93biBvblNlbGVjdD17aGFuZGxlU2VsZWN0Mn0gY2xhc3NOYW1lPVwidy0xMDBcIj5cbiAgICAgICAgICAgIDxEcm9wZG93bi5Ub2dnbGVcbiAgICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmUtc2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgaWQ9e2Ake2lkUHJlZml4fS1tb2RhbGl0eWB9XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17YHctMTAwICR7c3R5bGVzLmlucHV0QnV0dG9ufWB9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHtkcm9wZG93bjJUZXh0fVxuICAgICAgICAgICAgPC9Ecm9wZG93bi5Ub2dnbGU+XG4gICAgICAgICAgICA8RHJvcGRvd24uTWVudSBjbGFzc05hbWU9XCJ3LTEwMFwiPlxuICAgICAgICAgICAgICA8RHJvcGRvd24uSXRlbSBldmVudEtleT1cInVuYXNzaWduZWRcIj5TZWxlY3QgT3B0aW9uPC9Ecm9wZG93bi5JdGVtPlxuICAgICAgICAgICAgICA8RHJvcGRvd24uSXRlbSBldmVudEtleT1cIkNUXCI+Q1Q8L0Ryb3Bkb3duLkl0ZW0+XG4gICAgICAgICAgICAgIDxEcm9wZG93bi5JdGVtIGV2ZW50S2V5PVwiTVJJXCI+TVJJPC9Ecm9wZG93bi5JdGVtPlxuICAgICAgICAgICAgPC9Ecm9wZG93bi5NZW51PlxuICAgICAgICAgIDwvRHJvcGRvd24+XG4gICAgICAgIDwvSW5wdXRHcm91cD5cblxuICAgICAgICA8SW5wdXRHcm91cCBjbGFzc05hbWU9e3N0eWxlcy5pbnB1dEdyb3VwfT5cbiAgICAgICAgICA8SW5wdXRHcm91cC5UZXh0Pk1vZGVsPC9JbnB1dEdyb3VwLlRleHQ+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmUtc2Vjb25kYXJ5XCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT17YHctMTAwICR7c3R5bGVzLmlucHV0QnV0dG9ufWB9XG4gICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVNb2RlbENsaWNrfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHttb2RlbEJ1dHRvblRleHR9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvSW5wdXRHcm91cD5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmZpbHRlclNlY3Rpb259PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmZpbHRlclNlY3Rpb25UaXRsZX0+Q2xpZW50PC9kaXY+XG4gICAgICAgIDxJbnB1dEdyb3VwIGNsYXNzTmFtZT17c3R5bGVzLmlucHV0R3JvdXB9PlxuICAgICAgICAgIDxJbnB1dEdyb3VwLlRleHQ+Q2xpZW50IEZyb208L0lucHV0R3JvdXAuVGV4dD5cbiAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICB2YXJpYW50PVwib3V0bGluZS1zZWNvbmRhcnlcIlxuICAgICAgICAgICAgY2xhc3NOYW1lPXtgdy0xMDAgJHtzdHlsZXMuaW5wdXRCdXR0b259YH1cbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IGhhbmRsZUNsaWVudENsaWNrKFwiZnJvbVwiKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y2xpZW50RnJvbUJ1dHRvblRleHR9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvSW5wdXRHcm91cD5cblxuICAgICAgICA8SW5wdXRHcm91cCBjbGFzc05hbWU9e3N0eWxlcy5pbnB1dEdyb3VwfT5cbiAgICAgICAgICA8SW5wdXRHcm91cC5UZXh0PkNsaWVudCBDdXJyZW50PC9JbnB1dEdyb3VwLlRleHQ+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmUtc2Vjb25kYXJ5XCJcbiAgICAgICAgICAgIGNsYXNzTmFtZT17YHctMTAwICR7c3R5bGVzLmlucHV0QnV0dG9ufWB9XG4gICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBoYW5kbGVDbGllbnRDbGljayhcImN1cnJlbnRcIil9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge2NsaWVudEN1cnJlbnRCdXR0b25UZXh0fVxuICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICA8L0lucHV0R3JvdXA+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5maWx0ZXJTZWN0aW9ufT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5maWx0ZXJTZWN0aW9uVGl0bGV9PldhcmVob3VzZTwvZGl2PlxuICAgICAgICA8SW5wdXRHcm91cCBjbGFzc05hbWU9e3N0eWxlcy5pbnB1dEdyb3VwfT5cbiAgICAgICAgICA8SW5wdXRHcm91cC5UZXh0PlF1aWNrPC9JbnB1dEdyb3VwLlRleHQ+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5idXR0b25Hcm91cH0+XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lLXNlY29uZGFyeVwiXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmZsZXhCdXR0b259XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVNvQ2FsV2FyZWhvdXNlQ2xpY2t9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIFNvQ2FsIFdhcmVob3VzZVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lLXNlY29uZGFyeVwiXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmZsZXhCdXR0b259XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZU5vckNhbFdhcmVob3VzZUNsaWNrfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBOb3JDYWwgV2FyZWhvdXNlXG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgdmFyaWFudD1cIm91dGxpbmUtc2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtzdHlsZXMuZmxleEJ1dHRvbn1cbiAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlV2FyZWhvdXNlVW5hc3NpZ25lZENsaWNrfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBVbmFzc2lnbmVkXG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9JbnB1dEdyb3VwPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG5cblxuICByZXR1cm4gKFxuICAgIDxMb2dnZWRJbj5cbiAgICAgIHtpc0RlbGV0aW5nICYmIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5sb2FkaW5nT3ZlcmxheX0+XG4gICAgICAgICAgPFNwaW5uZXIgYW5pbWF0aW9uPVwiYm9yZGVyXCIgcm9sZT1cInN0YXR1c1wiIGNsYXNzTmFtZT17c3R5bGVzLnNwaW5uZXJDZW50ZXJ9PlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwic3Itb25seVwiPkxvYWRpbmcuLi48L3NwYW4+XG4gICAgICAgICAgPC9TcGlubmVyPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICl9XHJcbiAgICAgIDxNb2RhbCBzaG93PXtzaG93RGVsZXRlTW9kYWx9IG9uSGlkZT17aGFuZGxlQ2xvc2VEZWxldGVNb2RhbH0+XHJcbiAgICAgICAgPE1vZGFsLkhlYWRlciBjbG9zZUJ1dHRvbj5cclxuICAgICAgICAgIDxNb2RhbC5UaXRsZT5Db25maXJtIERlbGV0aW9uPC9Nb2RhbC5UaXRsZT5cclxuICAgICAgICA8L01vZGFsLkhlYWRlcj5cclxuICAgICAgICA8TW9kYWwuQm9keT5cclxuICAgICAgICAgIEFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUge3NlbGVjdGVkSXRlbXMubGVuZ3RofSBpdGVtXHJcbiAgICAgICAgICB7c2VsZWN0ZWRJdGVtcy5sZW5ndGggPiAxID8gXCJzXCIgOiBcIlwifT9cclxuICAgICAgICA8L01vZGFsLkJvZHk+XHJcbiAgICAgICAgPE1vZGFsLkZvb3Rlcj5cclxuICAgICAgICAgIDxCdXR0b24gdmFyaWFudD1cImRhbmdlclwiIG9uQ2xpY2s9e2hhbmRsZURlbGV0ZVNlbGVjdGVkfT5cclxuICAgICAgICAgICAgWWVzLCBkZWxldGVcclxuICAgICAgICAgIDwvQnV0dG9uPlxyXG4gICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PVwic2Vjb25kYXJ5XCIgb25DbGljaz17aGFuZGxlQ2xvc2VEZWxldGVNb2RhbH0+XHJcbiAgICAgICAgICAgIENhbmNlbFxyXG4gICAgICAgICAgPC9CdXR0b24+XHJcbiAgICAgICAgPC9Nb2RhbC5Gb290ZXI+XHJcbiAgICAgIDwvTW9kYWw+XHJcblxyXG4gICAgICA8TW9kYWwgc2hvdz17c2hvd0NsaWVudE1vZGFsfSBvbkhpZGU9eygpID0+IHNldFNob3dDbGllbnRNb2RhbChmYWxzZSl9PlxyXG4gICAgICAgIDxNb2RhbC5IZWFkZXIgY2xvc2VCdXR0b24+XHJcbiAgICAgICAgICA8TW9kYWwuVGl0bGU+XHJcbiAgICAgICAgICAgIFNlbGVjdCB7Y2xpZW50U2VsZWN0aW9uVHlwZSA9PT0gXCJmcm9tXCIgPyBcIkNsaWVudCBGcm9tXCIgOiBcIkNsaWVudCBDdXJyZW50XCJ9XHJcbiAgICAgICAgICA8L01vZGFsLlRpdGxlPlxyXG4gICAgICAgIDwvTW9kYWwuSGVhZGVyPlxyXG4gICAgICAgIDxNb2RhbC5Cb2R5PlxyXG4gICAgICAgICAgPEZvcm1Db250cm9sXHJcbiAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcclxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJTZWFyY2ggYnkgbmFtZVwiXHJcbiAgICAgICAgICAgIGNsYXNzTmFtZT1cIm1iLTNcIlxyXG4gICAgICAgICAgICB2YWx1ZT17Y2xpZW50U2VhcmNoVGVybX1cclxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRDbGllbnRTZWFyY2hUZXJtKGUudGFyZ2V0LnZhbHVlKX1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8Q2xpZW50VGFibGVcclxuICAgICAgICAgICAgY2xpZW50cz17KEFycmF5LmlzQXJyYXkoY2xpZW50cykgPyBjbGllbnRzIDogW10pLmZpbHRlcihcclxuICAgICAgICAgICAgICAoY2xpZW50KSA9PiAoY2xpZW50Py5uYW1lID8/IFwiXCIpLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoY2xpZW50U2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICAgICAgICApfVxyXG4gICAgICAgICAgICBvblNlbGVjdENsaWVudD17aGFuZGxlQ2xpZW50U2VsZWN0fVxyXG4gICAgICAgICAgICBvbkluZm9DbGljaz17aGFuZGxlQ2xpZW50SW5mb31cclxuICAgICAgICAgICAgaXNDbGllbnRTZWFyY2g9e2ZhbHNlfVxyXG4gICAgICAgICAgICBjbGVhclNlbGVjdGlvbj17KCkgPT4gaGFuZGxlQ2xpZW50U2VsZWN0KG51bGwpfVxyXG4gICAgICAgICAgLz5cclxuICAgICAgICA8L01vZGFsLkJvZHk+XHJcbiAgICAgIDwvTW9kYWw+XHJcblxyXG4gICAgICA8TW9kYWwgc2hvdz17c2hvd01vZGVsTW9kYWx9IG9uSGlkZT17KCkgPT4gc2V0U2hvd01vZGVsTW9kYWwoZmFsc2UpfT5cclxuICAgICAgICA8TW9kYWwuSGVhZGVyIGNsb3NlQnV0dG9uPlxyXG4gICAgICAgICAgPE1vZGFsLlRpdGxlPlNlbGVjdCBNb2RlbDwvTW9kYWwuVGl0bGU+XHJcbiAgICAgICAgPC9Nb2RhbC5IZWFkZXI+XHJcbiAgICAgICAgPE1vZGFsLkJvZHk+XHJcbiAgICAgICAgICA8Rm9ybUNvbnRyb2xcclxuICAgICAgICAgICAgdHlwZT1cInRleHRcIlxyXG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlYXJjaCBieSBuYW1lXCJcclxuICAgICAgICAgICAgY2xhc3NOYW1lPVwibWItM1wiXHJcbiAgICAgICAgICAgIHZhbHVlPXttb2RlbFNlYXJjaFRlcm19XHJcbiAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0TW9kZWxTZWFyY2hUZXJtKGUudGFyZ2V0LnZhbHVlKX1cclxuICAgICAgICAgIC8+XHJcbiAgICAgICAgICA8TW9kZWxUYWJsZVxyXG4gICAgICAgICAgICBtb2RlbHM9e21vZGVscy5maWx0ZXIoKG1vZGVsKSA9PlxyXG4gICAgICAgICAgICAgIHR5cGVvZiBtb2RlbCA9PT0gXCJzdHJpbmdcIlxyXG4gICAgICAgICAgICAgICAgPyBtb2RlbC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG1vZGVsU2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICAgICAgICAgICAgOiBmYWxzZVxyXG4gICAgICAgICAgICApfVxyXG4gICAgICAgICAgICBvblNlbGVjdE1vZGVsPXtoYW5kbGVNb2RlbFNlbGVjdH1cclxuICAgICAgICAgICAgY2xlYXJTZWxlY3Rpb249eygpID0+IGhhbmRsZU1vZGVsU2VsZWN0KG51bGwpfVxyXG4gICAgICAgICAgLz5cclxuICAgICAgICA8L01vZGFsLkJvZHk+XHJcbiAgICAgIDwvTW9kYWw+XHJcblxyXG4gICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnBhZ2V9PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnBhZ2VJbm5lcn0+XG4gICAgICAgICAgPGhlYWRlciBjbGFzc05hbWU9e3N0eWxlcy5oZWFkZXJ9PlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5oZWFkZXJMZWZ0fT5cbiAgICAgICAgICAgICAgPGJ1dHRvblxuICAgICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmJ1cmdlcn1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRTaG93RmlsdGVycyh0cnVlKX1cbiAgICAgICAgICAgICAgICBhcmlhLWxhYmVsPVwiT3BlbiBmaWx0ZXJzXCJcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5icmFuZH0+XG4gICAgICAgICAgICAgICAgPGltZ1xuICAgICAgICAgICAgICAgICAgc3JjPVwiL21hZ21vLWxvZ28ucG5nXCJcbiAgICAgICAgICAgICAgICAgIGFsdD1cIk1hZ21vXCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmJyYW5kTG9nb31cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmJyYW5kTmFtZX0+TWFnbW88L2Rpdj5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMuYnJhbmRTdWJ9PkludmVudG9yeSBTZWFyY2g8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMuaGVhZGVyUmlnaHR9PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmhlYWRlclN0YXR1c30+XG4gICAgICAgICAgICAgICAge2hhc0FjdGl2ZUZpbHRlcnMgPyBcIkZpbHRlcnMgYWN0aXZlXCIgOiBcIkFsbCBpdGVtc1wifVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvaGVhZGVyPlxuXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5jb250ZW50fT5cbiAgICAgICAgICAgIDxhc2lkZSBjbGFzc05hbWU9e3N0eWxlcy5zaWRlYmFyfT57cmVuZGVyRmlsdGVycyhcInNpZGViYXJcIil9PC9hc2lkZT5cbiAgICAgICAgICAgIDxtYWluIGNsYXNzTmFtZT17c3R5bGVzLm1haW59PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnRhYmxlQ2FyZH0+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy50YWJsZUhlYWRlcn0+XG4gICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnRhYmxlVGl0bGV9Pkl0ZW1zPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMudGFibGVTdWJ0aXRsZX0+XG4gICAgICAgICAgICAgICAgICAgICAge2lzTG9hZGluZyA/IFwiTG9hZGluZyBpdGVtc1wiIDogYCR7aW5mby5sZW5ndGh9IGl0ZW1zIG9uIHRoaXMgcGFnZWB9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnRhYmxlTWV0YX0+XG4gICAgICAgICAgICAgICAgICAgIFBhZ2Uge3BhZ2V9IHtoYXNOZXh0UGFnZSA/IGBvZiAke3RvdGFsS25vd25QYWdlc30rYCA6IGBvZiAke3RvdGFsS25vd25QYWdlc31gfVxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnRhYmxlQm9keX0gcmVmPXt0YWJsZUJvZHlSZWZ9PlxuICAgICAgICAgICAgICAgICAge2lzTG9hZGluZyA/IChcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5sb2FkaW5nU3RhdGV9PlxuICAgICAgICAgICAgICAgICAgICAgIDxpbWdcbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYz1cIi9tYWdtby1sb2dvLnBuZ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBhbHQ9XCJMb2FkaW5nIE1hZ21vXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmxvYWRpbmdMb2dvfVxuICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5sb2FkaW5nVGV4dH0+TG9hZGluZzwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDxzdHlsZSBqc3ggZ2xvYmFsPntgXG4gICAgICAgICAgICAgICAgICAgICAgICBAa2V5ZnJhbWVzIG1hZ21vLXNwaW4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgwZGVnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB0byB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiByb3RhdGUoMzYwZGVnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIGB9PC9zdHlsZT5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICApIDogbG9hZEVycm9yID8gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmVycm9yU3RhdGV9PlxuICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMuZXJyb3JUaXRsZX0+XG4gICAgICAgICAgICAgICAgICAgICAgICBMb2FkIGZhaWxlZCAoe2xvYWRFcnJvci5jb2RlfSlcbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLmVycm9yTWVzc2FnZX0+e2xvYWRFcnJvci5tZXNzYWdlfTwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lLXNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplPVwic21cIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldFBhZ2luYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0UXVlcnlFcG9jaCgodikgPT4gdiArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICBSZXRyeVxuICAgICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgIDxQYXJ0VGFibGVcbiAgICAgICAgICAgICAgICAgICAgICBpbmZvPXtpbmZvfVxuICAgICAgICAgICAgICAgICAgICAgIGxhYmVscz17bGFiZWxzfVxuICAgICAgICAgICAgICAgICAgICAgIGlkcz17aWRzfVxuICAgICAgICAgICAgICAgICAgICAgIGhvdmVyU3R5bGU9e2hvdmVyU3R5bGV9XG4gICAgICAgICAgICAgICAgICAgICAgc29ydENoZWNrQWxsPXtzb3J0Q2hlY2tBbGx9XG4gICAgICAgICAgICAgICAgICAgICAgY2hlY2tEZWxldGU9e2NoZWNrRGVsZXRlfVxuICAgICAgICAgICAgICAgICAgICAgIGlzRGVsZXRpbmc9e2lzRGVsZXRpbmd9XG4gICAgICAgICAgICAgICAgICAgICAgcm93U2VsZWN0PXtyb3dTZWxlY3R9XG4gICAgICAgICAgICAgICAgICAgICAgc2V0SG92ZXJJbmRleD17c2V0SG92ZXJJbmRleH1cbiAgICAgICAgICAgICAgICAgICAgICBob3ZlckluZGV4PXtob3ZlckluZGV4fVxuICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXM9e3NlbGVjdGVkSXRlbXN9XG4gICAgICAgICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRJdGVtcz17c2V0U2VsZWN0ZWRJdGVtc31cbiAgICAgICAgICAgICAgICAgICAgICBtaW5Sb3dzPXtwYWdlU2l6ZX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17c3R5bGVzLnRhYmxlRm9vdGVyfT5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPXtzdHlsZXMucGFnaW5hdGlvblJvd30+XG4gICAgICAgICAgICAgICAgICAgIDxQYWdpbmF0aW9uIHNpemU9XCJzbVwiPlxuICAgICAgICAgICAgICAgICAgICAgIDxQYWdpbmF0aW9uLlByZXZcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldFBhZ2UoKHApID0+IE1hdGgubWF4KDEsIHAgLSAxKSl9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17cGFnZSA8PSAxfVxuICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAge3BhZ2VCdXR0b25zfVxuICAgICAgICAgICAgICAgICAgICAgIDxQYWdpbmF0aW9uLk5leHRcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldFBhZ2UoKHApID0+IHAgKyAxKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXshaGFzTmV4dFBhZ2V9XG4gICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9QYWdpbmF0aW9uPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8Rm9ybSBjbGFzc05hbWU9e3N0eWxlcy5zZWFyY2hSb3d9PlxuICAgICAgICAgICAgICAgICAgICA8Rm9ybUNvbnRyb2xcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlPXtzaG93TGlzdFNlYXJjaH1cbiAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlYXJjaFwiXG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtzdHlsZXMuc2VhcmNoSW5wdXR9XG4gICAgICAgICAgICAgICAgICAgICAgYXJpYS1sYWJlbD1cIlNlYXJjaFwiXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e3NlYXJjaH1cbiAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17c2VhcmNoQ2hhbmdlSGFuZGxlcn1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPE5hdkRyb3Bkb3duXG4gICAgICAgICAgICAgICAgICAgICAgdGl0bGU9e3NlbGVjdH1cbiAgICAgICAgICAgICAgICAgICAgICBpZD1cImNvbGxhc2libGUtbmF2LWRyb3Bkb3duXCJcbiAgICAgICAgICAgICAgICAgICAgICBzaG93PXtzaG93TGlzdH1cbiAgICAgICAgICAgICAgICAgICAgICBvbk1vdXNlRW50ZXI9eygpID0+IHNldFNob3dMaXN0KHRydWUpfVxuICAgICAgICAgICAgICAgICAgICAgIG9uTW91c2VMZWF2ZT17KCkgPT4gc2V0U2hvd0xpc3QoZmFsc2UpfVxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLnNlYXJjaFNlbGVjdH1cbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIDxOYXZEcm9wZG93bi5JdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdChcIk5hbWVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNob3dMaXN0U2VhcmNoKFwidGV4dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgTmFtZVxuICAgICAgICAgICAgICAgICAgICAgIDwvTmF2RHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgICAgICAgICAgICA8TmF2RHJvcGRvd24uSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTZWxlY3QoXCJEYXRlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTaG93TGlzdFNlYXJjaChcImRhdGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIERhdGVcbiAgICAgICAgICAgICAgICAgICAgICA8L05hdkRyb3Bkb3duLkl0ZW0+XG4gICAgICAgICAgICAgICAgICAgICAgPE5hdkRyb3Bkb3duLkl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2VsZWN0KFwiV29yayBPcmRlclwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2hvd0xpc3RTZWFyY2goXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICBXb3JrIE9yZGVyXG4gICAgICAgICAgICAgICAgICAgICAgPC9OYXZEcm9wZG93bi5JdGVtPlxuICAgICAgICAgICAgICAgICAgICAgIDxOYXZEcm9wZG93bi5JdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdChcIlByb2R1Y3QgTnVtYmVyXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTaG93TGlzdFNlYXJjaChcInRleHRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgIFByb2R1Y3QgTnVtYmVyXG4gICAgICAgICAgICAgICAgICAgICAgPC9OYXZEcm9wZG93bi5JdGVtPlxuICAgICAgICAgICAgICAgICAgICAgIDxOYXZEcm9wZG93bi5JdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNlbGVjdChcIlNlcmlhbCBOdW1iZXJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNob3dMaXN0U2VhcmNoKFwidGV4dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgU2VyaWFsIE51bWJlclxuICAgICAgICAgICAgICAgICAgICAgIDwvTmF2RHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgICAgICAgICAgICA8TmF2RHJvcGRvd24uSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTZWxlY3QoXCJEZXNjcmlwdGlvblwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2hvd0xpc3RTZWFyY2goXCJ0ZXh0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgICAgICAgIDwvTmF2RHJvcGRvd24uSXRlbT5cbiAgICAgICAgICAgICAgICAgICAgICA8TmF2RHJvcGRvd24uSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRTZWxlY3QoXCJTS1VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNldFNob3dMaXN0U2VhcmNoKFwidGV4dFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgICAgU0tVXG4gICAgICAgICAgICAgICAgICAgICAgPC9OYXZEcm9wZG93bi5JdGVtPlxuICAgICAgICAgICAgICAgICAgICA8L05hdkRyb3Bkb3duPlxuICAgICAgICAgICAgICAgICAgPC9Gb3JtPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3N0eWxlcy5mb290ZXJBY3Rpb25zfT5cbiAgICAgICAgICAgICAgICAgICAgPExvYWRpbmdCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgICAgICAgICBuYW1lPVwiQWRkIE5ldyBJdGVtXCJcbiAgICAgICAgICAgICAgICAgICAgICByb3V0ZT1cIk5ld1NlYXJjaC9BZGRJdGVtL05ld0l0ZW1cIlxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17c3R5bGVzLmFjdGlvbkJ1dHRvbn1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPExvYWRpbmdCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgICAgICAgbmFtZT1cIkJhY2tcIlxuICAgICAgICAgICAgICAgICAgICAgIHJvdXRlPVwiV2FyZWhvdXNlZGIvV2FyZWhvdXNlU2VsZWN0XCJcbiAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e3N0eWxlcy5hY3Rpb25CdXR0b259XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L21haW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxPZmZjYW52YXNcbiAgICAgICAgICBzaG93PXtzaG93RmlsdGVyc31cbiAgICAgICAgICBvbkhpZGU9eygpID0+IHNldFNob3dGaWx0ZXJzKGZhbHNlKX1cbiAgICAgICAgICBwbGFjZW1lbnQ9XCJzdGFydFwiXG4gICAgICAgICAgY2xhc3NOYW1lPXtzdHlsZXMuZmlsdGVyc0RyYXdlcn1cbiAgICAgICAgICBzY3JvbGxcbiAgICAgICAgICBiYWNrZHJvcFxuICAgICAgICA+XG4gICAgICAgICAgPE9mZmNhbnZhcy5IZWFkZXIgY2xvc2VCdXR0b24+XG4gICAgICAgICAgICA8T2ZmY2FudmFzLlRpdGxlPkZpbHRlcnM8L09mZmNhbnZhcy5UaXRsZT5cbiAgICAgICAgICA8L09mZmNhbnZhcy5IZWFkZXI+XG4gICAgICAgICAgPE9mZmNhbnZhcy5Cb2R5PntyZW5kZXJGaWx0ZXJzKFwiZHJhd2VyXCIpfTwvT2ZmY2FudmFzLkJvZHk+XG4gICAgICAgIDwvT2ZmY2FudmFzPlxuICAgICAgPC9kaXY+XG4gICAgPC9Mb2dnZWRJbj5cbiAgKTtcblxyXG5cclxufVxyXG5cclxuIl19 */\\n/*@ sourceURL=C:\\\\\\\\Users\\\\\\\\mack2\\\\\\\\Desktop\\\\\\\\code\\\\\\\\pages\\\\\\\\NewSearch\\\\\\\\mainSearch.js */\")) : loadError ? __jsx(\"div\", {\n    className: styles.errorState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1385,\n      columnNumber: 21\n    }\n  }, __jsx(\"div\", {\n    className: styles.errorTitle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1386,\n      columnNumber: 23\n    }\n  }, \"Load failed (\", loadError.code, \")\"), __jsx(\"div\", {\n    className: styles.errorMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1389,\n      columnNumber: 23\n    }\n  }, loadError.message), __jsx(Button, {\n    variant: \"outline-secondary\",\n    size: \"sm\",\n    onClick: function onClick() {\n      resetPagination();\n      setQueryEpoch(function (v) {\n        return v + 1;\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1390,\n      columnNumber: 23\n    }\n  }, \"Retry\")) : __jsx(PartTable, {\n    info: info,\n    labels: labels,\n    ids: ids,\n    hoverStyle: hoverStyle,\n    sortCheckAll: sortCheckAll,\n    checkDelete: checkDelete,\n    isDeleting: isDeleting,\n    rowSelect: rowSelect,\n    setHoverIndex: setHoverIndex,\n    hoverIndex: hoverIndex,\n    selectedItems: selectedItems,\n    setSelectedItems: setSelectedItems,\n    minRows: pageSize,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1402,\n      columnNumber: 21\n    }\n  })), __jsx(\"div\", {\n    className: styles.tableFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1420,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.paginationRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1421,\n      columnNumber: 19\n    }\n  }, __jsx(Pagination, {\n    size: \"sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1422,\n      columnNumber: 21\n    }\n  }, __jsx(Pagination.Prev, {\n    onClick: function onClick() {\n      return setPage(function (p) {\n        return Math.max(1, p - 1);\n      });\n    },\n    disabled: page <= 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1423,\n      columnNumber: 23\n    }\n  }), pageButtons, __jsx(Pagination.Next, {\n    onClick: function onClick() {\n      return setPage(function (p) {\n        return p + 1;\n      });\n    },\n    disabled: !hasNextPage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1428,\n      columnNumber: 23\n    }\n  }))), __jsx(Form, {\n    className: styles.searchRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1434,\n      columnNumber: 19\n    }\n  }, __jsx(FormControl, {\n    type: showListSearch,\n    placeholder: \"Search\",\n    className: styles.searchInput,\n    \"aria-label\": \"Search\",\n    value: search,\n    onChange: searchChangeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1435,\n      columnNumber: 21\n    }\n  }), __jsx(NavDropdown, {\n    title: select,\n    id: \"collasible-nav-dropdown\",\n    show: showList,\n    onMouseEnter: function onMouseEnter() {\n      return setShowList(true);\n    },\n    onMouseLeave: function onMouseLeave() {\n      return setShowList(false);\n    },\n    className: styles.searchSelect,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1443,\n      columnNumber: 21\n    }\n  }, __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Name\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1451,\n      columnNumber: 23\n    }\n  }, \"Name\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Date\");\n      setShowListSearch(\"date\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1459,\n      columnNumber: 23\n    }\n  }, \"Date\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Work Order\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1467,\n      columnNumber: 23\n    }\n  }, \"Work Order\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Product Number\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1475,\n      columnNumber: 23\n    }\n  }, \"Product Number\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Serial Number\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1483,\n      columnNumber: 23\n    }\n  }, \"Serial Number\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Description\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1491,\n      columnNumber: 23\n    }\n  }, \"Description\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"SKU\");\n      setShowListSearch(\"text\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1499,\n      columnNumber: 23\n    }\n  }, \"SKU\"))), __jsx(\"div\", {\n    className: styles.footerActions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1509,\n      columnNumber: 19\n    }\n  }, __jsx(LoadingButton, {\n    type: \"secondary\",\n    name: \"Add New Item\",\n    route: \"NewSearch/AddItem/NewItem\",\n    className: styles.actionButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1510,\n      columnNumber: 21\n    }\n  }), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"Warehousedb/WarehouseSelect\",\n    className: styles.actionButton,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1516,\n      columnNumber: 21\n    }\n  }))))))), __jsx(Offcanvas, {\n    show: showFilters,\n    onHide: function onHide() {\n      return setShowFilters(false);\n    },\n    placement: \"start\",\n    className: styles.filtersDrawer,\n    scroll: true,\n    backdrop: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1529,\n      columnNumber: 9\n    }\n  }, __jsx(Offcanvas.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1537,\n      columnNumber: 11\n    }\n  }, __jsx(Offcanvas.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1538,\n      columnNumber: 13\n    }\n  }, \"Filters\")), __jsx(Offcanvas.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 1540,\n      columnNumber: 11\n    }\n  }, renderFilters(\"drawer\")))));\n}\n\n_s2(MainSearch, \"0T9KFScZbXKuLBIxsu6T62kb0e0=\", false, function () {\n  return [useAuth, useRouter];\n});\n\n_c2 = MainSearch;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"LoadingButton\");\n$RefreshReg$(_c2, \"MainSearch\");","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/mainSearch.js"],"names":["React","useEffect","useState","useRef","useCallback","InputGroup","Dropdown","FormControl","Button","NavDropdown","Form","Modal","Spinner","Pagination","Offcanvas","Link","useRouter","fetchPartsWithMachineDataPage","fetchClients","fetchModels","useAuth","LoggedIn","ClientTable","ModelTable","PartTable","styles","firebase","buildNameTokens","SOCAL_CLIENT_ID","NORCAL_CLIENT_ID","UNASSIGNED_CLIENT_ID","DEFAULT_PAGE_SIZE","simulateNetworkRequest","Promise","resolve","setTimeout","LoadingButton","type","name","route","className","isLoading","setLoading","cancelled","then","toTime","value","seconds","Date","t","getTime","isNaN","iso","parse","parts","split","length","mm","dd","yyyy","alt","toYMD","d","getFullYear","String","getMonth","padStart","getDate","normalizeText","toLowerCase","trim","getMachineField","item","key","lower","machineData","currentMachineData","theMachineData","TheMachine","MainSearch","signOut","info","setInfo","backupInfo","setBackupInfo","augmentedInfo","setAugmentedInfo","setIsLoading","ids","setID","show","setShow","showFilters","setShowFilters","pageSize","setPageSize","dItem","setDItem","select","setSelect","showList","setShowList","showListSearch","setShowListSearch","search","setSearch","selectedOEM","setSelectedOEM","selectedModality","setSelectedModality","selectedClientFrom","setSelectedClientFrom","clientFromButtonText","setClientFromButtonText","selectedClientCurrent","setSelectedClientCurrent","clientCurrentButtonText","setClientCurrentButtonText","clients","setClients","showClientModal","setShowClientModal","clientSelectionType","setClientSelectionType","router","labelBase","labelBaseNames","sortCheckBase","withSortIcon","baseLabels","activeIndex","isDesc","map","text","i","arrow","labels","setLabels","sortCheck","setSortCheck","hoverIndex","setHoverIndex","selectedModel","setSelectedModel","gPos","setGPos","gIde","setGIde","isDeleting","setIsDeleting","page","setPage","pageCursors","setPageCursors","hasNextPage","setHasNextPage","fetchSeq","backfillInFlight","queryEpoch","setQueryEpoch","loadError","setLoadError","tableBodyRef","rowHeightRef","headerHeightRef","LOAD_TIMEOUT_MS","startNameTokenBackfill","reason","current","lastRun","window","localStorage","getItem","now","Number","db","firestore","lastDoc","tokensEqual","a","b","setA","Set","setB","size","v","has","query","collection","orderBy","FieldPath","documentId","limit","startAfter","get","snap","empty","batch","writes","docs","forEach","doc","data","nameLower","nameTokens","existingTokens","Array","isArray","from","needsUpdate","update","ref","commit","setItem","console","error","searchLower","hasActiveFilters","Boolean","valueMatches","s","some","includes","matchesFilters","visible","OEM","Modality","Model","clientFromId","clientCurrentId","wantedDay","itemYMD","date","descriptions","workOrders","w","wo","workOrder","pn","sn","desc","description","id","localSN","local_sn","resetPagination","asPath","fetchData","requestedPage","seq","timedOut","timeoutId","code","message","Math","round","inputText","selectedType","startAfterDoc","clearTimeout","effectiveSelect","effectiveSearch","effectiveSearchLower","load","attempt","visibleOnly","filterFn","raw","needsMachineData","r","pow","nextPage","hasNameSearch","prev","next","setSelectedItems","augmented","ClientFrom","ClientCurrent","filter","searchChangeHandler","event","target","base","sortCheckAll","pos","nextSortCheck","sortedInfo","sort","ta","tb","av","toString","bv","localeCompare","an","bn","rowSelect","log","push","selectedItems","showDeleteModal","setShowDeleteModal","handleSelectItem","x","handleShowDeleteModal","handleCloseDeleteModal","handleDeleteSelected","itemId","deleteFromStorage","handleClose","handleShow","checkDelete","idsToDelete","preventDefault","stopPropagation","hoverStyle","index","backgroundColor","textAlign","cursor","dropdown1Text","setDropdown1Text","dropdown2Text","setDropdown2Text","handleSelect1","eventKey","textContent","handleSelect2","buildClientsFromItems","filtered","it","add","out","idArray","chunk","slice","where","handleClientClick","safeClients","clientsData","derived","setClientSearchTerm","handleClientSelect","clientId","clientSnap","exists","clientData","handleClientInfo","clientName","handleClearClientSelection","models","setModels","showModelModal","setShowModelModal","modelButtonText","setModelButtonText","handleModelClick","modelsData","setModelSearchTerm","handleModelSelect","modelName","handleClearModelSelection","handleSoCalWarehouseClick","handleNorCalWarehouseClick","handleWarehouseUnassignedClick","clientSearchTerm","modelSearchTerm","storageRef","storage","folderRef","child","listAll","listResult","deletePromises","items","all","deleteFromPartsCollection","totalKnownPages","max","pageButtons","buttons","maxVisible","pushPage","p","pushEllipsis","windowSize","start","end","min","desiredWindow","currentWindow","remaining","recalcPageSize","containerHeight","getBoundingClientRect","height","headerRow","querySelector","bodyRow","h","verticalPadding","available","estimated","floor","clamped","onResize","addEventListener","removeEventListener","renderFilters","idPrefix","filtersPanel","filtersHeader","filtersTitle","filtersSubtitle","filtersBadge","filterSection","filterSectionTitle","inputGroup","inputButton","buttonGroup","flexButton","loadingOverlay","spinnerCenter","e","client","model","pageInner","header","headerLeft","burger","brand","brandLogo","brandName","brandSub","headerRight","headerStatus","content","sidebar","main","tableCard","tableHeader","tableTitle","tableSubtitle","tableMeta","tableBody","loadingState","loadingLogo","loadingText","errorState","errorTitle","errorMessage","tableFooter","paginationRow","searchRow","searchInput","searchSelect","footerActions","actionButton","filtersDrawer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,EAAqCC,MAArC,EAA6CC,WAA7C,QAAgE,OAAhE;AACA,SACEC,UADF,EAEEC,QAFF,EAGEC,WAHF,EAIEC,MAJF,EAKEC,WALF,EAMEC,IANF,EAOEC,KAPF,EAQEC,OARF,EASEC,UATF,EAUEC,SAVF,QAWO,iBAXP;AAYA,OAAOC,IAAP,MAAiB,WAAjB;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SACEC,6BADF,EAEEC,YAFF,EAGEC,WAHF,QAIO,+BAJP;AAKA,SAASC,OAAT,QAAwB,+BAAxB;AACA,OAAOC,QAAP,MAAqB,aAArB;AACA,OAAOC,WAAP,MAAwB,yBAAxB;AACA,OAAOC,UAAP,MAAuB,wBAAvB;AACA,OAAOC,SAAP,MAAsB,uBAAtB;AACA,OAAOC,MAAP,MAAmB,oCAAnB;AACA,OAAOC,QAAP,MAAqB,wBAArB;AACA,SAASC,eAAT,QAAgC,4BAAhC,C,CAEA;;AACA,IAAMC,eAAe,GAAG,UAAxB;AACA,IAAMC,gBAAgB,GAAG,UAAzB;AACA,IAAMC,oBAAoB,GAAG,UAA7B;AACA,IAAMC,iBAAiB,GAAG,EAA1B,C,CAGA;;AACA,SAASC,sBAAT,GAAkC;AAChC,SAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD;AAAA,WAAaC,UAAU,CAACD,OAAD,EAAU,IAAV,CAAvB;AAAA,GAAZ,CAAP;AACD,C,CAED;;;AACA,SAASE,aAAT,OAAyD;AAAA;;AAAA,MAAhCC,IAAgC,QAAhCA,IAAgC;AAAA,MAA1BC,IAA0B,QAA1BA,IAA0B;AAAA,MAApBC,KAAoB,QAApBA,KAAoB;AAAA,MAAbC,SAAa,QAAbA,SAAa;;AAAA,kBACvBtC,QAAQ,CAAC,KAAD,CADe;AAAA,MAChDuC,SADgD;AAAA,MACrCC,UADqC;;AAGvDzC,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIwC,SAAJ,EAAe;AACb,UAAIE,SAAS,GAAG,KAAhB;AACAX,MAAAA,sBAAsB,GAAGY,IAAzB,CAA8B,YAAM;AAClC,YAAI,CAACD,SAAL,EAAgBD,UAAU,CAAC,KAAD,CAAV;AACjB,OAFD;AAGA,aAAO,YAAM;AACXC,QAAAA,SAAS,GAAG,IAAZ;AACD,OAFD;AAGD;AACF,GAVQ,EAUN,CAACF,SAAD,CAVM,CAAT;AAYA,SACE,MAAC,IAAD;AAAM,IAAA,IAAI,aAAMF,KAAN,CAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,SAAS,oBAAaF,IAAb,cAAqBG,SAAS,IAAI,EAAlC,CADX;AAEE,IAAA,QAAQ,EAAEC,SAFZ;AAGE,IAAA,OAAO,EAAE;AAAA,aAAM,CAACA,SAAD,IAAcC,UAAU,CAAC,IAAD,CAA9B;AAAA,KAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKGD,SAAS,GAAG,UAAH,GAAgBH,IAL5B,CADF,CADF;AAWD,C,CAED;AAEA;;;GA9BSF,a;;KAAAA,a;;AA+BT,SAASS,MAAT,CAAgBC,KAAhB,EAAuB;AACrB,MAAI,CAACA,KAAL,EAAY,OAAO,IAAP,CADS,CAGrB;;AACA,MAAI,OAAOA,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,KAAK,IAAvC,IAA+CA,KAAK,CAACC,OAAN,IAAiB,IAApE,EAA0E;AACxE,QAAI;AAAE,aAAOD,KAAK,CAACC,OAAN,GAAgB,IAAvB;AAA8B,KAApC,CAAqC,gBAAM;AAAE;AAAc;AAC5D,GANoB,CAQrB;;;AACA,MAAID,KAAK,YAAYE,IAArB,EAA2B;AACzB,QAAMC,EAAC,GAAGH,KAAK,CAACI,OAAN,EAAV;;AACA,WAAOC,KAAK,CAACF,EAAD,CAAL,GAAW,IAAX,GAAkBA,EAAzB;AACD,GAZoB,CAcrB;;;AACA,MAAI,OAAOH,KAAP,KAAiB,QAArB,EAA+B;AAC7B;AACA,QAAMM,GAAG,GAAGJ,IAAI,CAACK,KAAL,CAAWP,KAAX,CAAZ;AACA,QAAI,CAACK,KAAK,CAACC,GAAD,CAAV,EAAiB,OAAOA,GAAP,CAHY,CAK7B;;AACA,QAAME,KAAK,GAAGR,KAAK,CAACS,KAAN,CAAY,GAAZ,CAAd;;AACA,QAAID,KAAK,CAACE,MAAN,KAAiB,CAArB,EAAwB;AAAA,kCACCF,KADD;AAAA,UACfG,EADe;AAAA,UACXC,EADW;AAAA,UACPC,IADO;;AAEtB,UAAMC,GAAG,GAAGZ,IAAI,CAACK,KAAL,WAAcM,IAAd,cAAsBF,EAAtB,cAA4BC,EAA5B,EAAZ;AACA,UAAI,CAACP,KAAK,CAACS,GAAD,CAAV,EAAiB,OAAOA,GAAP;AAClB;AACF,GA3BoB,CA6BrB;;;AACA,MAAMX,CAAC,GAAGD,IAAI,CAACK,KAAL,CAAWP,KAAX,CAAV;AACA,SAAOK,KAAK,CAACF,CAAD,CAAL,GAAW,IAAX,GAAkBA,CAAzB;AACD,C,CAED;;;AACA,SAASY,KAAT,CAAef,KAAf,EAAsB;AACpB,MAAMG,CAAC,GAAGJ,MAAM,CAACC,KAAD,CAAhB;AACA,MAAIG,CAAC,IAAI,IAAT,EAAe,OAAO,IAAP;AACf,MAAMa,CAAC,GAAG,IAAId,IAAJ,CAASC,CAAT,CAAV;AACA,MAAMU,IAAI,GAAGG,CAAC,CAACC,WAAF,EAAb;AACA,MAAMN,EAAE,GAAGO,MAAM,CAACF,CAAC,CAACG,QAAF,KAAe,CAAhB,CAAN,CAAyBC,QAAzB,CAAkC,CAAlC,EAAqC,GAArC,CAAX;AACA,MAAMR,EAAE,GAAGM,MAAM,CAACF,CAAC,CAACK,OAAF,EAAD,CAAN,CAAoBD,QAApB,CAA6B,CAA7B,EAAgC,GAAhC,CAAX;AACA,mBAAUP,IAAV,cAAkBF,EAAlB,cAAwBC,EAAxB;AACD;;AAED,SAASU,aAAT,CAAuBtB,KAAvB,EAA8B;AAC5B,MAAIA,KAAK,IAAI,IAAb,EAAmB,OAAO,EAAP;AACnB,SAAOkB,MAAM,CAAClB,KAAD,CAAN,CAAcuB,WAAd,GAA4BC,IAA5B,EAAP;AACD;;AAED,SAASC,eAAT,CAAyBC,IAAzB,EAA+BC,GAA/B,EAAoC;AAAA;;AAClC,MAAI,CAACD,IAAL,EAAW,OAAO,IAAP;AACX,MAAME,KAAK,GAAGD,GAAG,CAACJ,WAAJ,EAAd;AACA,iGACEG,IADF,aACEA,IADF,4CACEA,IAAI,CAAEG,WADR,sDACE,kBAAoBF,GAApB,CADF,yEAEED,IAFF,aAEEA,IAFF,6CAEEA,IAAI,CAAEG,WAFR,uDAEE,mBAAoBD,KAApB,CAFF,yCAGEF,IAHF,aAGEA,IAHF,gDAGEA,IAAI,CAAEI,kBAHR,0DAGE,sBAA2BH,GAA3B,CAHF,yCAIED,IAJF,aAIEA,IAJF,iDAIEA,IAAI,CAAEI,kBAJR,2DAIE,uBAA2BF,KAA3B,CAJF,yCAKEF,IALF,aAKEA,IALF,+CAKEA,IAAI,CAAEK,cALR,yDAKE,qBAAuBJ,GAAvB,CALF,yCAMED,IANF,aAMEA,IANF,gDAMEA,IAAI,CAAEK,cANR,0DAME,sBAAuBH,KAAvB,CANF,yCAOEF,IAPF,aAOEA,IAPF,2CAOEA,IAAI,CAAEM,UAPR,qDAOE,iBAAmBL,GAAnB,CAPF,yCAQED,IARF,aAQEA,IARF,4CAQEA,IAAI,CAAEM,UARR,sDAQE,kBAAmBJ,KAAnB,CARF,yCASE,IATF;AAWD;;AAGD,eAAe,SAASK,UAAT,GAAsB;AAAA;;AAAA;;AAAA,iBACf3D,OAAO,EADQ;AAAA,MAC3B4D,OAD2B,YAC3BA,OAD2B;;AAAA,mBAEX9E,QAAQ,CAAC,EAAD,CAFG;AAAA,MAE5B+E,IAF4B;AAAA,MAEtBC,OAFsB;;AAAA,mBAGChF,QAAQ,CAAC,EAAD,CAHT;AAAA,MAG5BiF,UAH4B;AAAA,MAGhBC,aAHgB;;AAAA,mBAIOlF,QAAQ,CAAC,EAAD,CAJf;AAAA,MAI5BmF,aAJ4B;AAAA,MAIbC,gBAJa,kBAIqB;;;AAJrB,mBAKDpF,QAAQ,CAAC,IAAD,CALP;AAAA,MAK5BuC,SAL4B;AAAA,MAKjB8C,YALiB;;AAAA,mBAMdrF,QAAQ,CAAC,EAAD,CANM;AAAA,MAM5BsF,GAN4B;AAAA,MAMvBC,KANuB;;AAAA,mBAOXvF,QAAQ,CAAC,KAAD,CAPG;AAAA,MAO5BwF,IAP4B;AAAA,MAOtBC,OAPsB;;AAAA,mBAQGzF,QAAQ,CAAC,KAAD,CARX;AAAA,MAQ5B0F,WAR4B;AAAA,MAQfC,cARe;;AAAA,mBASH3F,QAAQ,CAAC6B,iBAAD,CATL;AAAA,MAS5B+D,QAT4B;AAAA,MASlBC,WATkB;;AAAA,oBAUT7F,QAAQ,EAVC;AAAA,MAU5B8F,KAV4B;AAAA,MAUrBC,QAVqB;;AAAA,oBAWP/F,QAAQ,CAAC,MAAD,CAXD;AAAA,MAW5BgG,MAX4B;AAAA,MAWpBC,SAXoB;;AAAA,oBAYHjG,QAAQ,CAAC,KAAD,CAZL;AAAA,MAY5BkG,QAZ4B;AAAA,MAYlBC,WAZkB;;AAAA,oBAaSnG,QAAQ,CAAC,MAAD,CAbjB;AAAA,MAa5BoG,cAb4B;AAAA,MAaZC,iBAbY;;AAAA,oBAcPrG,QAAQ,CAAC,EAAD,CAdD;AAAA,MAc5BsG,MAd4B;AAAA,MAcpBC,SAdoB;;AAAA,oBAeGvG,QAAQ,CAAC,IAAD,CAfX;AAAA,MAe5BwG,WAf4B;AAAA,MAefC,cAfe;;AAAA,oBAgBazG,QAAQ,CAAC,IAAD,CAhBrB;AAAA,MAgB5B0G,gBAhB4B;AAAA,MAgBVC,mBAhBU,mBAiBnC;;;AAjBmC,oBAkBiB3G,QAAQ,CAAC,IAAD,CAlBzB;AAAA,MAkB5B4G,kBAlB4B;AAAA,MAkBRC,qBAlBQ;;AAAA,oBAmBqB7G,QAAQ,CAAC,eAAD,CAnB7B;AAAA,MAmB5B8G,oBAnB4B;AAAA,MAmBNC,uBAnBM;;AAAA,oBAoBuB/G,QAAQ,CAAC,IAAD,CApB/B;AAAA,MAoB5BgH,qBApB4B;AAAA,MAoBLC,wBApBK;;AAAA,oBAqB2BjH,QAAQ,CAAC,eAAD,CArBnC;AAAA,MAqB5BkH,uBArB4B;AAAA,MAqBHC,0BArBG;;AAAA,oBAuBLnH,QAAQ,CAAC,EAAD,CAvBH;AAAA,MAuB5BoH,OAvB4B;AAAA,MAuBnBC,UAvBmB;;AAAA,oBAwBWrH,QAAQ,CAAC,KAAD,CAxBnB;AAAA,MAwB5BsH,eAxB4B;AAAA,MAwBXC,kBAxBW,mBAyBnC;;;AAzBmC,oBA0BmBvH,QAAQ,CAAC,IAAD,CA1B3B;AAAA,MA0B5BwH,mBA1B4B;AAAA,MA0BPC,sBA1BO;;AA4BnC,MAAMC,MAAM,GAAG5G,SAAS,EAAxB;AACA,MAAM6G,SAAS,GAAG,CAAC,MAAD,EAAS,MAAT,EAAiB,KAAjB,EAAwB,KAAxB,EAA+B,KAA/B,CAAlB;AACA,MAAMC,cAAc,GAAG,CAAC,MAAD,EAAS,MAAT,EAAiB,IAAjB,EAAuB,IAAvB,EAA6B,IAA7B,CAAvB;AACA,MAAMC,aAAa,GAAG,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,EAA6B,KAA7B,EAAoC,KAApC,CAAtB;;AAEA,WAASC,YAAT,CAAsBC,UAAtB,EAAkCC,WAAlC,EAA+CC,MAA/C,EAAuD;AACrD,WAAOF,UAAU,CAACG,GAAX,CAAe,UAACC,IAAD,EAAOC,CAAP,EAAa;AACjC,UAAIA,CAAC,KAAKJ,WAAV,EAAuB,OAAOG,IAAP,CADU,CACG;;AACpC,UAAME,KAAK,GAAGJ,MAAM,GAAG,IAAH,GAAU,IAA9B;AACA,uBAAUE,IAAV,SAAiBE,KAAjB;AACD,KAJM,CAAP;AAKD;;AAvCkC,oBA0CPrI,QAAQ,CAAC2H,SAAD,CA1CD;AAAA,MA0C5BW,MA1C4B;AAAA,MA0CpBC,SA1CoB;;AAAA,oBA2CDvI,QAAQ,CAAC6H,aAAD,CA3CP;AAAA,MA2C5BW,SA3C4B;AAAA,MA2CjBC,YA3CiB;;AAAA,oBA4CCzI,QAAQ,CAAC,IAAD,CA5CT;AAAA,MA4C5B0I,UA5C4B;AAAA,MA4ChBC,aA5CgB;;AAAA,oBA6CO3I,QAAQ,CAAC,IAAD,CA7Cf;AAAA,MA6C5B4I,aA7C4B;AAAA,MA6CbC,gBA7Ca;;AAAA,oBA8CX7I,QAAQ,CAAC,IAAD,CA9CG;AAAA,MA8C5B8I,IA9C4B;AAAA,MA8CtBC,OA9CsB;;AAAA,oBA+CX/I,QAAQ,CAAC,IAAD,CA/CG;AAAA,MA+C5BgJ,IA/C4B;AAAA,MA+CtBC,OA/CsB;;AAAA,oBAgDCjJ,QAAQ,CAAC,KAAD,CAhDT;AAAA,MAgD5BkJ,UAhD4B;AAAA,MAgDhBC,aAhDgB;;AAAA,oBAiDXnJ,QAAQ,CAAC,CAAD,CAjDG;AAAA,MAiD5BoJ,IAjD4B;AAAA,MAiDtBC,OAjDsB;;AAAA,oBAkDGrJ,QAAQ,CAAC,EAAD,CAlDX;AAAA,MAkD5BsJ,WAlD4B;AAAA,MAkDfC,cAlDe;;AAAA,oBAmDGvJ,QAAQ,CAAC,KAAD,CAnDX;AAAA,MAmD5BwJ,WAnD4B;AAAA,MAmDfC,cAnDe;;AAoDnC,MAAMC,QAAQ,GAAGzJ,MAAM,CAAC,CAAD,CAAvB;AACA,MAAM0J,gBAAgB,GAAG1J,MAAM,CAAC,KAAD,CAA/B;;AArDmC,oBAsDCD,QAAQ,CAAC,CAAD,CAtDT;AAAA,MAsD5B4J,UAtD4B;AAAA,MAsDhBC,aAtDgB;;AAAA,oBAuDD7J,QAAQ,CAAC,IAAD,CAvDP;AAAA,MAuD5B8J,SAvD4B;AAAA,MAuDjBC,YAvDiB;;AAwDnC,MAAMC,YAAY,GAAG/J,MAAM,CAAC,IAAD,CAA3B;AACA,MAAMgK,YAAY,GAAGhK,MAAM,CAAC,EAAD,CAA3B;AACA,MAAMiK,eAAe,GAAGjK,MAAM,CAAC,EAAD,CAA9B;AAEA,MAAMkK,eAAe,GAAG,KAAxB;AAEA,MAAMC,sBAAsB,GAAGlK,WAAW,wEAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAOmK,YAAAA,MAAP,8DAAgB,EAAhB;;AAAA,iBACrCV,gBAAgB,CAACW,OADoB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAGjCC,YAAAA,OAHiC,GAGvBC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,sBAA5B,CAHuB;;AAAA,kBAInCH,OAAO,IAAIzH,IAAI,CAAC6H,GAAL,KAAaC,MAAM,CAACL,OAAD,CAAnB,GAA+B,KAAK,EAAL,GAAU,EAAV,GAAe,IAJtB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AASzCZ,YAAAA,gBAAgB,CAACW,OAAjB,GAA2B,IAA3B;AACMO,YAAAA,EAVmC,GAU9BrJ,QAAQ,CAACsJ,SAAT,EAV8B;AAWrCC,YAAAA,OAXqC,GAW3B,IAX2B;;AAanCC,YAAAA,WAbmC,GAarB,SAAdA,WAAc,CAACC,CAAD,EAAIC,CAAJ,EAAU;AAC5B,kBAAID,CAAC,CAAC3H,MAAF,KAAa4H,CAAC,CAAC5H,MAAnB,EAA2B,OAAO,KAAP;AAC3B,kBAAM6H,IAAI,GAAG,IAAIC,GAAJ,CAAQH,CAAR,CAAb;AACA,kBAAMI,IAAI,GAAG,IAAID,GAAJ,CAAQF,CAAR,CAAb;AACA,kBAAIC,IAAI,CAACG,IAAL,KAAcD,IAAI,CAACC,IAAvB,EAA6B,OAAO,KAAP;;AAJD,yDAKZH,IALY;AAAA;;AAAA;AAK5B;AAAA,sBAAWI,CAAX;AAAsB,sBAAI,CAACF,IAAI,CAACG,GAAL,CAASD,CAAT,CAAL,EAAkB,OAAO,KAAP;AAAxC;AAL4B;AAAA;AAAA;AAAA;AAAA;;AAM5B,qBAAO,IAAP;AACD,aApBwC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwBjCE,sBAAAA,KAxBiC,GAwBzBZ,EAAE,CACXa,UADS,CACE,MADF,EAETC,OAFS,CAEDnK,QAAQ,CAACsJ,SAAT,CAAmBc,SAAnB,CAA6BC,UAA7B,EAFC,EAGTC,KAHS,CAGH,GAHG,CAxByB;AA4BrC,0BAAIf,OAAJ,EAAaU,KAAK,GAAGA,KAAK,CAACM,UAAN,CAAiBhB,OAAjB,CAAR;AA5BwB;AAAA,6BA8BlBU,KAAK,CAACO,GAAN,EA9BkB;;AAAA;AA8B/BC,sBAAAA,IA9B+B;;AAAA,2BA+BjCA,IAAI,CAACC,KA/B4B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAiC/BC,sBAAAA,KAjC+B,GAiCvBtB,EAAE,CAACsB,KAAH,EAjCuB;AAkCjCC,sBAAAA,MAlCiC,GAkCxB,CAlCwB;AAoCrCH,sBAAAA,IAAI,CAACI,IAAL,CAAUC,OAAV,CAAkB,UAACC,GAAD,EAAS;AACzB,4BAAMC,IAAI,GAAGD,GAAG,CAACC,IAAJ,MAAc,EAA3B;AACA,4BAAMpK,IAAI,GAAG,OAAOoK,IAAI,CAACpK,IAAZ,KAAqB,QAArB,GAAgCoK,IAAI,CAACpK,IAArC,GAA4C,EAAzD;AACA,4BAAMqK,SAAS,GAAGrK,IAAI,CAAC+B,WAAL,EAAlB;AACA,4BAAMuI,UAAU,GAAGjL,eAAe,CAACW,IAAD,CAAlC;AACA,4BAAMuK,cAAc,GAAGC,KAAK,CAACC,OAAN,CAAcL,IAAI,CAACE,UAAnB,IACnBE,KAAK,CAACE,IAAN,CAAW,IAAI1B,GAAJ,CAAQoB,IAAI,CAACE,UAAL,CAAgBxE,GAAhB,CAAoB,UAACqD,CAAD;AAAA,iCAAOzH,MAAM,CAACyH,CAAD,CAAb;AAAA,yBAApB,CAAR,CAAX,CADmB,GAEnB,EAFJ;AAIA,4BAAMwB,WAAW,GACfP,IAAI,CAACC,SAAL,KAAmBA,SAAnB,IACA,CAACzB,WAAW,CAAC2B,cAAD,EAAiBD,UAAjB,CAFd;;AAIA,4BAAIK,WAAJ,EAAiB;AACfZ,0BAAAA,KAAK,CAACa,MAAN,CAAaT,GAAG,CAACU,GAAjB,EAAsB;AAAER,4BAAAA,SAAS,EAATA,SAAF;AAAaC,4BAAAA,UAAU,EAAVA;AAAb,2BAAtB;AACAN,0BAAAA,MAAM,IAAI,CAAV;AACD;AACF,uBAjBD;;AApCqC,4BAuDjCA,MAAM,GAAG,CAvDwB;AAAA;AAAA;AAAA;;AAAA;AAAA,6BAwD7BD,KAAK,CAACe,MAAN,EAxD6B;;AAAA;AA2DrCnC,sBAAAA,OAAO,GAAGkB,IAAI,CAACI,IAAL,CAAUJ,IAAI,CAACI,IAAL,CAAU/I,MAAV,GAAmB,CAA7B,CAAV;AA3DqC;AAAA,6BA4D/B,IAAIvB,OAAJ,CAAY,UAACC,OAAD;AAAA,+BAAaC,UAAU,CAACD,OAAD,EAAU,EAAV,CAAvB;AAAA,uBAAZ,CA5D+B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,iBAuBhC,IAvBgC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AA+DvC,sBAAmC;AACjCwI,cAAAA,MAAM,CAACC,YAAP,CAAoB0C,OAApB,CACE,sBADF,EAEErJ,MAAM,CAAChB,IAAI,CAAC6H,GAAL,EAAD,CAFR;AAID;;AApEsC;AAAA;;AAAA;AAAA;AAAA;AAsEvCyC,YAAAA,OAAO,CAACC,KAAR,CAAc,6BAAd,EAA6ChD,MAA7C;;AAtEuC;AAAA;AAwEvCV,YAAAA,gBAAgB,CAACW,OAAjB,GAA2B,KAA3B;AAxEuC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAD,IA0EvC,EA1EuC,CAA1C;AA4EA,MAAMgD,WAAW,GAAG,CAAChH,MAAM,IAAI,EAAX,EAAenC,WAAf,GAA6BC,IAA7B,EAApB;AACA,MAAMmJ,gBAAgB,GACpBC,OAAO,CAAChH,WAAD,CAAP,IACAgH,OAAO,CAAC9G,gBAAD,CADP,IAEA8G,OAAO,CAAC5E,aAAD,CAFP,IAGA4E,OAAO,CAAC5G,kBAAD,CAHP,IAIA4G,OAAO,CAACxG,qBAAD,CAJP,IAKAwG,OAAO,CAACF,WAAD,CANT;;AAQA,MAAMG,YAAY,GAAG,SAAfA,YAAe,CAAC7K,KAAD,EAAQ8K,CAAR,EAAc;AACjC,QAAI,CAAC9K,KAAL,EAAY,OAAO,KAAP;;AACZ,QAAIgK,KAAK,CAACC,OAAN,CAAcjK,KAAd,CAAJ,EAA0B;AACxB,aAAOA,KAAK,CAAC+K,IAAN,CAAW,UAACpC,CAAD;AAAA,eAAOkC,YAAY,CAAClC,CAAD,EAAImC,CAAJ,CAAnB;AAAA,OAAX,CAAP;AACD;;AACD,WAAO5J,MAAM,CAAClB,KAAD,CAAN,CAAcuB,WAAd,GAA4ByJ,QAA5B,CAAqCF,CAArC,CAAP;AACD,GAND;;AAQA,MAAMG,cAAc,GAAG3N,WAAW,CAChC,UAACoE,IAAD,EAAU;AACR;AACA,QAAI,CAAAA,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEwJ,OAAN,MAAkB,KAAtB,EAA6B,OAAO,KAAP,CAFrB,CAIR;;AACA,QAAMC,GAAG,GAAG1J,eAAe,CAACC,IAAD,EAAO,KAAP,CAA3B;AACA,QAAM0J,QAAQ,GAAG3J,eAAe,CAACC,IAAD,EAAO,UAAP,CAAhC;AACA,QAAM2J,KAAK,GAAG5J,eAAe,CAACC,IAAD,EAAO,OAAP,CAA7B;;AAEA,QAAIkC,WAAW,IAAItC,aAAa,CAAC6J,GAAD,CAAb,KAAuB7J,aAAa,CAACsC,WAAD,CAAvD,EAAsE;AACpE,aAAO,KAAP;AACD;;AACD,QACEE,gBAAgB,IAChBxC,aAAa,CAAC8J,QAAD,CAAb,KAA4B9J,aAAa,CAACwC,gBAAD,CAF3C,EAGE;AACA,aAAO,KAAP;AACD;;AACD,QAAIkC,aAAa,IAAI1E,aAAa,CAAC+J,KAAD,CAAb,KAAyB/J,aAAa,CAAC0E,aAAD,CAA3D,EAA4E;AAC1E,aAAO,KAAP;AACD,KApBO,CAsBR;;;AACA,QAAIhC,kBAAkB,IAAI,CAAAtC,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAE4J,YAAN,MAAuBtH,kBAAjD,EAAqE;AACnE,aAAO,KAAP;AACD;;AACD,QACEI,qBAAqB,IACrB,CAAA1C,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAE6J,eAAN,MAA0BnH,qBAF5B,EAGE;AACA,aAAO,KAAP;AACD,KA/BO,CAiCR;;;AACA,QAAIsG,WAAJ,EAAiB;AACf,UAAItH,MAAM,KAAK,MAAf,EAAuB;AACrB,eAAOyH,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAElC,IAAP,EAAakL,WAAb,CAAnB;AACD;;AACD,UAAItH,MAAM,KAAK,MAAf,EAAuB;AACrB,YAAMoI,SAAS,GAAGd,WAAlB,CADqB,CACU;;AAC/B,YAAMe,OAAO,GAAG1K,KAAK,CAACW,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEgK,IAAP,CAArB;AACA,YAAID,OAAO,IAAIA,OAAO,KAAKD,SAA3B,EAAsC,OAAO,IAAP;;AACtC,YAAIxB,KAAK,CAACC,OAAN,CAAcvI,IAAd,aAAcA,IAAd,uBAAcA,IAAI,CAAEiK,YAApB,CAAJ,EAAuC;AACrC,cAAIjK,IAAI,CAACiK,YAAL,CAAkBZ,IAAlB,CAAuB,UAAC/J,CAAD;AAAA,mBAAOD,KAAK,CAACC,CAAD,aAACA,CAAD,uBAACA,CAAC,CAAE0K,IAAJ,CAAL,KAAmBF,SAA1B;AAAA,WAAvB,CAAJ,EAAiE;AAC/D,mBAAO,IAAP;AACD;AACF;;AACD,YAAIxB,KAAK,CAACC,OAAN,CAAcvI,IAAd,aAAcA,IAAd,uBAAcA,IAAI,CAAEkK,UAApB,CAAJ,EAAqC;AACnC,cAAIlK,IAAI,CAACkK,UAAL,CAAgBb,IAAhB,CAAqB,UAACc,CAAD;AAAA,mBAAO9K,KAAK,CAAC8K,CAAD,aAACA,CAAD,uBAACA,CAAC,CAAEH,IAAJ,CAAL,KAAmBF,SAA1B;AAAA,WAArB,CAAJ,EAA+D;AAC7D,mBAAO,IAAP;AACD;AACF;;AACD,eAAO,KAAP;AACD;;AACD,UAAIpI,MAAM,KAAK,YAAf,EAA6B;AAC3B,eACE4G,KAAK,CAACC,OAAN,CAAcvI,IAAd,aAAcA,IAAd,uBAAcA,IAAI,CAAEkK,UAApB,KACAlK,IAAI,CAACkK,UAAL,CAAgBb,IAAhB,CAAqB,UAACe,EAAD;AAAA,iBACnBjB,YAAY,CAACiB,EAAD,aAACA,EAAD,uBAACA,EAAE,CAAEC,SAAL,EAAgBrB,WAAhB,CADO;AAAA,SAArB,CAFF;AAMD;;AACD,UAAItH,MAAM,KAAK,gBAAf,EAAiC;AAC/B,eAAOyH,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEsK,EAAP,EAAWtB,WAAX,CAAnB;AACD;;AACD,UAAItH,MAAM,KAAK,eAAf,EAAgC;AAC9B,eAAOyH,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEuK,EAAP,EAAWvB,WAAX,CAAnB;AACD;;AACD,UAAItH,MAAM,KAAK,aAAf,EAA8B;AAC5B,YAAIyH,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEwK,IAAP,EAAaxB,WAAb,CAAhB,EAA2C,OAAO,IAAP;AAC3C,YAAIG,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAEyK,WAAP,EAAoBzB,WAApB,CAAhB,EAAkD,OAAO,IAAP;;AAClD,YAAIV,KAAK,CAACC,OAAN,CAAcvI,IAAd,aAAcA,IAAd,uBAAcA,IAAI,CAAEiK,YAApB,CAAJ,EAAuC;AACrC,iBAAOjK,IAAI,CAACiK,YAAL,CAAkBZ,IAAlB,CAAuB,UAAC/J,CAAD;AAAA,mBAC5B6J,YAAY,CAAC7J,CAAD,aAACA,CAAD,uBAACA,CAAC,CAAEmL,WAAJ,EAAiBzB,WAAjB,CADgB;AAAA,WAAvB,CAAP;AAGD;;AACD,eAAO,KAAP;AACD;;AACD,UAAItH,MAAM,KAAK,KAAf,EAAsB;AACpB,eACEyH,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAE0K,EAAP,EAAW1B,WAAX,CAAZ,IACAG,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAE2K,OAAP,EAAgB3B,WAAhB,CADZ,IAEAG,YAAY,CAACnJ,IAAD,aAACA,IAAD,uBAACA,IAAI,CAAE4K,QAAP,EAAiB5B,WAAjB,CAHd;AAKD;AACF;;AAED,WAAO,IAAP;AACD,GAzF+B,EA0FhC,CACE9G,WADF,EAEEE,gBAFF,EAGEkC,aAHF,EAIEhC,kBAJF,EAKEI,qBALF,EAMEsG,WANF,EAOEtH,MAPF,CA1FgC,CAAlC;;AAqGA,MAAMmJ,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC5B9F,IAAAA,OAAO,CAAC,CAAD,CAAP;AACAE,IAAAA,cAAc,CAAC,EAAD,CAAd;AACAE,IAAAA,cAAc,CAAC,KAAD,CAAd;AACD,GAJD,CAhQmC,CAsQnC;;;AACA1J,EAAAA,SAAS,CAAC,YAAM;AACdoP,IAAAA,eAAe;AACftF,IAAAA,aAAa,CAAC,UAAC0B,CAAD;AAAA,aAAOA,CAAC,GAAG,CAAX;AAAA,KAAD,CAAb;AACD,GAHQ,EAGN,CAAC7D,MAAM,CAAC0H,MAAR,CAHM,CAAT,CAvQmC,CA4QnC;;AACArP,EAAAA,SAAS,CAAC,YAAM;AACdoP,IAAAA,eAAe;AACftF,IAAAA,aAAa,CAAC,UAAC0B,CAAD;AAAA,aAAOA,CAAC,GAAG,CAAX;AAAA,KAAD,CAAb;AACD,GAHQ,EAGN,CACD/E,WADC,EAEDE,gBAFC,EAGDkC,aAHC,EAIDhC,kBAJC,EAKDI,qBALC,EAMDV,MANC,EAODN,MAPC,CAHM,CAAT,CA7QmC,CA2RnC;;AACAjG,EAAAA,SAAS,CAAC,YAAM;AACdsP,IAAAA,SAAS,CAACjG,IAAD,CAAT;AACD,GAFQ,EAEN,CAACA,IAAD,EAAOQ,UAAP,CAFM,CAAT;;AA5RmC,WAgSpByF,SAhSoB;AAAA;AAAA;;AAAA;AAAA,0EAgSnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAyBC,cAAAA,aAAzB,iEAAyC,CAAzC;AACQC,cAAAA,GADR,GACc,EAAE7F,QAAQ,CAACY,OADzB;AAEMkF,cAAAA,QAFN,GAEiB,KAFjB;AAGEnK,cAAAA,YAAY,CAAC,IAAD,CAAZ;AACA0E,cAAAA,YAAY,CAAC,IAAD,CAAZ;AACM0F,cAAAA,SALR,GAKoBxN,UAAU,CAAC,YAAM;AACjCuN,gBAAAA,QAAQ,GAAG,IAAX;;AACA,oBAAID,GAAG,KAAK7F,QAAQ,CAACY,OAArB,EAA8B;AAC5BP,kBAAAA,YAAY,CAAC;AACX2F,oBAAAA,IAAI,EAAE,SADK;AAEXC,oBAAAA,OAAO,0CAAmCC,IAAI,CAACC,KAAL,CACxC1F,eAAe,GAAG,IADsB,CAAnC;AAFI,mBAAD,CAAZ;AAMA9E,kBAAAA,YAAY,CAAC,KAAD,CAAZ;AACD;AACF,eAX2B,EAWzB8E,eAXyB,CAL9B;AAAA;;AAkBI,kBAAIzC,MAAM,CAAC+D,KAAP,CAAaqE,SAAb,IAA0BpI,MAAM,CAAC+D,KAAP,CAAasE,YAA3C,EAAyD;AACvD9J,gBAAAA,SAAS,CAACyB,MAAM,CAAC+D,KAAP,CAAasE,YAAd,CAAT;AACAxJ,gBAAAA,SAAS,CAACmB,MAAM,CAAC+D,KAAP,CAAaqE,SAAd,CAAT;AACD;;AACKE,cAAAA,aAtBV,GAuBMV,aAAa,GAAG,CAAhB,GAAoBhG,WAAW,CAACgG,aAAa,GAAG,CAAjB,CAA/B,GAAqD,IAvB3D;;AAAA,oBAwBQA,aAAa,GAAG,CAAhB,IAAqB,CAACU,aAxB9B;AAAA;AAAA;AAAA;;AAyBM3G,cAAAA,OAAO,CAAC,CAAD,CAAP;;AACA,kBAAIkG,GAAG,KAAK7F,QAAQ,CAACY,OAArB,EAA8B;AAC5B2F,gBAAAA,YAAY,CAACR,SAAD,CAAZ;AACApK,gBAAAA,YAAY,CAAC,KAAD,CAAZ;AACD;;AA7BP;;AAAA;AAgCU6K,cAAAA,eAhCV,GAgC4BxI,MAAM,CAAC+D,KAAP,CAAasE,YAAb,IAA6B/J,MAhCzD;AAiCUmK,cAAAA,eAjCV,GAiC4BzI,MAAM,CAAC+D,KAAP,CAAaqE,SAAb,IAA0BxJ,MAjCtD;AAkCU8J,cAAAA,oBAlCV,GAkCiC,CAACD,eAAe,IAAI,EAApB,EAC1BhM,WAD0B,GAE1BC,IAF0B,EAlCjC,EAsCI;;AACMiM,cAAAA,IAvCV;AAAA,sFAuCiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAOC,0BAAAA,OAAP,8DAAiB,CAAjB;AAAA;AAAA;AAAA,iCAEIvP,6BAA6B,CAAC;AACzC6E,4BAAAA,QAAQ,EAARA,QADyC;AAEzCoK,4BAAAA,aAAa,EAAbA,aAFyC;AAGzCO,4BAAAA,WAAW,EAAE,IAH4B;AAIzCC,4BAAAA,QAAQ,EAAEjD,gBAAgB,GAAGM,cAAH,GAAoB,IAJL;AAKzCvH,4BAAAA,MAAM,EAAE8J,oBAAoB,GACxB;AACEjO,8BAAAA,IAAI,EAAE+N,eADR;AAEEO,8BAAAA,GAAG,EAAEN,eAFP;AAGE3L,8BAAAA,KAAK,EAAE4L;AAHT,6BADwB,GAMxB,IAXqC;AAYzCM,4BAAAA,gBAAgB,EACdlD,OAAO,CAAChH,WAAD,CAAP,IACAgH,OAAO,CAAC9G,gBAAD,CADP,IAEA8G,OAAO,CAAC5E,aAAD,CAFP,IAGA4E,OAAO,CAAC5G,kBAAD,CAHP,IAIA4G,OAAO,CAACxG,qBAAD;AAjBgC,2BAAD,CAFjC;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,gCAsBLsJ,OAAO,IAAI,CAtBN;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA,iCAuBH,IAAIvO,OAAJ,CAAY,UAAA4O,CAAC;AAAA,mCAAI1O,UAAU,CAAC0O,CAAD,EAAI,MAAMf,IAAI,CAACgB,GAAL,CAAS,CAAT,EAAYN,OAAO,GAAG,CAAtB,CAAV,CAAd;AAAA,2BAAb,CAvBG;;AAAA;AAAA,4DAwBFD,IAAI,CAACC,OAAO,GAAG,CAAX,CAxBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAvCjB;;AAAA,gCAuCUD,IAvCV;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAkEkEA,IAAI,EAlEtE;;AAAA;AAAA;AAkEmB7D,cAAAA,IAlEnB,eAkEYpJ,KAlEZ;AAkEyB2H,cAAAA,OAlEzB,eAkEyBA,OAlEzB;AAkE+C8F,cAAAA,QAlE/C,eAkEkCrH,WAlElC;;AAAA,oBAmEQgG,QAAQ,IAAID,GAAG,KAAK7F,QAAQ,CAACY,OAnErC;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAoEUwG,cAAAA,aApEV,GAqEMtD,OAAO,CAAC4C,oBAAD,CAAP,IAAiCF,eAAe,KAAK,MArE3D;;AAsEI,kBACEY,aAAa,KACZtE,IAAI,CAAClJ,MAAL,KAAgB,CAAhB,IACCkJ,IAAI,CAACmB,IAAL,CACE,UAACrJ,IAAD;AAAA,uBACE,CAACsI,KAAK,CAACC,OAAN,CAAcvI,IAAd,aAAcA,IAAd,uBAAcA,IAAI,CAAEoI,UAApB,CAAD,IAAoCpI,IAAI,CAACoI,UAAL,CAAgBpJ,MAAhB,KAA2B,CADjE;AAAA,eADF,CAFW,CADf,EAOE;AACA8G,gBAAAA,sBAAsB,CAAC,aAAD,CAAtB;AACD;;AACD,kBAAIkF,aAAa,KAAK,CAAlB,IAAuB9C,IAAI,CAAClJ,MAAL,KAAgB,CAA3C,EAA8C;AAC5CiG,gBAAAA,cAAc,CAAC,EAAD,CAAd;AACAE,gBAAAA,cAAc,CAAC,KAAD,CAAd;AACD;;AACDvE,cAAAA,aAAa,CAACsH,IAAD,CAAb;AACAjE,cAAAA,SAAS,CAACZ,SAAD,CAAT,CArFJ,CAqF0B;;AACtBpC,cAAAA,KAAK,CAACiH,IAAI,CAACtE,GAAL,CAAS,UAAC5D,IAAD;AAAA,uBAAUA,IAAI,CAAC0K,EAAf;AAAA,eAAT,CAAD,CAAL;;AAtFJ,oBAuFQM,aAAa,GAAG,CAAhB,IAAqB9C,IAAI,CAAClJ,MAAL,KAAgB,CAvF7C;AAAA;AAAA;AAAA;;AAwFMmG,cAAAA,cAAc,CAAC,KAAD,CAAd;AACAJ,cAAAA,OAAO,CAAC,CAAD,CAAP;AAzFN;;AAAA;AA4FII,cAAAA,cAAc,CAACoH,QAAD,CAAd;AACAtH,cAAAA,cAAc,CAAC,UAACwH,IAAD,EAAU;AACvB,oBAAMC,IAAI,GAAG1B,aAAa,KAAK,CAAlB,GAAsB,EAAtB,sBAA+ByB,IAA/B,CAAb;;AACA,oBAAIhG,OAAJ,EAAa;AACXiG,kBAAAA,IAAI,CAAC1B,aAAa,GAAG,CAAjB,CAAJ,GAA0BvE,OAA1B;AACD;;AACD,uBAAOiG,IAAP;AACD,eANa,CAAd;AAOAC,cAAAA,gBAAgB,CAAC,EAAD,CAAhB,CApGJ,CAsGI;;AACMC,cAAAA,SAvGV,GAuGsB1E,IAAI,CAACtE,GAAL,CAAS,UAAC5D,IAAD;AAAA;;AAAA,uDACtBA,IADsB;AAEzB4J,kBAAAA,YAAY,4CACV5J,IADU,aACVA,IADU,uBACVA,IAAI,CAAE4J,YADI,mEAET,QAAO5J,IAAP,aAAOA,IAAP,uBAAOA,IAAI,CAAE6M,UAAb,MAA4B,QAA5B,GAAuC7M,IAAI,CAAC6M,UAA5C,GAAyD,IAFhD,2CAGV7M,IAHU,aAGVA,IAHU,2CAGVA,IAAI,CAAE6M,UAHI,qDAGV,iBAAkBnC,EAHR,2CAIV,IANuB;AAOzBb,kBAAAA,eAAe,+CACb7J,IADa,aACbA,IADa,uBACbA,IAAI,CAAE6J,eADO,yEAEZ,QAAO7J,IAAP,aAAOA,IAAP,uBAAOA,IAAI,CAAE8M,aAAb,MAA+B,QAA/B,GAA0C9M,IAAI,CAAC8M,aAA/C,GAA+D,IAFnD,2CAGb9M,IAHa,aAGbA,IAHa,8CAGbA,IAAI,CAAE8M,aAHO,wDAGb,oBAAqBpC,EAHR,2CAIb;AAXuB;AAAA,eAAT,CAvGtB;AAqHI5J,cAAAA,gBAAgB,CAAC8L,SAAD,CAAhB,CArHJ,CAsHI;;AACAlM,cAAAA,OAAO,CAACkM,SAAS,CAACG,MAAV,CAAiBxD,cAAjB,CAAD,CAAP;AAvHJ;AAAA;;AAAA;AAAA;AAAA;;AAAA,oBAyHQ0B,GAAG,KAAK7F,QAAQ,CAACY,OAzHzB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AA0HI8C,cAAAA,OAAO,CAACC,KAAR,CAAc,sBAAd;AACMqC,cAAAA,IA3HV,GA2HiB,6EAAKA,IAAL,KAAa,SA3H9B;AA4HI3F,cAAAA,YAAY,CAAC;AACX2F,gBAAAA,IAAI,EAAJA,IADW;AAEXC,gBAAAA,OAAO,EAAE,6EAAKA,OAAL,KAAgB;AAFd,eAAD,CAAZ;AAIA3K,cAAAA,OAAO,CAAC,EAAD,CAAP;AACAI,cAAAA,gBAAgB,CAAC,EAAD,CAAhB;;AAjIJ;AAAA;AAmII6K,cAAAA,YAAY,CAACR,SAAD,CAAZ;AACA,kBAAIF,GAAG,KAAK7F,QAAQ,CAACY,OAAjB,IAA4B,CAACkF,QAAjC,EAA2CnK,YAAY,CAAC,KAAD,CAAZ;AApI/C;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAhSmC;AAAA;AAAA;;AAwanC,MAAMiM,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,KAAD;AAAA,WAAWhL,SAAS,CAACgL,KAAK,CAACC,MAAN,CAAa5O,KAAd,CAApB;AAAA,GAA5B,CAxamC,CA0anC;;;AACA7C,EAAAA,SAAS,CAAC,YAAM;AACd,QAAM0R,IAAI,GAAGtM,aAAa,IAAI,EAA9B;AACAH,IAAAA,OAAO,CAACyM,IAAI,CAACJ,MAAL,CAAYxD,cAAZ,CAAD,CAAP;AACD,GAHQ,EAGN,CAAC1I,aAAD,EAAgB0I,cAAhB,CAHM,CAAT;;AAKA,WAAS6D,YAAT,CAAsBC,GAAtB,EAA2B;AACzB;AACA,QAAMC,aAAa,GAAGpJ,SAAS,CAACN,GAAV,CAAc,UAACqD,CAAD,EAAInD,CAAJ;AAAA,aAAWA,CAAC,KAAKuJ,GAAN,GAAY,CAACpG,CAAb,GAAiBA,CAA5B;AAAA,KAAd,CAAtB;AACA,QAAMtD,MAAM,GAAG2J,aAAa,CAACD,GAAD,CAA5B,CAHyB,CAGU;;AAEnC,QAAME,UAAU,GAAG,mBAAI9M,IAAJ,EAAU+M,IAAV,CAAe,UAAC7G,CAAD,EAAIC,CAAJ,EAAU;AAC1C,UAAM3G,GAAG,GAAGqD,cAAc,CAAC+J,GAAD,CAA1B;;AAEA,UAAIA,GAAG,KAAK,CAAZ,EAAe;AACb;AACA,YAAMI,EAAE,GAAGpP,MAAM,CAACsI,CAAC,CAAC1G,GAAD,CAAF,CAAjB;AACA,YAAMyN,EAAE,GAAGrP,MAAM,CAACuI,CAAC,CAAC3G,GAAD,CAAF,CAAjB,CAHa,CAKb;;AACA,YAAIwN,EAAE,KAAK,IAAP,IAAeC,EAAE,KAAK,IAA1B,EAAgC,OAAO,CAAP;AAChC,YAAID,EAAE,KAAK,IAAX,EAAiB,OAAO9J,MAAM,GAAG,CAAC,CAAJ,GAAQ,CAArB;AACjB,YAAI+J,EAAE,KAAK,IAAX,EAAiB,OAAO/J,MAAM,GAAG,CAAH,GAAO,CAAC,CAArB;AAEjB,eAAOA,MAAM,GAAI+J,EAAE,GAAGD,EAAT,GAAgBA,EAAE,GAAGC,EAAlC;AACD,OAdyC,CAgB1C;;;AACA,UAAIL,GAAG,KAAK,CAAR,IAAaA,GAAG,KAAK,CAAzB,EAA4B;AAAA;;AAC1B,YAAMM,EAAE,GAAG,WAAChH,CAAC,CAAC1G,GAAD,CAAF,2CAAW,EAAX,EAAe2N,QAAf,EAAX;AACA,YAAMC,EAAE,GAAG,WAACjH,CAAC,CAAC3G,GAAD,CAAF,2CAAW,EAAX,EAAe2N,QAAf,EAAX;AACA,eAAOjK,MAAM,GAAGkK,EAAE,CAACC,aAAH,CAAiBH,EAAjB,CAAH,GAA0BA,EAAE,CAACG,aAAH,CAAiBD,EAAjB,CAAvC;AACD,OArByC,CAuB1C;;;AACA,UAAME,EAAE,GAAGzH,MAAM,CAACK,CAAC,CAAC1G,GAAD,CAAF,CAAjB;AACA,UAAM+N,EAAE,GAAG1H,MAAM,CAACM,CAAC,CAAC3G,GAAD,CAAF,CAAjB;;AAEA,UAAI,CAACtB,KAAK,CAACoP,EAAD,CAAN,IAAc,CAACpP,KAAK,CAACqP,EAAD,CAAxB,EAA8B;AAC5B,eAAOrK,MAAM,GAAIqK,EAAE,GAAGD,EAAT,GAAgBA,EAAE,GAAGC,EAAlC;AACD,OAFD,MAEO;AAAA;;AACL,YAAML,GAAE,GAAG,YAAChH,CAAC,CAAC1G,GAAD,CAAF,6CAAW,EAAX,EAAe2N,QAAf,EAAX;;AACA,YAAMC,GAAE,GAAG,YAACjH,CAAC,CAAC3G,GAAD,CAAF,6CAAW,EAAX,EAAe2N,QAAf,EAAX;;AACA,eAAOjK,MAAM,GAAGkK,GAAE,CAACC,aAAH,CAAiBH,GAAjB,CAAH,GAA0BA,GAAE,CAACG,aAAH,CAAiBD,GAAjB,CAAvC;AACD;AACF,KAlCkB,CAAnB;;AAoCAnN,IAAAA,OAAO,CAAC6M,UAAD,CAAP;AACApJ,IAAAA,YAAY,CAACmJ,aAAD,CAAZ,CA1CyB,CA4CzB;;AACArJ,IAAAA,SAAS,CAACT,YAAY,CAACH,SAAD,EAAYgK,GAAZ,EAAiB1J,MAAjB,CAAb,CAAT;AACD;;AAGD,MAAMsK,SAAS,GAAG,SAAZA,SAAY,CAACjO,IAAD,EAAU;AAC1B,QAAIA,IAAI,IAAIA,IAAI,CAAC0K,EAAjB,EAAqB;AACnB5B,MAAAA,OAAO,CAACoF,GAAR,CAAY,gBAAZ,EAA8BlO,IAA9B;AACAoD,MAAAA,MAAM,CAAC+K,IAAP,CAAY,YAAYnO,IAAI,CAAC0K,EAA7B;AACD,KAHD,MAGO;AACL5B,MAAAA,OAAO,CAACC,KAAR,CAAc,8CAAd,EAA8D/I,IAA9D;AACD;AACF,GAPD;;AAjemC,oBA0eOtE,QAAQ,CAAC,EAAD,CA1ef;AAAA,MA0e5B0S,aA1e4B;AAAA,MA0ebzB,gBA1ea;;AAAA,oBA2eWjR,QAAQ,CAAC,KAAD,CA3enB;AAAA,MA2e5B2S,eA3e4B;AAAA,MA2eXC,kBA3eW;;AA6enC,MAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAC7D,EAAD,EAAQ;AAC/BiC,IAAAA,gBAAgB,CAAC,UAAAF,IAAI;AAAA,aACnBA,IAAI,CAACnD,QAAL,CAAcoB,EAAd,IAAoB+B,IAAI,CAACM,MAAL,CAAY,UAAAyB,CAAC;AAAA,eAAIA,CAAC,KAAK9D,EAAV;AAAA,OAAb,CAApB,gCAAqD+B,IAArD,IAA2D/B,EAA3D,EADmB;AAAA,KAAL,CAAhB;AAGD,GAJD,CA7emC,CAofnC;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,MAAM+D,qBAAqB,GAAG,SAAxBA,qBAAwB;AAAA,WAAMH,kBAAkB,CAAC,IAAD,CAAxB;AAAA,GAA9B;;AACA,MAAMI,sBAAsB,GAAG,SAAzBA,sBAAyB;AAAA,WAAMJ,kBAAkB,CAAC,KAAD,CAAxB;AAAA,GAA/B;;AAEA,MAAMK,oBAAoB;AAAA,0EAAG;AAAA;;AAAA;AAAA;AAAA;AAAA;AAC3B9J,cAAAA,aAAa,CAAC,IAAD,CAAb;AACM0B,cAAAA,EAFqB,GAEhBrJ,QAAQ,CAACsJ,SAAT,EAFgB;AAAA;AAIzB;AAJyB,sDAKJ4H,aALI;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKdQ,cAAAA,MALc;AAMvB9F,cAAAA,OAAO,CAACoF,GAAR,CAAYU,MAAZ;AANuB;AAAA;AAAA,qBASfrI,EAAE,CAACa,UAAH,CAAc,MAAd,EAAsBa,GAAtB,CAA0B2G,MAA1B,aATe;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAWrB9F,cAAAA,OAAO,CAACC,KAAR,mCAAyC6F,MAAzC;;AAXqB;AAAA;AAAA;AAAA,qBAefrI,EAAE,CAACa,UAAH,CAAc,OAAd,EAAuBa,GAAvB,CAA2B2G,MAA3B,aAfe;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAiBrB9F,cAAAA,OAAO,CAACC,KAAR,mCAAyC6F,MAAzC;;AAjBqB;AAAA;AAAA;AAAA,qBAqBfC,iBAAiB,CAACD,MAAD,CArBF;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAuBrB9F,cAAAA,OAAO,CAACC,KAAR,sCAA4C6F,MAA5C;;AAvBqB;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AA0BzB;AACAlO,cAAAA,OAAO,CAACD,IAAI,CAACsM,MAAL,CAAY,UAAC/M,IAAD;AAAA,uBAAU,CAACoO,aAAa,CAAC9E,QAAd,CAAuBtJ,IAAI,CAAC0K,EAA5B,CAAX;AAAA,eAAZ,CAAD,CAAP;AACAiC,cAAAA,gBAAgB,CAAC,EAAD,CAAhB;AA5ByB;AAAA;;AAAA;AAAA;AAAA;AA8BzB7D,cAAAA,OAAO,CAACC,KAAR,CAAc,uBAAd;;AA9ByB;AAAA;AAgCzBlE,cAAAA,aAAa,CAAC,KAAD,CAAb;AACA6J,cAAAA,sBAAsB,GAjCG,CAkCzB;AACA;;AAnCyB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAApBC,oBAAoB;AAAA;AAAA;AAAA,KAA1B;;AAwCA,MAAMG,WAAW,GAAG,SAAdA,WAAc;AAAA,WAAM3N,OAAO,CAAC,KAAD,CAAb;AAAA,GAApB;;AACA,MAAM4N,UAAU,GAAG,SAAbA,UAAa;AAAA,WAAM5N,OAAO,CAAC,IAAD,CAAb;AAAA,GAAnB;;AAEA,MAAM6N,WAAW,GAAG,SAAdA,WAAc,CAAC/B,KAAD,EAAQI,GAAR,EAAa4B,WAAb,EAA0BnR,IAA1B,EAAmC;AACrD,QAAImP,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAACiC,cAAN;AACAjC,MAAAA,KAAK,CAACkC,eAAN;AACD;;AACDrG,IAAAA,OAAO,CAACoF,GAAR,CAAY,yBAAZ,EAAuCe,WAAvC;AACAtC,IAAAA,gBAAgB,CAACsC,WAAD,CAAhB;AACAxN,IAAAA,QAAQ,CAAC3D,IAAD,CAAR;AACAwQ,IAAAA,kBAAkB,CAAC,IAAD,CAAlB;AACD,GATD,CA1iBmC,CAqjBnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,MAAMc,UAAU,GAAG,SAAbA,UAAa,CAACC,KAAD;AAAA,WAAY;AAC7BC,MAAAA,eAAe,EAAElL,UAAU,KAAKiL,KAAf,GAAuB,MAAvB,GAAgC,aADpB;AAE7BE,MAAAA,SAAS,EAAE,QAFkB;AAG7BC,MAAAA,MAAM,EAAE;AAHqB,KAAZ;AAAA,GAAnB;;AAvkBmC,oBA6kBO9T,QAAQ,CAAC,eAAD,CA7kBf;AAAA,MA6kB5B+T,aA7kB4B;AAAA,MA6kBbC,gBA7kBa;;AAAA,oBA8kBOhU,QAAQ,CAAC,eAAD,CA9kBf;AAAA,MA8kB5BiU,aA9kB4B;AAAA,MA8kBbC,gBA9kBa;;AAglBnC,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACC,QAAD,EAAW7C,KAAX,EAAqB;AACzC,QAAI6C,QAAQ,KAAK,YAAjB,EAA+B;AAC7BJ,MAAAA,gBAAgB,CAAC,eAAD,CAAhB;AACAvN,MAAAA,cAAc,CAAC,IAAD,CAAd;AACD,KAHD,MAGO;AACLuN,MAAAA,gBAAgB,CAACzC,KAAK,CAACC,MAAN,CAAa6C,WAAd,CAAhB;AACA5N,MAAAA,cAAc,CAAC8K,KAAK,CAACC,MAAN,CAAa6C,WAAd,CAAd;AACD;AACF,GARD;;AAUA,MAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACF,QAAD,EAAW7C,KAAX,EAAqB;AACzC,QAAI6C,QAAQ,KAAK,YAAjB,EAA+B;AAC7BF,MAAAA,gBAAgB,CAAC,eAAD,CAAhB;AACAvN,MAAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,KAHD,MAGO;AACLuN,MAAAA,gBAAgB,CAAC3C,KAAK,CAACC,MAAN,CAAa6C,WAAd,CAAhB;AACA1N,MAAAA,mBAAmB,CAAC4K,KAAK,CAACC,MAAN,CAAa6C,WAAd,CAAnB;AACD;AACF,GARD,CA1lBmC,CAomBnC;AACA;;;AArmBmC,WAsmBpBE,qBAtmBoB;AAAA;AAAA,IAmpBnC;AACA;AACA;AACA;;;AAtpBmC;AAAA,sFAsmBnC,mBAAqCpS,IAArC;AAAA;;AAAA;AAAA;AAAA;AAAA;AACQ0I,cAAAA,EADR,GACarJ,QAAQ,CAACsJ,SAAT,EADb;AAEQxF,cAAAA,GAFR,GAEc,IAAI8F,GAAJ,EAFd,EAIE;;AACMoJ,cAAAA,QALR,GAKmBrP,aAAa,CAACkM,MAAd,CAAqB,UAAC/M,IAAD,EAAU;AAC9C,oBAAMyJ,GAAG,GAAG1J,eAAe,CAACC,IAAD,EAAO,KAAP,CAA3B;AACA,oBAAM0J,QAAQ,GAAG3J,eAAe,CAACC,IAAD,EAAO,UAAP,CAAhC;;AACA,oBAAIkC,WAAW,IAAItC,aAAa,CAAC6J,GAAD,CAAb,KAAuB7J,aAAa,CAACsC,WAAD,CAAvD,EAAsE;AACpE,yBAAO,KAAP;AACD;;AACD,oBACEE,gBAAgB,IAChBxC,aAAa,CAAC8J,QAAD,CAAb,KAA4B9J,aAAa,CAACwC,gBAAD,CAF3C,EAGE;AACA,yBAAO,KAAP;AACD;;AACD,uBAAO,IAAP;AACD,eAbgB,CALnB;AAAA,sDAoBmB8N,QApBnB;;AAAA;AAoBE,uEAA2B;AAAhBC,kBAAAA,EAAgB;AACnBzF,kBAAAA,EADmB,GACd7M,IAAI,KAAK,MAAT,GAAkBsS,EAAE,CAACvG,YAArB,GAAoCuG,EAAE,CAACtG,eADzB;AAEzB,sBAAIa,EAAJ,EAAQ1J,GAAG,CAACoP,GAAJ,CAAQ1F,EAAR;AACT;AAvBH;AAAA;AAAA;AAAA;AAAA;;AAyBQ2F,cAAAA,GAzBR,GAyBc,EAzBd;AA0BQC,cAAAA,OA1BR,sBA0BsBtP,GA1BtB;AA2BW8C,cAAAA,CA3BX,GA2Be,CA3Bf;;AAAA;AAAA,oBA2BkBA,CAAC,GAAGwM,OAAO,CAACtR,MA3B9B;AAAA;AAAA;AAAA;;AA4BUuR,cAAAA,KA5BV,GA4BkBD,OAAO,CAACE,KAAR,CAAc1M,CAAd,EAAiBA,CAAC,GAAG,EAArB,CA5BlB;AAAA;AAAA,qBA6BuByC,EAAE,CAClBa,UADgB,CACL,QADK,EAEhBqJ,KAFgB,CAEVvT,QAAQ,CAACsJ,SAAT,CAAmBc,SAAnB,CAA6BC,UAA7B,EAFU,EAEiC,IAFjC,EAEuCgJ,KAFvC,EAGhB7I,GAHgB,EA7BvB;;AAAA;AA6BUC,cAAAA,IA7BV;AAiCIA,cAAAA,IAAI,CAACK,OAAL,CAAa,UAACC,GAAD,EAAS;AACpB,oBAAM3I,CAAC,GAAG2I,GAAG,CAACC,IAAJ,MAAc,EAAxB;AACAmI,gBAAAA,GAAG,CAAClC,IAAJ,CAAS;AAAEzD,kBAAAA,EAAE,EAAEzC,GAAG,CAACyC,EAAV;AAAc5M,kBAAAA,IAAI,EAAEwB,CAAC,CAACxB,IAAF,IAAUmK,GAAG,CAACyC;AAAlC,iBAAT;AACD,eAHD;;AAjCJ;AA2BsC5G,cAAAA,CAAC,IAAI,EA3B3C;AAAA;AAAA;;AAAA;AAuCE;AACAuM,cAAAA,GAAG,CAAC7C,IAAJ,CAAS,UAAC7G,CAAD,EAAIC,CAAJ;AAAA,uBAAU,CAACD,CAAC,CAAC7I,IAAF,IAAU,EAAX,EAAegQ,aAAf,CAA6BlH,CAAC,CAAC9I,IAAF,IAAU,EAAvC,CAAV;AAAA,eAAT;AAxCF,iDAyCSuS,GAzCT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAtmBmC;AAAA;AAAA;;AAupBnC,MAAMK,iBAAiB;AAAA,0EAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AACpBC,cAAAA,WADoB,GACN,EADM;AAAA;AAAA;AAAA,qBAGIjU,YAAY,CAACwF,WAAD,EAAcE,gBAAd,CAHhB;;AAAA;AAGhBwO,cAAAA,WAHgB;AAItBD,cAAAA,WAAW,GAAGrI,KAAK,CAACC,OAAN,CAAcqI,WAAd,IAA6BA,WAA7B,GAA2C,EAAzD;AAJsB;AAAA;;AAAA;AAAA;AAAA;AAMtB9H,cAAAA,OAAO,CAACC,KAAR,CAAc,sBAAd;;AANsB;AAAA,oBAUpB4H,WAAW,CAAC3R,MAAZ,KAAuB,CAVH;AAAA;AAAA;AAAA;;AAAA;;AAYpB,kBAAI,CAACkE,mBAAL,EAA0B;AACxB;AACAC,gBAAAA,sBAAsB,CAAC,MAAD,CAAtB;AACD;;AAfmB;AAAA,qBAgBE8M,qBAAqB,CAAC/M,mBAAmB,IAAI,MAAxB,CAhBvB;;AAAA;AAgBd2N,cAAAA,OAhBc;AAiBpBF,cAAAA,WAAW,GAAGE,OAAd;AAjBoB;AAAA;;AAAA;AAAA;AAAA;AAmBpB/H,cAAAA,OAAO,CAACC,KAAR,CAAc,wCAAd;AACA4H,cAAAA,WAAW,GAAG,EAAd;;AApBoB;AAwBxB5N,cAAAA,UAAU,CAAC4N,WAAD,CAAV;AACAG,cAAAA,mBAAmB,CAAC,EAAD,CAAnB;AACA7N,cAAAA,kBAAkB,CAAC,IAAD,CAAlB;;AA1BwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAjByN,iBAAiB;AAAA;AAAA;AAAA,KAAvB,CAvpBmC,CAsrBnC;AACA;;;AACA,MAAMK,kBAAkB;AAAA,0EAAG,kBAAOC,QAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACzBlI,cAAAA,OAAO,CAACoF,GAAR,CAAY,0BAAZ,EAAwC8C,QAAxC;;AADyB,kBAEpBA,QAFoB;AAAA;AAAA;AAAA;;AAGvB,kBAAI9N,mBAAmB,KAAK,MAA5B,EAAoC;AAClCT,gBAAAA,uBAAuB,CAAC,eAAD,CAAvB;AACAF,gBAAAA,qBAAqB,CAAC,IAAD,CAArB;AACD,eAHD,MAGO,IAAIW,mBAAmB,KAAK,SAA5B,EAAuC;AAC5CL,gBAAAA,0BAA0B,CAAC,eAAD,CAA1B;AACAF,gBAAAA,wBAAwB,CAAC,IAAD,CAAxB;AACD;;AACDM,cAAAA,kBAAkB,CAAC,KAAD,CAAlB;AAVuB;;AAAA;AAAA;AAAA;AAAA,qBAcE/F,QAAQ,CAACsJ,SAAT,GAAqBY,UAArB,CAAgC,QAAhC,EAA0Ca,GAA1C,CAA8C+I,QAA9C,EAAwDtJ,GAAxD,EAdF;;AAAA;AAcjBuJ,cAAAA,UAdiB;;AAevB,kBAAIA,UAAU,CAACC,MAAf,EAAuB;AACfC,gBAAAA,UADe,GACFF,UAAU,CAAC/I,IAAX,EADE;;AAErB,oBAAIhF,mBAAmB,KAAK,MAA5B,EAAoC;AAClCT,kBAAAA,uBAAuB,CAAC0O,UAAU,CAACrT,IAAZ,CAAvB;AACAyE,kBAAAA,qBAAqB,CAACyO,QAAD,CAArB;AACD,iBAHD,MAGO,IAAI9N,mBAAmB,KAAK,SAA5B,EAAuC;AAC5CL,kBAAAA,0BAA0B,CAACsO,UAAU,CAACrT,IAAZ,CAA1B;AACA6E,kBAAAA,wBAAwB,CAACqO,QAAD,CAAxB;AACD;AACF,eATD,MASO;AACLlI,gBAAAA,OAAO,CAACC,KAAR,CAAc,kCAAd,EAAkDiI,QAAlD;AACD;;AA1BsB;AAAA;;AAAA;AAAA;AAAA;AA4BvBlI,cAAAA,OAAO,CAACC,KAAR,CAAc,6BAAd;;AA5BuB;AA8BzB9F,cAAAA,kBAAkB,CAAC,KAAD,CAAlB;;AA9ByB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAlB8N,kBAAkB;AAAA;AAAA;AAAA,KAAxB;;AAiCA,MAAMK,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACJ,QAAD,EAAWK,UAAX,EAA0B;AACjDvI,IAAAA,OAAO,CAACoF,GAAR,sBAA0B8C,QAA1B,4BAAoDK,UAApD;AACAjO,IAAAA,MAAM,CAAC+K,IAAP,CAAY,YAAY6C,QAAxB;AACD,GAHD;;AAKA,MAAMM,0BAA0B,GAAG,SAA7BA,0BAA6B,GAAM;AACvC,QAAIpO,mBAAmB,KAAK,MAA5B,EAAoC;AAClCT,MAAAA,uBAAuB,CAAC,eAAD,CAAvB;AACAF,MAAAA,qBAAqB,CAAC,IAAD,CAArB;AACD,KAHD,MAGO,IAAIW,mBAAmB,KAAK,SAA5B,EAAuC;AAC5CL,MAAAA,0BAA0B,CAAC,eAAD,CAA1B;AACAF,MAAAA,wBAAwB,CAAC,IAAD,CAAxB;AACD;;AACDM,IAAAA,kBAAkB,CAAC,KAAD,CAAlB;AACD,GATD,CA9tBmC,CAyuBnC;AACA;AACA;;;AA3uBmC,oBA4uBPvH,QAAQ,CAAC,EAAD,CA5uBD;AAAA,MA4uB5B6V,MA5uB4B;AAAA,MA4uBpBC,SA5uBoB;;AAAA,oBA6uBS9V,QAAQ,CAAC,KAAD,CA7uBjB;AAAA,MA6uB5B+V,cA7uB4B;AAAA,MA6uBZC,iBA7uBY;;AAAA,oBA8uBWhW,QAAQ,CAAC,eAAD,CA9uBnB;AAAA,MA8uB5BiW,eA9uB4B;AAAA,MA8uBXC,kBA9uBW;;AAgvBnC,MAAMC,gBAAgB;AAAA,0EAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACElV,WAAW,CAClCuF,WADkC,EAElCE,gBAFkC,EAGlCE,kBAHkC,CADb;;AAAA;AACjBwP,cAAAA,UADiB;AAMvBN,cAAAA,SAAS,CAACM,UAAD,CAAT;AACAC,cAAAA,kBAAkB,CAAC,EAAD,CAAlB;AACAL,cAAAA,iBAAiB,CAAC,IAAD,CAAjB;;AARuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAhBG,gBAAgB;AAAA;AAAA;AAAA,KAAtB;;AAWA,MAAMG,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,SAAD,EAAe;AACvCL,IAAAA,kBAAkB,CAACK,SAAS,IAAI,eAAd,CAAlB;AACA1N,IAAAA,gBAAgB,CAAC0N,SAAS,IAAI,IAAd,CAAhB;AACAP,IAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACD,GAJD;;AAMA,MAAMQ,yBAAyB,GAAG,SAA5BA,yBAA4B,GAAM;AACtCN,IAAAA,kBAAkB,CAAC,eAAD,CAAlB;AACArN,IAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACAmN,IAAAA,iBAAiB,CAAC,KAAD,CAAjB;AACD,GAJD,CAjwBmC,CAuwBnC;AACA;AACA;;;AACA,MAAMS,yBAAyB,GAAG,SAA5BA,yBAA4B,GAAM;AACtCtP,IAAAA,0BAA0B,CAAC,iBAAD,CAA1B;AACAF,IAAAA,wBAAwB,CAACvF,eAAD,CAAxB;AACA0L,IAAAA,OAAO,CAACoF,GAAR,CAAY,qDAAZ,EAAmE9Q,eAAnE;AACD,GAJD;;AAMA,MAAMgV,0BAA0B,GAAG,SAA7BA,0BAA6B,GAAM;AACvCvP,IAAAA,0BAA0B,CAAC,kBAAD,CAA1B;AACAF,IAAAA,wBAAwB,CAACtF,gBAAD,CAAxB;AACAyL,IAAAA,OAAO,CAACoF,GAAR,CAAY,qDAAZ,EAAmE7Q,gBAAnE;AACD,GAJD;;AAMA,MAAMgV,8BAA8B,GAAG,SAAjCA,8BAAiC,GAAM;AAC3CxP,IAAAA,0BAA0B,CAAC,YAAD,CAA1B;AACAF,IAAAA,wBAAwB,CAACrF,oBAAD,CAAxB;AACAwL,IAAAA,OAAO,CAACoF,GAAR,CAAY,qDAAZ,EAAmE5Q,oBAAnE;AACD,GAJD;;AAtxBmC,oBA4xBa5B,QAAQ,CAAC,EAAD,CA5xBrB;AAAA,MA4xB5B4W,gBA5xB4B;AAAA,MA4xBVxB,mBA5xBU;;AAAA,oBA6xBWpV,QAAQ,CAAC,EAAD,CA7xBnB;AAAA,MA6xB5B6W,eA7xB4B;AAAA,MA6xBXR,kBA7xBW;;AA+xBnC,MAAMlD,iBAAiB;AAAA,0EAAG,kBAAOD,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAClB4D,cAAAA,UADkB,GACLtV,QAAQ,CAACuV,OAAT,GAAmB9J,GAAnB,EADK;AAElB+J,cAAAA,SAFkB,GAENF,UAAU,CAACG,KAAX,iBAA0B/D,MAA1B,OAFM;AAAA;AAAA;AAAA,qBAIG8D,SAAS,CAACE,OAAV,EAJH;;AAAA;AAIhBC,cAAAA,UAJgB;AAKhBC,cAAAA,cALgB,GAKCD,UAAU,CAACE,KAAX,CAAiBnP,GAAjB,CAAqB,UAAC5D,IAAD;AAAA,uBAAUA,IAAI,UAAJ,EAAV;AAAA,eAArB,CALD;AAAA;AAAA,qBAMhBvC,OAAO,CAACuV,GAAR,CAAYF,cAAZ,CANgB;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAQtBhK,cAAAA,OAAO,CAACC,KAAR,CAAc,8BAAd;;AARsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAjB8F,iBAAiB;AAAA;AAAA;AAAA,KAAvB;;AAYA,MAAMoE,yBAAyB;AAAA,0EAAG,kBAAOrE,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAC1BrI,cAAAA,EAD0B,GACrBrJ,QAAQ,CAACsJ,SAAT,EADqB;AAAA;AAAA;AAAA,qBAGxBD,EAAE,CAACa,UAAH,CAAc,OAAd,EAAuBa,GAAvB,CAA2B2G,MAA3B,aAHwB;;AAAA;AAI9B9F,cAAAA,OAAO,CAACoF,GAAR,+CAAmDU,MAAnD;AAJ8B;AAAA;;AAAA;AAAA;AAAA;AAM9B9F,cAAAA,OAAO,CAACC,KAAR,CAAc,uCAAd;;AAN8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAzBkK,yBAAyB;AAAA;AAAA;AAAA,KAA/B,CA3yBmC,CAqzBnC;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;;;AAEA,MAAMC,eAAe,GAAG5H,IAAI,CAAC6H,GAAL,CACtB,CADsB,EAEtBnO,WAAW,CAAC+H,MAAZ,CAAmB7D,OAAnB,EAA4BlK,MAA5B,IAAsCkG,WAAW,GAAG,CAAH,GAAO,CAAxD,CAFsB,CAAxB;;AAIA,MAAMkO,WAAW,GAAI,YAAM;AACzB,QAAMC,OAAO,GAAG,EAAhB;AACA,QAAMC,UAAU,GAAG,CAAnB;;AAEA,QAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,CAAD;AAAA,aACfH,OAAO,CAAClF,IAAR,CACE,MAAC,UAAD,CAAY,IAAZ;AACE,QAAA,GAAG,iBAAUqF,CAAV,CADL;AAEE,QAAA,MAAM,EAAEA,CAAC,KAAK1O,IAFhB;AAGE,QAAA,OAAO,EAAE;AAAA,iBAAMC,OAAO,CAACyO,CAAD,CAAb;AAAA,SAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAKGA,CALH,CADF,CADe;AAAA,KAAjB;;AAWA,QAAMC,YAAY,GAAG,SAAfA,YAAe,CAACxT,GAAD;AAAA,aACnBoT,OAAO,CAAClF,IAAR,CAAa,MAAC,UAAD,CAAY,QAAZ;AAAqB,QAAA,GAAG,EAAElO,GAA1B;AAA+B,QAAA,QAAQ,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAb,CADmB;AAAA,KAArB;;AAGA,QAAIiT,eAAe,IAAII,UAAvB,EAAmC;AACjC,WAAK,IAAIxP,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAIoP,eAArB,EAAsCpP,CAAC,IAAI,CAA3C;AAA8CyP,QAAAA,QAAQ,CAACzP,CAAD,CAAR;AAA9C;;AACA,aAAOuP,OAAP;AACD;;AAED,QAAMK,UAAU,GAAG,CAAnB;AACA,QAAIC,KAAK,GAAGrI,IAAI,CAAC6H,GAAL,CAAS,CAAT,EAAYrO,IAAI,GAAG,CAAnB,CAAZ;AACA,QAAI8O,GAAG,GAAGtI,IAAI,CAACuI,GAAL,CAASX,eAAe,GAAG,CAA3B,EAA8BpO,IAAI,GAAG,CAArC,CAAV;AAEA,QAAMgP,aAAa,GAAGR,UAAU,GAAG,CAAnC;AACA,QAAIS,aAAa,GAAGH,GAAG,GAAGD,KAAN,GAAc,CAAlC;AACA,QAAIK,SAAS,GAAGF,aAAa,GAAGC,aAAhC;;AAEA,WAAOC,SAAS,GAAG,CAAnB,EAAsB;AACpB,UAAIL,KAAK,GAAG,CAAZ,EAAe;AACbA,QAAAA,KAAK,IAAI,CAAT;AACAK,QAAAA,SAAS,IAAI,CAAb;AACD;;AACD,UAAIA,SAAS,GAAG,CAAZ,IAAiBJ,GAAG,GAAGV,eAAe,GAAG,CAA7C,EAAgD;AAC9CU,QAAAA,GAAG,IAAI,CAAP;AACAI,QAAAA,SAAS,IAAI,CAAb;AACD;;AACD,UAAIL,KAAK,KAAK,CAAV,IAAeC,GAAG,KAAKV,eAAe,GAAG,CAA7C,EAAgD;AACjD;;AAEDK,IAAAA,QAAQ,CAAC,CAAD,CAAR;AACA,QAAII,KAAK,GAAG,CAAZ,EAAeF,YAAY,CAAC,gBAAD,CAAZ;;AACf,SAAK,IAAI3P,EAAC,GAAG6P,KAAb,EAAoB7P,EAAC,IAAI8P,GAAzB,EAA8B9P,EAAC,IAAI,CAAnC;AAAsCyP,MAAAA,QAAQ,CAACzP,EAAD,CAAR;AAAtC;;AACA,QAAI8P,GAAG,GAAGV,eAAe,GAAG,CAA5B,EAA+BO,YAAY,CAAC,cAAD,CAAZ;AAC/BF,IAAAA,QAAQ,CAACL,eAAD,CAAR;AACA,QAAIhO,WAAJ,EAAiBuO,YAAY,CAAC,eAAD,CAAZ;AAEjB,WAAOJ,OAAP;AACD,GAnDmB,EAApB;;AAqDA,MAAMY,cAAc,GAAGrY,WAAW,CAAC,YAAM;AACvC,eAAmC;AACnC,QAAIkJ,IAAI,KAAK,CAAb,EAAgB;AAChB,QAAI,CAACY,YAAY,CAACM,OAAlB,EAA2B;AAC3B,QAAMkO,eAAe,GACnBxO,YAAY,CAACM,OAAb,CAAqBmO,qBAArB,GAA6CC,MAA7C,IAAuD,CADzD;AAEA,QAAI,CAACF,eAAL,EAAsB;AAEtB,QAAMG,SAAS,GACb3O,YAAY,CAACM,OAAb,CAAqBsO,aAArB,CAAmC,gBAAnC,KACA5O,YAAY,CAACM,OAAb,CAAqBsO,aAArB,CAAmC,UAAnC,CAFF;AAGA,QAAMC,OAAO,GACX7O,YAAY,CAACM,OAAb,CAAqBsO,aAArB,CAAmC,gBAAnC,KACA5O,YAAY,CAACM,OAAb,CAAqBsO,aAArB,CAAmC,UAAnC,CAFF;;AAIA,QAAID,SAAJ,EAAe;AACb,UAAMG,CAAC,GAAGH,SAAS,CAACF,qBAAV,GAAkCC,MAA5C;AACA,UAAII,CAAJ,EAAO5O,eAAe,CAACI,OAAhB,GAA0BwO,CAA1B;AACR;;AACD,QAAID,OAAJ,EAAa;AACX,UAAMlI,CAAC,GAAGkI,OAAO,CAACJ,qBAAR,GAAgCC,MAA1C;AACA,UAAI/H,CAAJ,EAAO1G,YAAY,CAACK,OAAb,GAAuBqG,CAAvB;AACR;;AAED,QAAMoI,eAAe,GAAG,EAAxB;AACA,QAAMC,SAAS,GACbR,eAAe,GAAGtO,eAAe,CAACI,OAAlC,GAA4CyO,eAD9C;AAEA,QAAME,SAAS,GAAGrJ,IAAI,CAACsJ,KAAL,CAAWF,SAAS,GAAG/O,YAAY,CAACK,OAApC,CAAlB;AACA,QAAM6O,OAAO,GAAGvJ,IAAI,CAAC6H,GAAL,CAAS,CAAT,EAAY7H,IAAI,CAACuI,GAAL,CAAS,EAAT,EAAac,SAAb,CAAZ,CAAhB;;AACA,QAAIE,OAAO,GAAG,CAAV,IAAeA,OAAO,KAAKvT,QAA/B,EAAyC;AACvCC,MAAAA,WAAW,CAACsT,OAAD,CAAX;AACAhK,MAAAA,eAAe;AACftF,MAAAA,aAAa,CAAC,UAAC0B,CAAD;AAAA,eAAOA,CAAC,GAAG,CAAX;AAAA,OAAD,CAAb;AACD;AACF,GAlCiC,EAkC/B,CAACnC,IAAD,EAAOxD,QAAP,CAlC+B,CAAlC;AAoCA7F,EAAAA,SAAS,CAAC,YAAM;AACd,eAAmC;AACnCwY,IAAAA,cAAc;;AACd,QAAMa,QAAQ,GAAG,SAAXA,QAAW;AAAA,aAAMb,cAAc,EAApB;AAAA,KAAjB;;AACA/N,IAAAA,MAAM,CAAC6O,gBAAP,CAAwB,QAAxB,EAAkCD,QAAlC;AACA,WAAO;AAAA,aAAM5O,MAAM,CAAC8O,mBAAP,CAA2B,QAA3B,EAAqCF,QAArC,CAAN;AAAA,KAAP;AACD,GANQ,EAMN,CAACb,cAAD,CANM,CAAT;AAQAxY,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIwC,SAAS,IAAI6G,IAAI,KAAK,CAA1B,EAA6B;AAC7BmP,IAAAA,cAAc;AACf,GAHQ,EAGN,CAACnP,IAAD,EAAO7G,SAAP,EAAkBgW,cAAlB,CAHM,CAAT;;AAKA,MAAMgB,aAAa,GAAG,SAAhBA,aAAgB,CAACC,QAAD;AAAA,WACpB;AAAK,MAAA,SAAS,EAAEjY,MAAM,CAACkY,YAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAElY,MAAM,CAACmY,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAEnY,MAAM,CAACoY,YAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADF,EAEE;AAAK,MAAA,SAAS,EAAEpY,MAAM,CAACqY,eAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0DAFF,CADF,EAOGrM,gBAAgB,GACf;AAAM,MAAA,SAAS,EAAEhM,MAAM,CAACsY,YAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADe,GAEb,IATN,CADF,EAaE;AAAK,MAAA,SAAS,EAAEtY,MAAM,CAACuY,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAEvY,MAAM,CAACwY,kBAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADF,EAEE,MAAC,UAAD;AAAY,MAAA,SAAS,EAAExY,MAAM,CAACyY,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,UAAD,CAAY,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADF,EAEE,MAAC,QAAD;AAAU,MAAA,QAAQ,EAAE7F,aAApB;AAAmC,MAAA,SAAS,EAAC,OAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,QAAD,CAAU,MAAV;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,EAAE,YAAKqF,QAAL,SAFJ;AAGE,MAAA,SAAS,kBAAWjY,MAAM,CAAC0Y,WAAlB,CAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKGlG,aALH,CADF,EAQE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,SAAS,EAAC,OAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,YAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,EAEE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFF,EAGE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,SAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAHF,EAIE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,SAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAJF,EAKE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,SAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBALF,CARF,CAFF,CAFF,EAsBE,MAAC,UAAD;AAAY,MAAA,SAAS,EAAExS,MAAM,CAACyY,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,UAAD,CAAY,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,EAEE,MAAC,QAAD;AAAU,MAAA,QAAQ,EAAE1F,aAApB;AAAmC,MAAA,SAAS,EAAC,OAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,QAAD,CAAU,MAAV;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,EAAE,YAAKkF,QAAL,cAFJ;AAGE,MAAA,SAAS,kBAAWjY,MAAM,CAAC0Y,WAAlB,CAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKGhG,aALH,CADF,EAQE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,SAAS,EAAC,OAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,YAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,EAEE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAFF,EAGE,MAAC,QAAD,CAAU,IAAV;AAAe,MAAA,QAAQ,EAAC,KAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAHF,CARF,CAFF,CAtBF,EAwCE,MAAC,UAAD;AAAY,MAAA,SAAS,EAAE1S,MAAM,CAACyY,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,UAAD,CAAY,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,EAEE,MAAC,MAAD;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,SAAS,kBAAWzY,MAAM,CAAC0Y,WAAlB,CAFX;AAGE,MAAA,OAAO,EAAE9D,gBAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKGF,eALH,CAFF,CAxCF,CAbF,EAiEE;AAAK,MAAA,SAAS,EAAE1U,MAAM,CAACuY,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAEvY,MAAM,CAACwY,kBAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,EAEE,MAAC,UAAD;AAAY,MAAA,SAAS,EAAExY,MAAM,CAACyY,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,UAAD,CAAY,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBADF,EAEE,MAAC,MAAD;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,SAAS,kBAAWzY,MAAM,CAAC0Y,WAAlB,CAFX;AAGE,MAAA,OAAO,EAAE;AAAA,eAAMjF,iBAAiB,CAAC,MAAD,CAAvB;AAAA,OAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKGlO,oBALH,CAFF,CAFF,EAaE,MAAC,UAAD;AAAY,MAAA,SAAS,EAAEvF,MAAM,CAACyY,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,UAAD,CAAY,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,EAEE,MAAC,MAAD;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,SAAS,kBAAWzY,MAAM,CAAC0Y,WAAlB,CAFX;AAGE,MAAA,OAAO,EAAE;AAAA,eAAMjF,iBAAiB,CAAC,SAAD,CAAvB;AAAA,OAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKG9N,uBALH,CAFF,CAbF,CAjEF,EA0FE;AAAK,MAAA,SAAS,EAAE3F,MAAM,CAACuY,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAEvY,MAAM,CAACwY,kBAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,EAEE,MAAC,UAAD;AAAY,MAAA,SAAS,EAAExY,MAAM,CAACyY,UAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,UAAD,CAAY,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,EAEE;AAAK,MAAA,SAAS,EAAEzY,MAAM,CAAC2Y,WAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,MAAC,MAAD;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,SAAS,EAAE3Y,MAAM,CAAC4Y,UAFpB;AAGE,MAAA,OAAO,EAAE1D,yBAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBADF,EAQE,MAAC,MAAD;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,SAAS,EAAElV,MAAM,CAAC4Y,UAFpB;AAGE,MAAA,OAAO,EAAEzD,0BAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BARF,EAeE,MAAC,MAAD;AACE,MAAA,OAAO,EAAC,mBADV;AAEE,MAAA,SAAS,EAAEnV,MAAM,CAAC4Y,UAFpB;AAGE,MAAA,OAAO,EAAExD,8BAHX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAfF,CAFF,CAFF,CA1FF,CADoB;AAAA,GAAtB;;AA4HA,SACE,MAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGzN,UAAU,IACT;AAAK,IAAA,SAAS,EAAE3H,MAAM,CAAC6Y,cAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,OAAD;AAAS,IAAA,SAAS,EAAC,QAAnB;AAA4B,IAAA,IAAI,EAAC,QAAjC;AAA0C,IAAA,SAAS,EAAE7Y,MAAM,CAAC8Y,aAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAM,IAAA,SAAS,EAAC,SAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBADF,CADF,CAFJ,EAQE,MAAC,KAAD;AAAO,IAAA,IAAI,EAAE1H,eAAb;AAA8B,IAAA,MAAM,EAAEK,sBAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,KAAD,CAAO,MAAP;AAAc,IAAA,WAAW,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,KAAD,CAAO,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF,CADF,EAIE,MAAC,KAAD,CAAO,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCACmCN,aAAa,CAACpP,MADjD,WAEGoP,aAAa,CAACpP,MAAd,GAAuB,CAAvB,GAA2B,GAA3B,GAAiC,EAFpC,MAJF,EAQE,MAAC,KAAD,CAAO,MAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,QAAhB;AAAyB,IAAA,OAAO,EAAE2P,oBAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBADF,EAIE,MAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,WAAhB;AAA4B,IAAA,OAAO,EAAED,sBAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAJF,CARF,CARF,EA0BE,MAAC,KAAD;AAAO,IAAA,IAAI,EAAE1L,eAAb;AAA8B,IAAA,MAAM,EAAE;AAAA,aAAMC,kBAAkB,CAAC,KAAD,CAAxB;AAAA,KAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,KAAD,CAAO,MAAP;AAAc,IAAA,WAAW,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,KAAD,CAAO,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACUC,mBAAmB,KAAK,MAAxB,GAAiC,aAAjC,GAAiD,gBAD3D,CADF,CADF,EAME,MAAC,KAAD,CAAO,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,WAAD;AACE,IAAA,IAAI,EAAC,MADP;AAEE,IAAA,WAAW,EAAC,gBAFd;AAGE,IAAA,SAAS,EAAC,MAHZ;AAIE,IAAA,KAAK,EAAEoP,gBAJT;AAKE,IAAA,QAAQ,EAAE,kBAAC0D,CAAD;AAAA,aAAOlF,mBAAmB,CAACkF,CAAC,CAAC9I,MAAF,CAAS5O,KAAV,CAA1B;AAAA,KALZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAQE,MAAC,WAAD;AACE,IAAA,OAAO,EAAE,CAACgK,KAAK,CAACC,OAAN,CAAczF,OAAd,IAAyBA,OAAzB,GAAmC,EAApC,EAAwCiK,MAAxC,CACP,UAACkJ,MAAD;AAAA;;AAAA,aAAY,iBAACA,MAAD,aAACA,MAAD,uBAACA,MAAM,CAAEnY,IAAT,uDAAiB,EAAjB,EAAqB+B,WAArB,GAAmCyJ,QAAnC,CAA4CgJ,gBAAgB,CAACzS,WAAjB,EAA5C,CAAZ;AAAA,KADO,CADX;AAIE,IAAA,cAAc,EAAEkR,kBAJlB;AAKE,IAAA,WAAW,EAAEK,gBALf;AAME,IAAA,cAAc,EAAE,KANlB;AAOE,IAAA,cAAc,EAAE;AAAA,aAAML,kBAAkB,CAAC,IAAD,CAAxB;AAAA,KAPlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,CANF,CA1BF,EAoDE,MAAC,KAAD;AAAO,IAAA,IAAI,EAAEU,cAAb;AAA6B,IAAA,MAAM,EAAE;AAAA,aAAMC,iBAAiB,CAAC,KAAD,CAAvB;AAAA,KAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,KAAD,CAAO,MAAP;AAAc,IAAA,WAAW,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,KAAD,CAAO,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBADF,CADF,EAIE,MAAC,KAAD,CAAO,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,WAAD;AACE,IAAA,IAAI,EAAC,MADP;AAEE,IAAA,WAAW,EAAC,gBAFd;AAGE,IAAA,SAAS,EAAC,MAHZ;AAIE,IAAA,KAAK,EAAEa,eAJT;AAKE,IAAA,QAAQ,EAAE,kBAACyD,CAAD;AAAA,aAAOjE,kBAAkB,CAACiE,CAAC,CAAC9I,MAAF,CAAS5O,KAAV,CAAzB;AAAA,KALZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAQE,MAAC,UAAD;AACE,IAAA,MAAM,EAAEiT,MAAM,CAACxE,MAAP,CAAc,UAACmJ,KAAD;AAAA,aACpB,OAAOA,KAAP,KAAiB,QAAjB,GACIA,KAAK,CAACrW,WAAN,GAAoByJ,QAApB,CAA6BiJ,eAAe,CAAC1S,WAAhB,EAA7B,CADJ,GAEI,KAHgB;AAAA,KAAd,CADV;AAME,IAAA,aAAa,EAAEmS,iBANjB;AAOE,IAAA,cAAc,EAAE;AAAA,aAAMA,iBAAiB,CAAC,IAAD,CAAvB;AAAA,KAPlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,CAJF,CApDF,EA4EE;AAAK,IAAA,SAAS,EAAE/U,MAAM,CAAC6H,IAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAE7H,MAAM,CAACkZ,SAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAQ,IAAA,SAAS,EAAElZ,MAAM,CAACmZ,MAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAEnZ,MAAM,CAACoZ,UAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,IAAI,EAAC,QADP;AAEE,IAAA,SAAS,EAAEpZ,MAAM,CAACqZ,MAFpB;AAGE,IAAA,OAAO,EAAE;AAAA,aAAMjV,cAAc,CAAC,IAAD,CAApB;AAAA,KAHX;AAIE,kBAAW,cAJb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANF,EAOE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAPF,EAQE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,CADF,EAWE;AAAK,IAAA,SAAS,EAAEpE,MAAM,CAACsZ,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,GAAG,EAAC,iBADN;AAEE,IAAA,GAAG,EAAC,OAFN;AAGE,IAAA,SAAS,EAAEtZ,MAAM,CAACuZ,SAHpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAEvZ,MAAM,CAACwZ,SAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADF,EAEE;AAAK,IAAA,SAAS,EAAExZ,MAAM,CAACyZ,QAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAFF,CANF,CAXF,CADF,EAwBE;AAAK,IAAA,SAAS,EAAEzZ,MAAM,CAAC0Z,WAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAE1Z,MAAM,CAAC2Z,YAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG3N,gBAAgB,GAAG,gBAAH,GAAsB,WADzC,CADF,CAxBF,CADF,EAgCE;AAAK,IAAA,SAAS,EAAEhM,MAAM,CAAC4Z,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAO,IAAA,SAAS,EAAE5Z,MAAM,CAAC6Z,OAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAmC7B,aAAa,CAAC,SAAD,CAAhD,CADF,EAEE;AAAM,IAAA,SAAS,EAAEhY,MAAM,CAAC8Z,IAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAE9Z,MAAM,CAAC+Z,SAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAE/Z,MAAM,CAACga,WAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAEha,MAAM,CAACia,UAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADF,EAEE;AAAK,IAAA,SAAS,EAAEja,MAAM,CAACka,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGlZ,SAAS,GAAG,eAAH,aAAwBwC,IAAI,CAACzB,MAA7B,wBADZ,CAFF,CADF,EAOE;AAAK,IAAA,SAAS,EAAE/B,MAAM,CAACma,SAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cACQtS,IADR,OACeI,WAAW,gBAASgO,eAAT,sBAAoCA,eAApC,CAD1B,CAPF,CADF,EAaE;AAAK,IAAA,SAAS,EAAEjW,MAAM,CAACoa,SAAvB;AAAkC,IAAA,GAAG,EAAE3R,YAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGzH,SAAS,GACR;AAAA,wCAAgBhB,MAAM,CAACqa,YAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AACE,IAAA,GAAG,EAAC,iBADN;AAEE,IAAA,GAAG,EAAC,eAFN;AAAA,wCAGara,MAAM,CAACsa,WAHpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAME;AAAA,wCAAgBta,MAAM,CAACua,WAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eANF;AAAA;AAAA;AAAA;AAAA,60uEADQ,GAmBNhS,SAAS,GACX;AAAK,IAAA,SAAS,EAAEvI,MAAM,CAACwa,UAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAExa,MAAM,CAACya,UAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACgBlS,SAAS,CAAC4F,IAD1B,MADF,EAIE;AAAK,IAAA,SAAS,EAAEnO,MAAM,CAAC0a,YAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAsCnS,SAAS,CAAC6F,OAAhD,CAJF,EAKE,MAAC,MAAD;AACE,IAAA,OAAO,EAAC,mBADV;AAEE,IAAA,IAAI,EAAC,IAFP;AAGE,IAAA,OAAO,EAAE,mBAAM;AACbR,MAAAA,eAAe;AACftF,MAAAA,aAAa,CAAC,UAAC0B,CAAD;AAAA,eAAOA,CAAC,GAAG,CAAX;AAAA,OAAD,CAAb;AACD,KANH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aALF,CADW,GAkBX,MAAC,SAAD;AACE,IAAA,IAAI,EAAExG,IADR;AAEE,IAAA,MAAM,EAAEuD,MAFV;AAGE,IAAA,GAAG,EAAEhD,GAHP;AAIE,IAAA,UAAU,EAAEoO,UAJd;AAKE,IAAA,YAAY,EAAEhC,YALhB;AAME,IAAA,WAAW,EAAE4B,WANf;AAOE,IAAA,UAAU,EAAEpK,UAPd;AAQE,IAAA,SAAS,EAAEqJ,SARb;AASE,IAAA,aAAa,EAAE5J,aATjB;AAUE,IAAA,UAAU,EAAED,UAVd;AAWE,IAAA,aAAa,EAAEgK,aAXjB;AAYE,IAAA,gBAAgB,EAAEzB,gBAZpB;AAaE,IAAA,OAAO,EAAErL,QAbX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAtCJ,CAbF,EAqEE;AAAK,IAAA,SAAS,EAAErE,MAAM,CAAC2a,WAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAK,IAAA,SAAS,EAAE3a,MAAM,CAAC4a,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,UAAD;AAAY,IAAA,IAAI,EAAC,IAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,UAAD,CAAY,IAAZ;AACE,IAAA,OAAO,EAAE;AAAA,aAAM9S,OAAO,CAAC,UAACyO,CAAD;AAAA,eAAOlI,IAAI,CAAC6H,GAAL,CAAS,CAAT,EAAYK,CAAC,GAAG,CAAhB,CAAP;AAAA,OAAD,CAAb;AAAA,KADX;AAEE,IAAA,QAAQ,EAAE1O,IAAI,IAAI,CAFpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAKGsO,WALH,EAME,MAAC,UAAD,CAAY,IAAZ;AACE,IAAA,OAAO,EAAE;AAAA,aAAMrO,OAAO,CAAC,UAACyO,CAAD;AAAA,eAAOA,CAAC,GAAG,CAAX;AAAA,OAAD,CAAb;AAAA,KADX;AAEE,IAAA,QAAQ,EAAE,CAACtO,WAFb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANF,CADF,CADF,EAcE,MAAC,IAAD;AAAM,IAAA,SAAS,EAAEjI,MAAM,CAAC6a,SAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,WAAD;AACE,IAAA,IAAI,EAAEhW,cADR;AAEE,IAAA,WAAW,EAAC,QAFd;AAGE,IAAA,SAAS,EAAE7E,MAAM,CAAC8a,WAHpB;AAIE,kBAAW,QAJb;AAKE,IAAA,KAAK,EAAE/V,MALT;AAME,IAAA,QAAQ,EAAEgL,mBANZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EASE,MAAC,WAAD;AACE,IAAA,KAAK,EAAEtL,MADT;AAEE,IAAA,EAAE,EAAC,yBAFL;AAGE,IAAA,IAAI,EAAEE,QAHR;AAIE,IAAA,YAAY,EAAE;AAAA,aAAMC,WAAW,CAAC,IAAD,CAAjB;AAAA,KAJhB;AAKE,IAAA,YAAY,EAAE;AAAA,aAAMA,WAAW,CAAC,KAAD,CAAjB;AAAA,KALhB;AAME,IAAA,SAAS,EAAE5E,MAAM,CAAC+a,YANpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbrW,MAAAA,SAAS,CAAC,MAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YARF,EAgBE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbJ,MAAAA,SAAS,CAAC,MAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAhBF,EAwBE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbJ,MAAAA,SAAS,CAAC,YAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAxBF,EAgCE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbJ,MAAAA,SAAS,CAAC,gBAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAhCF,EAwCE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbJ,MAAAA,SAAS,CAAC,eAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAxCF,EAgDE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbJ,MAAAA,SAAS,CAAC,aAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAhDF,EAwDE,MAAC,WAAD,CAAa,IAAb;AACE,IAAA,OAAO,EAAE,mBAAM;AACbJ,MAAAA,SAAS,CAAC,KAAD,CAAT;AACAI,MAAAA,iBAAiB,CAAC,MAAD,CAAjB;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAxDF,CATF,CAdF,EAyFE;AAAK,IAAA,SAAS,EAAE9E,MAAM,CAACgb,aAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,aAAD;AACE,IAAA,IAAI,EAAC,WADP;AAEE,IAAA,IAAI,EAAC,cAFP;AAGE,IAAA,KAAK,EAAC,2BAHR;AAIE,IAAA,SAAS,EAAEhb,MAAM,CAACib,YAJpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAOE,MAAC,aAAD;AACE,IAAA,IAAI,EAAC,SADP;AAEE,IAAA,IAAI,EAAC,MAFP;AAGE,IAAA,KAAK,EAAC,6BAHR;AAIE,IAAA,SAAS,EAAEjb,MAAM,CAACib,YAJpB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAPF,CAzFF,CArEF,CADF,CAFF,CAhCF,CADF,EAsNE,MAAC,SAAD;AACE,IAAA,IAAI,EAAE9W,WADR;AAEE,IAAA,MAAM,EAAE;AAAA,aAAMC,cAAc,CAAC,KAAD,CAApB;AAAA,KAFV;AAGE,IAAA,SAAS,EAAC,OAHZ;AAIE,IAAA,SAAS,EAAEpE,MAAM,CAACkb,aAJpB;AAKE,IAAA,MAAM,MALR;AAME,IAAA,QAAQ,MANV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAQE,MAAC,SAAD,CAAW,MAAX;AAAkB,IAAA,WAAW,MAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,SAAD,CAAW,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,CARF,EAWE,MAAC,SAAD,CAAW,IAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAiBlD,aAAa,CAAC,QAAD,CAA9B,CAXF,CAtNF,CA5EF,CADF;AAqTD;;IA93CuB1U,U;UACF3D,O,EA2BLJ,S;;;MA5BO+D,U","sourcesContent":["import React, { useEffect, useState, useRef, useCallback } from \"react\";\nimport {\n  InputGroup,\n  Dropdown,\n  FormControl,\n  Button,\n  NavDropdown,\n  Form,\n  Modal,\n  Spinner,\n  Pagination,\n  Offcanvas,\n} from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport {\n  fetchPartsWithMachineDataPage,\n  fetchClients,\n  fetchModels,\n} from \"../../utils/fetchAssociations\";\nimport { useAuth } from \"../../context/AuthUserContext\";\r\nimport LoggedIn from \"../LoggedIn\";\r\nimport ClientTable from \"../../utils/ClientTable\";\r\nimport ModelTable from \"../../utils/ModelTable\";\r\nimport PartTable from \"../../utils/PartTable\";\nimport styles from \"../../styles/MainSearch.module.css\";\nimport firebase from \"../../context/Firebase\";\nimport { buildNameTokens } from \"../../utils/itemFormShared\";\n\r\n// Predefined warehouse client IDs and display names\r\nconst SOCAL_CLIENT_ID = \"AIS17182\";\r\nconst NORCAL_CLIENT_ID = \"AIS25097\";\nconst UNASSIGNED_CLIENT_ID = \"AIS00404\";\nconst DEFAULT_PAGE_SIZE = 25;\n\r\n\r\n// Simulates a network request delay\r\nfunction simulateNetworkRequest() {\r\n  return new Promise((resolve) => setTimeout(resolve, 2000));\r\n}\r\n\r\n// Custom LoadingButton component\r\nfunction LoadingButton({ type, name, route, className }) {\n  const [isLoading, setLoading] = useState(false);\n\n  useEffect(() => {\n    if (isLoading) {\n      let cancelled = false;\n      simulateNetworkRequest().then(() => {\n        if (!cancelled) setLoading(false);\n      });\n      return () => {\n        cancelled = true;\n      };\n    }\n  }, [isLoading]);\n\r\n  return (\n    <Link href={`/${route}`}>\n      <a\n        className={`btn btn-${type} ${className || \"\"}`}\n        disabled={isLoading}\n        onClick={() => !isLoading && setLoading(true)}\n      >\n        {isLoading ? \"Loading…\" : name}\r\n      </a>\r\n    </Link>\r\n  );\r\n}\r\n\r\n// ---- DATE HELPERS (top-level scope) ----\r\n\r\n// Convert anything date-ish into a timestamp (ms since epoch).\r\nfunction toTime(value) {\r\n  if (!value) return null;\r\n\r\n  // Firestore Timestamp { seconds, nanoseconds }\r\n  if (typeof value === \"object\" && value !== null && value.seconds != null) {\r\n    try { return value.seconds * 1000; } catch { /* ignore */ }\r\n  }\r\n\r\n  // Native Date\r\n  if (value instanceof Date) {\r\n    const t = value.getTime();\r\n    return isNaN(t) ? null : t;\r\n  }\r\n\r\n  // Strings\r\n  if (typeof value === \"string\") {\r\n    // ISO / yyyy-mm-dd\r\n    const iso = Date.parse(value);\r\n    if (!isNaN(iso)) return iso;\r\n\r\n    // mm/dd/yyyy\r\n    const parts = value.split(\"/\");\r\n    if (parts.length === 3) {\r\n      const [mm, dd, yyyy] = parts;\r\n      const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\r\n      if (!isNaN(alt)) return alt;\r\n    }\r\n  }\r\n\r\n  // Last resort\r\n  const t = Date.parse(value);\r\n  return isNaN(t) ? null : t;\r\n}\r\n\r\n// Canonicalize to 'yyyy-mm-dd' (matches <input type=\"date\">)\r\nfunction toYMD(value) {\n  const t = toTime(value);\n  if (t == null) return null;\n  const d = new Date(t);\n  const yyyy = d.getFullYear();\n  const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  const dd = String(d.getDate()).padStart(2, \"0\");\n  return `${yyyy}-${mm}-${dd}`;\n}\n\nfunction normalizeText(value) {\n  if (value == null) return \"\";\n  return String(value).toLowerCase().trim();\n}\n\nfunction getMachineField(item, key) {\n  if (!item) return null;\n  const lower = key.toLowerCase();\n  return (\n    item?.machineData?.[key] ??\n    item?.machineData?.[lower] ??\n    item?.currentMachineData?.[key] ??\n    item?.currentMachineData?.[lower] ??\n    item?.theMachineData?.[key] ??\n    item?.theMachineData?.[lower] ??\n    item?.TheMachine?.[key] ??\n    item?.TheMachine?.[lower] ??\n    null\n  );\n}\n\n\nexport default function MainSearch() {\n  const { signOut } = useAuth();\r\n  const [info, setInfo] = useState([]);\r\n  const [backupInfo, setBackupInfo] = useState([]);\r\n  const [augmentedInfo, setAugmentedInfo] = useState([]); // items with clientFromId/currentId added\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [ids, setID] = useState([]);\r\n  const [show, setShow] = useState(false);\n  const [showFilters, setShowFilters] = useState(false);\n  const [pageSize, setPageSize] = useState(DEFAULT_PAGE_SIZE);\n  const [dItem, setDItem] = useState();\r\n  const [select, setSelect] = useState(\"Name\");\r\n  const [showList, setShowList] = useState(false);\r\n  const [showListSearch, setShowListSearch] = useState(\"text\");\r\n  const [search, setSearch] = useState(\"\");\r\n  const [selectedOEM, setSelectedOEM] = useState(null);\r\n  const [selectedModality, setSelectedModality] = useState(null);\r\n  // Replace the old single client state with two sets:\r\n  const [selectedClientFrom, setSelectedClientFrom] = useState(null);\r\n  const [clientFromButtonText, setClientFromButtonText] = useState(\"Select Option\");\r\n  const [selectedClientCurrent, setSelectedClientCurrent] = useState(null);\r\n  const [clientCurrentButtonText, setClientCurrentButtonText] = useState(\"Select Option\");\r\n\r\n  const [clients, setClients] = useState([]);\r\n  const [showClientModal, setShowClientModal] = useState(false);\r\n  // This state tells the modal which client box is being updated: \"from\" or \"current\"\r\n  const [clientSelectionType, setClientSelectionType] = useState(null);\r\n\r\n  const router = useRouter();\r\n  const labelBase = [\"name\", \"date\", \"w/o\", \"p/n\", \"s/n\"];\r\n  const labelBaseNames = [\"name\", \"date\", \"wo\", \"pn\", \"sn\"];\r\n  const sortCheckBase = [false, false, false, false, false, false];\r\n\r\n  function withSortIcon(baseLabels, activeIndex, isDesc) {\r\n    return baseLabels.map((text, i) => {\r\n      if (i !== activeIndex) return text; // untouched\r\n      const arrow = isDesc ? \" ▼\" : \" ▲\";\r\n      return `${text}${arrow}`;\r\n    });\r\n  }\r\n\r\n\r\n  const [labels, setLabels] = useState(labelBase);\r\n  const [sortCheck, setSortCheck] = useState(sortCheckBase);\r\n  const [hoverIndex, setHoverIndex] = useState(null);\r\n  const [selectedModel, setSelectedModel] = useState(null);\r\n  const [gPos, setGPos] = useState(null);\n  const [gIde, setGIde] = useState(null);\n  const [isDeleting, setIsDeleting] = useState(false);\n  const [page, setPage] = useState(1);\n  const [pageCursors, setPageCursors] = useState([]);\n  const [hasNextPage, setHasNextPage] = useState(false);\n  const fetchSeq = useRef(0);\n  const backfillInFlight = useRef(false);\n  const [queryEpoch, setQueryEpoch] = useState(0);\n  const [loadError, setLoadError] = useState(null);\n  const tableBodyRef = useRef(null);\n  const rowHeightRef = useRef(46);\n  const headerHeightRef = useRef(38);\n\n  const LOAD_TIMEOUT_MS = 30000;\n\n  const startNameTokenBackfill = useCallback(async (reason = \"\") => {\n    if (backfillInFlight.current) return;\n    if (typeof window !== \"undefined\") {\n      const lastRun = window.localStorage.getItem(\"nameTokensBackfillAt\");\n      if (lastRun && Date.now() - Number(lastRun) < 24 * 60 * 60 * 1000) {\n        return;\n      }\n    }\n\n    backfillInFlight.current = true;\n    const db = firebase.firestore();\n    let lastDoc = null;\n\n    const tokensEqual = (a, b) => {\n      if (a.length !== b.length) return false;\n      const setA = new Set(a);\n      const setB = new Set(b);\n      if (setA.size !== setB.size) return false;\n      for (const v of setA) if (!setB.has(v)) return false;\n      return true;\n    };\n\n    try {\n      while (true) {\n        let query = db\n          .collection(\"Test\")\n          .orderBy(firebase.firestore.FieldPath.documentId())\n          .limit(200);\n        if (lastDoc) query = query.startAfter(lastDoc);\n\n        const snap = await query.get();\n        if (snap.empty) break;\n\n        const batch = db.batch();\n        let writes = 0;\n\n        snap.docs.forEach((doc) => {\n          const data = doc.data() || {};\n          const name = typeof data.name === \"string\" ? data.name : \"\";\n          const nameLower = name.toLowerCase();\n          const nameTokens = buildNameTokens(name);\n          const existingTokens = Array.isArray(data.nameTokens)\n            ? Array.from(new Set(data.nameTokens.map((v) => String(v))))\n            : [];\n\n          const needsUpdate =\n            data.nameLower !== nameLower ||\n            !tokensEqual(existingTokens, nameTokens);\n\n          if (needsUpdate) {\n            batch.update(doc.ref, { nameLower, nameTokens });\n            writes += 1;\n          }\n        });\n\n        if (writes > 0) {\n          await batch.commit();\n        }\n\n        lastDoc = snap.docs[snap.docs.length - 1];\n        await new Promise((resolve) => setTimeout(resolve, 25));\n      }\n\n      if (typeof window !== \"undefined\") {\n        window.localStorage.setItem(\n          \"nameTokensBackfillAt\",\n          String(Date.now())\n        );\n      }\n    } catch (error) {\n      console.error(\"Name token backfill failed:\", reason, error);\n    } finally {\n      backfillInFlight.current = false;\n    }\n  }, []);\n\n  const searchLower = (search || \"\").toLowerCase().trim();\n  const hasActiveFilters =\n    Boolean(selectedOEM) ||\n    Boolean(selectedModality) ||\n    Boolean(selectedModel) ||\n    Boolean(selectedClientFrom) ||\n    Boolean(selectedClientCurrent) ||\n    Boolean(searchLower);\n\n  const valueMatches = (value, s) => {\n    if (!value) return false;\n    if (Array.isArray(value)) {\n      return value.some((v) => valueMatches(v, s));\n    }\n    return String(value).toLowerCase().includes(s);\n  };\n\n  const matchesFilters = useCallback(\n    (item) => {\n      // hide explicitly hidden items\n      if (item?.visible === false) return false;\n\n      // OEM / Modality / Model filtering\n      const OEM = getMachineField(item, \"OEM\");\n      const Modality = getMachineField(item, \"Modality\");\n      const Model = getMachineField(item, \"Model\");\n\n      if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n        return false;\n      }\n      if (\n        selectedModality &&\n        normalizeText(Modality) !== normalizeText(selectedModality)\n      ) {\n        return false;\n      }\n      if (selectedModel && normalizeText(Model) !== normalizeText(selectedModel)) {\n        return false;\n      }\n\n      // Client filters\n      if (selectedClientFrom && item?.clientFromId !== selectedClientFrom) {\n        return false;\n      }\n      if (\n        selectedClientCurrent &&\n        item?.clientCurrentId !== selectedClientCurrent\n      ) {\n        return false;\n      }\n\n      // Search\n      if (searchLower) {\n        if (select === \"Name\") {\n          return valueMatches(item?.name, searchLower);\n        }\n        if (select === \"Date\") {\n          const wantedDay = searchLower; // yyyy-mm-dd from input\n          const itemYMD = toYMD(item?.date);\n          if (itemYMD && itemYMD === wantedDay) return true;\n          if (Array.isArray(item?.descriptions)) {\n            if (item.descriptions.some((d) => toYMD(d?.date) === wantedDay)) {\n              return true;\n            }\n          }\n          if (Array.isArray(item?.workOrders)) {\n            if (item.workOrders.some((w) => toYMD(w?.date) === wantedDay)) {\n              return true;\n            }\n          }\n          return false;\n        }\n        if (select === \"Work Order\") {\n          return (\n            Array.isArray(item?.workOrders) &&\n            item.workOrders.some((wo) =>\n              valueMatches(wo?.workOrder, searchLower)\n            )\n          );\n        }\n        if (select === \"Product Number\") {\n          return valueMatches(item?.pn, searchLower);\n        }\n        if (select === \"Serial Number\") {\n          return valueMatches(item?.sn, searchLower);\n        }\n        if (select === \"Description\") {\n          if (valueMatches(item?.desc, searchLower)) return true;\n          if (valueMatches(item?.description, searchLower)) return true;\n          if (Array.isArray(item?.descriptions)) {\n            return item.descriptions.some((d) =>\n              valueMatches(d?.description, searchLower)\n            );\n          }\n          return false;\n        }\n        if (select === \"SKU\") {\n          return (\n            valueMatches(item?.id, searchLower) ||\n            valueMatches(item?.localSN, searchLower) ||\n            valueMatches(item?.local_sn, searchLower)\n          );\n        }\n      }\n\n      return true;\n    },\n    [\n      selectedOEM,\n      selectedModality,\n      selectedModel,\n      selectedClientFrom,\n      selectedClientCurrent,\n      searchLower,\n      select,\n    ]\n  );\n\n  const resetPagination = () => {\n    setPage(1);\n    setPageCursors([]);\n    setHasNextPage(false);\n  };\n\n  // Reset pagination on route/query change (prevents stale pages like “starting at 6”)\n  useEffect(() => {\n    resetPagination();\n    setQueryEpoch((v) => v + 1);\n  }, [router.asPath]);\n\n  // Reset and refetch when filters/search change\n  useEffect(() => {\n    resetPagination();\n    setQueryEpoch((v) => v + 1);\n  }, [\n    selectedOEM,\n    selectedModality,\n    selectedModel,\n    selectedClientFrom,\n    selectedClientCurrent,\n    search,\n    select,\n  ]);\n\n\n  // Fetch data on component mount and route change\n  useEffect(() => {\n    fetchData(page);\n  }, [page, queryEpoch]);\n\n  async function fetchData(requestedPage = 1) {\n    const seq = ++fetchSeq.current;\n    let timedOut = false;\n    setIsLoading(true);\n    setLoadError(null);\n    const timeoutId = setTimeout(() => {\n      timedOut = true;\n      if (seq === fetchSeq.current) {\n        setLoadError({\n          code: \"timeout\",\n          message: `Loading is taking longer than ${Math.round(\n            LOAD_TIMEOUT_MS / 1000\n          )}s. This is likely due to very selective filters.`,\n        });\n        setIsLoading(false);\n      }\n    }, LOAD_TIMEOUT_MS);\n    try {\n      if (router.query.inputText && router.query.selectedType) {\n        setSelect(router.query.selectedType);\n        setSearch(router.query.inputText);\n      }\n      const startAfterDoc =\n        requestedPage > 1 ? pageCursors[requestedPage - 2] : null;\n      if (requestedPage > 1 && !startAfterDoc) {\n        setPage(1);\n        if (seq === fetchSeq.current) {\n          clearTimeout(timeoutId);\n          setIsLoading(false);\n        }\n        return;\n      }\n      const effectiveSelect = router.query.selectedType || select;\n      const effectiveSearch = router.query.inputText || search;\n      const effectiveSearchLower = (effectiveSearch || \"\")\n        .toLowerCase()\n        .trim();\n\n      // light retry for transient Firestore hiccups\n      const load = async (attempt = 1) => {\n        try {\n          return await fetchPartsWithMachineDataPage({\n            pageSize,\n            startAfterDoc,\n            visibleOnly: true,\n            filterFn: hasActiveFilters ? matchesFilters : null,\n            search: effectiveSearchLower\n              ? {\n                  type: effectiveSelect,\n                  raw: effectiveSearch,\n                  lower: effectiveSearchLower,\n                }\n              : null,\n            needsMachineData:\n              Boolean(selectedOEM) ||\n              Boolean(selectedModality) ||\n              Boolean(selectedModel) ||\n              Boolean(selectedClientFrom) ||\n              Boolean(selectedClientCurrent),\n          });\n        } catch (e) {\n          if (attempt >= 3) throw e;\n          await new Promise(r => setTimeout(r, 250 * Math.pow(2, attempt - 1)));\n          return load(attempt + 1);\n        }\n      };\n      const { parts: data, lastDoc, hasNextPage: nextPage } = await load();\n      if (timedOut || seq !== fetchSeq.current) return;\n      const hasNameSearch =\n        Boolean(effectiveSearchLower) && effectiveSelect === \"Name\";\n      if (\n        hasNameSearch &&\n        (data.length === 0 ||\n          data.some(\n            (item) =>\n              !Array.isArray(item?.nameTokens) || item.nameTokens.length === 0\n          ))\n      ) {\n        startNameTokenBackfill(\"name-search\");\n      }\n      if (requestedPage === 1 && data.length === 0) {\n        setPageCursors([]);\n        setHasNextPage(false);\n      }\n      setBackupInfo(data);\n      setLabels(labelBase); // <-- add this line after setBackupInfo(data)\n      setID(data.map((item) => item.id));\n      if (requestedPage > 1 && data.length === 0) {\n        setHasNextPage(false);\n        setPage(1);\n        return;\n      }\n      setHasNextPage(nextPage);\n      setPageCursors((prev) => {\n        const next = requestedPage === 1 ? [] : [...prev];\n        if (lastDoc) {\n          next[requestedPage - 1] = lastDoc;\n        }\n        return next;\n      });\n      setSelectedItems([]);\n\n      // Normalize client ids for filtering\n      const augmented = data.map((item) => ({\n        ...item,\n        clientFromId:\n          item?.clientFromId ??\n          (typeof item?.ClientFrom === \"string\" ? item.ClientFrom : null) ??\n          item?.ClientFrom?.id ??\n          null,\n        clientCurrentId:\n          item?.clientCurrentId ??\n          (typeof item?.ClientCurrent === \"string\" ? item.ClientCurrent : null) ??\n          item?.ClientCurrent?.id ??\n          null,\n      }));\n\r\n      setAugmentedInfo(augmented);\n      // default view = filtered (keeps pagination and filters consistent)\n      setInfo(augmented.filter(matchesFilters));\n    } catch (err) {\n      if (seq !== fetchSeq.current) return;\n      console.error(\"Error fetching data:\", err);\n      const code = err?.code || \"unknown\";\n      setLoadError({\n        code,\n        message: err?.message || \"Failed to load items.\",\n      });\n      setInfo([]);\n      setAugmentedInfo([]);\n    } finally {\n      clearTimeout(timeoutId);\n      if (seq === fetchSeq.current && !timedOut) setIsLoading(false);\n    }\n  }\n\r\n  const searchChangeHandler = (event) => setSearch(event.target.value);\r\n\r\n  // Filter the currently loaded items (now consistent with paged filtering)\n  useEffect(() => {\n    const base = augmentedInfo || [];\n    setInfo(base.filter(matchesFilters));\n  }, [augmentedInfo, matchesFilters]);\n\r\n  function sortCheckAll(pos) {\r\n    // Determine next direction: toggle the clicked column only\r\n    const nextSortCheck = sortCheck.map((v, i) => (i === pos ? !v : v));\r\n    const isDesc = nextSortCheck[pos]; // true means descending\r\n\r\n    const sortedInfo = [...info].sort((a, b) => {\r\n      const key = labelBaseNames[pos];\r\n\r\n      if (pos === 1) {\r\n        // DATE column\r\n        const ta = toTime(a[key]);\r\n        const tb = toTime(b[key]);\r\n\r\n        // Put missing dates at the end for ascending, at the start for descending\r\n        if (ta === null && tb === null) return 0;\r\n        if (ta === null) return isDesc ? -1 : 1;\r\n        if (tb === null) return isDesc ? 1 : -1;\r\n\r\n        return isDesc ? (tb - ta) : (ta - tb);\r\n      }\r\n\r\n      // NAME or SKU (string-y columns): indexes 0 or 5 in your original logic\r\n      if (pos === 0 || pos === 5) {\r\n        const av = (a[key] ?? \"\").toString();\r\n        const bv = (b[key] ?? \"\").toString();\r\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\r\n      }\r\n\r\n      // Numeric-ish columns (wo, pn, sn) — fall back to string compare if NaN\r\n      const an = Number(a[key]);\r\n      const bn = Number(b[key]);\r\n\r\n      if (!isNaN(an) && !isNaN(bn)) {\r\n        return isDesc ? (bn - an) : (an - bn);\r\n      } else {\r\n        const av = (a[key] ?? \"\").toString();\r\n        const bv = (b[key] ?? \"\").toString();\r\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\r\n      }\r\n    });\r\n\r\n    setInfo(sortedInfo);\r\n    setSortCheck(nextSortCheck);\r\n\r\n    // Update header labels to show the little arrow on the active column\r\n    setLabels(withSortIcon(labelBase, pos, isDesc));\r\n  }\r\n\r\n\r\n  const rowSelect = (item) => {\r\n    if (item && item.id) {\r\n      console.log(\"Selected item:\", item);\r\n      router.push(\"./item/\" + item.id);\r\n    } else {\r\n      console.error(\"Unable to determine the selected item’s ID: \", item);\r\n    }\r\n  };\r\n\r\n  const [selectedItems, setSelectedItems] = useState([]);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n\r\n  const handleSelectItem = (id) => {\r\n    setSelectedItems(prev =>\r\n      prev.includes(id) ? prev.filter(x => x !== id) : [...prev, id]\r\n    );\r\n  };\r\n\r\n\r\n  // setSelectedItems((prev) => {\r\n  //   const newSelection = prev.includes(id)\r\n  //     ? prev.filter((itemId) => itemId !== id)\r\n  //     : [...prev, id];\r\n  //   console.log(\"Selected items:\", newSelection);\r\n  //   return newSelection; // <- important\r\n  // });\r\n\r\n  const handleShowDeleteModal = () => setShowDeleteModal(true);\r\n  const handleCloseDeleteModal = () => setShowDeleteModal(false);\r\n\r\n  const handleDeleteSelected = async () => {\r\n    setIsDeleting(true);\r\n    const db = firebase.firestore();\r\n    try {\r\n      // Loop over each selected item one at a time\r\n      for (const itemId of selectedItems) {\r\n        console.log(itemId)\r\n        try {\r\n          // Delete from \"Test\" collection\r\n          await db.collection(\"Test\").doc(itemId).delete();\r\n        } catch (err) {\r\n          console.error(`Error deleting document ${itemId} from Test:`, err);\r\n        }\r\n        try {\r\n          // Delete from \"Parts\" collection\r\n          await db.collection(\"Parts\").doc(itemId).delete();\r\n        } catch (err) {\r\n          console.error(`Error deleting document ${itemId} from Parts:`, err);\r\n        }\r\n        try {\r\n          // Delete associated photos from storage\r\n          await deleteFromStorage(itemId);\r\n        } catch (err) {\r\n          console.error(`Error deleting storage for ${itemId}:`, err);\r\n        }\r\n      }\r\n      // Update local state by filtering out the deleted items\r\n      setInfo(info.filter((item) => !selectedItems.includes(item.id)));\r\n      setSelectedItems([]);\r\n    } catch (error) {\r\n      console.error(\"Error deleting items:\", error);\r\n    } finally {\r\n      setIsDeleting(false);\r\n      handleCloseDeleteModal();\r\n      // Optionally, reload the page\r\n      // router.reload();\r\n    }\r\n  };\r\n\r\n\r\n  const handleClose = () => setShow(false);\r\n  const handleShow = () => setShow(true);\r\n\r\n  const checkDelete = (event, pos, idsToDelete, name) => {\r\n    if (event) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n    }\r\n    console.log(\"Selected IDs to delete:\", idsToDelete);\r\n    setSelectedItems(idsToDelete);\r\n    setDItem(name);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  // const handleDelete = async () => {\r\n  //   let itemId = gIde;\r\n  //   try {\r\n  //     setIsDeleting(true);\r\n  //     const db = firebase.firestore();\r\n  //     await db.collection(\"Test\").doc(itemId).delete();\r\n  //     await deleteFromPartsCollection(itemId);\r\n  //     await deleteFromStorage(itemId);\r\n  //     setInfo(info.filter((_, i) => gPos !== i));\r\n  //     console.log(`Deleted item: ${itemId}`);\r\n  //   } catch (error) {\r\n  //     console.error(\"Error deleting item:\", error);\r\n  //   } finally {\r\n  //     setIsDeleting(false);\r\n  //   }\r\n  //   handleClose();\r\n  // };\r\n\r\n  const hoverStyle = (index) => ({\r\n    backgroundColor: hoverIndex === index ? \"#ddd\" : \"transparent\",\r\n    textAlign: \"center\",\r\n    cursor: \"default\",\r\n  });\r\n\r\n  const [dropdown1Text, setDropdown1Text] = useState(\"Select Option\");\r\n  const [dropdown2Text, setDropdown2Text] = useState(\"Select Option\");\r\n\r\n  const handleSelect1 = (eventKey, event) => {\r\n    if (eventKey === \"unassigned\") {\r\n      setDropdown1Text(\"Select Option\");\r\n      setSelectedOEM(null);\r\n    } else {\r\n      setDropdown1Text(event.target.textContent);\r\n      setSelectedOEM(event.target.textContent);\r\n    }\r\n  };\r\n\r\n  const handleSelect2 = (eventKey, event) => {\r\n    if (eventKey === \"unassigned\") {\r\n      setDropdown2Text(\"Select Option\");\r\n      setSelectedModality(null);\r\n    } else {\r\n      setDropdown2Text(event.target.textContent);\r\n      setSelectedModality(event.target.textContent);\r\n    }\r\n  };\r\n\r\n  // Build a unique list of clients from the items currently loaded, filtered by OEM/Modality.\r\n  // `type` is \"from\" or \"current\" to decide which client ref to read.\r\n  async function buildClientsFromItems(type) {\n    const db = firebase.firestore();\n    const ids = new Set();\n\n    // Respect current OEM / Modality filters when deriving client options\n    const filtered = augmentedInfo.filter((item) => {\n      const OEM = getMachineField(item, \"OEM\");\n      const Modality = getMachineField(item, \"Modality\");\n      if (selectedOEM && normalizeText(OEM) !== normalizeText(selectedOEM)) {\n        return false;\n      }\n      if (\n        selectedModality &&\n        normalizeText(Modality) !== normalizeText(selectedModality)\n      ) {\n        return false;\n      }\n      return true;\n    });\n\r\n    for (const it of filtered) {\r\n      const id = type === \"from\" ? it.clientFromId : it.clientCurrentId;\r\n      if (id) ids.add(id);\r\n    }\r\n\r\n    const out = [];\r\n    const idArray = [...ids];\r\n    for (let i = 0; i < idArray.length; i += 10) {\r\n      const chunk = idArray.slice(i, i + 10);\r\n      const snap = await db\r\n        .collection(\"Client\")\r\n        .where(firebase.firestore.FieldPath.documentId(), \"in\", chunk)\r\n        .get();\r\n      snap.forEach((doc) => {\r\n        const d = doc.data() || {};\r\n        out.push({ id: doc.id, name: d.name || doc.id });\r\n      });\r\n    }\r\n\r\n    // sort by name for nicer UX\r\n    out.sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\"));\r\n    return out;\r\n  }\r\n\r\n\r\n  // --------------------\r\n  // CLIENT SELECTION HANDLING\r\n  // --------------------\r\n  // This function fetches clients and opens the client modal.\r\n  const handleClientClick = async () => {\r\n    let safeClients = [];\r\n    try {\r\n      const clientsData = await fetchClients(selectedOEM, selectedModality);\r\n      safeClients = Array.isArray(clientsData) ? clientsData : [];\r\n    } catch (e) {\r\n      console.error(\"fetchClients failed:\", e);\r\n    }\r\n\r\n    // Fallback to building from loaded items if API gave us nothing\r\n    if (safeClients.length === 0) {\r\n      try {\r\n        if (!clientSelectionType) {\r\n          // if somehow not set yet, default to \"from\"\r\n          setClientSelectionType(\"from\");\r\n        }\r\n        const derived = await buildClientsFromItems(clientSelectionType || \"from\");\r\n        safeClients = derived;\r\n      } catch (e) {\r\n        console.error(\"Fallback buildClientsFromItems failed:\", e);\r\n        safeClients = [];\r\n      }\r\n    }\r\n\r\n    setClients(safeClients);\r\n    setClientSearchTerm(\"\");\r\n    setShowClientModal(true);\r\n  };\r\n\r\n\r\n\r\n  // When a client is selected in the modal, we now assume the parameter is a client ID.\r\n  // If the passed value is null, we clear the selection.\r\n  const handleClientSelect = async (clientId) => {\r\n    console.log(\"User selected client id:\", clientId);\r\n    if (!clientId) {\r\n      if (clientSelectionType === \"from\") {\r\n        setClientFromButtonText(\"Select Option\");\r\n        setSelectedClientFrom(null);\r\n      } else if (clientSelectionType === \"current\") {\r\n        setClientCurrentButtonText(\"Select Option\");\r\n        setSelectedClientCurrent(null);\r\n      }\r\n      setShowClientModal(false);\r\n      return;\r\n    }\r\n    try {\r\n      const clientSnap = await firebase.firestore().collection(\"Client\").doc(clientId).get();\r\n      if (clientSnap.exists) {\r\n        const clientData = clientSnap.data();\r\n        if (clientSelectionType === \"from\") {\r\n          setClientFromButtonText(clientData.name);\r\n          setSelectedClientFrom(clientId);\r\n        } else if (clientSelectionType === \"current\") {\r\n          setClientCurrentButtonText(clientData.name);\r\n          setSelectedClientCurrent(clientId);\r\n        }\r\n      } else {\r\n        console.error(\"No client document found for id:\", clientId);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching client data:\", error);\r\n    }\r\n    setShowClientModal(false);\r\n  };\r\n\r\n  const handleClientInfo = (clientId, clientName) => {\r\n    console.log(`Client ID: ${clientId}, Client Name: ${clientName}`);\r\n    router.push(\"client/\" + clientId);\r\n  };\r\n\r\n  const handleClearClientSelection = () => {\r\n    if (clientSelectionType === \"from\") {\r\n      setClientFromButtonText(\"Select Option\");\r\n      setSelectedClientFrom(null);\r\n    } else if (clientSelectionType === \"current\") {\r\n      setClientCurrentButtonText(\"Select Option\");\r\n      setSelectedClientCurrent(null);\r\n    }\r\n    setShowClientModal(false);\r\n  };\r\n\r\n  // --------------------\r\n  // MODEL SELECTION HANDLING\r\n  // --------------------\r\n  const [models, setModels] = useState([]);\r\n  const [showModelModal, setShowModelModal] = useState(false);\r\n  const [modelButtonText, setModelButtonText] = useState(\"Select Option\");\r\n\r\n  const handleModelClick = async () => {\r\n    const modelsData = await fetchModels(\r\n      selectedOEM,\r\n      selectedModality,\r\n      selectedClientFrom\r\n    );\r\n    setModels(modelsData);\r\n    setModelSearchTerm(\"\");\r\n    setShowModelModal(true);\r\n  };\r\n\r\n  const handleModelSelect = (modelName) => {\r\n    setModelButtonText(modelName || \"Select Option\");\r\n    setSelectedModel(modelName || null);\r\n    setShowModelModal(false);\r\n  };\r\n\r\n  const handleClearModelSelection = () => {\r\n    setModelButtonText(\"Select Option\");\r\n    setSelectedModel(null);\r\n    setShowModelModal(false);\r\n  };\r\n\r\n  // --------------------\r\n  // WAREHOUSE BUTTONS (for Client Current)\r\n  // --------------------\r\n  const handleSoCalWarehouseClick = () => {\r\n    setClientCurrentButtonText(\"SoCal Warehouse\");\r\n    setSelectedClientCurrent(SOCAL_CLIENT_ID);\r\n    console.log(\"Warehouse button clicked: setting Client Current to\", SOCAL_CLIENT_ID);\r\n  };\r\n\r\n  const handleNorCalWarehouseClick = () => {\r\n    setClientCurrentButtonText(\"NorCal Warehouse\");\r\n    setSelectedClientCurrent(NORCAL_CLIENT_ID);\r\n    console.log(\"Warehouse button clicked: setting Client Current to\", NORCAL_CLIENT_ID);\r\n  };\r\n\r\n  const handleWarehouseUnassignedClick = () => {\r\n    setClientCurrentButtonText(\"Unassigned\");\r\n    setSelectedClientCurrent(UNASSIGNED_CLIENT_ID);\r\n    console.log(\"Warehouse button clicked: setting Client Current to\", UNASSIGNED_CLIENT_ID);\r\n  };\r\n\r\n  const [clientSearchTerm, setClientSearchTerm] = useState(\"\");\r\n  const [modelSearchTerm, setModelSearchTerm] = useState(\"\");\r\n\r\n  const deleteFromStorage = async (itemId) => {\r\n    const storageRef = firebase.storage().ref();\r\n    const folderRef = storageRef.child(`Parts/${itemId}/`);\r\n    try {\r\n      const listResult = await folderRef.listAll();\r\n      const deletePromises = listResult.items.map((item) => item.delete());\r\n      await Promise.all(deletePromises);\r\n    } catch (error) {\r\n      console.error(\"Error deleting from storage:\", error);\r\n    }\r\n  };\r\n\r\n  const deleteFromPartsCollection = async (itemId) => {\r\n    const db = firebase.firestore();\r\n    try {\r\n      await db.collection(\"Parts\").doc(itemId).delete();\r\n      console.log(`Deleted item from Parts collection: ${itemId}`);\r\n    } catch (error) {\r\n      console.error(\"Error deleting from Parts collection:\", error);\r\n    }\r\n  };\r\n\r\n  //   // Safely convert any date-ish value into a comparable timestamp (ms since epoch).\r\n  // function toTime(value) {\r\n  //   if (!value) return null;\r\n\r\n  //   // Firestore Timestamp: { seconds, nanoseconds }\r\n  //   if (typeof value === \"object\" && value.seconds) {\r\n  //     try {\r\n  //       return value.seconds * 1000;\r\n  //     } catch { /* fallthrough */ }\r\n  //   }\r\n\r\n  //   // If already a Date\r\n  //   if (value instanceof Date) return isNaN(value.getTime()) ? null : value.getTime();\r\n\r\n  //   // If string: try ISO first\r\n  //   if (typeof value === \"string\") {\r\n  //     // yyyy-mm-dd (from your form inputs)\r\n  //     const iso = Date.parse(value);\r\n  //     if (!isNaN(iso)) return iso;\r\n\r\n  //     // mm/dd/yyyy fallback (older items)\r\n  //     const parts = value.split(\"/\");\r\n  //     if (parts.length === 3) {\r\n  //       const [mm, dd, yyyy] = parts;\r\n  //       const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\r\n  //       if (!isNaN(alt)) return alt;\r\n  //     }\r\n  //   }\r\n\r\n  //   // Canonicalize any date-ish value to 'yyyy-mm-dd' so it matches <input type=\"date\"> values\r\n  //   function toYMD(value) {\r\n  //     const t = toTime(value);\r\n  //     if (t == null) return null;\r\n  //     const d = new Date(t);\r\n  //     const yyyy = d.getFullYear();\r\n  //     const mm = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  //     const dd = String(d.getDate()).padStart(2, \"0\");\r\n  //     return `${yyyy}-${mm}-${dd}`;\r\n  //   }\r\n\r\n\r\n  //   // Last resort\n  //   const t = Date.parse(value);\n  //   return isNaN(t) ? null : t;\n  // }\n\n  const totalKnownPages = Math.max(\n    1,\n    pageCursors.filter(Boolean).length + (hasNextPage ? 1 : 0)\n  );\n  const pageButtons = (() => {\n    const buttons = [];\n    const maxVisible = 7;\n\n    const pushPage = (p) =>\n      buttons.push(\n        <Pagination.Item\n          key={`page-${p}`}\n          active={p === page}\n          onClick={() => setPage(p)}\n        >\n          {p}\n        </Pagination.Item>\n      );\n\n    const pushEllipsis = (key) =>\n      buttons.push(<Pagination.Ellipsis key={key} disabled />);\n\n    if (totalKnownPages <= maxVisible) {\n      for (let i = 1; i <= totalKnownPages; i += 1) pushPage(i);\n      return buttons;\n    }\n\n    const windowSize = 3;\n    let start = Math.max(2, page - 1);\n    let end = Math.min(totalKnownPages - 1, page + 1);\n\n    const desiredWindow = maxVisible - 2;\n    let currentWindow = end - start + 1;\n    let remaining = desiredWindow - currentWindow;\n\n    while (remaining > 0) {\n      if (start > 2) {\n        start -= 1;\n        remaining -= 1;\n      }\n      if (remaining > 0 && end < totalKnownPages - 1) {\n        end += 1;\n        remaining -= 1;\n      }\n      if (start === 2 && end === totalKnownPages - 1) break;\n    }\n\n    pushPage(1);\n    if (start > 2) pushEllipsis(\"start-ellipsis\");\n    for (let i = start; i <= end; i += 1) pushPage(i);\n    if (end < totalKnownPages - 1) pushEllipsis(\"end-ellipsis\");\n    pushPage(totalKnownPages);\n    if (hasNextPage) pushEllipsis(\"more-ellipsis\");\n\n    return buttons;\n  })();\n\n  const recalcPageSize = useCallback(() => {\n    if (typeof window === \"undefined\") return;\n    if (page !== 1) return;\n    if (!tableBodyRef.current) return;\n    const containerHeight =\n      tableBodyRef.current.getBoundingClientRect().height || 0;\n    if (!containerHeight) return;\n\n    const headerRow =\n      tableBodyRef.current.querySelector(\"table thead tr\") ||\n      tableBodyRef.current.querySelector(\"thead tr\");\n    const bodyRow =\n      tableBodyRef.current.querySelector(\"table tbody tr\") ||\n      tableBodyRef.current.querySelector(\"tbody tr\");\n\n    if (headerRow) {\n      const h = headerRow.getBoundingClientRect().height;\n      if (h) headerHeightRef.current = h;\n    }\n    if (bodyRow) {\n      const r = bodyRow.getBoundingClientRect().height;\n      if (r) rowHeightRef.current = r;\n    }\n\n    const verticalPadding = 24;\n    const available =\n      containerHeight - headerHeightRef.current - verticalPadding;\n    const estimated = Math.floor(available / rowHeightRef.current);\n    const clamped = Math.max(5, Math.min(50, estimated));\n    if (clamped > 0 && clamped !== pageSize) {\n      setPageSize(clamped);\n      resetPagination();\n      setQueryEpoch((v) => v + 1);\n    }\n  }, [page, pageSize]);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    recalcPageSize();\n    const onResize = () => recalcPageSize();\n    window.addEventListener(\"resize\", onResize);\n    return () => window.removeEventListener(\"resize\", onResize);\n  }, [recalcPageSize]);\n\n  useEffect(() => {\n    if (isLoading || page !== 1) return;\n    recalcPageSize();\n  }, [page, isLoading, recalcPageSize]);\n\n  const renderFilters = (idPrefix) => (\n    <div className={styles.filtersPanel}>\n      <div className={styles.filtersHeader}>\n        <div>\n          <div className={styles.filtersTitle}>Filters</div>\n          <div className={styles.filtersSubtitle}>\n            Narrow results by machine, client, or warehouse.\n          </div>\n        </div>\n        {hasActiveFilters ? (\n          <span className={styles.filtersBadge}>Active</span>\n        ) : null}\n      </div>\n\n      <div className={styles.filterSection}>\n        <div className={styles.filterSectionTitle}>Machine</div>\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>OEM</InputGroup.Text>\n          <Dropdown onSelect={handleSelect1} className=\"w-100\">\n            <Dropdown.Toggle\n              variant=\"outline-secondary\"\n              id={`${idPrefix}-oem`}\n              className={`w-100 ${styles.inputButton}`}\n            >\n              {dropdown1Text}\n            </Dropdown.Toggle>\n            <Dropdown.Menu className=\"w-100\">\n              <Dropdown.Item eventKey=\"unassigned\">Select Option</Dropdown.Item>\n              <Dropdown.Item eventKey=\"GE\">GE</Dropdown.Item>\n              <Dropdown.Item eventKey=\"Toshiba\">Toshiba</Dropdown.Item>\n              <Dropdown.Item eventKey=\"Siemens\">Siemens</Dropdown.Item>\n              <Dropdown.Item eventKey=\"Philips\">Philips</Dropdown.Item>\n            </Dropdown.Menu>\n          </Dropdown>\n        </InputGroup>\n\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Modality</InputGroup.Text>\n          <Dropdown onSelect={handleSelect2} className=\"w-100\">\n            <Dropdown.Toggle\n              variant=\"outline-secondary\"\n              id={`${idPrefix}-modality`}\n              className={`w-100 ${styles.inputButton}`}\n            >\n              {dropdown2Text}\n            </Dropdown.Toggle>\n            <Dropdown.Menu className=\"w-100\">\n              <Dropdown.Item eventKey=\"unassigned\">Select Option</Dropdown.Item>\n              <Dropdown.Item eventKey=\"CT\">CT</Dropdown.Item>\n              <Dropdown.Item eventKey=\"MRI\">MRI</Dropdown.Item>\n            </Dropdown.Menu>\n          </Dropdown>\n        </InputGroup>\n\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Model</InputGroup.Text>\n          <Button\n            variant=\"outline-secondary\"\n            className={`w-100 ${styles.inputButton}`}\n            onClick={handleModelClick}\n          >\n            {modelButtonText}\n          </Button>\n        </InputGroup>\n      </div>\n\n      <div className={styles.filterSection}>\n        <div className={styles.filterSectionTitle}>Client</div>\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Client From</InputGroup.Text>\n          <Button\n            variant=\"outline-secondary\"\n            className={`w-100 ${styles.inputButton}`}\n            onClick={() => handleClientClick(\"from\")}\n          >\n            {clientFromButtonText}\n          </Button>\n        </InputGroup>\n\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Client Current</InputGroup.Text>\n          <Button\n            variant=\"outline-secondary\"\n            className={`w-100 ${styles.inputButton}`}\n            onClick={() => handleClientClick(\"current\")}\n          >\n            {clientCurrentButtonText}\n          </Button>\n        </InputGroup>\n      </div>\n\n      <div className={styles.filterSection}>\n        <div className={styles.filterSectionTitle}>Warehouse</div>\n        <InputGroup className={styles.inputGroup}>\n          <InputGroup.Text>Quick</InputGroup.Text>\n          <div className={styles.buttonGroup}>\n            <Button\n              variant=\"outline-secondary\"\n              className={styles.flexButton}\n              onClick={handleSoCalWarehouseClick}\n            >\n              SoCal Warehouse\n            </Button>\n            <Button\n              variant=\"outline-secondary\"\n              className={styles.flexButton}\n              onClick={handleNorCalWarehouseClick}\n            >\n              NorCal Warehouse\n            </Button>\n            <Button\n              variant=\"outline-secondary\"\n              className={styles.flexButton}\n              onClick={handleWarehouseUnassignedClick}\n            >\n              Unassigned\n            </Button>\n          </div>\n        </InputGroup>\n      </div>\n    </div>\n  );\n\n\n  return (\n    <LoggedIn>\n      {isDeleting && (\n        <div className={styles.loadingOverlay}>\n          <Spinner animation=\"border\" role=\"status\" className={styles.spinnerCenter}>\n            <span className=\"sr-only\">Loading...</span>\n          </Spinner>\n        </div>\n      )}\r\n      <Modal show={showDeleteModal} onHide={handleCloseDeleteModal}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Confirm Deletion</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          Are you sure you want to delete {selectedItems.length} item\r\n          {selectedItems.length > 1 ? \"s\" : \"\"}?\r\n        </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"danger\" onClick={handleDeleteSelected}>\r\n            Yes, delete\r\n          </Button>\r\n          <Button variant=\"secondary\" onClick={handleCloseDeleteModal}>\r\n            Cancel\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n\r\n      <Modal show={showClientModal} onHide={() => setShowClientModal(false)}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            Select {clientSelectionType === \"from\" ? \"Client From\" : \"Client Current\"}\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <FormControl\r\n            type=\"text\"\r\n            placeholder=\"Search by name\"\r\n            className=\"mb-3\"\r\n            value={clientSearchTerm}\r\n            onChange={(e) => setClientSearchTerm(e.target.value)}\r\n          />\r\n          <ClientTable\r\n            clients={(Array.isArray(clients) ? clients : []).filter(\r\n              (client) => (client?.name ?? \"\").toLowerCase().includes(clientSearchTerm.toLowerCase())\r\n            )}\r\n            onSelectClient={handleClientSelect}\r\n            onInfoClick={handleClientInfo}\r\n            isClientSearch={false}\r\n            clearSelection={() => handleClientSelect(null)}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n\r\n      <Modal show={showModelModal} onHide={() => setShowModelModal(false)}>\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>Select Model</Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <FormControl\r\n            type=\"text\"\r\n            placeholder=\"Search by name\"\r\n            className=\"mb-3\"\r\n            value={modelSearchTerm}\r\n            onChange={(e) => setModelSearchTerm(e.target.value)}\r\n          />\r\n          <ModelTable\r\n            models={models.filter((model) =>\r\n              typeof model === \"string\"\r\n                ? model.toLowerCase().includes(modelSearchTerm.toLowerCase())\r\n                : false\r\n            )}\r\n            onSelectModel={handleModelSelect}\r\n            clearSelection={() => handleModelSelect(null)}\r\n          />\r\n        </Modal.Body>\r\n      </Modal>\r\n\r\n      <div className={styles.page}>\n        <div className={styles.pageInner}>\n          <header className={styles.header}>\n            <div className={styles.headerLeft}>\n              <button\n                type=\"button\"\n                className={styles.burger}\n                onClick={() => setShowFilters(true)}\n                aria-label=\"Open filters\"\n              >\n                <span></span>\n                <span></span>\n                <span></span>\n              </button>\n              <div className={styles.brand}>\n                <img\n                  src=\"/magmo-logo.png\"\n                  alt=\"Magmo\"\n                  className={styles.brandLogo}\n                />\n                <div>\n                  <div className={styles.brandName}>Magmo</div>\n                  <div className={styles.brandSub}>Inventory Search</div>\n                </div>\n              </div>\n            </div>\n            <div className={styles.headerRight}>\n              <div className={styles.headerStatus}>\n                {hasActiveFilters ? \"Filters active\" : \"All items\"}\n              </div>\n            </div>\n          </header>\n\n          <div className={styles.content}>\n            <aside className={styles.sidebar}>{renderFilters(\"sidebar\")}</aside>\n            <main className={styles.main}>\n              <div className={styles.tableCard}>\n                <div className={styles.tableHeader}>\n                  <div>\n                    <div className={styles.tableTitle}>Items</div>\n                    <div className={styles.tableSubtitle}>\n                      {isLoading ? \"Loading items\" : `${info.length} items on this page`}\n                    </div>\n                  </div>\n                  <div className={styles.tableMeta}>\n                    Page {page} {hasNextPage ? `of ${totalKnownPages}+` : `of ${totalKnownPages}`}\n                  </div>\n                </div>\n\n                <div className={styles.tableBody} ref={tableBodyRef}>\n                  {isLoading ? (\n                    <div className={styles.loadingState}>\n                      <img\n                        src=\"/magmo-logo.png\"\n                        alt=\"Loading Magmo\"\n                        className={styles.loadingLogo}\n                      />\n                      <div className={styles.loadingText}>Loading</div>\n                      <style jsx global>{`\n                        @keyframes magmo-spin {\n                          from {\n                            transform: rotate(0deg);\n                          }\n                          to {\n                            transform: rotate(360deg);\n                          }\n                        }\n                      `}</style>\n                    </div>\n                  ) : loadError ? (\n                    <div className={styles.errorState}>\n                      <div className={styles.errorTitle}>\n                        Load failed ({loadError.code})\n                      </div>\n                      <div className={styles.errorMessage}>{loadError.message}</div>\n                      <Button\n                        variant=\"outline-secondary\"\n                        size=\"sm\"\n                        onClick={() => {\n                          resetPagination();\n                          setQueryEpoch((v) => v + 1);\n                        }}\n                      >\n                        Retry\n                      </Button>\n                    </div>\n                  ) : (\n                    <PartTable\n                      info={info}\n                      labels={labels}\n                      ids={ids}\n                      hoverStyle={hoverStyle}\n                      sortCheckAll={sortCheckAll}\n                      checkDelete={checkDelete}\n                      isDeleting={isDeleting}\n                      rowSelect={rowSelect}\n                      setHoverIndex={setHoverIndex}\n                      hoverIndex={hoverIndex}\n                      selectedItems={selectedItems}\n                      setSelectedItems={setSelectedItems}\n                      minRows={pageSize}\n                    />\n                  )}\n                </div>\n\n                <div className={styles.tableFooter}>\n                  <div className={styles.paginationRow}>\n                    <Pagination size=\"sm\">\n                      <Pagination.Prev\n                        onClick={() => setPage((p) => Math.max(1, p - 1))}\n                        disabled={page <= 1}\n                      />\n                      {pageButtons}\n                      <Pagination.Next\n                        onClick={() => setPage((p) => p + 1)}\n                        disabled={!hasNextPage}\n                      />\n                    </Pagination>\n                  </div>\n                  <Form className={styles.searchRow}>\n                    <FormControl\n                      type={showListSearch}\n                      placeholder=\"Search\"\n                      className={styles.searchInput}\n                      aria-label=\"Search\"\n                      value={search}\n                      onChange={searchChangeHandler}\n                    />\n                    <NavDropdown\n                      title={select}\n                      id=\"collasible-nav-dropdown\"\n                      show={showList}\n                      onMouseEnter={() => setShowList(true)}\n                      onMouseLeave={() => setShowList(false)}\n                      className={styles.searchSelect}\n                    >\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Name\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Name\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Date\");\n                          setShowListSearch(\"date\");\n                        }}\n                      >\n                        Date\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Work Order\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Work Order\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Product Number\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Product Number\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Serial Number\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Serial Number\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"Description\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        Description\n                      </NavDropdown.Item>\n                      <NavDropdown.Item\n                        onClick={() => {\n                          setSelect(\"SKU\");\n                          setShowListSearch(\"text\");\n                        }}\n                      >\n                        SKU\n                      </NavDropdown.Item>\n                    </NavDropdown>\n                  </Form>\n                  <div className={styles.footerActions}>\n                    <LoadingButton\n                      type=\"secondary\"\n                      name=\"Add New Item\"\n                      route=\"NewSearch/AddItem/NewItem\"\n                      className={styles.actionButton}\n                    />\n                    <LoadingButton\n                      type=\"primary\"\n                      name=\"Back\"\n                      route=\"Warehousedb/WarehouseSelect\"\n                      className={styles.actionButton}\n                    />\n                  </div>\n                </div>\n              </div>\n            </main>\n          </div>\n        </div>\n\n        <Offcanvas\n          show={showFilters}\n          onHide={() => setShowFilters(false)}\n          placement=\"start\"\n          className={styles.filtersDrawer}\n          scroll\n          backdrop\n        >\n          <Offcanvas.Header closeButton>\n            <Offcanvas.Title>Filters</Offcanvas.Title>\n          </Offcanvas.Header>\n          <Offcanvas.Body>{renderFilters(\"drawer\")}</Offcanvas.Body>\n        </Offcanvas>\n      </div>\n    </LoggedIn>\n  );\n\r\n\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}