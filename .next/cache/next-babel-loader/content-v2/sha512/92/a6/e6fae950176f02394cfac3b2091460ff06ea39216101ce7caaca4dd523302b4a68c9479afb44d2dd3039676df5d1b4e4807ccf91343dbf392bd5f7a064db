{"ast":null,"code":"import _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { useEffect, useState } from \"react\";\nimport { Container, Card, Row, Col, InputGroup, Dropdown, FormControl, Button, NavDropdown, Form, Modal, Spinner } from \"react-bootstrap\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { fetchPartsWithMachineData, fetchClients, fetchModels, formatDate } from \"../../utils/fetchAssociations\";\nimport { useAuth } from \"../../context/AuthUserContext\";\nimport LoggedIn from \"../LoggedIn\";\nimport ClientTable from \"../../utils/ClientTable\";\nimport ModelTable from \"../../utils/ModelTable\";\nimport PartTable from \"../../utils/PartTable\";\nimport styles from \"../../styles/MainSearch.module.css\";\nimport firebase from \"../../context/Firebase\"; // Predefined warehouse client IDs and display names\n\nvar SOCAL_CLIENT_ID = \"AIS17182\";\nvar NORCAL_CLIENT_ID = \"AIS25097\";\nvar UNASSIGNED_CLIENT_ID = \"AIS00404\"; // Simulates a network request delay\n\nfunction simulateNetworkRequest() {\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, 2000);\n  });\n} // Custom LoadingButton component\n\n\nfunction LoadingButton(_ref) {\n  var type = _ref.type,\n      name = _ref.name,\n      route = _ref.route;\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setLoading = _useState[1];\n\n  useEffect(function () {\n    if (isLoading) {\n      simulateNetworkRequest().then(function () {\n        return setLoading(false);\n      });\n    }\n  }, [isLoading]);\n  return __jsx(Link, {\n    href: \"/\".concat(route)\n  }, __jsx(\"a\", {\n    className: \"btn btn-\".concat(type),\n    disabled: isLoading,\n    onClick: function onClick() {\n      return !isLoading && setLoading(true);\n    }\n  }, isLoading ? \"Loading…\" : name));\n} // ---- DATE HELPERS (top-level scope) ----\n// Convert anything date-ish into a timestamp (ms since epoch).\n\n\nfunction toTime(value) {\n  if (!value) return null; // Firestore Timestamp { seconds, nanoseconds }\n\n  if (typeof value === \"object\" && value !== null && value.seconds != null) {\n    try {\n      return value.seconds * 1000;\n    } catch (_unused) {\n      /* ignore */\n    }\n  } // Native Date\n\n\n  if (value instanceof Date) {\n    var _t = value.getTime();\n\n    return isNaN(_t) ? null : _t;\n  } // Strings\n\n\n  if (typeof value === \"string\") {\n    // ISO / yyyy-mm-dd\n    var iso = Date.parse(value);\n    if (!isNaN(iso)) return iso; // mm/dd/yyyy\n\n    var parts = value.split(\"/\");\n\n    if (parts.length === 3) {\n      var _parts = _slicedToArray(parts, 3),\n          mm = _parts[0],\n          dd = _parts[1],\n          yyyy = _parts[2];\n\n      var alt = Date.parse(\"\".concat(yyyy, \"-\").concat(mm, \"-\").concat(dd));\n      if (!isNaN(alt)) return alt;\n    }\n  } // Last resort\n\n\n  var t = Date.parse(value);\n  return isNaN(t) ? null : t;\n} // Canonicalize to 'yyyy-mm-dd' (matches <input type=\"date\">)\n\n\nfunction toYMD(value) {\n  var t = toTime(value);\n  if (t == null) return null;\n  var d = new Date(t);\n  var yyyy = d.getFullYear();\n  var mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  var dd = String(d.getDate()).padStart(2, \"0\");\n  return \"\".concat(yyyy, \"-\").concat(mm, \"-\").concat(dd);\n}\n\nexport default function MainSearch() {\n  var _useAuth = useAuth(),\n      signOut = _useAuth.signOut;\n\n  var _useState2 = useState([]),\n      info = _useState2[0],\n      setInfo = _useState2[1];\n\n  var _useState3 = useState([]),\n      backupInfo = _useState3[0],\n      setBackupInfo = _useState3[1];\n\n  var _useState4 = useState([]),\n      augmentedInfo = _useState4[0],\n      setAugmentedInfo = _useState4[1]; // items with clientFromId/currentId added\n\n\n  var _useState5 = useState(true),\n      isLoading = _useState5[0],\n      setIsLoading = _useState5[1];\n\n  var _useState6 = useState([]),\n      ids = _useState6[0],\n      setID = _useState6[1];\n\n  var _useState7 = useState(false),\n      show = _useState7[0],\n      setShow = _useState7[1];\n\n  var _useState8 = useState(),\n      dItem = _useState8[0],\n      setDItem = _useState8[1];\n\n  var _useState9 = useState(\"Name\"),\n      select = _useState9[0],\n      setSelect = _useState9[1];\n\n  var _useState10 = useState(false),\n      showList = _useState10[0],\n      setShowList = _useState10[1];\n\n  var _useState11 = useState(\"text\"),\n      showListSearch = _useState11[0],\n      setShowListSearch = _useState11[1];\n\n  var _useState12 = useState(\"\"),\n      search = _useState12[0],\n      setSearch = _useState12[1];\n\n  var _useState13 = useState(null),\n      selectedOEM = _useState13[0],\n      setSelectedOEM = _useState13[1];\n\n  var _useState14 = useState(null),\n      selectedModality = _useState14[0],\n      setSelectedModality = _useState14[1]; // Replace the old single client state with two sets:\n\n\n  var _useState15 = useState(null),\n      selectedClientFrom = _useState15[0],\n      setSelectedClientFrom = _useState15[1];\n\n  var _useState16 = useState(\"Select Option\"),\n      clientFromButtonText = _useState16[0],\n      setClientFromButtonText = _useState16[1];\n\n  var _useState17 = useState(null),\n      selectedClientCurrent = _useState17[0],\n      setSelectedClientCurrent = _useState17[1];\n\n  var _useState18 = useState(\"Select Option\"),\n      clientCurrentButtonText = _useState18[0],\n      setClientCurrentButtonText = _useState18[1];\n\n  var _useState19 = useState([]),\n      clients = _useState19[0],\n      setClients = _useState19[1];\n\n  var _useState20 = useState(false),\n      showClientModal = _useState20[0],\n      setShowClientModal = _useState20[1]; // This state tells the modal which client box is being updated: \"from\" or \"current\"\n\n\n  var _useState21 = useState(null),\n      clientSelectionType = _useState21[0],\n      setClientSelectionType = _useState21[1];\n\n  var router = useRouter();\n  var labelBase = [\"name\", \"date\", \"w/o\", \"p/n\", \"s/n\"];\n  var labelBaseNames = [\"name\", \"date\", \"wo\", \"pn\", \"sn\"];\n  var sortCheckBase = [false, false, false, false, false, false];\n\n  function withSortIcon(baseLabels, activeIndex, isDesc) {\n    return baseLabels.map(function (text, i) {\n      if (i !== activeIndex) return text; // untouched\n\n      var arrow = isDesc ? \" ▼\" : \" ▲\";\n      return \"\".concat(text).concat(arrow);\n    });\n  }\n\n  var _useState22 = useState(labelBase),\n      labels = _useState22[0],\n      setLabels = _useState22[1];\n\n  var _useState23 = useState(sortCheckBase),\n      sortCheck = _useState23[0],\n      setSortCheck = _useState23[1];\n\n  var _useState24 = useState(null),\n      hoverIndex = _useState24[0],\n      setHoverIndex = _useState24[1];\n\n  var _useState25 = useState(null),\n      selectedModel = _useState25[0],\n      setSelectedModel = _useState25[1];\n\n  var _useState26 = useState(null),\n      gPos = _useState26[0],\n      setGPos = _useState26[1];\n\n  var _useState27 = useState(null),\n      gIde = _useState27[0],\n      setGIde = _useState27[1];\n\n  var _useState28 = useState(false),\n      isDeleting = _useState28[0],\n      setIsDeleting = _useState28[1]; // Fetch data on component mount and route change\n\n\n  useEffect(function () {\n    fetchData();\n  }, [router.route]);\n\n  function fetchData() {\n    return _fetchData.apply(this, arguments);\n  }\n\n  function _fetchData() {\n    _fetchData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n      var load, data, db, machineIds, curMachineIds, theMachineIds, _iterator2, _step2, _item$Machine, _item$CurrentMachine, _item$TheMachine4, item, uniq, mIds, cIds, fetchMachineClients, fetchMachinesData, _yield$Promise$all, _yield$Promise$all2, fromMap, curMap, theMap, augmented;\n\n      return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              setIsLoading(true);\n              _context10.prev = 1;\n\n              if (router.query.inputText && router.query.selectedType) {\n                setSelect(router.query.selectedType);\n                setSearch(router.query.inputText);\n              } // light retry for transient Firestore hiccups\n\n\n              load = /*#__PURE__*/function () {\n                var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n                  var attempt,\n                      _args7 = arguments;\n                  return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                    while (1) {\n                      switch (_context7.prev = _context7.next) {\n                        case 0:\n                          attempt = _args7.length > 0 && _args7[0] !== undefined ? _args7[0] : 1;\n                          _context7.prev = 1;\n                          _context7.next = 4;\n                          return fetchPartsWithMachineData();\n\n                        case 4:\n                          return _context7.abrupt(\"return\", _context7.sent);\n\n                        case 7:\n                          _context7.prev = 7;\n                          _context7.t0 = _context7[\"catch\"](1);\n\n                          if (!(attempt >= 3)) {\n                            _context7.next = 11;\n                            break;\n                          }\n\n                          throw _context7.t0;\n\n                        case 11:\n                          _context7.next = 13;\n                          return new Promise(function (r) {\n                            return setTimeout(r, 250 * Math.pow(2, attempt - 1));\n                          });\n\n                        case 13:\n                          return _context7.abrupt(\"return\", load(attempt + 1));\n\n                        case 14:\n                        case \"end\":\n                          return _context7.stop();\n                      }\n                    }\n                  }, _callee7, null, [[1, 7]]);\n                }));\n\n                return function load() {\n                  return _ref11.apply(this, arguments);\n                };\n              }();\n\n              _context10.next = 6;\n              return load();\n\n            case 6:\n              data = _context10.sent;\n              setBackupInfo(data);\n              setLabels(labelBase); // <-- add this line after setBackupInfo(data)\n\n              setID(data.map(function (item) {\n                return item.id;\n              })); // --- Pre-augment: resolve client ids of Machine / CurrentMachine once ---\n\n              db = firebase.firestore();\n              machineIds = [];\n              curMachineIds = [];\n              theMachineIds = []; // <-- ADD\n\n              _iterator2 = _createForOfIteratorHelper(data);\n\n              try {\n                for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n                  item = _step2.value;\n                  if (item !== null && item !== void 0 && (_item$Machine = item.Machine) !== null && _item$Machine !== void 0 && _item$Machine.id) machineIds.push(item.Machine.id);\n                  if (item !== null && item !== void 0 && (_item$CurrentMachine = item.CurrentMachine) !== null && _item$CurrentMachine !== void 0 && _item$CurrentMachine.id) curMachineIds.push(item.CurrentMachine.id);\n                  if (item !== null && item !== void 0 && (_item$TheMachine4 = item.TheMachine) !== null && _item$TheMachine4 !== void 0 && _item$TheMachine4.id) theMachineIds.push(item.TheMachine.id); // <-- ADD\n                }\n              } catch (err) {\n                _iterator2.e(err);\n              } finally {\n                _iterator2.f();\n              }\n\n              uniq = function uniq(arr) {\n                return _toConsumableArray(new Set(arr));\n              };\n\n              mIds = uniq(machineIds);\n              cIds = uniq(curMachineIds);\n\n              fetchMachineClients = /*#__PURE__*/function () {\n                var _ref12 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(ids) {\n                  var out, chunks, i, _i, _chunks, chunk, snap;\n\n                  return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n                    while (1) {\n                      switch (_context8.prev = _context8.next) {\n                        case 0:\n                          if (ids.length) {\n                            _context8.next = 2;\n                            break;\n                          }\n\n                          return _context8.abrupt(\"return\", {});\n\n                        case 2:\n                          out = {}; // Firestore \"in\" supports up to 10 document IDs per query\n\n                          chunks = [];\n\n                          for (i = 0; i < ids.length; i += 10) {\n                            chunks.push(ids.slice(i, i + 10));\n                          }\n\n                          _i = 0, _chunks = chunks;\n\n                        case 6:\n                          if (!(_i < _chunks.length)) {\n                            _context8.next = 15;\n                            break;\n                          }\n\n                          chunk = _chunks[_i];\n                          _context8.next = 10;\n                          return db.collection(\"Machine\").where(firebase.firestore.FieldPath.documentId(), \"in\", chunk).get();\n\n                        case 10:\n                          snap = _context8.sent;\n                          snap.forEach(function (doc) {\n                            var _md$client;\n\n                            var md = doc.data() || {};\n                            out[doc.id] = ((_md$client = md.client) === null || _md$client === void 0 ? void 0 : _md$client.id) || null;\n                          });\n\n                        case 12:\n                          _i++;\n                          _context8.next = 6;\n                          break;\n\n                        case 15:\n                          return _context8.abrupt(\"return\", out);\n\n                        case 16:\n                        case \"end\":\n                          return _context8.stop();\n                      }\n                    }\n                  }, _callee8);\n                }));\n\n                return function fetchMachineClients(_x5) {\n                  return _ref12.apply(this, arguments);\n                };\n              }(); // Fetch full machine docs (OEM/Modality/Model/Client/etc.) for a set of ids\n\n\n              fetchMachinesData = /*#__PURE__*/function () {\n                var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(ids) {\n                  var out, chunks, i, _i2, _chunks2, chunk, snap;\n\n                  return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n                    while (1) {\n                      switch (_context9.prev = _context9.next) {\n                        case 0:\n                          if (ids.length) {\n                            _context9.next = 2;\n                            break;\n                          }\n\n                          return _context9.abrupt(\"return\", {});\n\n                        case 2:\n                          out = {};\n                          chunks = [];\n\n                          for (i = 0; i < ids.length; i += 10) {\n                            chunks.push(ids.slice(i, i + 10));\n                          }\n\n                          _i2 = 0, _chunks2 = chunks;\n\n                        case 6:\n                          if (!(_i2 < _chunks2.length)) {\n                            _context9.next = 15;\n                            break;\n                          }\n\n                          chunk = _chunks2[_i2];\n                          _context9.next = 10;\n                          return db.collection(\"Machine\").where(firebase.firestore.FieldPath.documentId(), \"in\", chunk).get();\n\n                        case 10:\n                          snap = _context9.sent;\n                          snap.forEach(function (doc) {\n                            out[doc.id] = _objectSpread({\n                              id: doc.id\n                            }, doc.data() || {});\n                          });\n\n                        case 12:\n                          _i2++;\n                          _context9.next = 6;\n                          break;\n\n                        case 15:\n                          return _context9.abrupt(\"return\", out);\n\n                        case 16:\n                        case \"end\":\n                          return _context9.stop();\n                      }\n                    }\n                  }, _callee9);\n                }));\n\n                return function fetchMachinesData(_x6) {\n                  return _ref13.apply(this, arguments);\n                };\n              }();\n\n              _context10.next = 23;\n              return Promise.all([fetchMachineClients(mIds), fetchMachineClients(cIds), fetchMachinesData(uniq(theMachineIds)) // <-- now captured as theMap\n              ]);\n\n            case 23:\n              _yield$Promise$all = _context10.sent;\n              _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 3);\n              fromMap = _yield$Promise$all2[0];\n              curMap = _yield$Promise$all2[1];\n              theMap = _yield$Promise$all2[2];\n              // New-style only: take client ids straight from item refs\n              augmented = data.map(function (item) {\n                var _item$ClientFrom$id, _item$ClientFrom, _item$ClientCurrent$i, _item$ClientCurrent;\n\n                return _objectSpread(_objectSpread({}, item), {}, {\n                  clientFromId: (_item$ClientFrom$id = item === null || item === void 0 ? void 0 : (_item$ClientFrom = item.ClientFrom) === null || _item$ClientFrom === void 0 ? void 0 : _item$ClientFrom.id) !== null && _item$ClientFrom$id !== void 0 ? _item$ClientFrom$id : null,\n                  clientCurrentId: (_item$ClientCurrent$i = item === null || item === void 0 ? void 0 : (_item$ClientCurrent = item.ClientCurrent) === null || _item$ClientCurrent === void 0 ? void 0 : _item$ClientCurrent.id) !== null && _item$ClientCurrent$i !== void 0 ? _item$ClientCurrent$i : null\n                });\n              });\n              setAugmentedInfo(augmented); // default view = everything not explicitly hidden\n\n              setInfo(augmented.filter(function (it) {\n                return it.visible !== false;\n              }));\n              _context10.next = 38;\n              break;\n\n            case 33:\n              _context10.prev = 33;\n              _context10.t0 = _context10[\"catch\"](1);\n              console.error(\"Error fetching data:\", _context10.t0);\n              setInfo([]);\n              setAugmentedInfo([]);\n\n            case 38:\n              _context10.prev = 38;\n              setIsLoading(false);\n              return _context10.finish(38);\n\n            case 41:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee10, null, [[1, 33, 38, 41]]);\n    }));\n    return _fetchData.apply(this, arguments);\n  }\n\n  var searchChangeHandler = function searchChangeHandler(event) {\n    return setSearch(event.target.value);\n  }; // Asynchronous filter function that loops through backupInfo and,\n  // for each item, fetches its Machine and CurrentMachine documents,\n  // then compares the client id (from machineData.client.id) to the selected client.\n\n\n  useEffect(function () {\n    function filterParts() {\n      var base = augmentedInfo; // already has clientFromId/clientCurrentId\n\n      var noFilters = !selectedOEM && !selectedModality && !selectedModel && !selectedClientFrom && !selectedClientCurrent && !search;\n\n      if (noFilters) {\n        setInfo(base.filter(function (it) {\n          return it.visible !== false;\n        }));\n        return;\n      }\n\n      var filtered = base.filter(function (item) {\n        var _ref2, _item$machineData$OEM, _item$machineData, _item$theMachineData, _item$TheMachine, _ref3, _item$machineData$Mod, _item$machineData2, _item$theMachineData2, _item$TheMachine2, _ref4, _item$machineData$Mod2, _item$machineData3, _item$theMachineData3, _item$TheMachine3;\n\n        // only hide when explicitly false\n        if (item.visible === false) return false; // OEM/modality/model via machineData (you already put this in items)\n        // OEM / Modality / Model filtering\n        // Prefer machineData; fall back to theMachineData; finally try inline TheMachine if it has plain fields\n\n        var OEM = (_ref2 = (_item$machineData$OEM = item === null || item === void 0 ? void 0 : (_item$machineData = item.machineData) === null || _item$machineData === void 0 ? void 0 : _item$machineData.OEM) !== null && _item$machineData$OEM !== void 0 ? _item$machineData$OEM : item === null || item === void 0 ? void 0 : (_item$theMachineData = item.theMachineData) === null || _item$theMachineData === void 0 ? void 0 : _item$theMachineData.OEM) !== null && _ref2 !== void 0 ? _ref2 : item === null || item === void 0 ? void 0 : (_item$TheMachine = item.TheMachine) === null || _item$TheMachine === void 0 ? void 0 : _item$TheMachine.OEM;\n        var Modality = (_ref3 = (_item$machineData$Mod = item === null || item === void 0 ? void 0 : (_item$machineData2 = item.machineData) === null || _item$machineData2 === void 0 ? void 0 : _item$machineData2.Modality) !== null && _item$machineData$Mod !== void 0 ? _item$machineData$Mod : item === null || item === void 0 ? void 0 : (_item$theMachineData2 = item.theMachineData) === null || _item$theMachineData2 === void 0 ? void 0 : _item$theMachineData2.Modality) !== null && _ref3 !== void 0 ? _ref3 : item === null || item === void 0 ? void 0 : (_item$TheMachine2 = item.TheMachine) === null || _item$TheMachine2 === void 0 ? void 0 : _item$TheMachine2.Modality;\n        var Model = (_ref4 = (_item$machineData$Mod2 = item === null || item === void 0 ? void 0 : (_item$machineData3 = item.machineData) === null || _item$machineData3 === void 0 ? void 0 : _item$machineData3.Model) !== null && _item$machineData$Mod2 !== void 0 ? _item$machineData$Mod2 : item === null || item === void 0 ? void 0 : (_item$theMachineData3 = item.theMachineData) === null || _item$theMachineData3 === void 0 ? void 0 : _item$theMachineData3.Model) !== null && _ref4 !== void 0 ? _ref4 : item === null || item === void 0 ? void 0 : (_item$TheMachine3 = item.TheMachine) === null || _item$TheMachine3 === void 0 ? void 0 : _item$TheMachine3.Model;\n        if (selectedOEM && OEM !== selectedOEM) return false;\n        if (selectedModality && Modality !== selectedModality) return false;\n        if (selectedModel && Model !== selectedModel) return false; // Client filters (now instant)\n\n        if (selectedClientFrom && item.clientFromId !== selectedClientFrom) return false;\n        if (selectedClientCurrent && item.clientCurrentId !== selectedClientCurrent) return false; // Search\n\n        if (search) {\n          var s = String(search).toLowerCase();\n\n          if (select === \"Name\") {\n            return (item.name || \"\").toLowerCase().includes(s);\n          }\n\n          if (select === \"Date\") {\n            // If user hasn't picked a date yet, don't hide anything\n            if (!search) return true;\n            var wantedDay = search; // already 'yyyy-mm-dd' from <input type=\"date\">\n            // 1) Match item.date, regardless of its format or type\n\n            var itemYMD = toYMD(item.date);\n            if (itemYMD && itemYMD === wantedDay) return true; // 2) Also check any description dates (if you store dates there)\n\n            if (Array.isArray(item.descriptions)) {\n              var hitDesc = item.descriptions.some(function (d) {\n                return toYMD(d === null || d === void 0 ? void 0 : d.date) === wantedDay;\n              });\n              if (hitDesc) return true;\n            } // 3) And work order dates (if present)\n\n\n            if (Array.isArray(item.workOrders)) {\n              var hitWO = item.workOrders.some(function (w) {\n                return toYMD(w === null || w === void 0 ? void 0 : w.date) === wantedDay;\n              });\n              if (hitWO) return true;\n            }\n\n            return false;\n          }\n\n          if (select === \"Work Order\") {\n            return Array.isArray(item.workOrders) && item.workOrders.some(function (wo) {\n              return String(wo.workOrder || \"\").toLowerCase().includes(s);\n            });\n          }\n\n          if (select === \"Product Number\") {\n            return String(item.pn || \"\").toLowerCase().includes(s);\n          }\n\n          if (select === \"Description\") {\n            return String(item.desc || \"\").toLowerCase().includes(s);\n          }\n\n          if (select === \"SKU\") {\n            return String(item.id || \"\").toLowerCase().includes(s);\n          }\n        }\n\n        return true;\n      });\n      setInfo(filtered);\n    }\n\n    filterParts();\n  }, [selectedOEM, selectedModality, selectedClientFrom, selectedClientCurrent, selectedModel, search, select, augmentedInfo]);\n\n  function sortCheckAll(pos) {\n    // Determine next direction: toggle the clicked column only\n    var nextSortCheck = sortCheck.map(function (v, i) {\n      return i === pos ? !v : v;\n    });\n    var isDesc = nextSortCheck[pos]; // true means descending\n\n    var sortedInfo = _toConsumableArray(info).sort(function (a, b) {\n      var key = labelBaseNames[pos];\n\n      if (pos === 1) {\n        // DATE column\n        var ta = toTime(a[key]);\n        var tb = toTime(b[key]); // Put missing dates at the end for ascending, at the start for descending\n\n        if (ta === null && tb === null) return 0;\n        if (ta === null) return isDesc ? -1 : 1;\n        if (tb === null) return isDesc ? 1 : -1;\n        return isDesc ? tb - ta : ta - tb;\n      } // NAME or SKU (string-y columns): indexes 0 or 5 in your original logic\n\n\n      if (pos === 0 || pos === 5) {\n        var _a$key, _b$key;\n\n        var av = ((_a$key = a[key]) !== null && _a$key !== void 0 ? _a$key : \"\").toString();\n        var bv = ((_b$key = b[key]) !== null && _b$key !== void 0 ? _b$key : \"\").toString();\n        return isDesc ? bv.localeCompare(av) : av.localeCompare(bv);\n      } // Numeric-ish columns (wo, pn, sn) — fall back to string compare if NaN\n\n\n      var an = Number(a[key]);\n      var bn = Number(b[key]);\n\n      if (!isNaN(an) && !isNaN(bn)) {\n        return isDesc ? bn - an : an - bn;\n      } else {\n        var _a$key2, _b$key2;\n\n        var _av = ((_a$key2 = a[key]) !== null && _a$key2 !== void 0 ? _a$key2 : \"\").toString();\n\n        var _bv = ((_b$key2 = b[key]) !== null && _b$key2 !== void 0 ? _b$key2 : \"\").toString();\n\n        return isDesc ? _bv.localeCompare(_av) : _av.localeCompare(_bv);\n      }\n    });\n\n    setInfo(sortedInfo);\n    setSortCheck(nextSortCheck); // Update header labels to show the little arrow on the active column\n\n    setLabels(withSortIcon(labelBase, pos, isDesc));\n  }\n\n  var rowSelect = function rowSelect(item) {\n    if (item && item.id) {\n      console.log(\"Selected item:\", item);\n      router.push(\"./item/\" + item.id);\n    } else {\n      console.error(\"Unable to determine the selected item’s ID: \", item);\n    }\n  };\n\n  var _useState29 = useState([]),\n      selectedItems = _useState29[0],\n      setSelectedItems = _useState29[1];\n\n  var _useState30 = useState(false),\n      showDeleteModal = _useState30[0],\n      setShowDeleteModal = _useState30[1];\n\n  var handleSelectItem = function handleSelectItem(id) {\n    setSelectedItems(function (prev) {\n      return prev.includes(id) ? prev.filter(function (x) {\n        return x !== id;\n      }) : [].concat(_toConsumableArray(prev), [id]);\n    });\n  }; // setSelectedItems((prev) => {\n  //   const newSelection = prev.includes(id)\n  //     ? prev.filter((itemId) => itemId !== id)\n  //     : [...prev, id];\n  //   console.log(\"Selected items:\", newSelection);\n  //   return newSelection; // <- important\n  // });\n\n\n  var handleShowDeleteModal = function handleShowDeleteModal() {\n    return setShowDeleteModal(true);\n  };\n\n  var handleCloseDeleteModal = function handleCloseDeleteModal() {\n    return setShowDeleteModal(false);\n  };\n\n  var handleDeleteSelected = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var db, _iterator, _step, itemId;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setIsDeleting(true);\n              db = firebase.firestore();\n              _context.prev = 2;\n              // Loop over each selected item one at a time\n              _iterator = _createForOfIteratorHelper(selectedItems);\n              _context.prev = 4;\n\n              _iterator.s();\n\n            case 6:\n              if ((_step = _iterator.n()).done) {\n                _context.next = 35;\n                break;\n              }\n\n              itemId = _step.value;\n              console.log(itemId);\n              _context.prev = 9;\n              _context.next = 12;\n              return db.collection(\"Test\").doc(itemId)[\"delete\"]();\n\n            case 12:\n              _context.next = 17;\n              break;\n\n            case 14:\n              _context.prev = 14;\n              _context.t0 = _context[\"catch\"](9);\n              console.error(\"Error deleting document \".concat(itemId, \" from Test:\"), _context.t0);\n\n            case 17:\n              _context.prev = 17;\n              _context.next = 20;\n              return db.collection(\"Parts\").doc(itemId)[\"delete\"]();\n\n            case 20:\n              _context.next = 25;\n              break;\n\n            case 22:\n              _context.prev = 22;\n              _context.t1 = _context[\"catch\"](17);\n              console.error(\"Error deleting document \".concat(itemId, \" from Parts:\"), _context.t1);\n\n            case 25:\n              _context.prev = 25;\n              _context.next = 28;\n              return deleteFromStorage(itemId);\n\n            case 28:\n              _context.next = 33;\n              break;\n\n            case 30:\n              _context.prev = 30;\n              _context.t2 = _context[\"catch\"](25);\n              console.error(\"Error deleting storage for \".concat(itemId, \":\"), _context.t2);\n\n            case 33:\n              _context.next = 6;\n              break;\n\n            case 35:\n              _context.next = 40;\n              break;\n\n            case 37:\n              _context.prev = 37;\n              _context.t3 = _context[\"catch\"](4);\n\n              _iterator.e(_context.t3);\n\n            case 40:\n              _context.prev = 40;\n\n              _iterator.f();\n\n              return _context.finish(40);\n\n            case 43:\n              // Update local state by filtering out the deleted items\n              setInfo(info.filter(function (item) {\n                return !selectedItems.includes(item.id);\n              }));\n              setSelectedItems([]);\n              _context.next = 50;\n              break;\n\n            case 47:\n              _context.prev = 47;\n              _context.t4 = _context[\"catch\"](2);\n              console.error(\"Error deleting items:\", _context.t4);\n\n            case 50:\n              _context.prev = 50;\n              setIsDeleting(false);\n              handleCloseDeleteModal(); // Optionally, reload the page\n              // router.reload();\n\n              return _context.finish(50);\n\n            case 54:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[2, 47, 50, 54], [4, 37, 40, 43], [9, 14], [17, 22], [25, 30]]);\n    }));\n\n    return function handleDeleteSelected() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var handleClose = function handleClose() {\n    return setShow(false);\n  };\n\n  var handleShow = function handleShow() {\n    return setShow(true);\n  };\n\n  var checkDelete = function checkDelete(event, pos, idsToDelete, name) {\n    if (event) {\n      event.preventDefault();\n      event.stopPropagation();\n    }\n\n    console.log(\"Selected IDs to delete:\", idsToDelete);\n    setSelectedItems(idsToDelete);\n    setDItem(name);\n    setShowDeleteModal(true);\n  }; // const handleDelete = async () => {\n  //   let itemId = gIde;\n  //   try {\n  //     setIsDeleting(true);\n  //     const db = firebase.firestore();\n  //     await db.collection(\"Test\").doc(itemId).delete();\n  //     await deleteFromPartsCollection(itemId);\n  //     await deleteFromStorage(itemId);\n  //     setInfo(info.filter((_, i) => gPos !== i));\n  //     console.log(`Deleted item: ${itemId}`);\n  //   } catch (error) {\n  //     console.error(\"Error deleting item:\", error);\n  //   } finally {\n  //     setIsDeleting(false);\n  //   }\n  //   handleClose();\n  // };\n\n\n  var hoverStyle = function hoverStyle(index) {\n    return {\n      backgroundColor: hoverIndex === index ? \"#ddd\" : \"transparent\",\n      textAlign: \"center\",\n      cursor: \"default\"\n    };\n  };\n\n  var _useState31 = useState(\"Select Option\"),\n      dropdown1Text = _useState31[0],\n      setDropdown1Text = _useState31[1];\n\n  var _useState32 = useState(\"Select Option\"),\n      dropdown2Text = _useState32[0],\n      setDropdown2Text = _useState32[1];\n\n  var handleSelect1 = function handleSelect1(eventKey, event) {\n    if (eventKey === \"unassigned\") {\n      setDropdown1Text(\"Select Option\");\n      setSelectedOEM(null);\n    } else {\n      setDropdown1Text(event.target.textContent);\n      setSelectedOEM(event.target.textContent);\n    }\n  };\n\n  var handleSelect2 = function handleSelect2(eventKey, event) {\n    if (eventKey === \"unassigned\") {\n      setDropdown2Text(\"Select Option\");\n      setSelectedModality(null);\n    } else {\n      setDropdown2Text(event.target.textContent);\n      setSelectedModality(event.target.textContent);\n    }\n  }; // Build a unique list of clients from the items currently loaded, filtered by OEM/Modality.\n  // `type` is \"from\" or \"current\" to decide which client ref to read.\n\n\n  function buildClientsFromItems(_x) {\n    return _buildClientsFromItems.apply(this, arguments);\n  } // --------------------\n  // CLIENT SELECTION HANDLING\n  // --------------------\n  // This function fetches clients and opens the client modal.\n\n\n  function _buildClientsFromItems() {\n    _buildClientsFromItems = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(type) {\n      var db, ids, filtered, _iterator3, _step3, it, id, out, idArray, i, chunk, snap;\n\n      return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n        while (1) {\n          switch (_context11.prev = _context11.next) {\n            case 0:\n              db = firebase.firestore();\n              ids = new Set(); // Respect current OEM / Modality filters when deriving client options\n\n              filtered = augmentedInfo.filter(function (item) {\n                var _ref14, _item$machineData$OEM2, _item$machineData4, _ref15, _item$machineData$Mod3, _item$machineData5;\n\n                var OEM = (_ref14 = (_item$machineData$OEM2 = item === null || item === void 0 ? void 0 : (_item$machineData4 = item.machineData) === null || _item$machineData4 === void 0 ? void 0 : _item$machineData4.OEM) !== null && _item$machineData$OEM2 !== void 0 ? _item$machineData$OEM2 : item === null || item === void 0 ? void 0 : item.OEM) !== null && _ref14 !== void 0 ? _ref14 : null;\n                var Modality = (_ref15 = (_item$machineData$Mod3 = item === null || item === void 0 ? void 0 : (_item$machineData5 = item.machineData) === null || _item$machineData5 === void 0 ? void 0 : _item$machineData5.Modality) !== null && _item$machineData$Mod3 !== void 0 ? _item$machineData$Mod3 : item === null || item === void 0 ? void 0 : item.Modality) !== null && _ref15 !== void 0 ? _ref15 : null;\n                if (selectedOEM && OEM !== selectedOEM) return false;\n                if (selectedModality && Modality !== selectedModality) return false;\n                return true;\n              });\n              _iterator3 = _createForOfIteratorHelper(filtered);\n\n              try {\n                for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                  it = _step3.value;\n                  id = type === \"from\" ? it.clientFromId : it.clientCurrentId;\n                  if (id) ids.add(id);\n                }\n              } catch (err) {\n                _iterator3.e(err);\n              } finally {\n                _iterator3.f();\n              }\n\n              out = [];\n              idArray = _toConsumableArray(ids);\n              i = 0;\n\n            case 8:\n              if (!(i < idArray.length)) {\n                _context11.next = 17;\n                break;\n              }\n\n              chunk = idArray.slice(i, i + 10);\n              _context11.next = 12;\n              return db.collection(\"Client\").where(firebase.firestore.FieldPath.documentId(), \"in\", chunk).get();\n\n            case 12:\n              snap = _context11.sent;\n              snap.forEach(function (doc) {\n                var d = doc.data() || {};\n                out.push({\n                  id: doc.id,\n                  name: d.name || doc.id\n                });\n              });\n\n            case 14:\n              i += 10;\n              _context11.next = 8;\n              break;\n\n            case 17:\n              // sort by name for nicer UX\n              out.sort(function (a, b) {\n                return (a.name || \"\").localeCompare(b.name || \"\");\n              });\n              return _context11.abrupt(\"return\", out);\n\n            case 19:\n            case \"end\":\n              return _context11.stop();\n          }\n        }\n      }, _callee11);\n    }));\n    return _buildClientsFromItems.apply(this, arguments);\n  }\n\n  var handleClientClick = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var safeClients, clientsData, derived;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              safeClients = [];\n              _context2.prev = 1;\n              _context2.next = 4;\n              return fetchClients(selectedOEM, selectedModality);\n\n            case 4:\n              clientsData = _context2.sent;\n              safeClients = Array.isArray(clientsData) ? clientsData : [];\n              _context2.next = 11;\n              break;\n\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error(\"fetchClients failed:\", _context2.t0);\n\n            case 11:\n              if (!(safeClients.length === 0)) {\n                _context2.next = 24;\n                break;\n              }\n\n              _context2.prev = 12;\n\n              if (!clientSelectionType) {\n                // if somehow not set yet, default to \"from\"\n                setClientSelectionType(\"from\");\n              }\n\n              _context2.next = 16;\n              return buildClientsFromItems(clientSelectionType || \"from\");\n\n            case 16:\n              derived = _context2.sent;\n              safeClients = derived;\n              _context2.next = 24;\n              break;\n\n            case 20:\n              _context2.prev = 20;\n              _context2.t1 = _context2[\"catch\"](12);\n              console.error(\"Fallback buildClientsFromItems failed:\", _context2.t1);\n              safeClients = [];\n\n            case 24:\n              setClients(safeClients);\n              setClientSearchTerm(\"\");\n              setShowClientModal(true);\n\n            case 27:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 8], [12, 20]]);\n    }));\n\n    return function handleClientClick() {\n      return _ref6.apply(this, arguments);\n    };\n  }(); // When a client is selected in the modal, we now assume the parameter is a client ID.\n  // If the passed value is null, we clear the selection.\n\n\n  var handleClientSelect = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(clientId) {\n      var clientSnap, clientData;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              console.log(\"User selected client id:\", clientId);\n\n              if (clientId) {\n                _context3.next = 5;\n                break;\n              }\n\n              if (clientSelectionType === \"from\") {\n                setClientFromButtonText(\"Select Option\");\n                setSelectedClientFrom(null);\n              } else if (clientSelectionType === \"current\") {\n                setClientCurrentButtonText(\"Select Option\");\n                setSelectedClientCurrent(null);\n              }\n\n              setShowClientModal(false);\n              return _context3.abrupt(\"return\");\n\n            case 5:\n              _context3.prev = 5;\n              _context3.next = 8;\n              return firebase.firestore().collection(\"Client\").doc(clientId).get();\n\n            case 8:\n              clientSnap = _context3.sent;\n\n              if (clientSnap.exists) {\n                clientData = clientSnap.data();\n\n                if (clientSelectionType === \"from\") {\n                  setClientFromButtonText(clientData.name);\n                  setSelectedClientFrom(clientId);\n                } else if (clientSelectionType === \"current\") {\n                  setClientCurrentButtonText(clientData.name);\n                  setSelectedClientCurrent(clientId);\n                }\n              } else {\n                console.error(\"No client document found for id:\", clientId);\n              }\n\n              _context3.next = 15;\n              break;\n\n            case 12:\n              _context3.prev = 12;\n              _context3.t0 = _context3[\"catch\"](5);\n              console.error(\"Error fetching client data:\", _context3.t0);\n\n            case 15:\n              setShowClientModal(false);\n\n            case 16:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[5, 12]]);\n    }));\n\n    return function handleClientSelect(_x2) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  var handleClientInfo = function handleClientInfo(clientId, clientName) {\n    console.log(\"Client ID: \".concat(clientId, \", Client Name: \").concat(clientName));\n    router.push(\"client/\" + clientId);\n  };\n\n  var handleClearClientSelection = function handleClearClientSelection() {\n    if (clientSelectionType === \"from\") {\n      setClientFromButtonText(\"Select Option\");\n      setSelectedClientFrom(null);\n    } else if (clientSelectionType === \"current\") {\n      setClientCurrentButtonText(\"Select Option\");\n      setSelectedClientCurrent(null);\n    }\n\n    setShowClientModal(false);\n  }; // --------------------\n  // MODEL SELECTION HANDLING\n  // --------------------\n\n\n  var _useState33 = useState([]),\n      models = _useState33[0],\n      setModels = _useState33[1];\n\n  var _useState34 = useState(false),\n      showModelModal = _useState34[0],\n      setShowModelModal = _useState34[1];\n\n  var _useState35 = useState(\"Select Option\"),\n      modelButtonText = _useState35[0],\n      setModelButtonText = _useState35[1];\n\n  var handleModelClick = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var modelsData;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return fetchModels(selectedOEM, selectedModality, selectedClientFrom);\n\n            case 2:\n              modelsData = _context4.sent;\n              setModels(modelsData);\n              setModelSearchTerm(\"\");\n              setShowModelModal(true);\n\n            case 6:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function handleModelClick() {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n\n  var handleModelSelect = function handleModelSelect(modelName) {\n    setModelButtonText(modelName || \"Select Option\");\n    setSelectedModel(modelName || null);\n    setShowModelModal(false);\n  };\n\n  var handleClearModelSelection = function handleClearModelSelection() {\n    setModelButtonText(\"Select Option\");\n    setSelectedModel(null);\n    setShowModelModal(false);\n  }; // --------------------\n  // WAREHOUSE BUTTONS (for Client Current)\n  // --------------------\n\n\n  var handleSoCalWarehouseClick = function handleSoCalWarehouseClick() {\n    setClientCurrentButtonText(\"SoCal Warehouse\");\n    setSelectedClientCurrent(SOCAL_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", SOCAL_CLIENT_ID);\n  };\n\n  var handleNorCalWarehouseClick = function handleNorCalWarehouseClick() {\n    setClientCurrentButtonText(\"NorCal Warehouse\");\n    setSelectedClientCurrent(NORCAL_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", NORCAL_CLIENT_ID);\n  };\n\n  var handleWarehouseUnassignedClick = function handleWarehouseUnassignedClick() {\n    setClientCurrentButtonText(\"Unassigned\");\n    setSelectedClientCurrent(UNASSIGNED_CLIENT_ID);\n    console.log(\"Warehouse button clicked: setting Client Current to\", UNASSIGNED_CLIENT_ID);\n  };\n\n  var _useState36 = useState(\"\"),\n      clientSearchTerm = _useState36[0],\n      setClientSearchTerm = _useState36[1];\n\n  var _useState37 = useState(\"\"),\n      modelSearchTerm = _useState37[0],\n      setModelSearchTerm = _useState37[1];\n\n  var deleteFromStorage = /*#__PURE__*/function () {\n    var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(itemId) {\n      var storageRef, folderRef, listResult, deletePromises;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              storageRef = firebase.storage().ref();\n              folderRef = storageRef.child(\"Parts/\".concat(itemId, \"/\"));\n              _context5.prev = 2;\n              _context5.next = 5;\n              return folderRef.listAll();\n\n            case 5:\n              listResult = _context5.sent;\n              deletePromises = listResult.items.map(function (item) {\n                return item[\"delete\"]();\n              });\n              _context5.next = 9;\n              return Promise.all(deletePromises);\n\n            case 9:\n              _context5.next = 14;\n              break;\n\n            case 11:\n              _context5.prev = 11;\n              _context5.t0 = _context5[\"catch\"](2);\n              console.error(\"Error deleting from storage:\", _context5.t0);\n\n            case 14:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, null, [[2, 11]]);\n    }));\n\n    return function deleteFromStorage(_x3) {\n      return _ref9.apply(this, arguments);\n    };\n  }();\n\n  var deleteFromPartsCollection = /*#__PURE__*/function () {\n    var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(itemId) {\n      var db;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              db = firebase.firestore();\n              _context6.prev = 1;\n              _context6.next = 4;\n              return db.collection(\"Parts\").doc(itemId)[\"delete\"]();\n\n            case 4:\n              console.log(\"Deleted item from Parts collection: \".concat(itemId));\n              _context6.next = 10;\n              break;\n\n            case 7:\n              _context6.prev = 7;\n              _context6.t0 = _context6[\"catch\"](1);\n              console.error(\"Error deleting from Parts collection:\", _context6.t0);\n\n            case 10:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6, null, [[1, 7]]);\n    }));\n\n    return function deleteFromPartsCollection(_x4) {\n      return _ref10.apply(this, arguments);\n    };\n  }(); //   // Safely convert any date-ish value into a comparable timestamp (ms since epoch).\n  // function toTime(value) {\n  //   if (!value) return null;\n  //   // Firestore Timestamp: { seconds, nanoseconds }\n  //   if (typeof value === \"object\" && value.seconds) {\n  //     try {\n  //       return value.seconds * 1000;\n  //     } catch { /* fallthrough */ }\n  //   }\n  //   // If already a Date\n  //   if (value instanceof Date) return isNaN(value.getTime()) ? null : value.getTime();\n  //   // If string: try ISO first\n  //   if (typeof value === \"string\") {\n  //     // yyyy-mm-dd (from your form inputs)\n  //     const iso = Date.parse(value);\n  //     if (!isNaN(iso)) return iso;\n  //     // mm/dd/yyyy fallback (older items)\n  //     const parts = value.split(\"/\");\n  //     if (parts.length === 3) {\n  //       const [mm, dd, yyyy] = parts;\n  //       const alt = Date.parse(`${yyyy}-${mm}-${dd}`);\n  //       if (!isNaN(alt)) return alt;\n  //     }\n  //   }\n  //   // Canonicalize any date-ish value to 'yyyy-mm-dd' so it matches <input type=\"date\"> values\n  //   function toYMD(value) {\n  //     const t = toTime(value);\n  //     if (t == null) return null;\n  //     const d = new Date(t);\n  //     const yyyy = d.getFullYear();\n  //     const mm = String(d.getMonth() + 1).padStart(2, \"0\");\n  //     const dd = String(d.getDate()).padStart(2, \"0\");\n  //     return `${yyyy}-${mm}-${dd}`;\n  //   }\n  //   // Last resort\n  //   const t = Date.parse(value);\n  //   return isNaN(t) ? null : t;\n  // }\n\n\n  return __jsx(LoggedIn, null, isDeleting && __jsx(\"div\", {\n    className: \"loading-overlay\"\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    className: \"spinner-center\"\n  }, __jsx(\"span\", {\n    className: \"sr-only\"\n  }, \"Loading...\"))), __jsx(Modal, {\n    show: showDeleteModal,\n    onHide: handleCloseDeleteModal\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Confirm Deletion\")), __jsx(Modal.Body, null, \"Are you sure you want to delete \", selectedItems.length, \" item\", selectedItems.length > 1 ? \"s\" : \"\", \"?\"), __jsx(Modal.Footer, null, __jsx(Button, {\n    variant: \"danger\",\n    onClick: handleDeleteSelected\n  }, \"Yes, delete\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: handleCloseDeleteModal\n  }, \"Cancel\"))), __jsx(Modal, {\n    show: showClientModal,\n    onHide: function onHide() {\n      return setShowClientModal(false);\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Select \", clientSelectionType === \"from\" ? \"Client From\" : \"Client Current\")), __jsx(Modal.Body, null, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: clientSearchTerm,\n    onChange: function onChange(e) {\n      return setClientSearchTerm(e.target.value);\n    }\n  }), __jsx(ClientTable, {\n    clients: (Array.isArray(clients) ? clients : []).filter(function (client) {\n      var _client$name;\n\n      return ((_client$name = client === null || client === void 0 ? void 0 : client.name) !== null && _client$name !== void 0 ? _client$name : \"\").toLowerCase().includes(clientSearchTerm.toLowerCase());\n    }),\n    onSelectClient: handleClientSelect,\n    onInfoClick: handleClientInfo,\n    isClientSearch: false,\n    clearSelection: function clearSelection() {\n      return handleClientSelect(null);\n    }\n  }))), __jsx(Modal, {\n    show: showModelModal,\n    onHide: function onHide() {\n      return setShowModelModal(false);\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true\n  }, __jsx(Modal.Title, null, \"Select Model\")), __jsx(Modal.Body, null, __jsx(FormControl, {\n    type: \"text\",\n    placeholder: \"Search by name\",\n    className: \"mb-3\",\n    value: modelSearchTerm,\n    onChange: function onChange(e) {\n      return setModelSearchTerm(e.target.value);\n    }\n  }), __jsx(ModelTable, {\n    models: models.filter(function (model) {\n      return typeof model === \"string\" ? model.toLowerCase().includes(modelSearchTerm.toLowerCase()) : false;\n    }),\n    onSelectModel: handleModelSelect,\n    clearSelection: function clearSelection() {\n      return handleModelSelect(null);\n    }\n  }))), __jsx(Container, {\n    className: \"d-flex align-items-center justify-content-center\",\n    style: {\n      minHeight: \"100vh\"\n    }\n  }, __jsx(\"div\", {\n    className: \"w-100\",\n    style: {\n      maxWidth: \"1200px\"\n    }\n  }, __jsx(Card, null, __jsx(Card.Body, null, __jsx(\"h2\", {\n    className: \"text-center mb-4\"\n  }, \"Magmo\"), __jsx(Row, null, __jsx(Col, {\n    md: 4\n  }, __jsx(\"div\", null, __jsx(InputGroup, {\n    className: \"mb-3\"\n  }, __jsx(InputGroup.Text, null, \"OEM\"), __jsx(Dropdown, {\n    onSelect: handleSelect1\n  }, __jsx(Dropdown.Toggle, {\n    variant: \"outline-secondary\",\n    id: \"dropdown-button-1\",\n    className: \"w-100\"\n  }, dropdown1Text), __jsx(Dropdown.Menu, {\n    className: \"w-100\"\n  }, __jsx(Dropdown.Item, {\n    eventKey: \"unassigned\"\n  }, \"Select Option\"), __jsx(Dropdown.Item, {\n    eventKey: \"GE\"\n  }, \"GE\"), __jsx(Dropdown.Item, {\n    eventKey: \"Toshiba\"\n  }, \"Toshiba\"), __jsx(Dropdown.Item, {\n    eventKey: \"Siemens\"\n  }, \"Siemens\"), __jsx(Dropdown.Item, {\n    eventKey: \"Philips\"\n  }, \"Philips\")))), __jsx(InputGroup, {\n    className: \"mb-5\"\n  }, __jsx(InputGroup.Text, null, \"Modality\"), __jsx(Dropdown, {\n    onSelect: handleSelect2\n  }, __jsx(Dropdown.Toggle, {\n    variant: \"outline-secondary\",\n    id: \"dropdown-button-2\",\n    className: \"w-100\"\n  }, dropdown2Text), __jsx(Dropdown.Menu, {\n    className: \"w-100\"\n  }, __jsx(Dropdown.Item, {\n    eventKey: \"unassigned\"\n  }, \"Select Option\"), __jsx(Dropdown.Item, {\n    eventKey: \"CT\"\n  }, \"CT\"), __jsx(Dropdown.Item, {\n    eventKey: \"MRI\"\n  }, \"MRI\"))))), __jsx(\"div\", {\n    className: styles.divider\n  }), __jsx(\"div\", null, __jsx(InputGroup, {\n    className: \"mb-3\"\n  }, __jsx(InputGroup.Text, null, \"Client From\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: function onClick() {\n      return handleClientClick(\"from\");\n    }\n  }, clientFromButtonText)), __jsx(InputGroup, {\n    className: \"mb-3\"\n  }, __jsx(InputGroup.Text, null, \"Client Current\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: function onClick() {\n      return handleClientClick(\"current\");\n    }\n  }, clientCurrentButtonText)), __jsx(InputGroup, {\n    className: \"mb-3\"\n  }, __jsx(InputGroup.Text, null, \"Model\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: \"w-100\",\n    onClick: handleModelClick\n  }, modelButtonText)), __jsx(\"div\", {\n    className: styles.divider\n  }), __jsx(InputGroup, {\n    className: \"mb-3\"\n  }, __jsx(InputGroup.Text, null, \"Warehouse\"), __jsx(\"div\", {\n    className: styles.buttonGroup\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.flexButton,\n    onClick: handleSoCalWarehouseClick\n  }, \"SoCal Warehouse\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.flexButton,\n    onClick: handleNorCalWarehouseClick\n  }, \"NorCal Warehouse\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.flexButton,\n    onClick: handleWarehouseUnassignedClick\n  }, \"Unassigned\"))))), __jsx(Col, {\n    md: 8\n  }, __jsx(\"div\", {\n    className: styles.tableContainer\n  }, isLoading ? __jsx(\"div\", {\n    className: \"jsx-1682384643\" + \" \" + \"d-flex justify-content-center align-items-center p-5\"\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\" // make sure it's in /public\n    ,\n    alt: \"Loading Magmo\",\n    style: {\n      width: 64,\n      height: 64,\n      animation: \"magmo-spin 1s linear infinite\",\n      transformOrigin: \"50% 50%\",\n      display: \"block\"\n    },\n    className: \"jsx-1682384643\"\n  }), __jsx(_JSXStyle, {\n    id: \"1682384643\"\n  }, [\"@-webkit-keyframes magmo-spin{from{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}to{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}\", \"@keyframes magmo-spin{from{-webkit-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}to{-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}\"])) : __jsx(PartTable, {\n    info: info,\n    labels: labels,\n    ids: ids,\n    hoverStyle: hoverStyle,\n    sortCheckAll: sortCheckAll,\n    checkDelete: checkDelete,\n    isDeleting: isDeleting,\n    rowSelect: rowSelect,\n    setHoverIndex: setHoverIndex,\n    hoverIndex: hoverIndex,\n    selectedItems: selectedItems,\n    setSelectedItems: setSelectedItems\n  }), __jsx(\"div\", {\n    className: styles.searchContainer\n  }, __jsx(Form, {\n    className: \"d-flex pb-2\"\n  }, __jsx(FormControl, {\n    type: showListSearch,\n    placeholder: \"Search\",\n    className: \"me-2 flex-grow-1\",\n    \"aria-label\": \"Search\",\n    value: search,\n    onChange: searchChangeHandler,\n    style: {\n      flex: \"1\"\n    }\n  }), __jsx(NavDropdown, {\n    title: select,\n    id: \"collasible-nav-dropdown\",\n    show: showList,\n    onMouseEnter: function onMouseEnter() {\n      return setShowList(true);\n    },\n    onMouseLeave: function onMouseLeave() {\n      return setShowList(false);\n    },\n    style: {\n      marginTop: \"-5px\"\n    }\n  }, __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Name\");\n      setShowListSearch(\"text\");\n    }\n  }, \"Name\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Date\");\n      setShowListSearch(\"date\");\n    }\n  }, \"Date\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Work Order\");\n      setShowListSearch(\"number\");\n    }\n  }, \"Work Order\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Product Number\");\n      setShowListSearch(\"number\");\n    }\n  }, \"Product Number\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"Description\");\n      setShowListSearch(\"text\");\n    }\n  }, \"Description\"), __jsx(NavDropdown.Item, {\n    onClick: function onClick() {\n      setSelect(\"SKU\");\n      setShowListSearch(\"text\");\n    }\n  }, \"SKU\"))), __jsx(\"div\", {\n    className: \"d-flex justify-content-between\"\n  }, __jsx(LoadingButton, {\n    type: \"secondary\",\n    name: \"Add New Item\",\n    route: \"NewSearch/AddItem/NewItem\"\n  }), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"Warehousedb/WarehouseSelect\"\n  })))))))))));\n}","map":null,"metadata":{},"sourceType":"module"}