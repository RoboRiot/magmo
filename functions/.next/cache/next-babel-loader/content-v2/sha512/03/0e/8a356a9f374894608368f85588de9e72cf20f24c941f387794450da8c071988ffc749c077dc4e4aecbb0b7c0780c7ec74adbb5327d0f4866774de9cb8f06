{"ast":null,"code":"import fs from \"fs\";\nimport { initializeApp, getApps, cert } from \"firebase-admin/app\";\nimport { getFirestore } from \"firebase-admin/firestore\"; // Import Firebase Functions for config access\n\nlet functions;\n\ntry {\n  functions = require(\"firebase-functions\");\n} catch (error) {\n  // Not running in Firebase Functions environment\n  functions = null;\n} // Initialize Firebase Admin if it hasn't been initialized\n\n\nif (!getApps().length) {\n  var _serviceAccount, _functions$config$adm, _functions$config$ssr, _serviceAccount2, _functions$config$adm2, _functions$config$ssr2, _serviceAccount3;\n\n  const serviceAccountPath = process.env.FIREBASE_ADMIN_SERVICE_ACCOUNT_PATH || process.env.FIREBASE_SERVICE_ACCOUNT_PATH;\n  let serviceAccount = null;\n\n  if (serviceAccountPath) {\n    try {\n      const raw = fs.readFileSync(serviceAccountPath, \"utf8\");\n      serviceAccount = JSON.parse(raw);\n    } catch (error) {\n      console.warn(\"Firebase Admin service account file could not be loaded:\", error.message);\n    }\n  }\n\n  const clientEmail = process.env.FIREBASE_CLIENT_EMAIL || process.env.FIREBASE_FUNCTIONS_CLIENT_EMAIL || process.env.FIREBASE_ADMIN_CLIENT_EMAIL || ((_serviceAccount = serviceAccount) === null || _serviceAccount === void 0 ? void 0 : _serviceAccount.client_email) || (functions ? ((_functions$config$adm = functions.config().admin) === null || _functions$config$adm === void 0 ? void 0 : _functions$config$adm.client_email) || ((_functions$config$ssr = functions.config().ssr) === null || _functions$config$ssr === void 0 ? void 0 : _functions$config$ssr.firebase_client_email) : undefined);\n  const privateKey = process.env.FIREBASE_PRIVATE_KEY || process.env.FIREBASE_FUNCTIONS_PRIVATE_KEY || process.env.FIREBASE_ADMIN_PRIVATE_KEY || ((_serviceAccount2 = serviceAccount) === null || _serviceAccount2 === void 0 ? void 0 : _serviceAccount2.private_key) || (functions ? ((_functions$config$adm2 = functions.config().admin) === null || _functions$config$adm2 === void 0 ? void 0 : _functions$config$adm2.private_key) || ((_functions$config$ssr2 = functions.config().ssr) === null || _functions$config$ssr2 === void 0 ? void 0 : _functions$config$ssr2.firebase_private_key) : undefined);\n  const projectId = process.env.FIREBASE_ADMIN_PROJECT_ID || process.env.FIREBASE_PROJECT_ID || ((_serviceAccount3 = serviceAccount) === null || _serviceAccount3 === void 0 ? void 0 : _serviceAccount3.project_id) || \"magmo-ac10c\";\n  const hasExplicitAdminCreds = Boolean(clientEmail && privateKey);\n  const isGoogleRuntime = Boolean(process.env.K_SERVICE || process.env.FUNCTION_TARGET || process.env.GAE_ENV || process.env.GOOGLE_CLOUD_PROJECT);\n  const canUseAdc = isGoogleRuntime || Boolean(process.env.GOOGLE_APPLICATION_CREDENTIALS);\n\n  try {\n    if (hasExplicitAdminCreds) {\n      initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail: clientEmail,\n          privateKey: privateKey.replace(/\\\\n/g, \"\\n\")\n        }),\n        databaseURL: \"https://magmo-ac10c.firebaseio.com\"\n      });\n    } else if (canUseAdc) {\n      // Fall back to Application Default Credentials (e.g. Cloud Functions/Run)\n      initializeApp({\n        projectId,\n        databaseURL: \"https://magmo-ac10c.firebaseio.com\"\n      });\n    } else {\n      console.warn(\"Firebase Admin not initialized: missing service account credentials in local environment.\");\n    }\n  } catch (error) {\n    console.warn(\"Firebase Admin initialization failed:\", error.message); // Don't throw error during build process\n  }\n} // Only export Firestore if Firebase Admin is properly initialized\n\n\nlet adminDb = null;\n\ntry {\n  if (getApps().length > 0) {\n    adminDb = getFirestore();\n  }\n} catch (error) {\n  console.warn(\"Firebase Admin not available:\", error.message);\n}\n\nexport { adminDb };\nexport default adminDb;","map":null,"metadata":{},"sourceType":"module"}