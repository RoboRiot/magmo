{"ast":null,"code":"import _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _readOnlyError from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/readOnlyError\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\client\\\\[id]\\\\addClient.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { Form, Button, Card, Container, Row, Col, Modal, Table } from \"react-bootstrap\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../../../../context/Firebase\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport MachineCreationModal from \"../../MachineCreationModal\";\n\nvar AddClient = function AddClient() {\n  _s();\n\n  var router = useRouter();\n\n  var _useState = useState(null),\n      clientId = _useState[0],\n      setClientId = _useState[1];\n\n  var _useState2 = useState({\n    name: \"\",\n    location: \"\"\n  }),\n      client = _useState2[0],\n      setClient = _useState2[1];\n\n  var _useState3 = useState([]),\n      addedMachines = _useState3[0],\n      setAddedMachines = _useState3[1];\n\n  var _useState4 = useState(false),\n      showClientInfoModal = _useState4[0],\n      setShowClientInfoModal = _useState4[1];\n\n  var _useState5 = useState(false),\n      showMachineCreationModal = _useState5[0],\n      setShowMachineCreationModal = _useState5[1];\n\n  var _useState6 = useState([]),\n      machineOptions = _useState6[0],\n      setMachineOptions = _useState6[1];\n\n  var _useState7 = useState(null),\n      error = _useState7[0],\n      setError = _useState7[1];\n\n  useEffect(function () {\n    var handleClientId = function handleClientId() {\n      var id = router.query.id;\n\n      if (id) {\n        setClientId(id);\n        fetchClientData(id);\n      }\n    };\n\n    if (router.isReady) {\n      handleClientId();\n    }\n  }, [router.isReady, router.query]);\n\n  var fetchClientData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n      var db, doc, data, machineRefs, machines;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              db = firebase.firestore();\n              _context.prev = 1;\n              _context.next = 4;\n              return db.collection(\"Client\").doc(id).get();\n\n            case 4:\n              doc = _context.sent;\n\n              if (!doc.exists) {\n                _context.next = 13;\n                break;\n              }\n\n              data = doc.data();\n              setClient({\n                name: data.name || \"\",\n                location: data.local || \"\"\n              });\n              machineRefs = data.machines || [];\n              _context.next = 11;\n              return Promise.all(machineRefs.map(function (ref) {\n                return ref.get().then(function (doc) {\n                  return _objectSpread({\n                    id: doc.id\n                  }, doc.data());\n                });\n              }));\n\n            case 11:\n              machines = _context.sent;\n              setAddedMachines(machines);\n\n            case 13:\n              _context.next = 19;\n              break;\n\n            case 15:\n              _context.prev = 15;\n              _context.t0 = _context[\"catch\"](1);\n              console.error(\"Error fetching client data:\", _context.t0);\n              setError(\"Failed to fetch client data.\");\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 15]]);\n    }));\n\n    return function fetchClientData(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var fetchAvailableMachines = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var db, snapshot, machines;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              db = firebase.firestore();\n              _context2.prev = 1;\n              _context2.next = 4;\n              return db.collection(\"Machine\").where(\"client\", \"==\", null).get();\n\n            case 4:\n              snapshot = _context2.sent;\n              machines = snapshot.docs.map(function (doc) {\n                return _objectSpread({\n                  id: doc.id\n                }, doc.data());\n              });\n              setMachineOptions(machines);\n              _context2.next = 13;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error(\"Error fetching machines:\", _context2.t0);\n              setError(\"Failed to fetch machines.\");\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 9]]);\n    }));\n\n    return function fetchAvailableMachines() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleChange = function handleChange(field) {\n    return function (event) {\n      var value = event.target.value;\n      setClient(function (prev) {\n        return _objectSpread(_objectSpread({}, prev), {}, _defineProperty({}, field, value));\n      });\n    };\n  };\n\n  var handleAddMachine = function handleAddMachine(machine) {\n    setAddedMachines(function (prev) {\n      return [].concat(_toConsumableArray(prev), [machine]);\n    });\n    setShowClientInfoModal(false);\n  }; // When creating a new machine, if a client exists (edit mode) use set with merge\n  // so that if the client document doesn't exist yet it gets created.\n\n\n  var handleCreateMachine = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(newMachine) {\n      var db, machineId, machineWithId, clientRef;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              db = firebase.firestore();\n              machineId = \"AIS\".concat(Math.floor(10000 + Math.random() * 90000));\n              _context3.prev = 2;\n              machineWithId = _objectSpread(_objectSpread({}, newMachine), {}, {\n                id: machineId,\n                // Only set the client if clientId exists; otherwise, leave it null.\n                client: clientId ? db.collection(\"Client\").doc(clientId) : null\n              });\n              _context3.next = 6;\n              return db.collection(\"Machine\").doc(machineId).set(machineWithId);\n\n            case 6:\n              if (!clientId) {\n                _context3.next = 10;\n                break;\n              }\n\n              clientRef = db.collection(\"Client\").doc(clientId);\n              _context3.next = 10;\n              return clientRef.set({\n                machines: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Machine\").doc(machineId))\n              }, {\n                merge: true\n              });\n\n            case 10:\n              setShowMachineCreationModal(false);\n              setAddedMachines(function (prev) {\n                return [].concat(_toConsumableArray(prev), [_objectSpread({\n                  id: machineId\n                }, newMachine)]);\n              });\n              _context3.next = 18;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](2);\n              console.error(\"Error creating and adding machine:\", _context3.t0);\n              setError(\"Failed to create and add machine.\");\n\n            case 18:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[2, 14]]);\n    }));\n\n    return function handleCreateMachine(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleRemoveMachine = function handleRemoveMachine(index) {\n    setAddedMachines(function (prev) {\n      return prev.filter(function (_, i) {\n        return i !== index;\n      });\n    });\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var db, newClientId;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              db = firebase.firestore();\n              _context4.prev = 1;\n\n              if (!clientId) {\n                _context4.next = 7;\n                break;\n              }\n\n              _context4.next = 5;\n              return db.collection(\"Client\").doc(clientId).set(_objectSpread(_objectSpread({}, client), {}, {\n                machines: addedMachines.map(function (machine) {\n                  return db.collection(\"Machine\").doc(machine.id);\n                })\n              }), {\n                merge: true\n              });\n\n            case 5:\n              _context4.next = 11;\n              break;\n\n            case 7:\n              // Create new client\n              newClientId = \"AIS\".concat(Math.floor(10000 + Math.random() * 90000));\n              _context4.next = 10;\n              return db.collection(\"Client\").doc(newClientId).set(_objectSpread(_objectSpread({}, client), {}, {\n                machines: addedMachines.map(function (machine) {\n                  return db.collection(\"Machine\").doc(machine.id);\n                })\n              }));\n\n            case 10:\n              // (Update machines with the new client reference as needed.)\n              clientId = (_readOnlyError(\"clientId\"), newClientId);\n\n            case 11:\n              alert(\"Client and machines saved successfully.\"); // Check if we came from an item; if so, route back to that item page.\n\n              if (router.query.from === \"item\" && router.query.itemId) {\n                router.push(\"/NewSearch/item/\".concat(router.query.itemId));\n              } else if (router.query.from === \"addItem\" && router.query.itemId) {\n                router.push(\"AddItem/NewItem\");\n              } else {\n                router.push(\"../../clientSearch\");\n              }\n\n              _context4.next = 19;\n              break;\n\n            case 15:\n              _context4.prev = 15;\n              _context4.t0 = _context4[\"catch\"](1);\n              console.error(\"Error saving client:\", _context4.t0);\n              setError(\"Failed to save client.\");\n\n            case 19:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[1, 15]]);\n    }));\n\n    return function handleSubmit() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Container, {\n    className: \"mt-5\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 5\n    }\n  }, __jsx(Row, {\n    className: \"justify-content-md-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }\n  }, __jsx(Col, {\n    md: \"8\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 9\n    }\n  }, __jsx(Card, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 11\n    }\n  }, __jsx(Card.Header, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }\n  }, __jsx(\"h4\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 15\n    }\n  }, clientId ? \"Edit Client\" : \"Add New Client\")), __jsx(Card.Body, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }\n  }, error && __jsx(\"p\", {\n    className: \"text-danger\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 25\n    }\n  }, error), __jsx(Form, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 15\n    }\n  }, __jsx(Row, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 17\n    }\n  }, __jsx(Col, {\n    md: 6,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 19\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"clientName\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Label, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 23\n    }\n  }, \"Client Name\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter client name\",\n    value: client.name,\n    onChange: handleChange(\"name\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 23\n    }\n  }))), __jsx(Col, {\n    md: 6,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 19\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"clientLocation\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Label, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 23\n    }\n  }, \"Location\"), __jsx(Form.Control, {\n    type: \"text\",\n    placeholder: \"Enter location\",\n    value: client.location,\n    onChange: handleChange(\"location\"),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 23\n    }\n  })))), __jsx(Row, {\n    className: \"mt-3\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }, __jsx(Col, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: function onClick() {\n      return setShowClientInfoModal(true);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 21\n    }\n  }, \"Add Machine\"), __jsx(Button, {\n    variant: \"secondary\",\n    className: \"ms-2\",\n    onClick: function onClick() {\n      return setShowMachineCreationModal(true);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 21\n    }\n  }, \"Create Machine\"))), __jsx(Row, {\n    className: \"mt-3\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 17\n    }\n  }, __jsx(Col, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 19\n    }\n  }, __jsx(Table, {\n    striped: true,\n    bordered: true,\n    hover: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 21\n    }\n  }, __jsx(\"thead\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 23\n    }\n  }, __jsx(\"tr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 25\n    }\n  }, __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 27\n    }\n  }, \"Machine Name\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 27\n    }\n  }, \"Location\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 27\n    }\n  }, \"Actions\"))), __jsx(\"tbody\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 23\n    }\n  }, addedMachines.map(function (machine, index) {\n    return __jsx(\"tr\", {\n      key: index,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 27\n      }\n    }, __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 29\n      }\n    }, machine.name), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 29\n      }\n    }, machine.local), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 29\n      }\n    }, __jsx(Button, {\n      variant: \"danger\",\n      size: \"sm\",\n      onClick: function onClick() {\n        return handleRemoveMachine(index);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 31\n      }\n    }, \"Remove\")));\n  }))))), __jsx(Row, {\n    className: \"mt-4\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 17\n    }\n  }, __jsx(Col, {\n    md: 6,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"success\",\n    onClick: handleSubmit,\n    className: \"w-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 21\n    }\n  }, \"Submit\")), __jsx(Col, {\n    md: 6,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: function onClick() {\n      return router.back();\n    },\n    className: \"w-100\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 21\n    }\n  }, \"Back\")))))))), __jsx(ClientInfoModal, {\n    show: showClientInfoModal,\n    handleClose: function handleClose() {\n      return setShowClientInfoModal(false);\n    },\n    machineOptions: machineOptions,\n    setSelectedMachine: handleAddMachine,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }\n  }), __jsx(MachineCreationModal, {\n    show: showMachineCreationModal,\n    handleClose: function handleClose() {\n      return setShowMachineCreationModal(false);\n    },\n    onCreateMachine: handleCreateMachine,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 7\n    }\n  }));\n};\n\n_s(AddClient, \"czilsrCSFTVw8ksKZ6hxD4Jq+yE=\", false, function () {\n  return [useRouter];\n});\n\n_c = AddClient;\nexport default AddClient;\n\nvar _c;\n\n$RefreshReg$(_c, \"AddClient\");","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/client/[id]/addClient.js"],"names":["React","useState","useEffect","Form","Button","Card","Container","Row","Col","Modal","Table","useRouter","firebase","ClientInfoModal","MachineCreationModal","AddClient","router","clientId","setClientId","name","location","client","setClient","addedMachines","setAddedMachines","showClientInfoModal","setShowClientInfoModal","showMachineCreationModal","setShowMachineCreationModal","machineOptions","setMachineOptions","error","setError","handleClientId","id","query","fetchClientData","isReady","db","firestore","collection","doc","get","exists","data","local","machineRefs","machines","Promise","all","map","ref","then","console","fetchAvailableMachines","where","snapshot","docs","handleChange","field","event","value","target","prev","handleAddMachine","machine","handleCreateMachine","newMachine","machineId","Math","floor","random","machineWithId","set","clientRef","FieldValue","arrayUnion","merge","handleRemoveMachine","index","filter","_","i","handleSubmit","newClientId","alert","from","itemId","push","back"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport {\n  Form,\n  Button,\n  Card,\n  Container,\n  Row,\n  Col,\n  Modal,\n  Table,\n} from \"react-bootstrap\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../../../../context/Firebase\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport MachineCreationModal from \"../../MachineCreationModal\";\n\nconst AddClient = () => {\n  const router = useRouter();\n  const [clientId, setClientId] = useState(null);\n  const [client, setClient] = useState({\n    name: \"\",\n    location: \"\",\n  });\n  const [addedMachines, setAddedMachines] = useState([]);\n  const [showClientInfoModal, setShowClientInfoModal] = useState(false);\n  const [showMachineCreationModal, setShowMachineCreationModal] = useState(false);\n  const [machineOptions, setMachineOptions] = useState([]);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const handleClientId = () => {\n      const { id } = router.query;\n      if (id) {\n        setClientId(id);\n        fetchClientData(id);\n      }\n    };\n\n    if (router.isReady) {\n      handleClientId();\n    }\n  }, [router.isReady, router.query]);\n\n  const fetchClientData = async (id) => {\n    const db = firebase.firestore();\n    try {\n      const doc = await db.collection(\"Client\").doc(id).get();\n      if (doc.exists) {\n        const data = doc.data();\n        setClient({\n          name: data.name || \"\",\n          location: data.local || \"\",\n        });\n        const machineRefs = data.machines || [];\n        const machines = await Promise.all(\n          machineRefs.map((ref) =>\n            ref.get().then((doc) => ({ id: doc.id, ...doc.data() }))\n          )\n        );\n        setAddedMachines(machines);\n      }\n    } catch (error) {\n      console.error(\"Error fetching client data:\", error);\n      setError(\"Failed to fetch client data.\");\n    }\n  };\n\n  const fetchAvailableMachines = async () => {\n    const db = firebase.firestore();\n    try {\n      const snapshot = await db\n        .collection(\"Machine\")\n        .where(\"client\", \"==\", null)\n        .get();\n      const machines = snapshot.docs.map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      }));\n      setMachineOptions(machines);\n    } catch (error) {\n      console.error(\"Error fetching machines:\", error);\n      setError(\"Failed to fetch machines.\");\n    }\n  };\n\n  const handleChange = (field) => (event) => {\n    const value = event.target.value;\n    setClient((prev) => ({ ...prev, [field]: value }));\n  };\n\n  const handleAddMachine = (machine) => {\n    setAddedMachines((prev) => [...prev, machine]);\n    setShowClientInfoModal(false);\n  };\n\n  // When creating a new machine, if a client exists (edit mode) use set with merge\n  // so that if the client document doesn't exist yet it gets created.\n  const handleCreateMachine = async (newMachine) => {\n    const db = firebase.firestore();\n    const machineId = `AIS${Math.floor(10000 + Math.random() * 90000)}`;\n    try {\n      const machineWithId = {\n        ...newMachine,\n        id: machineId,\n        // Only set the client if clientId exists; otherwise, leave it null.\n        client: clientId ? db.collection(\"Client\").doc(clientId) : null,\n      };\n      await db.collection(\"Machine\").doc(machineId).set(machineWithId);\n\n      // If editing an existing client, update its machines array using set with merge.\n      if (clientId) {\n        const clientRef = db.collection(\"Client\").doc(clientId);\n        await clientRef.set(\n          {\n            machines: firebase.firestore.FieldValue.arrayUnion(\n              db.collection(\"Machine\").doc(machineId)\n            ),\n          },\n          { merge: true }\n        );\n      }\n\n      setShowMachineCreationModal(false);\n      setAddedMachines((prev) => [...prev, { id: machineId, ...newMachine }]);\n    } catch (error) {\n      console.error(\"Error creating and adding machine:\", error);\n      setError(\"Failed to create and add machine.\");\n    }\n  };\n\n  const handleRemoveMachine = (index) => {\n    setAddedMachines((prev) => prev.filter((_, i) => i !== index));\n  };\n\n  const handleSubmit = async () => {\n    const db = firebase.firestore();\n    try {\n      if (clientId) {\n        // Update existing client\n        await db.collection(\"Client\").doc(clientId).set(\n          {\n            ...client,\n            machines: addedMachines.map((machine) =>\n              db.collection(\"Machine\").doc(machine.id)\n            ),\n          },\n          { merge: true }\n        );\n      } else {\n        // Create new client\n        const newClientId = `AIS${Math.floor(10000 + Math.random() * 90000)}`;\n        await db.collection(\"Client\").doc(newClientId).set({\n          ...client,\n          machines: addedMachines.map((machine) =>\n            db.collection(\"Machine\").doc(machine.id)\n          ),\n        });\n        // (Update machines with the new client reference as needed.)\n        clientId = newClientId;\n      }\n      alert(\"Client and machines saved successfully.\");\n\n      // Check if we came from an item; if so, route back to that item page.\n      if (router.query.from === \"item\" && router.query.itemId) {\n        router.push(`/NewSearch/item/${router.query.itemId}`);\n      } else if(router.query.from === \"addItem\" && router.query.itemId){\n        router.push(\"AddItem/NewItem\");\n      } else {\n        router.push(\"../../clientSearch\");\n      }\n    } catch (error) {\n      console.error(\"Error saving client:\", error);\n      setError(\"Failed to save client.\");\n    }\n  };\n\n\n  return (\n    <Container className=\"mt-5\">\n      <Row className=\"justify-content-md-center\">\n        <Col md=\"8\">\n          <Card>\n            <Card.Header>\n              <h4>{clientId ? \"Edit Client\" : \"Add New Client\"}</h4>\n            </Card.Header>\n            <Card.Body>\n              {error && <p className=\"text-danger\">{error}</p>}\n              <Form>\n                <Row>\n                  <Col md={6}>\n                    <Form.Group controlId=\"clientName\">\n                      <Form.Label>Client Name</Form.Label>\n                      <Form.Control\n                        type=\"text\"\n                        placeholder=\"Enter client name\"\n                        value={client.name}\n                        onChange={handleChange(\"name\")}\n                      />\n                    </Form.Group>\n                  </Col>\n                  <Col md={6}>\n                    <Form.Group controlId=\"clientLocation\">\n                      <Form.Label>Location</Form.Label>\n                      <Form.Control\n                        type=\"text\"\n                        placeholder=\"Enter location\"\n                        value={client.location}\n                        onChange={handleChange(\"location\")}\n                      />\n                    </Form.Group>\n                  </Col>\n                </Row>\n                <Row className=\"mt-3\">\n                  <Col>\n                    <Button\n                      variant=\"primary\"\n                      onClick={() => setShowClientInfoModal(true)}\n                    >\n                      Add Machine\n                    </Button>\n                    <Button\n                      variant=\"secondary\"\n                      className=\"ms-2\"\n                      onClick={() => setShowMachineCreationModal(true)}\n                    >\n                      Create Machine\n                    </Button>\n                  </Col>\n                </Row>\n                <Row className=\"mt-3\">\n                  <Col>\n                    <Table striped bordered hover>\n                      <thead>\n                        <tr>\n                          <th>Machine Name</th>\n                          <th>Location</th>\n                          <th>Actions</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {addedMachines.map((machine, index) => (\n                          <tr key={index}>\n                            <td>{machine.name}</td>\n                            <td>{machine.local}</td>\n                            <td>\n                              <Button\n                                variant=\"danger\"\n                                size=\"sm\"\n                                onClick={() => handleRemoveMachine(index)}\n                              >\n                                Remove\n                              </Button>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </Table>\n                  </Col>\n                </Row>\n                <Row className=\"mt-4\">\n                  <Col md={6}>\n                    <Button\n                      variant=\"success\"\n                      onClick={handleSubmit}\n                      className=\"w-100\"\n                    >\n                      Submit\n                    </Button>\n                  </Col>\n                  <Col md={6}>\n                    <Button\n                      variant=\"primary\"\n                      onClick={() => router.back()}\n                      className=\"w-100\"\n                    >\n                      Back\n                    </Button>\n                  </Col>\n                </Row>\n              </Form>\n            </Card.Body>\n          </Card>\n        </Col>\n      </Row>\n\n      {/* Modal to add an existing machine */}\n      <ClientInfoModal\n        show={showClientInfoModal}\n        handleClose={() => setShowClientInfoModal(false)}\n        machineOptions={machineOptions}\n        setSelectedMachine={handleAddMachine}\n      />\n\n      {/* Modal to create a new machine */}\n      <MachineCreationModal\n        show={showMachineCreationModal}\n        handleClose={() => setShowMachineCreationModal(false)}\n        onCreateMachine={handleCreateMachine}\n      />\n    </Container>\n  );\n};\n\nexport default AddClient;\n"]},"metadata":{},"sourceType":"module"}