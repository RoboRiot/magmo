{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\components\\\\WarehouseMapModal.js\";\nvar __jsx = React.createElement;\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport firebase from \"../context/Firebase\";\nimport styles from \"./WarehouseMapModal.module.css\";\nconst REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\nconst LETTERS = Array.from({\n  length: 26\n}, (_, i) => String.fromCharCode(65 + i));\nconst NUMBERS = Array.from({\n  length: 50\n}, (_, i) => i + 1);\nexport default function WarehouseMapModal({\n  show = false,\n  onHide = () => {},\n  onView,\n  onSelectionChange,\n  initialSelection = {}\n}) {\n  const {\n    0: regionOptions,\n    1: setRegionOptions\n  } = useState([]);\n  const {\n    0: sectionMap,\n    1: setSectionMap\n  } = useState({});\n  const {\n    0: mapStep,\n    1: setMapStep\n  } = useState(\"regions\");\n  const {\n    0: mapRegion,\n    1: setMapRegion\n  } = useState(\"\");\n  const {\n    0: mapRow,\n    1: setMapRow\n  } = useState(\"\");\n  const {\n    0: mapCol,\n    1: setMapCol\n  } = useState(\"\");\n  const {\n    0: mapPallet,\n    1: setMapPallet\n  } = useState(\"\");\n  const {\n    0: mapBin,\n    1: setMapBin\n  } = useState(\"\");\n  const {\n    0: mapCellPallets,\n    1: setMapCellPallets\n  } = useState({});\n  const {\n    0: mapPalletBins,\n    1: setMapPalletBins\n  } = useState({});\n  const {\n    0: mapLoading,\n    1: setMapLoading\n  } = useState(false);\n  const {\n    0: mapError,\n    1: setMapError\n  } = useState(\"\");\n  const {\n    0: directoryLoaded,\n    1: setDirectoryLoaded\n  } = useState(false);\n  const lastShowRef = useRef(false);\n  const notifySelectionChange = useCallback(selection => {\n    if (typeof onSelectionChange === \"function\") {\n      onSelectionChange(selection);\n    }\n  }, [onSelectionChange]);\n  const loadDirectory = useCallback(async () => {\n    if (directoryLoaded) return;\n\n    try {\n      const doc = await firebase.firestore().collection(\"Warehouse\").doc(\"directory\").get();\n      const data = doc.data() || {};\n      setRegionOptions(data.Region || []);\n      setSectionMap(data.Section || {});\n      setDirectoryLoaded(true);\n    } catch (error) {\n      console.error(\"Failed to load map directory\", error);\n      setMapError(\"Failed to load warehouse directory.\");\n    }\n  }, [directoryLoaded]);\n  const loadRegionInventory = useCallback(async regionId => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n\n    try {\n      const snap = await firebase.firestore().collection(\"Test\").where(\"newLocalCurrent.region\", \"==\", regionId).get();\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach(doc => {\n        var _doc$data, _loc$section, _loc$section2;\n\n        const loc = ((_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.newLocalCurrent) || {};\n        let row = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.letter;\n        let col = (_loc$section2 = loc.section) === null || _loc$section2 === void 0 ? void 0 : _loc$section2.number;\n\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n\n        if (pallet !== undefined && pallet !== null && `${pallet}` !== \"\") {\n          if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n          cellPallets[cellKey].add(String(pallet));\n\n          if (bin !== undefined && bin !== null && `${bin}` !== \"\") {\n            const palletKey = `${cellKey}-P${pallet}`;\n            if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n            palletBins[palletKey].add(String(bin));\n          }\n        }\n      });\n      const cellObj = {};\n      Object.keys(cellPallets).forEach(key => {\n        cellObj[key] = Array.from(cellPallets[key]).sort((a, b) => Number(a) - Number(b));\n      });\n      const palletObj = {};\n      Object.keys(palletBins).forEach(key => {\n        palletObj[key] = Array.from(palletBins[key]).sort((a, b) => Number(a) - Number(b));\n      });\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  }, []);\n  const getRegionDimensions = useCallback(regionId => {\n    const entry = sectionMap === null || sectionMap === void 0 ? void 0 : sectionMap[regionId];\n\n    if (Array.isArray(entry) && entry.length >= 2) {\n      const cols = parseInt(entry[0], 10);\n      const rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0\n      };\n    }\n\n    return {\n      cols: 0,\n      rows: 0\n    };\n  }, [sectionMap]);\n  useEffect(() => {\n    const wasOpen = lastShowRef.current;\n    lastShowRef.current = show;\n    if (!show || wasOpen) return;\n    loadDirectory();\n    setMapError(\"\");\n    const {\n      region,\n      sectionLetter,\n      sectionNumber,\n      pallet,\n      bin\n    } = initialSelection || {};\n    setMapRegion(region || \"\");\n    setMapRow(sectionLetter || \"\");\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\n    setMapPallet(pallet ? String(pallet) : \"\");\n    setMapBin(bin ? String(bin) : \"\");\n    setMapStep(region ? \"grid\" : \"regions\");\n    if (region) loadRegionInventory(region);\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\n\n  const handleSelectRegion = regionId => {\n    const selection = {\n      region: regionId,\n      sectionLetter: \"\",\n      sectionNumber: \"\",\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"grid\");\n    notifySelectionChange(selection);\n    loadRegionInventory(regionId);\n  };\n\n  const handleSelectCell = (rowLetter, colNumber) => {\n    const colValue = String(colNumber);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: rowLetter,\n      sectionNumber: colValue,\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRow(rowLetter);\n    setMapCol(colValue);\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"pallets\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectPallet = palletId => {\n    const palletValue = String(palletId);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: palletValue,\n      bin: \"\"\n    };\n    setMapPallet(palletValue);\n    setMapBin(\"\");\n    setMapStep(\"bins\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectBin = binId => {\n    const binValue = String(binId);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: binValue\n    };\n    setMapBin(binValue);\n    notifySelectionChange(selection);\n  };\n\n  const handleBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");else if (mapStep === \"pallets\") setMapStep(\"grid\");else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleView = () => {\n    if (typeof onView !== \"function\") return;\n    onView({\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: mapBin\n    });\n  };\n\n  return __jsx(Modal, {\n    show: show,\n    onHide: onHide,\n    centered: true,\n    size: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 5\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }\n  }, \"Warehouse Map\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }\n  }, mapLoading && __jsx(\"div\", {\n    className: styles.mapLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 11\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 13\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 13\n    }\n  }, \"Loading map data...\")), mapError && __jsx(\"div\", {\n    className: styles.mapError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 22\n    }\n  }, mapError), !mapLoading && mapStep === \"regions\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 13\n    }\n  }, \"Select a region\"), __jsx(\"div\", {\n    className: styles.mapCanvas,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 13\n    }\n  }, REGION_ORDER.map(regionId => __jsx(\"button\", {\n    key: regionId,\n    type: \"button\",\n    className: `${styles.regionBlock} ${styles[`region${regionId}`]}`,\n    onClick: () => handleSelectRegion(regionId),\n    disabled: Array.isArray(regionOptions) && regionOptions.length > 0 && !regionOptions.includes(regionId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 17\n    }\n  }, regionId)))), !mapLoading && mapStep === \"grid\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \": choose a row and column\"), (() => {\n    const dims = getRegionDimensions(mapRegion);\n    const rows = LETTERS.slice(0, dims.rows || 0);\n    const cols = NUMBERS.slice(0, dims.cols || 0);\n\n    if (!rows.length || !cols.length) {\n      return __jsx(\"div\", {\n        className: styles.mapEmpty,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 19\n        }\n      }, \"No grid data for this region.\");\n    }\n\n    return __jsx(\"div\", {\n      className: styles.gridWrapper,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 17\n      }\n    }, __jsx(\"div\", {\n      className: styles.grid,\n      style: {\n        \"--grid-cols\": cols.length\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 19\n      }\n    }, rows.map(row => cols.map(col => {\n      var _mapCellPallets$cellK;\n\n      const cellKey = `${row}-${col}`;\n      const hasPallets = Boolean((_mapCellPallets$cellK = mapCellPallets[cellKey]) === null || _mapCellPallets$cellK === void 0 ? void 0 : _mapCellPallets$cellK.length);\n      return __jsx(\"button\", {\n        key: cellKey,\n        type: \"button\",\n        className: `${styles.gridCell} ${hasPallets ? \"\" : styles.gridCellDisabled}`,\n        onClick: () => hasPallets && handleSelectCell(row, col),\n        disabled: !hasPallets,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 27\n        }\n      }, __jsx(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 29\n        }\n      }, row, col));\n    }))));\n  })()), !mapLoading && mapStep === \"pallets\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \": select a pallet\"), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  }, (mapCellPallets[`${mapRow}-${mapCol}`] || []).map(pallet => {\n    const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\n    const bins = mapPalletBins[palletKey] || [];\n    return __jsx(\"button\", {\n      key: pallet,\n      type: \"button\",\n      className: styles.palletButton,\n      onClick: () => {\n        if (bins.length === 0 && typeof onView === \"function\") {\n          const selection = {\n            region: mapRegion,\n            sectionLetter: mapRow,\n            sectionNumber: mapCol,\n            pallet: String(pallet),\n            bin: \"\"\n          };\n          notifySelectionChange(selection);\n          onView(selection);\n          return;\n        }\n\n        handleSelectPallet(pallet);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 19\n      }\n    }, \"Pallet \", pallet);\n  }), !(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 17\n    }\n  }, \"No pallets available here.\"))), !mapLoading && mapStep === \"bins\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \" - Pallet \", mapPallet), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 13\n    }\n  }, (mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(bin => __jsx(\"button\", {\n    key: bin,\n    type: \"button\",\n    className: `${styles.palletButton} ${styles.binButton}`,\n    onClick: () => handleSelectBin(bin),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 19\n    }\n  }, \"Bin \", bin)), !(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 17\n    }\n  }, \"No bins available on this pallet.\")))), __jsx(Modal.Footer, {\n    className: styles.mapFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 7\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBack,\n    disabled: mapStep === \"regions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 9\n    }\n  }, \"Back\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: handleView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 9\n    }\n  }, \"View\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: onHide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 421,\n      columnNumber: 9\n    }\n  }, \"Close\")));\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/components/WarehouseMapModal.js"],"names":["React","useCallback","useEffect","useRef","useState","Modal","Button","Spinner","firebase","styles","REGION_ORDER","LETTERS","Array","from","length","_","i","String","fromCharCode","NUMBERS","WarehouseMapModal","show","onHide","onView","onSelectionChange","initialSelection","regionOptions","setRegionOptions","sectionMap","setSectionMap","mapStep","setMapStep","mapRegion","setMapRegion","mapRow","setMapRow","mapCol","setMapCol","mapPallet","setMapPallet","mapBin","setMapBin","mapCellPallets","setMapCellPallets","mapPalletBins","setMapPalletBins","mapLoading","setMapLoading","mapError","setMapError","directoryLoaded","setDirectoryLoaded","lastShowRef","notifySelectionChange","selection","loadDirectory","doc","firestore","collection","get","data","Region","Section","error","console","loadRegionInventory","regionId","snap","where","cellPallets","palletBins","forEach","loc","newLocalCurrent","row","section","letter","col","number","trimmed","trim","slice","undefined","pallet","bin","cellKey","Set","add","palletKey","cellObj","Object","keys","key","sort","a","b","Number","palletObj","getRegionDimensions","entry","isArray","cols","parseInt","rows","isFinite","wasOpen","current","region","sectionLetter","sectionNumber","handleSelectRegion","handleSelectCell","rowLetter","colNumber","colValue","handleSelectPallet","palletId","palletValue","handleSelectBin","binId","binValue","handleBack","handleView","mapStage","mapHint","mapCanvas","map","regionBlock","includes","dims","mapEmpty","gridWrapper","grid","hasPallets","Boolean","gridCell","gridCellDisabled","palletGrid","bins","palletButton","binButton","mapFooter"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport firebase from \"../context/Firebase\";\nimport styles from \"./WarehouseMapModal.module.css\";\n\nconst REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\nconst LETTERS = Array.from({ length: 26 }, (_, i) =>\n  String.fromCharCode(65 + i)\n);\nconst NUMBERS = Array.from({ length: 50 }, (_, i) => i + 1);\n\nexport default function WarehouseMapModal({\n  show = false,\n  onHide = () => {},\n  onView,\n  onSelectionChange,\n  initialSelection = {},\n}) {\n  const [regionOptions, setRegionOptions] = useState([]);\n  const [sectionMap, setSectionMap] = useState({});\n  const [mapStep, setMapStep] = useState(\"regions\");\n  const [mapRegion, setMapRegion] = useState(\"\");\n  const [mapRow, setMapRow] = useState(\"\");\n  const [mapCol, setMapCol] = useState(\"\");\n  const [mapPallet, setMapPallet] = useState(\"\");\n  const [mapBin, setMapBin] = useState(\"\");\n  const [mapCellPallets, setMapCellPallets] = useState({});\n  const [mapPalletBins, setMapPalletBins] = useState({});\n  const [mapLoading, setMapLoading] = useState(false);\n  const [mapError, setMapError] = useState(\"\");\n  const [directoryLoaded, setDirectoryLoaded] = useState(false);\n  const lastShowRef = useRef(false);\n\n  const notifySelectionChange = useCallback(\n    (selection) => {\n      if (typeof onSelectionChange === \"function\") {\n        onSelectionChange(selection);\n      }\n    },\n    [onSelectionChange]\n  );\n\n  const loadDirectory = useCallback(async () => {\n    if (directoryLoaded) return;\n    try {\n      const doc = await firebase\n        .firestore()\n        .collection(\"Warehouse\")\n        .doc(\"directory\")\n        .get();\n      const data = doc.data() || {};\n      setRegionOptions(data.Region || []);\n      setSectionMap(data.Section || {});\n      setDirectoryLoaded(true);\n    } catch (error) {\n      console.error(\"Failed to load map directory\", error);\n      setMapError(\"Failed to load warehouse directory.\");\n    }\n  }, [directoryLoaded]);\n\n  const loadRegionInventory = useCallback(async (regionId) => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n    try {\n      const snap = await firebase\n        .firestore()\n        .collection(\"Test\")\n        .where(\"newLocalCurrent.region\", \"==\", regionId)\n        .get();\n\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach((doc) => {\n        const loc = doc.data()?.newLocalCurrent || {};\n        let row = loc.section?.letter;\n        let col = loc.section?.number;\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n        if (pallet !== undefined && pallet !== null && `${pallet}` !== \"\") {\n          if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n          cellPallets[cellKey].add(String(pallet));\n          if (bin !== undefined && bin !== null && `${bin}` !== \"\") {\n            const palletKey = `${cellKey}-P${pallet}`;\n            if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n            palletBins[palletKey].add(String(bin));\n          }\n        }\n      });\n\n      const cellObj = {};\n      Object.keys(cellPallets).forEach((key) => {\n        cellObj[key] = Array.from(cellPallets[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      const palletObj = {};\n      Object.keys(palletBins).forEach((key) => {\n        palletObj[key] = Array.from(palletBins[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  }, []);\n\n  const getRegionDimensions = useCallback(\n    (regionId) => {\n      const entry = sectionMap?.[regionId];\n      if (Array.isArray(entry) && entry.length >= 2) {\n        const cols = parseInt(entry[0], 10);\n        const rows = parseInt(entry[1], 10);\n        return {\n          cols: Number.isFinite(cols) ? cols : 0,\n          rows: Number.isFinite(rows) ? rows : 0,\n        };\n      }\n      return { cols: 0, rows: 0 };\n    },\n    [sectionMap]\n  );\n\n  useEffect(() => {\n    const wasOpen = lastShowRef.current;\n    lastShowRef.current = show;\n    if (!show || wasOpen) return;\n\n    loadDirectory();\n    setMapError(\"\");\n    const {\n      region,\n      sectionLetter,\n      sectionNumber,\n      pallet,\n      bin,\n    } = initialSelection || {};\n\n    setMapRegion(region || \"\");\n    setMapRow(sectionLetter || \"\");\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\n    setMapPallet(pallet ? String(pallet) : \"\");\n    setMapBin(bin ? String(bin) : \"\");\n    setMapStep(region ? \"grid\" : \"regions\");\n    if (region) loadRegionInventory(region);\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\n\n  const handleSelectRegion = (regionId) => {\n    const selection = {\n      region: regionId,\n      sectionLetter: \"\",\n      sectionNumber: \"\",\n      pallet: \"\",\n      bin: \"\",\n    };\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"grid\");\n    notifySelectionChange(selection);\n    loadRegionInventory(regionId);\n  };\n\n  const handleSelectCell = (rowLetter, colNumber) => {\n    const colValue = String(colNumber);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: rowLetter,\n      sectionNumber: colValue,\n      pallet: \"\",\n      bin: \"\",\n    };\n    setMapRow(rowLetter);\n    setMapCol(colValue);\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"pallets\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectPallet = (palletId) => {\n    const palletValue = String(palletId);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: palletValue,\n      bin: \"\",\n    };\n    setMapPallet(palletValue);\n    setMapBin(\"\");\n    setMapStep(\"bins\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectBin = (binId) => {\n    const binValue = String(binId);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: binValue,\n    };\n    setMapBin(binValue);\n    notifySelectionChange(selection);\n  };\n\n  const handleBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");\n    else if (mapStep === \"pallets\") setMapStep(\"grid\");\n    else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleView = () => {\n    if (typeof onView !== \"function\") return;\n    onView({\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: mapBin,\n    });\n  };\n\n  return (\n    <Modal show={show} onHide={onHide} centered size=\"lg\">\n      <Modal.Header closeButton>\n        <Modal.Title>Warehouse Map</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        {mapLoading && (\n          <div className={styles.mapLoading}>\n            <Spinner animation=\"border\" />\n            <span>Loading map data...</span>\n          </div>\n        )}\n        {mapError && <div className={styles.mapError}>{mapError}</div>}\n\n        {!mapLoading && mapStep === \"regions\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>Select a region</div>\n            <div className={styles.mapCanvas}>\n              {REGION_ORDER.map((regionId) => (\n                <button\n                  key={regionId}\n                  type=\"button\"\n                  className={`${styles.regionBlock} ${styles[`region${regionId}`]}`}\n                  onClick={() => handleSelectRegion(regionId)}\n                  disabled={\n                    Array.isArray(regionOptions) &&\n                    regionOptions.length > 0 &&\n                    !regionOptions.includes(regionId)\n                  }\n                >\n                  {regionId}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {!mapLoading && mapStep === \"grid\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>\n              Region {mapRegion}: choose a row and column\n            </div>\n            {(() => {\n              const dims = getRegionDimensions(mapRegion);\n              const rows = LETTERS.slice(0, dims.rows || 0);\n              const cols = NUMBERS.slice(0, dims.cols || 0);\n              if (!rows.length || !cols.length) {\n                return (\n                  <div className={styles.mapEmpty}>\n                    No grid data for this region.\n                  </div>\n                );\n              }\n              return (\n                <div className={styles.gridWrapper}>\n                  <div\n                    className={styles.grid}\n                    style={{ \"--grid-cols\": cols.length }}\n                  >\n                    {rows.map((row) =>\n                      cols.map((col) => {\n                        const cellKey = `${row}-${col}`;\n                        const hasPallets = Boolean(\n                          mapCellPallets[cellKey]?.length\n                        );\n                        return (\n                          <button\n                            key={cellKey}\n                            type=\"button\"\n                            className={`${styles.gridCell} ${\n                              hasPallets ? \"\" : styles.gridCellDisabled\n                            }`}\n                            onClick={() =>\n                              hasPallets && handleSelectCell(row, col)\n                            }\n                            disabled={!hasPallets}\n                          >\n                            <span>\n                              {row}\n                              {col}\n                            </span>\n                          </button>\n                        );\n                      })\n                    )}\n                  </div>\n                </div>\n              );\n            })()}\n          </div>\n        )}\n\n        {!mapLoading && mapStep === \"pallets\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>\n              Region {mapRegion} - Section {mapRow}\n              {mapCol}: select a pallet\n            </div>\n            <div className={styles.palletGrid}>\n              {(mapCellPallets[`${mapRow}-${mapCol}`] || []).map((pallet) => {\n                const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\n                const bins = mapPalletBins[palletKey] || [];\n                return (\n                  <button\n                    key={pallet}\n                    type=\"button\"\n                    className={styles.palletButton}\n                  onClick={() => {\n                      if (bins.length === 0 && typeof onView === \"function\") {\n                        const selection = {\n                          region: mapRegion,\n                          sectionLetter: mapRow,\n                          sectionNumber: mapCol,\n                          pallet: String(pallet),\n                          bin: \"\",\n                        };\n                        notifySelectionChange(selection);\n                        onView(selection);\n                        return;\n                      }\n                      handleSelectPallet(pallet);\n                    }}\n                  >\n                    Pallet {pallet}\n                  </button>\n                );\n              })}\n              {!(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && (\n                <div className={styles.mapEmpty}>\n                  No pallets available here.\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {!mapLoading && mapStep === \"bins\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>\n              Region {mapRegion} - Section {mapRow}\n              {mapCol} - Pallet {mapPallet}\n            </div>\n            <div className={styles.palletGrid}>\n              {(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(\n                (bin) => (\n                  <button\n                    key={bin}\n                    type=\"button\"\n                    className={`${styles.palletButton} ${styles.binButton}`}\n                    onClick={() => handleSelectBin(bin)}\n                  >\n                    Bin {bin}\n                  </button>\n                )\n              )}\n              {!(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || [])\n                .length && (\n                <div className={styles.mapEmpty}>\n                  No bins available on this pallet.\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </Modal.Body>\n      <Modal.Footer className={styles.mapFooter}>\n        <Button\n          variant=\"outline-secondary\"\n          onClick={handleBack}\n          disabled={mapStep === \"regions\"}\n        >\n          Back\n        </Button>\n        <Button variant=\"outline-primary\" onClick={handleView}>\n          View\n        </Button>\n        <Button variant=\"secondary\" onClick={onHide}>\n          Close\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}