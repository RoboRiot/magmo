{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\isavc\\\\OneDrive\\\\Documents\\\\AIS\\\\Apps\\\\magmo\\\\components\\\\WarehouseMapModal.js\";\nvar __jsx = React.createElement;\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport firebase from \"../context/Firebase\";\nimport styles from \"./WarehouseMapModal.module.css\";\nconst REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\nconst NO_PALLET = \"NoPallet\";\nconst LETTERS = Array.from({\n  length: 26\n}, (_, i) => String.fromCharCode(65 + i));\nconst NUMBERS = Array.from({\n  length: 50\n}, (_, i) => i + 1);\nexport default function WarehouseMapModal({\n  show = false,\n  onHide = () => {},\n  onView,\n  onSelectionChange,\n  initialSelection = {}\n}) {\n  const {\n    0: regionOptions,\n    1: setRegionOptions\n  } = useState([]);\n  const {\n    0: sectionMap,\n    1: setSectionMap\n  } = useState({});\n  const {\n    0: mapStep,\n    1: setMapStep\n  } = useState(\"regions\");\n  const {\n    0: mapRegion,\n    1: setMapRegion\n  } = useState(\"\");\n  const {\n    0: mapRow,\n    1: setMapRow\n  } = useState(\"\");\n  const {\n    0: mapCol,\n    1: setMapCol\n  } = useState(\"\");\n  const {\n    0: mapPallet,\n    1: setMapPallet\n  } = useState(\"\");\n  const {\n    0: mapBin,\n    1: setMapBin\n  } = useState(\"\");\n  const {\n    0: mapCellPallets,\n    1: setMapCellPallets\n  } = useState({});\n  const {\n    0: mapPalletBins,\n    1: setMapPalletBins\n  } = useState({});\n  const {\n    0: mapLoading,\n    1: setMapLoading\n  } = useState(false);\n  const {\n    0: mapError,\n    1: setMapError\n  } = useState(\"\");\n  const {\n    0: directoryLoaded,\n    1: setDirectoryLoaded\n  } = useState(false);\n  const lastShowRef = useRef(false);\n  const notifySelectionChange = useCallback(selection => {\n    if (typeof onSelectionChange === \"function\") {\n      onSelectionChange(selection);\n    }\n  }, [onSelectionChange]);\n  const loadDirectory = useCallback(async () => {\n    if (directoryLoaded) return;\n\n    try {\n      const doc = await firebase.firestore().collection(\"Warehouse\").doc(\"directory\").get();\n      const data = doc.data() || {};\n      setRegionOptions(data.Region || []);\n      setSectionMap(data.Section || {});\n      setDirectoryLoaded(true);\n    } catch (error) {\n      console.error(\"Failed to load map directory\", error);\n      setMapError(\"Failed to load warehouse directory.\");\n    }\n  }, [directoryLoaded]);\n  const loadRegionInventory = useCallback(async regionId => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n\n    try {\n      const snap = await firebase.firestore().collection(\"Test\").where(\"newLocalCurrent.region\", \"==\", regionId).get();\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach(doc => {\n        var _doc$data, _loc$section, _loc$section2;\n\n        const loc = ((_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.newLocalCurrent) || {};\n        let row = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.letter;\n        let col = (_loc$section2 = loc.section) === null || _loc$section2 === void 0 ? void 0 : _loc$section2.number;\n\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n        const hasBin = bin !== undefined && bin !== null && `${bin}` !== \"\";\n        const hasPallet = pallet !== undefined && pallet !== null && `${pallet}` !== \"\";\n        if (!hasPallet && !hasBin) return;\n        const palletId = hasPallet ? String(pallet) : NO_PALLET;\n        if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n        cellPallets[cellKey].add(palletId);\n\n        if (hasBin) {\n          const palletKey = `${cellKey}-P${palletId}`;\n          if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n          palletBins[palletKey].add(String(bin));\n        }\n      });\n      const cellObj = {};\n      Object.keys(cellPallets).forEach(key => {\n        cellObj[key] = Array.from(cellPallets[key]).sort((a, b) => {\n          if (a === NO_PALLET) return 1;\n          if (b === NO_PALLET) return -1;\n          const na = Number(a);\n          const nb = Number(b);\n          if (Number.isFinite(na) && Number.isFinite(nb)) return na - nb;\n          return String(a).localeCompare(String(b));\n        });\n      });\n      const palletObj = {};\n      Object.keys(palletBins).forEach(key => {\n        palletObj[key] = Array.from(palletBins[key]).sort((a, b) => Number(a) - Number(b));\n      });\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  }, []);\n  const getRegionDimensions = useCallback(regionId => {\n    const entry = sectionMap === null || sectionMap === void 0 ? void 0 : sectionMap[regionId];\n\n    if (Array.isArray(entry) && entry.length >= 2) {\n      const cols = parseInt(entry[0], 10);\n      const rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0\n      };\n    }\n\n    return {\n      cols: 0,\n      rows: 0\n    };\n  }, [sectionMap]);\n  useEffect(() => {\n    const wasOpen = lastShowRef.current;\n    lastShowRef.current = show;\n    if (!show || wasOpen) return;\n    loadDirectory();\n    setMapError(\"\");\n    const {\n      region,\n      sectionLetter,\n      sectionNumber,\n      pallet,\n      bin\n    } = initialSelection || {};\n    setMapRegion(region || \"\");\n    setMapRow(sectionLetter || \"\");\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\n    setMapPallet(pallet ? String(pallet) : \"\");\n    setMapBin(bin ? String(bin) : \"\");\n    setMapStep(region ? \"grid\" : \"regions\");\n    if (region) loadRegionInventory(region);\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\n\n  const handleSelectRegion = regionId => {\n    const selection = {\n      region: regionId,\n      sectionLetter: \"\",\n      sectionNumber: \"\",\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"grid\");\n    notifySelectionChange(selection);\n    loadRegionInventory(regionId);\n  };\n\n  const handleSelectCell = (rowLetter, colNumber) => {\n    const colValue = String(colNumber);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: rowLetter,\n      sectionNumber: colValue,\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRow(rowLetter);\n    setMapCol(colValue);\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"pallets\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectPallet = palletId => {\n    const palletValue = String(palletId);\n    const normalizedPallet = palletValue === NO_PALLET ? \"\" : palletValue;\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: normalizedPallet,\n      bin: \"\"\n    };\n    setMapPallet(palletValue);\n    setMapBin(\"\");\n    setMapStep(\"bins\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectBin = binId => {\n    const binValue = String(binId);\n    const normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: normalizedPallet,\n      bin: binValue\n    };\n    setMapBin(binValue);\n    notifySelectionChange(selection);\n  };\n\n  const handleBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");else if (mapStep === \"pallets\") setMapStep(\"grid\");else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleView = () => {\n    if (typeof onView !== \"function\") return;\n    const normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\n    onView({\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: normalizedPallet,\n      bin: mapBin\n    });\n  };\n\n  return __jsx(Modal, {\n    show: show,\n    onHide: onHide,\n    centered: true,\n    size: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 5\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }, \"Warehouse Map\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }\n  }, mapLoading && __jsx(\"div\", {\n    className: styles.mapLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 11\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 13\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 13\n    }\n  }, \"Loading map data...\")), mapError && __jsx(\"div\", {\n    className: styles.mapError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 22\n    }\n  }, mapError), !mapLoading && mapStep === \"regions\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 13\n    }\n  }, \"Select a region\"), __jsx(\"div\", {\n    className: styles.mapCanvas,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 13\n    }\n  }, REGION_ORDER.map(regionId => __jsx(\"button\", {\n    key: regionId,\n    type: \"button\",\n    className: `${styles.regionBlock} ${styles[`region${regionId}`]}`,\n    onClick: () => handleSelectRegion(regionId),\n    disabled: Array.isArray(regionOptions) && regionOptions.length > 0 && !regionOptions.includes(regionId),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 17\n    }\n  }, regionId)))), !mapLoading && mapStep === \"grid\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \": choose a row and column\"), (() => {\n    const dims = getRegionDimensions(mapRegion);\n    const rows = LETTERS.slice(0, dims.rows || 0).reverse();\n    const cols = NUMBERS.slice(0, dims.cols || 0);\n\n    if (!rows.length || !cols.length) {\n      const sectionKeys = Object.keys(mapCellPallets || {}).filter(Boolean).map(key => {\n        const [row, col] = key.split(\"-\");\n        return {\n          key,\n          row,\n          col\n        };\n      }).sort((a, b) => {\n        if (a.row === b.row) {\n          return Number(a.col) - Number(b.col);\n        }\n\n        return b.row.localeCompare(a.row);\n      });\n\n      if (!sectionKeys.length) {\n        return __jsx(\"div\", {\n          className: styles.mapEmpty,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 21\n          }\n        }, \"No grid data for this region.\");\n      }\n\n      return __jsx(\"div\", {\n        className: styles.gridWrapper,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 19\n        }\n      }, __jsx(\"div\", {\n        className: styles.mapHint,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 21\n        }\n      }, \"Grid not available. Select an available section below.\"), __jsx(\"div\", {\n        className: styles.palletGrid,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 21\n        }\n      }, sectionKeys.map(({\n        key,\n        row,\n        col\n      }) => __jsx(\"button\", {\n        key: key,\n        type: \"button\",\n        className: styles.palletButton,\n        onClick: () => handleSelectCell(row, col),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 25\n        }\n      }, row, col))));\n    }\n\n    return __jsx(\"div\", {\n      className: styles.gridWrapper,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 17\n      }\n    }, __jsx(\"div\", {\n      className: styles.grid,\n      style: {\n        \"--grid-cols\": cols.length\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 19\n      }\n    }, rows.map(row => cols.map(col => {\n      var _mapCellPallets$cellK;\n\n      const cellKey = `${row}-${col}`;\n      const hasPallets = Boolean((_mapCellPallets$cellK = mapCellPallets[cellKey]) === null || _mapCellPallets$cellK === void 0 ? void 0 : _mapCellPallets$cellK.length);\n      return __jsx(\"button\", {\n        key: cellKey,\n        type: \"button\",\n        className: `${styles.gridCell} ${hasPallets ? \"\" : styles.gridCellDisabled}`,\n        onClick: () => hasPallets && handleSelectCell(row, col),\n        disabled: !hasPallets,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 27\n        }\n      }, __jsx(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 29\n        }\n      }, row, col));\n    }))));\n  })()), !mapLoading && mapStep === \"pallets\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \": select a pallet\"), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 13\n    }\n  }, (mapCellPallets[`${mapRow}-${mapCol}`] || []).map(pallet => {\n    const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\n    const bins = mapPalletBins[palletKey] || [];\n    return __jsx(\"button\", {\n      key: pallet,\n      type: \"button\",\n      className: styles.palletButton,\n      onClick: () => {\n        if (bins.length === 0 && typeof onView === \"function\") {\n          const selection = {\n            region: mapRegion,\n            sectionLetter: mapRow,\n            sectionNumber: mapCol,\n            pallet: pallet === NO_PALLET ? \"\" : String(pallet),\n            bin: \"\"\n          };\n          notifySelectionChange(selection);\n          onView(selection);\n          return;\n        }\n\n        handleSelectPallet(pallet);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 19\n      }\n    }, pallet === NO_PALLET ? \"No Pallet\" : `Pallet ${pallet}`);\n  }), !(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 17\n    }\n  }, \"No pallets available here.\"))), !mapLoading && mapStep === \"bins\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 433,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \" - Pallet \", mapPallet), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 13\n    }\n  }, (mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(bin => __jsx(\"button\", {\n    key: bin,\n    type: \"button\",\n    className: `${styles.palletButton} ${styles.binButton}`,\n    onClick: () => handleSelectBin(bin),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 19\n    }\n  }, \"Bin \", bin)), !(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 452,\n      columnNumber: 17\n    }\n  }, \"No bins available on this pallet.\")))), __jsx(Modal.Footer, {\n    className: styles.mapFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 460,\n      columnNumber: 7\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBack,\n    disabled: mapStep === \"regions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 461,\n      columnNumber: 9\n    }\n  }, \"Back\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: handleView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 9\n    }\n  }, \"View\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: onHide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 9\n    }\n  }, \"Close\")));\n}","map":{"version":3,"sources":["C:/Users/isavc/OneDrive/Documents/AIS/Apps/magmo/components/WarehouseMapModal.js"],"names":["React","useCallback","useEffect","useRef","useState","Modal","Button","Spinner","firebase","styles","REGION_ORDER","NO_PALLET","LETTERS","Array","from","length","_","i","String","fromCharCode","NUMBERS","WarehouseMapModal","show","onHide","onView","onSelectionChange","initialSelection","regionOptions","setRegionOptions","sectionMap","setSectionMap","mapStep","setMapStep","mapRegion","setMapRegion","mapRow","setMapRow","mapCol","setMapCol","mapPallet","setMapPallet","mapBin","setMapBin","mapCellPallets","setMapCellPallets","mapPalletBins","setMapPalletBins","mapLoading","setMapLoading","mapError","setMapError","directoryLoaded","setDirectoryLoaded","lastShowRef","notifySelectionChange","selection","loadDirectory","doc","firestore","collection","get","data","Region","Section","error","console","loadRegionInventory","regionId","snap","where","cellPallets","palletBins","forEach","loc","newLocalCurrent","row","section","letter","col","number","trimmed","trim","slice","undefined","pallet","bin","cellKey","hasBin","hasPallet","palletId","Set","add","palletKey","cellObj","Object","keys","key","sort","a","b","na","Number","nb","isFinite","localeCompare","palletObj","getRegionDimensions","entry","isArray","cols","parseInt","rows","wasOpen","current","region","sectionLetter","sectionNumber","handleSelectRegion","handleSelectCell","rowLetter","colNumber","colValue","handleSelectPallet","palletValue","normalizedPallet","handleSelectBin","binId","binValue","handleBack","handleView","mapStage","mapHint","mapCanvas","map","regionBlock","includes","dims","reverse","sectionKeys","filter","Boolean","split","mapEmpty","gridWrapper","palletGrid","palletButton","grid","hasPallets","gridCell","gridCellDisabled","bins","binButton","mapFooter"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\r\nimport firebase from \"../context/Firebase\";\r\nimport styles from \"./WarehouseMapModal.module.css\";\r\n\r\nconst REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\r\nconst NO_PALLET = \"NoPallet\";\r\nconst LETTERS = Array.from({ length: 26 }, (_, i) =>\r\n  String.fromCharCode(65 + i)\r\n);\r\nconst NUMBERS = Array.from({ length: 50 }, (_, i) => i + 1);\r\n\r\nexport default function WarehouseMapModal({\r\n  show = false,\r\n  onHide = () => {},\r\n  onView,\r\n  onSelectionChange,\r\n  initialSelection = {},\r\n}) {\r\n  const [regionOptions, setRegionOptions] = useState([]);\r\n  const [sectionMap, setSectionMap] = useState({});\r\n  const [mapStep, setMapStep] = useState(\"regions\");\r\n  const [mapRegion, setMapRegion] = useState(\"\");\r\n  const [mapRow, setMapRow] = useState(\"\");\r\n  const [mapCol, setMapCol] = useState(\"\");\r\n  const [mapPallet, setMapPallet] = useState(\"\");\r\n  const [mapBin, setMapBin] = useState(\"\");\r\n  const [mapCellPallets, setMapCellPallets] = useState({});\r\n  const [mapPalletBins, setMapPalletBins] = useState({});\r\n  const [mapLoading, setMapLoading] = useState(false);\r\n  const [mapError, setMapError] = useState(\"\");\r\n  const [directoryLoaded, setDirectoryLoaded] = useState(false);\r\n  const lastShowRef = useRef(false);\r\n\r\n  const notifySelectionChange = useCallback(\r\n    (selection) => {\r\n      if (typeof onSelectionChange === \"function\") {\r\n        onSelectionChange(selection);\r\n      }\r\n    },\r\n    [onSelectionChange]\r\n  );\r\n\r\n  const loadDirectory = useCallback(async () => {\r\n    if (directoryLoaded) return;\r\n    try {\r\n      const doc = await firebase\r\n        .firestore()\r\n        .collection(\"Warehouse\")\r\n        .doc(\"directory\")\r\n        .get();\r\n      const data = doc.data() || {};\r\n      setRegionOptions(data.Region || []);\r\n      setSectionMap(data.Section || {});\r\n      setDirectoryLoaded(true);\r\n    } catch (error) {\r\n      console.error(\"Failed to load map directory\", error);\r\n      setMapError(\"Failed to load warehouse directory.\");\r\n    }\r\n  }, [directoryLoaded]);\r\n\r\n  const loadRegionInventory = useCallback(async (regionId) => {\r\n    if (!regionId) return;\r\n    setMapLoading(true);\r\n    setMapError(\"\");\r\n    try {\r\n      const snap = await firebase\r\n        .firestore()\r\n        .collection(\"Test\")\r\n        .where(\"newLocalCurrent.region\", \"==\", regionId)\r\n        .get();\r\n\r\n      const cellPallets = {};\r\n      const palletBins = {};\r\n      snap.forEach((doc) => {\r\n        const loc = doc.data()?.newLocalCurrent || {};\r\n        let row = loc.section?.letter;\r\n        let col = loc.section?.number;\r\n        if ((!row || !col) && typeof loc.section === \"string\") {\r\n          const trimmed = loc.section.trim();\r\n          row = trimmed.slice(0, 1);\r\n          col = trimmed.slice(1);\r\n        }\r\n        if (col !== undefined && col !== null) {\r\n          col = String(col);\r\n        }\r\n        const pallet = loc.pallet;\r\n        const bin = loc.bin;\r\n        if (!row || !col) return;\r\n        const cellKey = `${row}-${col}`;\r\n        const hasBin = bin !== undefined && bin !== null && `${bin}` !== \"\";\r\n        const hasPallet =\r\n          pallet !== undefined && pallet !== null && `${pallet}` !== \"\";\r\n        if (!hasPallet && !hasBin) return;\r\n\r\n        const palletId = hasPallet ? String(pallet) : NO_PALLET;\r\n        if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\r\n        cellPallets[cellKey].add(palletId);\r\n\r\n        if (hasBin) {\r\n          const palletKey = `${cellKey}-P${palletId}`;\r\n          if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\r\n          palletBins[palletKey].add(String(bin));\r\n        }\r\n      });\r\n\r\n      const cellObj = {};\r\n      Object.keys(cellPallets).forEach((key) => {\r\n        cellObj[key] = Array.from(cellPallets[key]).sort((a, b) => {\r\n          if (a === NO_PALLET) return 1;\r\n          if (b === NO_PALLET) return -1;\r\n          const na = Number(a);\r\n          const nb = Number(b);\r\n          if (Number.isFinite(na) && Number.isFinite(nb)) return na - nb;\r\n          return String(a).localeCompare(String(b));\r\n        });\r\n      });\r\n\r\n      const palletObj = {};\r\n      Object.keys(palletBins).forEach((key) => {\r\n        palletObj[key] = Array.from(palletBins[key]).sort(\r\n          (a, b) => Number(a) - Number(b)\r\n        );\r\n      });\r\n\r\n      setMapCellPallets(cellObj);\r\n      setMapPalletBins(palletObj);\r\n    } catch (error) {\r\n      console.error(\"Failed to load map inventory\", error);\r\n      setMapError(\"Failed to load map inventory.\");\r\n    } finally {\r\n      setMapLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const getRegionDimensions = useCallback(\r\n    (regionId) => {\r\n      const entry = sectionMap?.[regionId];\r\n      if (Array.isArray(entry) && entry.length >= 2) {\r\n        const cols = parseInt(entry[0], 10);\r\n        const rows = parseInt(entry[1], 10);\r\n        return {\r\n          cols: Number.isFinite(cols) ? cols : 0,\r\n          rows: Number.isFinite(rows) ? rows : 0,\r\n        };\r\n      }\r\n      return { cols: 0, rows: 0 };\r\n    },\r\n    [sectionMap]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const wasOpen = lastShowRef.current;\r\n    lastShowRef.current = show;\r\n    if (!show || wasOpen) return;\r\n\r\n    loadDirectory();\r\n    setMapError(\"\");\r\n    const {\r\n      region,\r\n      sectionLetter,\r\n      sectionNumber,\r\n      pallet,\r\n      bin,\r\n    } = initialSelection || {};\r\n\r\n    setMapRegion(region || \"\");\r\n    setMapRow(sectionLetter || \"\");\r\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\r\n    setMapPallet(pallet ? String(pallet) : \"\");\r\n    setMapBin(bin ? String(bin) : \"\");\r\n    setMapStep(region ? \"grid\" : \"regions\");\r\n    if (region) loadRegionInventory(region);\r\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\r\n\r\n  const handleSelectRegion = (regionId) => {\r\n    const selection = {\r\n      region: regionId,\r\n      sectionLetter: \"\",\r\n      sectionNumber: \"\",\r\n      pallet: \"\",\r\n      bin: \"\",\r\n    };\r\n    setMapRegion(regionId);\r\n    setMapRow(\"\");\r\n    setMapCol(\"\");\r\n    setMapPallet(\"\");\r\n    setMapBin(\"\");\r\n    setMapStep(\"grid\");\r\n    notifySelectionChange(selection);\r\n    loadRegionInventory(regionId);\r\n  };\r\n\r\n  const handleSelectCell = (rowLetter, colNumber) => {\r\n    const colValue = String(colNumber);\r\n    const selection = {\r\n      region: mapRegion,\r\n      sectionLetter: rowLetter,\r\n      sectionNumber: colValue,\r\n      pallet: \"\",\r\n      bin: \"\",\r\n    };\r\n    setMapRow(rowLetter);\r\n    setMapCol(colValue);\r\n    setMapPallet(\"\");\r\n    setMapBin(\"\");\r\n    setMapStep(\"pallets\");\r\n    notifySelectionChange(selection);\r\n  };\r\n\r\n  const handleSelectPallet = (palletId) => {\r\n    const palletValue = String(palletId);\r\n    const normalizedPallet = palletValue === NO_PALLET ? \"\" : palletValue;\r\n    const selection = {\r\n      region: mapRegion,\r\n      sectionLetter: mapRow,\r\n      sectionNumber: mapCol,\r\n      pallet: normalizedPallet,\r\n      bin: \"\",\r\n    };\r\n    setMapPallet(palletValue);\r\n    setMapBin(\"\");\r\n    setMapStep(\"bins\");\r\n    notifySelectionChange(selection);\r\n  };\r\n\r\n  const handleSelectBin = (binId) => {\r\n    const binValue = String(binId);\r\n    const normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\r\n    const selection = {\r\n      region: mapRegion,\r\n      sectionLetter: mapRow,\r\n      sectionNumber: mapCol,\r\n      pallet: normalizedPallet,\r\n      bin: binValue,\r\n    };\r\n    setMapBin(binValue);\r\n    notifySelectionChange(selection);\r\n  };\r\n\r\n  const handleBack = () => {\r\n    if (mapStep === \"bins\") setMapStep(\"pallets\");\r\n    else if (mapStep === \"pallets\") setMapStep(\"grid\");\r\n    else if (mapStep === \"grid\") setMapStep(\"regions\");\r\n  };\r\n\r\n  const handleView = () => {\r\n    if (typeof onView !== \"function\") return;\r\n    const normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\r\n    onView({\r\n      region: mapRegion,\r\n      sectionLetter: mapRow,\r\n      sectionNumber: mapCol,\r\n      pallet: normalizedPallet,\r\n      bin: mapBin,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Modal show={show} onHide={onHide} centered size=\"lg\">\r\n      <Modal.Header closeButton>\r\n        <Modal.Title>Warehouse Map</Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body>\r\n        {mapLoading && (\r\n          <div className={styles.mapLoading}>\r\n            <Spinner animation=\"border\" />\r\n            <span>Loading map data...</span>\r\n          </div>\r\n        )}\r\n        {mapError && <div className={styles.mapError}>{mapError}</div>}\r\n\r\n        {!mapLoading && mapStep === \"regions\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>Select a region</div>\r\n            <div className={styles.mapCanvas}>\r\n              {REGION_ORDER.map((regionId) => (\r\n                <button\r\n                  key={regionId}\r\n                  type=\"button\"\r\n                  className={`${styles.regionBlock} ${styles[`region${regionId}`]}`}\r\n                  onClick={() => handleSelectRegion(regionId)}\r\n                  disabled={\r\n                    Array.isArray(regionOptions) &&\r\n                    regionOptions.length > 0 &&\r\n                    !regionOptions.includes(regionId)\r\n                  }\r\n                >\r\n                  {regionId}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!mapLoading && mapStep === \"grid\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>\r\n              Region {mapRegion}: choose a row and column\r\n            </div>\r\n            {(() => {\r\n              const dims = getRegionDimensions(mapRegion);\r\n              const rows = LETTERS.slice(0, dims.rows || 0).reverse();\r\n              const cols = NUMBERS.slice(0, dims.cols || 0);\r\n              if (!rows.length || !cols.length) {\r\n                const sectionKeys = Object.keys(mapCellPallets || {})\r\n                  .filter(Boolean)\r\n                  .map((key) => {\r\n                    const [row, col] = key.split(\"-\");\r\n                    return { key, row, col };\r\n                  })\r\n                  .sort((a, b) => {\r\n                    if (a.row === b.row) {\r\n                      return Number(a.col) - Number(b.col);\r\n                    }\r\n                    return b.row.localeCompare(a.row);\r\n                  });\r\n\r\n                if (!sectionKeys.length) {\r\n                  return (\r\n                    <div className={styles.mapEmpty}>\r\n                      No grid data for this region.\r\n                    </div>\r\n                  );\r\n                }\r\n\r\n                return (\r\n                  <div className={styles.gridWrapper}>\r\n                    <div className={styles.mapHint}>\r\n                      Grid not available. Select an available section below.\r\n                    </div>\r\n                    <div className={styles.palletGrid}>\r\n                      {sectionKeys.map(({ key, row, col }) => (\r\n                        <button\r\n                          key={key}\r\n                          type=\"button\"\r\n                          className={styles.palletButton}\r\n                          onClick={() => handleSelectCell(row, col)}\r\n                        >\r\n                          {row}\r\n                          {col}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n              return (\r\n                <div className={styles.gridWrapper}>\r\n                  <div\r\n                    className={styles.grid}\r\n                    style={{ \"--grid-cols\": cols.length }}\r\n                  >\r\n                    {rows.map((row) =>\r\n                      cols.map((col) => {\r\n                        const cellKey = `${row}-${col}`;\r\n                        const hasPallets = Boolean(\r\n                          mapCellPallets[cellKey]?.length\r\n                        );\r\n                        return (\r\n                          <button\r\n                            key={cellKey}\r\n                            type=\"button\"\r\n                            className={`${styles.gridCell} ${\r\n                              hasPallets ? \"\" : styles.gridCellDisabled\r\n                            }`}\r\n                            onClick={() =>\r\n                              hasPallets && handleSelectCell(row, col)\r\n                            }\r\n                            disabled={!hasPallets}\r\n                          >\r\n                            <span>\r\n                              {row}\r\n                              {col}\r\n                            </span>\r\n                          </button>\r\n                        );\r\n                      })\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })()}\r\n          </div>\r\n        )}\r\n\r\n        {!mapLoading && mapStep === \"pallets\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>\r\n              Region {mapRegion} - Section {mapRow}\r\n              {mapCol}: select a pallet\r\n            </div>\r\n            <div className={styles.palletGrid}>\r\n              {(mapCellPallets[`${mapRow}-${mapCol}`] || []).map((pallet) => {\r\n                const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\r\n                const bins = mapPalletBins[palletKey] || [];\r\n                return (\r\n                  <button\r\n                    key={pallet}\r\n                    type=\"button\"\r\n                    className={styles.palletButton}\r\n                    onClick={() => {\r\n                      if (bins.length === 0 && typeof onView === \"function\") {\r\n                        const selection = {\r\n                          region: mapRegion,\r\n                          sectionLetter: mapRow,\r\n                          sectionNumber: mapCol,\r\n                          pallet: pallet === NO_PALLET ? \"\" : String(pallet),\r\n                          bin: \"\",\r\n                        };\r\n                        notifySelectionChange(selection);\r\n                        onView(selection);\r\n                        return;\r\n                      }\r\n                      handleSelectPallet(pallet);\r\n                    }}\r\n                  >\r\n                    {pallet === NO_PALLET ? \"No Pallet\" : `Pallet ${pallet}`}\r\n                  </button>\r\n                );\r\n              })}\r\n              {!(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && (\r\n                <div className={styles.mapEmpty}>\r\n                  No pallets available here.\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!mapLoading && mapStep === \"bins\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>\r\n              Region {mapRegion} - Section {mapRow}\r\n              {mapCol} - Pallet {mapPallet}\r\n            </div>\r\n            <div className={styles.palletGrid}>\r\n              {(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(\r\n                (bin) => (\r\n                  <button\r\n                    key={bin}\r\n                    type=\"button\"\r\n                    className={`${styles.palletButton} ${styles.binButton}`}\r\n                    onClick={() => handleSelectBin(bin)}\r\n                  >\r\n                    Bin {bin}\r\n                  </button>\r\n                )\r\n              )}\r\n              {!(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || [])\r\n                .length && (\r\n                <div className={styles.mapEmpty}>\r\n                  No bins available on this pallet.\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </Modal.Body>\r\n      <Modal.Footer className={styles.mapFooter}>\r\n        <Button\r\n          variant=\"outline-secondary\"\r\n          onClick={handleBack}\r\n          disabled={mapStep === \"regions\"}\r\n        >\r\n          Back\r\n        </Button>\r\n        <Button variant=\"outline-primary\" onClick={handleView}>\r\n          View\r\n        </Button>\r\n        <Button variant=\"secondary\" onClick={onHide}>\r\n          Close\r\n        </Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}