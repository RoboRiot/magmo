{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\inventory\\\\inventoryManage.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport LoggedIn from \"../../LoggedIn\";\nimport firebase from \"../../../context/Firebase\";\nimport { Table, Form, Button, Container, Row, Col, Spinner } from \"react-bootstrap\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport Link from \"next/link\";\nexport default function InventoryManage() {\n  const {\n    0: items,\n    1: setItems\n  } = useState([]);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(true);\n  const {\n    0: selectedIds,\n    1: setSelectedIds\n  } = useState(new Set());\n  const {\n    0: filters,\n    1: setFilters\n  } = useState({\n    region: \"\",\n    section: \"\",\n    bin: \"\",\n    pallet: \"\",\n    localSN: \"\"\n  });\n  const {\n    0: bulkField,\n    1: setBulkField\n  } = useState(\"\");\n  const {\n    0: bulkValue,\n    1: setBulkValue\n  } = useState(\"\"); // ---- load data once ----\n\n  useEffect(() => {\n    const db = firebase.firestore();\n    db.collection(\"Test\").get().then(snap => {\n      const data = snap.docs.map(d => {\n        var _loc$region$toString, _loc$region, _loc$section$toString, _loc$section, _loc$bin$toString, _loc$bin, _loc$pallet$toString, _loc$pallet;\n\n        const doc = d.data();\n        const loc = doc.newLocalCurrent || {};\n        return {\n          id: d.id,\n          name: doc.name || \"\",\n          pn: doc.pn || \"\",\n          sn: doc.sn || \"\",\n          localSN: doc.localSN || \"\",\n          region: (_loc$region$toString = (_loc$region = loc.region) === null || _loc$region === void 0 ? void 0 : _loc$region.toString()) !== null && _loc$region$toString !== void 0 ? _loc$region$toString : \"\",\n          section: (_loc$section$toString = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.toString()) !== null && _loc$section$toString !== void 0 ? _loc$section$toString : \"\",\n          bin: (_loc$bin$toString = (_loc$bin = loc.bin) === null || _loc$bin === void 0 ? void 0 : _loc$bin.toString()) !== null && _loc$bin$toString !== void 0 ? _loc$bin$toString : \"\",\n          pallet: (_loc$pallet$toString = (_loc$pallet = loc.pallet) === null || _loc$pallet === void 0 ? void 0 : _loc$pallet.toString()) !== null && _loc$pallet$toString !== void 0 ? _loc$pallet$toString : \"\"\n        };\n      });\n      setItems(data);\n    }).finally(() => setLoading(false));\n  }, []); // ---- derive distinct filter options ----\n\n  const distinct = arr => Array.from(new Set(arr.filter(v => v))).sort();\n\n  const regions = useMemo(() => distinct(items.map(i => i.region)), [items]);\n  const sections = useMemo(() => distinct(items.map(i => i.section)), [items]);\n  const bins = useMemo(() => distinct(items.map(i => i.bin)), [items]);\n  const pallets = useMemo(() => distinct(items.map(i => i.pallet)), [items]); // ---- toggles ----\n\n  const toggleSelect = id => {\n    setSelectedIds(prev => {\n      const next = new Set(prev);\n      next.has(id) ? next.delete(id) : next.add(id);\n      return next;\n    });\n  };\n\n  const toggleSelectAll = () => {\n    const visibleIds = filteredItems.map(i => i.id);\n    setSelectedIds(prev => {\n      const next = new Set(prev);\n\n      if (visibleIds.every(id => next.has(id))) {\n        visibleIds.forEach(id => next.delete(id));\n      } else {\n        visibleIds.forEach(id => next.add(id));\n      }\n\n      return next;\n    });\n  }; // ---- filtered list ----\n\n\n  const filteredItems = items.filter(it => [\"region\", \"section\", \"bin\", \"pallet\", \"localSN\"].every(f => !filters[f] || it[f] === filters[f])); // ---- bulk update handler ----\n\n  const applyBulkUpdate = () => {\n    if (!bulkField || !bulkValue) return;\n    const db = firebase.firestore();\n    const updates = Array.from(selectedIds).map(id => {\n      const orig = items.find(i => i.id === id) || {};\n      const newRegion = bulkField === \"region\" ? bulkValue : orig.region;\n      const newSection = bulkField === \"section\" ? bulkValue : orig.section;\n      const newBin = bulkField === \"bin\" ? bulkValue : orig.bin;\n      const newPallet = bulkField === \"pallet\" ? bulkValue : orig.pallet;\n      const parts = [];\n      if (newRegion) parts.push(newRegion);\n      if (newSection) parts.push(newSection);\n      if (newBin) parts.push(`B${newBin}`);\n      if (newPallet) parts.push(`P${newPallet}`);\n      const newLocString = parts.join(\"-\");\n      const updateObj = {\n        region: newRegion,\n        section: newSection,\n        bin: newBin,\n        pallet: newPallet,\n        localLocCurrent: newLocString,\n        newLocalCurrent: {\n          region: newRegion,\n          section: newSection,\n          bin: newBin,\n          pallet: newPallet\n        }\n      };\n      return db.collection(\"Test\").doc(id).update(updateObj).then(() => {\n        setItems(prev => prev.map(item => item.id === id ? _objectSpread(_objectSpread({}, item), {}, {\n          region: newRegion,\n          section: newSection,\n          bin: newBin,\n          pallet: newPallet\n        }) : item));\n      });\n    });\n    Promise.all(updates).then(() => {\n      setSelectedIds(new Set());\n      setBulkField(\"\");\n      setBulkValue(\"\");\n    });\n  }; // ---- loading state ----\n\n\n  if (loading) {\n    return __jsx(Container, {\n      className: \"py-5 text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 7\n      }\n    }, __jsx(Spinner, {\n      animation: \"border\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  function LoadingButton({\n    type,\n    name,\n    route\n  }) {\n    const {\n      0: isLoading,\n      1: setLoading\n    } = useState(false);\n    useEffect(() => {\n      if (isLoading) {\n        simulateNetworkRequest().then(() => setLoading(false));\n      }\n    }, [isLoading]);\n\n    const handleClick = () => setLoading(true);\n\n    return __jsx(Link, {\n      href: `/${route}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 9\n      }\n    }, __jsx(\"a\", {\n      className: `btn btn-${type}`,\n      disabled: isLoading,\n      onClick: !isLoading ? handleClick : null,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 17\n      }\n    }, isLoading ? \"Loading…\" : name));\n  }\n\n  function simulateNetworkRequest() {\n    return new Promise(resolve => setTimeout(resolve, 2000));\n  }\n\n  return __jsx(LoggedIn, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, __jsx(Container, {\n    className: \"py-4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 13\n    }\n  }, __jsx(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 17\n    }\n  }, \"Inventory Management\"), __jsx(LoadingButton, {\n    type: \"primary\",\n    name: \"Back\",\n    route: \"Warehousedb/WarehouseSelect\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 17\n    }\n  }), __jsx(Row, {\n    className: \"mb-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 17\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 21\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 25\n    }\n  }, \"Region\"), __jsx(Form.Select, {\n    value: filters.region,\n    onChange: e => {\n      const v = e.target.value;\n      setFilters(p => _objectSpread(_objectSpread({}, p), {}, {\n        region: v\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 25\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 15\n    }\n  }, \"All regions\"), regions.map(r => __jsx(\"option\", {\n    key: r,\n    value: r,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 17\n    }\n  }, r)))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }\n  }, \"Section\"), __jsx(Form.Select, {\n    value: filters.section,\n    onChange: e => {\n      const v = e.target.value;\n      setFilters(p => _objectSpread(_objectSpread({}, p), {}, {\n        section: v\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 15\n    }\n  }, \"All sections\"), sections.map(s => __jsx(\"option\", {\n    key: s,\n    value: s,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 17\n    }\n  }, s)))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 13\n    }\n  }, \"Bin\"), __jsx(Form.Select, {\n    value: filters.bin,\n    onChange: e => {\n      const v = e.target.value;\n      setFilters(p => _objectSpread(_objectSpread({}, p), {}, {\n        bin: v\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 13\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 15\n    }\n  }, \"All bins\"), bins.map(b => __jsx(\"option\", {\n    key: b,\n    value: b,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 17\n    }\n  }, b)))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 13\n    }\n  }, \"Pallet\"), __jsx(Form.Select, {\n    value: filters.pallet,\n    onChange: e => {\n      const v = e.target.value;\n      setFilters(p => _objectSpread(_objectSpread({}, p), {}, {\n        pallet: v\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 13\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 15\n    }\n  }, \"All pallets\"), pallets.map(p => __jsx(\"option\", {\n    key: p,\n    value: p,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 17\n    }\n  }, p)))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 13\n    }\n  }, \"Local SN\"), __jsx(Form.Control, {\n    placeholder: \"Search SN\",\n    value: filters.localSN,\n    onChange: e => {\n      const v = e.target.value;\n      setFilters(p => _objectSpread(_objectSpread({}, p), {}, {\n        localSN: v\n      }));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 13\n    }\n  }))), __jsx(\"div\", {\n    className: \"d-flex mb-2 align-items-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Check, {\n    type: \"checkbox\",\n    label: \"Select All\",\n    onChange: toggleSelectAll,\n    checked: filteredItems.length > 0 && filteredItems.every(i => selectedIds.has(i.id)),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 11\n    }\n  }), selectedIds.size > 0 && __jsx(React.Fragment, null, __jsx(Form.Select, {\n    className: \"mx-2\",\n    value: bulkField,\n    onChange: e => setBulkField(e.target.value),\n    style: {\n      width: \"150px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 15\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 17\n    }\n  }, \"Change\\u2026\"), __jsx(\"option\", {\n    value: \"region\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 17\n    }\n  }, \"Region\"), __jsx(\"option\", {\n    value: \"section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 17\n    }\n  }, \"Section\"), __jsx(\"option\", {\n    value: \"bin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 17\n    }\n  }, \"Bin\"), __jsx(\"option\", {\n    value: \"pallet\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 17\n    }\n  }, \"Pallet\")), __jsx(Form.Control, {\n    style: {\n      width: \"100px\"\n    },\n    placeholder: \"New value\",\n    value: bulkValue,\n    onChange: e => setBulkValue(e.target.value),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 15\n    }\n  }), __jsx(Button, {\n    className: \"ms-2\",\n    onClick: applyBulkUpdate,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 15\n    }\n  }, \"Apply\"))), __jsx(Table, {\n    bordered: true,\n    hover: true,\n    responsive: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 9\n    }\n  }, __jsx(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 11\n    }\n  }, __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 13\n    }\n  }, __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 317,\n      columnNumber: 15\n    }\n  }), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 318,\n      columnNumber: 15\n    }\n  }, \"Name\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 319,\n      columnNumber: 15\n    }\n  }, \"PN\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 320,\n      columnNumber: 15\n    }\n  }, \"SN\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 15\n    }\n  }, \"LocalSN\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 15\n    }\n  }, \"Region\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 15\n    }\n  }, \"Section\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 15\n    }\n  }, \"Bin\"), __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 15\n    }\n  }, \"Pallet\"))), __jsx(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 11\n    }\n  }, filteredItems.map(it => __jsx(\"tr\", {\n    key: it.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 15\n    }\n  }, __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 17\n    }\n  }, __jsx(Form.Check, {\n    type: \"checkbox\",\n    checked: selectedIds.has(it.id),\n    onChange: () => toggleSelect(it.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 332,\n      columnNumber: 19\n    }\n  })), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 17\n    }\n  }, it.name), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 17\n    }\n  }, it.pn), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 17\n    }\n  }, it.sn), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 17\n    }\n  }, it.localSN), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 17\n    }\n  }, it.region), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 17\n    }\n  }, it.section), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 17\n    }\n  }, it.bin), __jsx(\"td\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 17\n    }\n  }, it.pallet)))))));\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/inventory/inventoryManage.js"],"names":["React","useEffect","useState","useMemo","LoggedIn","firebase","Table","Form","Button","Container","Row","Col","Spinner","Link","InventoryManage","items","setItems","loading","setLoading","selectedIds","setSelectedIds","Set","filters","setFilters","region","section","bin","pallet","localSN","bulkField","setBulkField","bulkValue","setBulkValue","db","firestore","collection","get","then","snap","data","docs","map","d","doc","loc","newLocalCurrent","id","name","pn","sn","toString","finally","distinct","arr","Array","from","filter","v","sort","regions","i","sections","bins","pallets","toggleSelect","prev","next","has","delete","add","toggleSelectAll","visibleIds","filteredItems","every","forEach","it","f","applyBulkUpdate","updates","orig","find","newRegion","newSection","newBin","newPallet","parts","push","newLocString","join","updateObj","localLocCurrent","update","item","Promise","all","LoadingButton","type","route","isLoading","simulateNetworkRequest","handleClick","resolve","setTimeout","e","target","value","p","r","s","b","length","size","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\nimport LoggedIn from \"../../LoggedIn\";\nimport firebase from \"../../../context/Firebase\";\nimport {\n  Table,\n  Form,\n  Button,\n  Container,\n  Row,\n  Col,\n  Spinner,\n} from \"react-bootstrap\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport Link from \"next/link\";\n\n\nexport default function InventoryManage() {\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [selectedIds, setSelectedIds] = useState(new Set());\n  const [filters, setFilters] = useState({\n    region: \"\",\n    section: \"\",\n    bin: \"\",\n    pallet: \"\",\n    localSN: \"\",\n  });\n  const [bulkField, setBulkField] = useState(\"\");\n  const [bulkValue, setBulkValue] = useState(\"\");\n\n  // ---- load data once ----\n  useEffect(() => {\n    const db = firebase.firestore();\n    db.collection(\"Test\")\n      .get()\n      .then((snap) => {\n        const data = snap.docs.map((d) => {\n          const doc = d.data();\n          const loc = doc.newLocalCurrent || {};\n          return {\n            id: d.id,\n            name: doc.name || \"\",\n            pn: doc.pn || \"\",\n            sn: doc.sn || \"\",\n            localSN: doc.localSN || \"\",\n            region: loc.region?.toString() ?? \"\",\n            section: loc.section?.toString() ?? \"\",\n            bin: loc.bin?.toString() ?? \"\",\n            pallet: loc.pallet?.toString() ?? \"\",\n          };\n        });\n        setItems(data);\n      })\n      .finally(() => setLoading(false));\n  }, []);\n\n  // ---- derive distinct filter options ----\n  const distinct = (arr) =>\n    Array.from(new Set(arr.filter((v) => v))).sort();\n  const regions  = useMemo(() => distinct(items.map((i) => i.region)),  [items]);\n  const sections = useMemo(() => distinct(items.map((i) => i.section)), [items]);\n  const bins     = useMemo(() => distinct(items.map((i) => i.bin)),     [items]);\n  const pallets  = useMemo(() => distinct(items.map((i) => i.pallet)),  [items]);\n\n  // ---- toggles ----\n  const toggleSelect = (id) => {\n    setSelectedIds((prev) => {\n      const next = new Set(prev);\n      next.has(id) ? next.delete(id) : next.add(id);\n      return next;\n    });\n  };\n  const toggleSelectAll = () => {\n    const visibleIds = filteredItems.map((i) => i.id);\n    setSelectedIds((prev) => {\n      const next = new Set(prev);\n      if (visibleIds.every((id) => next.has(id))) {\n        visibleIds.forEach((id) => next.delete(id));\n      } else {\n        visibleIds.forEach((id) => next.add(id));\n      }\n      return next;\n    });\n  };\n\n  // ---- filtered list ----\n  const filteredItems = items.filter((it) =>\n    [\"region\", \"section\", \"bin\", \"pallet\", \"localSN\"].every(\n      (f) => !filters[f] || it[f] === filters[f]\n    )\n  );\n\n  // ---- bulk update handler ----\n  const applyBulkUpdate = () => {\n    if (!bulkField || !bulkValue) return;\n    const db = firebase.firestore();\n\n    const updates = Array.from(selectedIds).map((id) => {\n      const orig = items.find((i) => i.id === id) || {};\n      const newRegion  = bulkField === \"region\"  ? bulkValue : orig.region;\n      const newSection = bulkField === \"section\" ? bulkValue : orig.section;\n      const newBin     = bulkField === \"bin\"     ? bulkValue : orig.bin;\n      const newPallet  = bulkField === \"pallet\"  ? bulkValue : orig.pallet;\n\n      const parts = [];\n      if (newRegion)  parts.push(newRegion);\n      if (newSection) parts.push(newSection);\n      if (newBin)     parts.push(`B${newBin}`);\n      if (newPallet)  parts.push(`P${newPallet}`);\n      const newLocString = parts.join(\"-\");\n\n      const updateObj = {\n        region: newRegion,\n        section: newSection,\n        bin: newBin,\n        pallet: newPallet,\n        localLocCurrent: newLocString,\n        newLocalCurrent: {\n          region: newRegion,\n          section: newSection,\n          bin: newBin,\n          pallet: newPallet,\n        },\n      };\n\n      return db\n        .collection(\"Test\")\n        .doc(id)\n        .update(updateObj)\n        .then(() => {\n          setItems((prev) =>\n            prev.map((item) =>\n              item.id === id\n                ? {\n                    ...item,\n                    region: newRegion,\n                    section: newSection,\n                    bin: newBin,\n                    pallet: newPallet,\n                  }\n                : item\n            )\n          );\n        });\n    });\n\n    Promise.all(updates).then(() => {\n      setSelectedIds(new Set());\n      setBulkField(\"\");\n      setBulkValue(\"\");\n    });\n  };\n\n  // ---- loading state ----\n  if (loading) {\n    return (\n      <Container className=\"py-5 text-center\">\n        <Spinner animation=\"border\" />\n            </Container>\n        );\n    }\n\n    function LoadingButton({ type, name, route }) {\n      const [isLoading, setLoading] = useState(false);\n    \n      useEffect(() => {\n        if (isLoading) {\n          simulateNetworkRequest().then(() => setLoading(false));\n        }\n      }, [isLoading]);\n    \n      const handleClick = () => setLoading(true);\n    \n      return (\n        <Link href={`/${route}`}>\n                <a\n                    className={`btn btn-${type}`}\n                    disabled={isLoading}\n                    onClick={!isLoading ? handleClick : null}\n                >\n                    {isLoading ? \"Loading…\" : name}\n                </a>\n            </Link>\n        );\n    }\n\n    function simulateNetworkRequest() {\n        return new Promise(resolve => setTimeout(resolve, 2000));\n    }\n\n    return (\n        <LoggedIn>\n            <Container className=\"py-4\">\n                <h2>Inventory Management</h2>\n                <LoadingButton\n                    type=\"primary\"\n                    name=\"Back\"\n                    route=\"Warehousedb/WarehouseSelect\"\n                />\n                {/* dropdown filters */}\n                <Row className=\"mb-3\">\n                    <Col>\n                        <Form.Label>Region</Form.Label>\n                        <Form.Select\n                            value={filters.region}\n                            onChange={(e) => {\n                const v = e.target.value;\n                setFilters((p) => ({ ...p, region: v }));\n              }}\n            >\n              <option value=\"\">All regions</option>\n              {regions.map((r) => (\n                <option key={r} value={r}>{r}</option>\n              ))}\n            </Form.Select>\n          </Col>\n          <Col>\n            <Form.Label>Section</Form.Label>\n            <Form.Select\n              value={filters.section}\n              onChange={(e) => {\n                const v = e.target.value;\n                setFilters((p) => ({ ...p, section: v }));\n              }}\n            >\n              <option value=\"\">All sections</option>\n              {sections.map((s) => (\n                <option key={s} value={s}>{s}</option>\n              ))}\n            </Form.Select>\n          </Col>\n          <Col>\n            <Form.Label>Bin</Form.Label>\n            <Form.Select\n              value={filters.bin}\n              onChange={(e) => {\n                const v = e.target.value;\n                setFilters((p) => ({ ...p, bin: v }));\n              }}\n            >\n              <option value=\"\">All bins</option>\n              {bins.map((b) => (\n                <option key={b} value={b}>{b}</option>\n              ))}\n            </Form.Select>\n          </Col>\n          <Col>\n            <Form.Label>Pallet</Form.Label>\n            <Form.Select\n              value={filters.pallet}\n              onChange={(e) => {\n                const v = e.target.value;\n                setFilters((p) => ({ ...p, pallet: v }));\n              }}\n            >\n              <option value=\"\">All pallets</option>\n              {pallets.map((p) => (\n                <option key={p} value={p}>{p}</option>\n              ))}\n            </Form.Select>\n          </Col>\n          <Col>\n            <Form.Label>Local SN</Form.Label>\n            <Form.Control\n              placeholder=\"Search SN\"\n              value={filters.localSN}\n              onChange={(e) => {\n                const v = e.target.value;\n                setFilters((p) => ({ ...p, localSN: v }));\n              }}\n            />\n          </Col>\n        </Row>\n\n        {/* bulk action bar */}\n        <div className=\"d-flex mb-2 align-items-center\">\n          <Form.Check\n            type=\"checkbox\"\n            label=\"Select All\"\n            onChange={toggleSelectAll}\n            checked={\n              filteredItems.length > 0 &&\n              filteredItems.every((i) => selectedIds.has(i.id))\n            }\n          />\n          {selectedIds.size > 0 && (\n            <>\n              <Form.Select\n                className=\"mx-2\"\n                value={bulkField}\n                onChange={(e) => setBulkField(e.target.value)}\n                style={{ width: \"150px\" }}\n              >\n                <option value=\"\">Change…</option>\n                <option value=\"region\">Region</option>\n                <option value=\"section\">Section</option>\n                <option value=\"bin\">Bin</option>\n                <option value=\"pallet\">Pallet</option>\n              </Form.Select>\n              <Form.Control\n                style={{ width: \"100px\" }}\n                placeholder=\"New value\"\n                value={bulkValue}\n                onChange={(e) => setBulkValue(e.target.value)}\n              />\n              <Button className=\"ms-2\" onClick={applyBulkUpdate}>\n                Apply\n              </Button>\n            </>\n          )}\n        </div>\n\n        {/* data table */}\n        <Table bordered hover responsive>\n          <thead>\n            <tr>\n              <th></th>\n              <th>Name</th>\n              <th>PN</th>\n              <th>SN</th>\n              <th>LocalSN</th>\n              <th>Region</th>\n              <th>Section</th>\n              <th>Bin</th>\n              <th>Pallet</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filteredItems.map((it) => (\n              <tr key={it.id}>\n                <td>\n                  <Form.Check\n                    type=\"checkbox\"\n                    checked={selectedIds.has(it.id)}\n                    onChange={() => toggleSelect(it.id)}\n                  />\n                </td>\n                <td>{it.name}</td>\n                <td>{it.pn}</td>\n                <td>{it.sn}</td>\n                <td>{it.localSN}</td>\n                <td>{it.region}</td>\n                <td>{it.section}</td>\n                <td>{it.bin}</td>\n                <td>{it.pallet}</td>\n              </tr>\n            ))}\n          </tbody>\n        </Table>\n      </Container>\n    </LoggedIn>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}