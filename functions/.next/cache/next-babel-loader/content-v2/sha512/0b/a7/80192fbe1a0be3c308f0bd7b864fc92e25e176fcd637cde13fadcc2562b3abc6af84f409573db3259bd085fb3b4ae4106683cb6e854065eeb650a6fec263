{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\components\\\\WarehouseMapModal.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport firebase from \"../context/Firebase\";\nimport styles from \"./WarehouseMapModal.module.css\";\nvar REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\nvar LETTERS = Array.from({\n  length: 26\n}, function (_, i) {\n  return String.fromCharCode(65 + i);\n});\nvar NUMBERS = Array.from({\n  length: 50\n}, function (_, i) {\n  return i + 1;\n});\nexport default function WarehouseMapModal(_ref) {\n  _s();\n\n  var _this = this;\n\n  var _ref$show = _ref.show,\n      show = _ref$show === void 0 ? false : _ref$show,\n      _ref$onHide = _ref.onHide,\n      onHide = _ref$onHide === void 0 ? function () {} : _ref$onHide,\n      onView = _ref.onView,\n      onSelectionChange = _ref.onSelectionChange,\n      _ref$initialSelection = _ref.initialSelection,\n      initialSelection = _ref$initialSelection === void 0 ? {} : _ref$initialSelection;\n\n  var _useState = useState([]),\n      regionOptions = _useState[0],\n      setRegionOptions = _useState[1];\n\n  var _useState2 = useState({}),\n      sectionMap = _useState2[0],\n      setSectionMap = _useState2[1];\n\n  var _useState3 = useState(\"regions\"),\n      mapStep = _useState3[0],\n      setMapStep = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      mapRegion = _useState4[0],\n      setMapRegion = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      mapRow = _useState5[0],\n      setMapRow = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      mapCol = _useState6[0],\n      setMapCol = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      mapPallet = _useState7[0],\n      setMapPallet = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      mapBin = _useState8[0],\n      setMapBin = _useState8[1];\n\n  var _useState9 = useState({}),\n      mapCellPallets = _useState9[0],\n      setMapCellPallets = _useState9[1];\n\n  var _useState10 = useState({}),\n      mapPalletBins = _useState10[0],\n      setMapPalletBins = _useState10[1];\n\n  var _useState11 = useState(false),\n      mapLoading = _useState11[0],\n      setMapLoading = _useState11[1];\n\n  var _useState12 = useState(\"\"),\n      mapError = _useState12[0],\n      setMapError = _useState12[1];\n\n  var _useState13 = useState(false),\n      directoryLoaded = _useState13[0],\n      setDirectoryLoaded = _useState13[1];\n\n  var lastShowRef = useRef(false);\n  var notifySelectionChange = useCallback(function (selection) {\n    if (typeof onSelectionChange === \"function\") {\n      onSelectionChange(selection);\n    }\n  }, [onSelectionChange]);\n  var loadDirectory = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var doc, data;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!directoryLoaded) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            _context.prev = 2;\n            _context.next = 5;\n            return firebase.firestore().collection(\"Warehouse\").doc(\"directory\").get();\n\n          case 5:\n            doc = _context.sent;\n            data = doc.data() || {};\n            setRegionOptions(data.Region || []);\n            setSectionMap(data.Section || {});\n            setDirectoryLoaded(true);\n            _context.next = 16;\n            break;\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](2);\n            console.error(\"Failed to load map directory\", _context.t0);\n            setMapError(\"Failed to load warehouse directory.\");\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[2, 12]]);\n  })), [directoryLoaded]);\n  var loadRegionInventory = useCallback( /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(regionId) {\n      var snap, cellPallets, palletBins, cellObj, palletObj;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (regionId) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              setMapLoading(true);\n              setMapError(\"\");\n              _context2.prev = 4;\n              _context2.next = 7;\n              return firebase.firestore().collection(\"Test\").where(\"newLocalCurrent.region\", \"==\", regionId).get();\n\n            case 7:\n              snap = _context2.sent;\n              cellPallets = {};\n              palletBins = {};\n              snap.forEach(function (doc) {\n                var _doc$data, _loc$section, _loc$section2;\n\n                var loc = ((_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.newLocalCurrent) || {};\n                var row = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.letter;\n                var col = (_loc$section2 = loc.section) === null || _loc$section2 === void 0 ? void 0 : _loc$section2.number;\n\n                if ((!row || !col) && typeof loc.section === \"string\") {\n                  var trimmed = loc.section.trim();\n                  row = trimmed.slice(0, 1);\n                  col = trimmed.slice(1);\n                }\n\n                if (col !== undefined && col !== null) {\n                  col = String(col);\n                }\n\n                var pallet = loc.pallet;\n                var bin = loc.bin;\n                if (!row || !col) return;\n                var cellKey = \"\".concat(row, \"-\").concat(col);\n\n                if (pallet !== undefined && pallet !== null && \"\".concat(pallet) !== \"\") {\n                  if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n                  cellPallets[cellKey].add(String(pallet));\n\n                  if (bin !== undefined && bin !== null && \"\".concat(bin) !== \"\") {\n                    var palletKey = \"\".concat(cellKey, \"-P\").concat(pallet);\n                    if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n                    palletBins[palletKey].add(String(bin));\n                  }\n                }\n              });\n              cellObj = {};\n              Object.keys(cellPallets).forEach(function (key) {\n                cellObj[key] = Array.from(cellPallets[key]).sort(function (a, b) {\n                  return Number(a) - Number(b);\n                });\n              });\n              palletObj = {};\n              Object.keys(palletBins).forEach(function (key) {\n                palletObj[key] = Array.from(palletBins[key]).sort(function (a, b) {\n                  return Number(a) - Number(b);\n                });\n              });\n              setMapCellPallets(cellObj);\n              setMapPalletBins(palletObj);\n              _context2.next = 23;\n              break;\n\n            case 19:\n              _context2.prev = 19;\n              _context2.t0 = _context2[\"catch\"](4);\n              console.error(\"Failed to load map inventory\", _context2.t0);\n              setMapError(\"Failed to load map inventory.\");\n\n            case 23:\n              _context2.prev = 23;\n              setMapLoading(false);\n              return _context2.finish(23);\n\n            case 26:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 19, 23, 26]]);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), []);\n  var getRegionDimensions = useCallback(function (regionId) {\n    var entry = sectionMap === null || sectionMap === void 0 ? void 0 : sectionMap[regionId];\n\n    if (Array.isArray(entry) && entry.length >= 2) {\n      var cols = parseInt(entry[0], 10);\n      var rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0\n      };\n    }\n\n    return {\n      cols: 0,\n      rows: 0\n    };\n  }, [sectionMap]);\n  useEffect(function () {\n    var wasOpen = lastShowRef.current;\n    lastShowRef.current = show;\n    if (!show || wasOpen) return;\n    loadDirectory();\n    setMapError(\"\");\n\n    var _ref4 = initialSelection || {},\n        region = _ref4.region,\n        sectionLetter = _ref4.sectionLetter,\n        sectionNumber = _ref4.sectionNumber,\n        pallet = _ref4.pallet,\n        bin = _ref4.bin;\n\n    setMapRegion(region || \"\");\n    setMapRow(sectionLetter || \"\");\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\n    setMapPallet(pallet ? String(pallet) : \"\");\n    setMapBin(bin ? String(bin) : \"\");\n    setMapStep(region ? \"grid\" : \"regions\");\n    if (region) loadRegionInventory(region);\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\n\n  var handleSelectRegion = function handleSelectRegion(regionId) {\n    var selection = {\n      region: regionId,\n      sectionLetter: \"\",\n      sectionNumber: \"\",\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"grid\");\n    notifySelectionChange(selection);\n    loadRegionInventory(regionId);\n  };\n\n  var handleSelectCell = function handleSelectCell(rowLetter, colNumber) {\n    var colValue = String(colNumber);\n    var selection = {\n      region: mapRegion,\n      sectionLetter: rowLetter,\n      sectionNumber: colValue,\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRow(rowLetter);\n    setMapCol(colValue);\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"pallets\");\n    notifySelectionChange(selection);\n  };\n\n  var handleSelectPallet = function handleSelectPallet(palletId) {\n    var palletValue = String(palletId);\n    var selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: palletValue,\n      bin: \"\"\n    };\n    setMapPallet(palletValue);\n    setMapBin(\"\");\n    setMapStep(\"bins\");\n    notifySelectionChange(selection);\n  };\n\n  var handleSelectBin = function handleSelectBin(binId) {\n    var binValue = String(binId);\n    var selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: binValue\n    };\n    setMapBin(binValue);\n    notifySelectionChange(selection);\n  };\n\n  var handleBack = function handleBack() {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");else if (mapStep === \"pallets\") setMapStep(\"grid\");else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  var handleView = function handleView() {\n    if (typeof onView !== \"function\") return;\n    onView({\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: mapBin\n    });\n  };\n\n  return __jsx(Modal, {\n    show: show,\n    onHide: onHide,\n    centered: true,\n    size: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 5\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 9\n    }\n  }, \"Warehouse Map\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }\n  }, mapLoading && __jsx(\"div\", {\n    className: styles.mapLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 11\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 13\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 13\n    }\n  }, \"Loading map data...\")), mapError && __jsx(\"div\", {\n    className: styles.mapError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 22\n    }\n  }, mapError), !mapLoading && mapStep === \"regions\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 13\n    }\n  }, \"Select a region\"), __jsx(\"div\", {\n    className: styles.mapCanvas,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 13\n    }\n  }, REGION_ORDER.map(function (regionId) {\n    return __jsx(\"button\", {\n      key: regionId,\n      type: \"button\",\n      className: \"\".concat(styles.regionBlock, \" \").concat(styles[\"region\".concat(regionId)]),\n      onClick: function onClick() {\n        return handleSelectRegion(regionId);\n      },\n      disabled: Array.isArray(regionOptions) && regionOptions.length > 0 && !regionOptions.includes(regionId),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 17\n      }\n    }, regionId);\n  }))), !mapLoading && mapStep === \"grid\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \": choose a row and column\"), function () {\n    var dims = getRegionDimensions(mapRegion);\n    var rows = LETTERS.slice(0, dims.rows || 0).reverse();\n    var cols = NUMBERS.slice(0, dims.cols || 0);\n\n    if (!rows.length || !cols.length) {\n      return __jsx(\"div\", {\n        className: styles.mapEmpty,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 19\n        }\n      }, \"No grid data for this region.\");\n    }\n\n    return __jsx(\"div\", {\n      className: styles.gridWrapper,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 17\n      }\n    }, __jsx(\"div\", {\n      className: styles.grid,\n      style: {\n        \"--grid-cols\": cols.length\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 19\n      }\n    }, rows.map(function (row) {\n      return cols.map(function (col) {\n        var _mapCellPallets$cellK;\n\n        var cellKey = \"\".concat(row, \"-\").concat(col);\n        var hasPallets = Boolean((_mapCellPallets$cellK = mapCellPallets[cellKey]) === null || _mapCellPallets$cellK === void 0 ? void 0 : _mapCellPallets$cellK.length);\n        return __jsx(\"button\", {\n          key: cellKey,\n          type: \"button\",\n          className: \"\".concat(styles.gridCell, \" \").concat(hasPallets ? \"\" : styles.gridCellDisabled),\n          onClick: function onClick() {\n            return hasPallets && handleSelectCell(row, col);\n          },\n          disabled: !hasPallets,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 311,\n            columnNumber: 27\n          }\n        }, __jsx(\"span\", {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 29\n          }\n        }, row, col));\n      });\n    })));\n  }()), !mapLoading && mapStep === \"pallets\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \": select a pallet\"), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  }, (mapCellPallets[\"\".concat(mapRow, \"-\").concat(mapCol)] || []).map(function (pallet) {\n    var palletKey = \"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(pallet);\n    var bins = mapPalletBins[palletKey] || [];\n    return __jsx(\"button\", {\n      key: pallet,\n      type: \"button\",\n      className: styles.palletButton,\n      onClick: function onClick() {\n        if (bins.length === 0 && typeof onView === \"function\") {\n          var selection = {\n            region: mapRegion,\n            sectionLetter: mapRow,\n            sectionNumber: mapCol,\n            pallet: String(pallet),\n            bin: \"\"\n          };\n          notifySelectionChange(selection);\n          onView(selection);\n          return;\n        }\n\n        handleSelectPallet(pallet);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 19\n      }\n    }, \"Pallet \", pallet);\n  }), !(mapCellPallets[\"\".concat(mapRow, \"-\").concat(mapCol)] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 17\n    }\n  }, \"No pallets available here.\"))), !mapLoading && mapStep === \"bins\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 382,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 383,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \" - Pallet \", mapPallet), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 13\n    }\n  }, (mapPalletBins[\"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(mapPallet)] || []).map(function (bin) {\n    return __jsx(\"button\", {\n      key: bin,\n      type: \"button\",\n      className: \"\".concat(styles.palletButton, \" \").concat(styles.binButton),\n      onClick: function onClick() {\n        return handleSelectBin(bin);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 19\n      }\n    }, \"Bin \", bin);\n  }), !(mapPalletBins[\"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(mapPallet)] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 17\n    }\n  }, \"No bins available on this pallet.\")))), __jsx(Modal.Footer, {\n    className: styles.mapFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 7\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBack,\n    disabled: mapStep === \"regions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 9\n    }\n  }, \"Back\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: handleView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 9\n    }\n  }, \"View\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: onHide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 421,\n      columnNumber: 9\n    }\n  }, \"Close\")));\n}\n\n_s(WarehouseMapModal, \"K3jZUBqumdfQwS4G3Gpw4/L1+uc=\");\n\n_c = WarehouseMapModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"WarehouseMapModal\");","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/components/WarehouseMapModal.js"],"names":["React","useCallback","useEffect","useRef","useState","Modal","Button","Spinner","firebase","styles","REGION_ORDER","LETTERS","Array","from","length","_","i","String","fromCharCode","NUMBERS","WarehouseMapModal","show","onHide","onView","onSelectionChange","initialSelection","regionOptions","setRegionOptions","sectionMap","setSectionMap","mapStep","setMapStep","mapRegion","setMapRegion","mapRow","setMapRow","mapCol","setMapCol","mapPallet","setMapPallet","mapBin","setMapBin","mapCellPallets","setMapCellPallets","mapPalletBins","setMapPalletBins","mapLoading","setMapLoading","mapError","setMapError","directoryLoaded","setDirectoryLoaded","lastShowRef","notifySelectionChange","selection","loadDirectory","firestore","collection","doc","get","data","Region","Section","console","error","loadRegionInventory","regionId","where","snap","cellPallets","palletBins","forEach","loc","newLocalCurrent","row","section","letter","col","number","trimmed","trim","slice","undefined","pallet","bin","cellKey","Set","add","palletKey","cellObj","Object","keys","key","sort","a","b","Number","palletObj","getRegionDimensions","entry","isArray","cols","parseInt","rows","isFinite","wasOpen","current","region","sectionLetter","sectionNumber","handleSelectRegion","handleSelectCell","rowLetter","colNumber","colValue","handleSelectPallet","palletId","palletValue","handleSelectBin","binId","binValue","handleBack","handleView","mapStage","mapHint","mapCanvas","map","regionBlock","includes","dims","reverse","mapEmpty","gridWrapper","grid","hasPallets","Boolean","gridCell","gridCellDisabled","palletGrid","bins","palletButton","binButton","mapFooter"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport firebase from \"../context/Firebase\";\nimport styles from \"./WarehouseMapModal.module.css\";\n\nconst REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\nconst LETTERS = Array.from({ length: 26 }, (_, i) =>\n  String.fromCharCode(65 + i)\n);\nconst NUMBERS = Array.from({ length: 50 }, (_, i) => i + 1);\n\nexport default function WarehouseMapModal({\n  show = false,\n  onHide = () => {},\n  onView,\n  onSelectionChange,\n  initialSelection = {},\n}) {\n  const [regionOptions, setRegionOptions] = useState([]);\n  const [sectionMap, setSectionMap] = useState({});\n  const [mapStep, setMapStep] = useState(\"regions\");\n  const [mapRegion, setMapRegion] = useState(\"\");\n  const [mapRow, setMapRow] = useState(\"\");\n  const [mapCol, setMapCol] = useState(\"\");\n  const [mapPallet, setMapPallet] = useState(\"\");\n  const [mapBin, setMapBin] = useState(\"\");\n  const [mapCellPallets, setMapCellPallets] = useState({});\n  const [mapPalletBins, setMapPalletBins] = useState({});\n  const [mapLoading, setMapLoading] = useState(false);\n  const [mapError, setMapError] = useState(\"\");\n  const [directoryLoaded, setDirectoryLoaded] = useState(false);\n  const lastShowRef = useRef(false);\n\n  const notifySelectionChange = useCallback(\n    (selection) => {\n      if (typeof onSelectionChange === \"function\") {\n        onSelectionChange(selection);\n      }\n    },\n    [onSelectionChange]\n  );\n\n  const loadDirectory = useCallback(async () => {\n    if (directoryLoaded) return;\n    try {\n      const doc = await firebase\n        .firestore()\n        .collection(\"Warehouse\")\n        .doc(\"directory\")\n        .get();\n      const data = doc.data() || {};\n      setRegionOptions(data.Region || []);\n      setSectionMap(data.Section || {});\n      setDirectoryLoaded(true);\n    } catch (error) {\n      console.error(\"Failed to load map directory\", error);\n      setMapError(\"Failed to load warehouse directory.\");\n    }\n  }, [directoryLoaded]);\n\n  const loadRegionInventory = useCallback(async (regionId) => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n    try {\n      const snap = await firebase\n        .firestore()\n        .collection(\"Test\")\n        .where(\"newLocalCurrent.region\", \"==\", regionId)\n        .get();\n\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach((doc) => {\n        const loc = doc.data()?.newLocalCurrent || {};\n        let row = loc.section?.letter;\n        let col = loc.section?.number;\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n        if (pallet !== undefined && pallet !== null && `${pallet}` !== \"\") {\n          if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n          cellPallets[cellKey].add(String(pallet));\n          if (bin !== undefined && bin !== null && `${bin}` !== \"\") {\n            const palletKey = `${cellKey}-P${pallet}`;\n            if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n            palletBins[palletKey].add(String(bin));\n          }\n        }\n      });\n\n      const cellObj = {};\n      Object.keys(cellPallets).forEach((key) => {\n        cellObj[key] = Array.from(cellPallets[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      const palletObj = {};\n      Object.keys(palletBins).forEach((key) => {\n        palletObj[key] = Array.from(palletBins[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  }, []);\n\n  const getRegionDimensions = useCallback(\n    (regionId) => {\n      const entry = sectionMap?.[regionId];\n      if (Array.isArray(entry) && entry.length >= 2) {\n        const cols = parseInt(entry[0], 10);\n        const rows = parseInt(entry[1], 10);\n        return {\n          cols: Number.isFinite(cols) ? cols : 0,\n          rows: Number.isFinite(rows) ? rows : 0,\n        };\n      }\n      return { cols: 0, rows: 0 };\n    },\n    [sectionMap]\n  );\n\n  useEffect(() => {\n    const wasOpen = lastShowRef.current;\n    lastShowRef.current = show;\n    if (!show || wasOpen) return;\n\n    loadDirectory();\n    setMapError(\"\");\n    const {\n      region,\n      sectionLetter,\n      sectionNumber,\n      pallet,\n      bin,\n    } = initialSelection || {};\n\n    setMapRegion(region || \"\");\n    setMapRow(sectionLetter || \"\");\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\n    setMapPallet(pallet ? String(pallet) : \"\");\n    setMapBin(bin ? String(bin) : \"\");\n    setMapStep(region ? \"grid\" : \"regions\");\n    if (region) loadRegionInventory(region);\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\n\n  const handleSelectRegion = (regionId) => {\n    const selection = {\n      region: regionId,\n      sectionLetter: \"\",\n      sectionNumber: \"\",\n      pallet: \"\",\n      bin: \"\",\n    };\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"grid\");\n    notifySelectionChange(selection);\n    loadRegionInventory(regionId);\n  };\n\n  const handleSelectCell = (rowLetter, colNumber) => {\n    const colValue = String(colNumber);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: rowLetter,\n      sectionNumber: colValue,\n      pallet: \"\",\n      bin: \"\",\n    };\n    setMapRow(rowLetter);\n    setMapCol(colValue);\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"pallets\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectPallet = (palletId) => {\n    const palletValue = String(palletId);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: palletValue,\n      bin: \"\",\n    };\n    setMapPallet(palletValue);\n    setMapBin(\"\");\n    setMapStep(\"bins\");\n    notifySelectionChange(selection);\n  };\n\n  const handleSelectBin = (binId) => {\n    const binValue = String(binId);\n    const selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: binValue,\n    };\n    setMapBin(binValue);\n    notifySelectionChange(selection);\n  };\n\n  const handleBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");\n    else if (mapStep === \"pallets\") setMapStep(\"grid\");\n    else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleView = () => {\n    if (typeof onView !== \"function\") return;\n    onView({\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: mapPallet,\n      bin: mapBin,\n    });\n  };\n\n  return (\n    <Modal show={show} onHide={onHide} centered size=\"lg\">\n      <Modal.Header closeButton>\n        <Modal.Title>Warehouse Map</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>\n        {mapLoading && (\n          <div className={styles.mapLoading}>\n            <Spinner animation=\"border\" />\n            <span>Loading map data...</span>\n          </div>\n        )}\n        {mapError && <div className={styles.mapError}>{mapError}</div>}\n\n        {!mapLoading && mapStep === \"regions\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>Select a region</div>\n            <div className={styles.mapCanvas}>\n              {REGION_ORDER.map((regionId) => (\n                <button\n                  key={regionId}\n                  type=\"button\"\n                  className={`${styles.regionBlock} ${styles[`region${regionId}`]}`}\n                  onClick={() => handleSelectRegion(regionId)}\n                  disabled={\n                    Array.isArray(regionOptions) &&\n                    regionOptions.length > 0 &&\n                    !regionOptions.includes(regionId)\n                  }\n                >\n                  {regionId}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {!mapLoading && mapStep === \"grid\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>\n              Region {mapRegion}: choose a row and column\n            </div>\n            {(() => {\n              const dims = getRegionDimensions(mapRegion);\n              const rows = LETTERS.slice(0, dims.rows || 0).reverse();\n              const cols = NUMBERS.slice(0, dims.cols || 0);\n              if (!rows.length || !cols.length) {\n                return (\n                  <div className={styles.mapEmpty}>\n                    No grid data for this region.\n                  </div>\n                );\n              }\n              return (\n                <div className={styles.gridWrapper}>\n                  <div\n                    className={styles.grid}\n                    style={{ \"--grid-cols\": cols.length }}\n                  >\n                    {rows.map((row) =>\n                      cols.map((col) => {\n                        const cellKey = `${row}-${col}`;\n                        const hasPallets = Boolean(\n                          mapCellPallets[cellKey]?.length\n                        );\n                        return (\n                          <button\n                            key={cellKey}\n                            type=\"button\"\n                            className={`${styles.gridCell} ${\n                              hasPallets ? \"\" : styles.gridCellDisabled\n                            }`}\n                            onClick={() =>\n                              hasPallets && handleSelectCell(row, col)\n                            }\n                            disabled={!hasPallets}\n                          >\n                            <span>\n                              {row}\n                              {col}\n                            </span>\n                          </button>\n                        );\n                      })\n                    )}\n                  </div>\n                </div>\n              );\n            })()}\n          </div>\n        )}\n\n        {!mapLoading && mapStep === \"pallets\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>\n              Region {mapRegion} - Section {mapRow}\n              {mapCol}: select a pallet\n            </div>\n            <div className={styles.palletGrid}>\n              {(mapCellPallets[`${mapRow}-${mapCol}`] || []).map((pallet) => {\n                const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\n                const bins = mapPalletBins[palletKey] || [];\n                return (\n                  <button\n                    key={pallet}\n                    type=\"button\"\n                    className={styles.palletButton}\n                  onClick={() => {\n                      if (bins.length === 0 && typeof onView === \"function\") {\n                        const selection = {\n                          region: mapRegion,\n                          sectionLetter: mapRow,\n                          sectionNumber: mapCol,\n                          pallet: String(pallet),\n                          bin: \"\",\n                        };\n                        notifySelectionChange(selection);\n                        onView(selection);\n                        return;\n                      }\n                      handleSelectPallet(pallet);\n                    }}\n                  >\n                    Pallet {pallet}\n                  </button>\n                );\n              })}\n              {!(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && (\n                <div className={styles.mapEmpty}>\n                  No pallets available here.\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {!mapLoading && mapStep === \"bins\" && (\n          <div className={styles.mapStage}>\n            <div className={styles.mapHint}>\n              Region {mapRegion} - Section {mapRow}\n              {mapCol} - Pallet {mapPallet}\n            </div>\n            <div className={styles.palletGrid}>\n              {(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(\n                (bin) => (\n                  <button\n                    key={bin}\n                    type=\"button\"\n                    className={`${styles.palletButton} ${styles.binButton}`}\n                    onClick={() => handleSelectBin(bin)}\n                  >\n                    Bin {bin}\n                  </button>\n                )\n              )}\n              {!(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || [])\n                .length && (\n                <div className={styles.mapEmpty}>\n                  No bins available on this pallet.\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </Modal.Body>\n      <Modal.Footer className={styles.mapFooter}>\n        <Button\n          variant=\"outline-secondary\"\n          onClick={handleBack}\n          disabled={mapStep === \"regions\"}\n        >\n          Back\n        </Button>\n        <Button variant=\"outline-primary\" onClick={handleView}>\n          View\n        </Button>\n        <Button variant=\"secondary\" onClick={onHide}>\n          Close\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}