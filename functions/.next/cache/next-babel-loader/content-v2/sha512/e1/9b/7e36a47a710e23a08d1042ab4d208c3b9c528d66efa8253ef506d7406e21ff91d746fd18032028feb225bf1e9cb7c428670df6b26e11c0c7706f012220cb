{"ast":null,"code":"import _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\client\\\\[id]\\\\index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { Table, Button, Alert, Spinner } from \"react-bootstrap\";\nimport firebase from \"../../../../context/Firebase\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport MachineCreationModal from \"../../MachineCreationModal\";\nimport styles from \"../Client.module.css\"; // Import for SSR\n\nvar Client = function Client(_ref) {\n  _s();\n\n  var initialClient = _ref.initialClient,\n      initialMachines = _ref.initialMachines,\n      initialError = _ref.error;\n  var router = useRouter();\n\n  var _useState = useState(initialClient || null),\n      selectedClient = _useState[0],\n      setSelectedClient = _useState[1];\n\n  var _useState2 = useState(Array.isArray(initialMachines) ? initialMachines : []),\n      machineOptions = _useState2[0],\n      setMachineOptions = _useState2[1];\n\n  var _useState3 = useState(initialError || null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(!initialClient && !initialError),\n      isLoading = _useState4[0],\n      setIsLoading = _useState4[1]; // State for machine addition modals\n\n\n  var _useState5 = useState(false),\n      showAddMachineModal = _useState5[0],\n      setShowAddMachineModal = _useState5[1];\n\n  var _useState6 = useState(false),\n      showCreateMachineModal = _useState6[0],\n      setShowCreateMachineModal = _useState6[1];\n\n  var _useState7 = useState([]),\n      availableMachines = _useState7[0],\n      setAvailableMachines = _useState7[1];\n\n  useEffect(function () {\n    if (!router.isReady) return;\n    var activeId = router.query.id || router.asPath.split(\"/\").pop();\n    if (!activeId) return;\n    var hasInitial = initialClient && initialClient.id === activeId;\n    fetchClientData(activeId, {\n      silent: hasInitial\n    });\n  }, [router.isReady, router.query.id, initialClient]);\n\n  var fetchClientData = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(clientId) {\n      var _ref3,\n          _ref3$silent,\n          silent,\n          db,\n          clientDoc,\n          clientData,\n          machineRefs,\n          machinePromises,\n          machineDocs,\n          machines,\n          _args = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _ref3 = _args.length > 1 && _args[1] !== undefined ? _args[1] : {}, _ref3$silent = _ref3.silent, silent = _ref3$silent === void 0 ? false : _ref3$silent;\n\n              if (!silent) {\n                setIsLoading(true);\n              }\n\n              setError(null);\n              _context.prev = 3;\n              db = firebase.firestore();\n              _context.next = 7;\n              return db.collection(\"Client\").doc(clientId).get();\n\n            case 7:\n              clientDoc = _context.sent;\n\n              if (!clientDoc.exists) {\n                _context.next = 20;\n                break;\n              }\n\n              clientData = clientDoc.data();\n              setSelectedClient(_objectSpread({\n                id: clientId\n              }, clientData));\n              machineRefs = Array.isArray(clientData.machines) ? clientData.machines : [];\n              machinePromises = machineRefs.map(function (machineRef) {\n                return machineRef.get();\n              });\n              _context.next = 15;\n              return Promise.all(machinePromises);\n\n            case 15:\n              machineDocs = _context.sent;\n              machines = machineDocs.map(function (machineDoc) {\n                return _objectSpread({\n                  id: machineDoc.id\n                }, machineDoc.data());\n              });\n              setMachineOptions(machines);\n              _context.next = 21;\n              break;\n\n            case 20:\n              setError(\"Client not found\");\n\n            case 21:\n              _context.next = 27;\n              break;\n\n            case 23:\n              _context.prev = 23;\n              _context.t0 = _context[\"catch\"](3);\n              console.error(\"Error fetching client data:\", _context.t0);\n              setError(\"Error fetching client data\");\n\n            case 27:\n              _context.prev = 27;\n\n              if (!silent) {\n                setIsLoading(false);\n              }\n\n              return _context.finish(27);\n\n            case 30:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 23, 27, 30]]);\n    }));\n\n    return function fetchClientData(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(); // Fetch available machines (those not yet assigned to a client)\n\n\n  var fetchAvailableMachines = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var db, snapshot, machines;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              db = firebase.firestore();\n              _context2.next = 4;\n              return db.collection(\"Machine\").where(\"client\", \"==\", null).get();\n\n            case 4:\n              snapshot = _context2.sent;\n              machines = snapshot.docs.map(function (doc) {\n                return _objectSpread({\n                  id: doc.id\n                }, doc.data());\n              });\n              setAvailableMachines(machines);\n              _context2.next = 13;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error(\"Error fetching available machines:\", _context2.t0);\n              setError(\"Failed to fetch available machines.\");\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n\n    return function fetchAvailableMachines() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var handleSelectMachine = function handleSelectMachine(id, name) {\n    // Navigate to the machine details page if needed\n    router.push(\"../machine/\" + id);\n  }; // When adding an existing machine\n\n\n  var handleAddMachine = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(machine) {\n      var db, clientId;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              db = firebase.firestore();\n              clientId = router.query.clientId || router.asPath.split(\"/\").pop(); // Update client's \"machines\" array with the machine reference\n\n              _context3.next = 5;\n              return db.collection(\"Client\").doc(clientId).update({\n                machines: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Machine\").doc(machine.id))\n              });\n\n            case 5:\n              // Update local state to include the newly added machine\n              setMachineOptions(function (prev) {\n                return [].concat(_toConsumableArray(prev), [machine]);\n              });\n              setShowAddMachineModal(false);\n              _context3.next = 13;\n              break;\n\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(\"Error adding machine to client:\", _context3.t0);\n              setError(\"Failed to add machine to client.\");\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 9]]);\n    }));\n\n    return function handleAddMachine(_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }(); // When creating a new machine for the client\n\n\n  var handleCreateMachine = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(newMachine) {\n      var db, clientId, machineId, machineWithId;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              db = firebase.firestore();\n              clientId = router.query.clientId || router.asPath.split(\"/\").pop();\n              machineId = \"AIS\".concat(Math.floor(10000 + Math.random() * 90000));\n              machineWithId = _objectSpread(_objectSpread({}, newMachine), {}, {\n                id: machineId,\n                client: db.collection(\"Client\").doc(clientId)\n              }); // Create the machine document\n\n              _context4.next = 7;\n              return db.collection(\"Machine\").doc(machineId).set(machineWithId);\n\n            case 7:\n              _context4.next = 9;\n              return db.collection(\"Client\").doc(clientId).update({\n                machines: firebase.firestore.FieldValue.arrayUnion(db.collection(\"Machine\").doc(machineId))\n              });\n\n            case 9:\n              // Update local state\n              setMachineOptions(function (prev) {\n                return [].concat(_toConsumableArray(prev), [_objectSpread({\n                  id: machineId\n                }, newMachine)]);\n              });\n              setShowCreateMachineModal(false);\n              _context4.next = 17;\n              break;\n\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](0);\n              console.error(\"Error creating and adding machine:\", _context4.t0);\n              setError(\"Failed to create and add machine.\");\n\n            case 17:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 13]]);\n    }));\n\n    return function handleCreateMachine(_x3) {\n      return _ref6.apply(this, arguments);\n    };\n  }(); // Open the modal to add an existing machine; fetch available machines first\n\n\n  var openAddMachineModal = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return fetchAvailableMachines();\n\n            case 2:\n              setShowAddMachineModal(true);\n\n            case 3:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function openAddMachineModal() {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: styles.page,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: styles.shell,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    className: styles.header,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.brand,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 11\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Magmo\",\n    className: styles.brandLogo,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.brandName,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 15\n    }\n  }, \"Magmo\"), __jsx(\"div\", {\n    className: styles.brandSub,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 15\n    }\n  }, \"Client Detail\"))), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.backButton,\n    onClick: function onClick() {\n      return router.back();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 11\n    }\n  }, \"Back\")), __jsx(\"section\", {\n    className: styles.card,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.cardHeader,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.cardTitle,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 15\n    }\n  }, \"Client Machines\"), __jsx(\"div\", {\n    className: styles.cardSubtitle,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 15\n    }\n  }, \"Manage machines linked to this client.\")), __jsx(\"div\", {\n    className: styles.cardMeta,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 13\n    }\n  }, machineOptions.length, \" machines\")), __jsx(\"div\", {\n    className: styles.cardBody,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 11\n    }\n  }, error && __jsx(Alert, {\n    variant: \"danger\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 23\n    }\n  }, error), isLoading && __jsx(\"div\", {\n    className: styles.loadingWrap,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 15\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    role: \"status\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 17\n    }\n  }, __jsx(\"span\", {\n    className: \"sr-only\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 19\n    }\n  }, \"Loading...\"))), !isLoading && selectedClient && __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: styles.clientSummary,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.clientName,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 19\n    }\n  }, selectedClient.name), __jsx(\"div\", {\n    className: styles.clientMetaRow,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 19\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 21\n    }\n  }, \"Location: \", selectedClient.local || \"Unknown\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 21\n    }\n  }, \"Client ID: \", selectedClient.id))), __jsx(\"div\", {\n    className: styles.actionRow,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 17\n    }\n  }, __jsx(Button, {\n    variant: \"primary\",\n    onClick: openAddMachineModal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 19\n    }\n  }, \"Add Existing Machine\"), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: function onClick() {\n      return setShowCreateMachineModal(true);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 19\n    }\n  }, \"Create New Machine\")), __jsx(\"div\", {\n    className: styles.tableCard,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableHeader,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 19\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 21\n    }\n  }, \"Machines\"), __jsx(\"span\", {\n    className: styles.tableHint,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 21\n    }\n  }, \"Select a machine to view details.\")), __jsx(\"div\", {\n    className: styles.tableWrap,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 19\n    }\n  }, __jsx(Table, {\n    striped: true,\n    bordered: true,\n    hover: true,\n    size: \"sm\",\n    className: styles.table,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 21\n    }\n  }, __jsx(\"thead\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 23\n    }\n  }, __jsx(\"tr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 25\n    }\n  }, __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 27\n    }\n  }, \"Name\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 27\n    }\n  }, \"Location\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 27\n    }\n  }, \"OEM\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 27\n    }\n  }, \"Modality\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 27\n    }\n  }, \"Select\"))), __jsx(\"tbody\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 23\n    }\n  }, machineOptions.length === 0 ? __jsx(\"tr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 27\n    }\n  }, __jsx(\"td\", {\n    colSpan: 5,\n    className: styles.emptyState,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 29\n    }\n  }, \"No machines assigned yet.\")) : machineOptions.map(function (machine) {\n    return __jsx(\"tr\", {\n      key: machine.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 29\n      }\n    }, __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 31\n      }\n    }, machine.name), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 31\n      }\n    }, machine.local), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 31\n      }\n    }, machine.OEM), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 31\n      }\n    }, machine.Modality), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 31\n      }\n    }, __jsx(Button, {\n      variant: \"primary\",\n      size: \"sm\",\n      onClick: function onClick() {\n        return handleSelectMachine(machine.id, machine.name);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 33\n      }\n    }, \"Select\")));\n  }))))))))), __jsx(ClientInfoModal, {\n    show: showAddMachineModal,\n    handleClose: function handleClose() {\n      return setShowAddMachineModal(false);\n    },\n    machineOptions: availableMachines,\n    setSelectedMachine: handleAddMachine,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 7\n    }\n  }), __jsx(MachineCreationModal, {\n    show: showCreateMachineModal,\n    handleClose: function handleClose() {\n      return setShowCreateMachineModal(false);\n    },\n    onCreateMachine: handleCreateMachine,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 7\n    }\n  }));\n};\n\n_s(Client, \"Hfj3M0y9V2+MvXV000cjMZRVz3o=\", false, function () {\n  return [useRouter];\n});\n\n_c = Client;\nexport var __N_SSP = true;\nexport default Client; // Server-side rendering function\n\nvar _c;\n\n$RefreshReg$(_c, \"Client\");","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/client/[id]/index.js"],"names":["React","useEffect","useState","useRouter","Table","Button","Alert","Spinner","firebase","ClientInfoModal","MachineCreationModal","styles","Client","initialClient","initialMachines","initialError","error","router","selectedClient","setSelectedClient","Array","isArray","machineOptions","setMachineOptions","setError","isLoading","setIsLoading","showAddMachineModal","setShowAddMachineModal","showCreateMachineModal","setShowCreateMachineModal","availableMachines","setAvailableMachines","isReady","activeId","query","id","asPath","split","pop","hasInitial","fetchClientData","silent","clientId","db","firestore","collection","doc","get","clientDoc","exists","clientData","data","machineRefs","machines","machinePromises","map","machineRef","Promise","all","machineDocs","machineDoc","console","fetchAvailableMachines","where","snapshot","docs","handleSelectMachine","name","push","handleAddMachine","machine","update","FieldValue","arrayUnion","prev","handleCreateMachine","newMachine","machineId","Math","floor","random","machineWithId","client","set","openAddMachineModal","page","shell","header","brand","brandLogo","brandName","brandSub","backButton","back","card","cardHeader","cardTitle","cardSubtitle","cardMeta","length","cardBody","loadingWrap","clientSummary","clientName","clientMetaRow","local","actionRow","tableCard","tableHeader","tableHint","tableWrap","table","emptyState","OEM","Modality"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport {\n  Table,\n  Button,\n  Alert,\n  Spinner,\n} from \"react-bootstrap\";\nimport firebase from \"../../../../context/Firebase\";\nimport ClientInfoModal from \"../../ClientInfoModal\";\nimport MachineCreationModal from \"../../MachineCreationModal\";\nimport styles from \"../Client.module.css\";\n\n// Import for SSR\nimport { adminDb } from \"../../../../context/FirebaseAdmin\";\n\nconst Client = ({ initialClient, initialMachines, error: initialError }) => {\n  const router = useRouter();\n  const [selectedClient, setSelectedClient] = useState(initialClient || null);\n  const [machineOptions, setMachineOptions] = useState(\n    Array.isArray(initialMachines) ? initialMachines : []\n  );\n  const [error, setError] = useState(initialError || null);\n  const [isLoading, setIsLoading] = useState(\n    !initialClient && !initialError\n  );\n\n  // State for machine addition modals\n  const [showAddMachineModal, setShowAddMachineModal] = useState(false);\n  const [showCreateMachineModal, setShowCreateMachineModal] = useState(false);\n  const [availableMachines, setAvailableMachines] = useState([]);\n\n  useEffect(() => {\n    if (!router.isReady) return;\n    const activeId = router.query.id || router.asPath.split(\"/\").pop();\n    if (!activeId) return;\n    const hasInitial = initialClient && initialClient.id === activeId;\n    fetchClientData(activeId, { silent: hasInitial });\n  }, [router.isReady, router.query.id, initialClient]);\n\n  const fetchClientData = async (clientId, { silent = false } = {}) => {\n    if (!silent) {\n      setIsLoading(true);\n    }\n    setError(null);\n    try {\n      const db = firebase.firestore();\n      const clientDoc = await db.collection(\"Client\").doc(clientId).get();\n      if (clientDoc.exists) {\n        const clientData = clientDoc.data();\n        setSelectedClient({ id: clientId, ...clientData });\n\n        const machineRefs = Array.isArray(clientData.machines)\n          ? clientData.machines\n          : [];\n        const machinePromises = machineRefs.map((machineRef) =>\n          machineRef.get()\n        );\n        const machineDocs = await Promise.all(machinePromises);\n        const machines = machineDocs.map((machineDoc) => ({\n          id: machineDoc.id,\n          ...machineDoc.data(),\n        }));\n        setMachineOptions(machines);\n      } else {\n        setError(\"Client not found\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching client data:\", error);\n      setError(\"Error fetching client data\");\n    } finally {\n      if (!silent) {\n        setIsLoading(false);\n      }\n    }\n  };\n\n  // Fetch available machines (those not yet assigned to a client)\n  const fetchAvailableMachines = async () => {\n    try {\n      const db = firebase.firestore();\n      const snapshot = await db\n        .collection(\"Machine\")\n        .where(\"client\", \"==\", null)\n        .get();\n      const machines = snapshot.docs.map((doc) => ({\n        id: doc.id,\n        ...doc.data(),\n      }));\n      setAvailableMachines(machines);\n    } catch (error) {\n      console.error(\"Error fetching available machines:\", error);\n      setError(\"Failed to fetch available machines.\");\n    }\n  };\n\n  const handleSelectMachine = (id, name) => {\n    // Navigate to the machine details page if needed\n    router.push(\"../machine/\" + id);\n  };\n\n  // When adding an existing machine\n  const handleAddMachine = async (machine) => {\n    try {\n      const db = firebase.firestore();\n      const clientId = router.query.clientId || router.asPath.split(\"/\").pop();\n\n      // Update client's \"machines\" array with the machine reference\n      await db\n        .collection(\"Client\")\n        .doc(clientId)\n        .update({\n          machines: firebase.firestore.FieldValue.arrayUnion(\n            db.collection(\"Machine\").doc(machine.id)\n          ),\n        });\n\n      // Update local state to include the newly added machine\n      setMachineOptions((prev) => [...prev, machine]);\n      setShowAddMachineModal(false);\n    } catch (error) {\n      console.error(\"Error adding machine to client:\", error);\n      setError(\"Failed to add machine to client.\");\n    }\n  };\n\n  // When creating a new machine for the client\n  const handleCreateMachine = async (newMachine) => {\n    try {\n      const db = firebase.firestore();\n      const clientId = router.query.clientId || router.asPath.split(\"/\").pop();\n      const machineId = `AIS${Math.floor(10000 + Math.random() * 90000)}`;\n      const machineWithId = {\n        ...newMachine,\n        id: machineId,\n        client: db.collection(\"Client\").doc(clientId),\n      };\n      // Create the machine document\n      await db.collection(\"Machine\").doc(machineId).set(machineWithId);\n      // Add the machine reference to the client\n      await db\n        .collection(\"Client\")\n        .doc(clientId)\n        .update({\n          machines: firebase.firestore.FieldValue.arrayUnion(\n            db.collection(\"Machine\").doc(machineId)\n          ),\n        });\n      // Update local state\n      setMachineOptions((prev) => [...prev, { id: machineId, ...newMachine }]);\n      setShowCreateMachineModal(false);\n    } catch (error) {\n      console.error(\"Error creating and adding machine:\", error);\n      setError(\"Failed to create and add machine.\");\n    }\n  };\n\n  // Open the modal to add an existing machine; fetch available machines first\n  const openAddMachineModal = async () => {\n    await fetchAvailableMachines();\n    setShowAddMachineModal(true);\n  };\n\n  return (\n    <div className={styles.page}>\n      <div className={styles.shell}>\n        <header className={styles.header}>\n          <div className={styles.brand}>\n            <img src=\"/magmo-logo.png\" alt=\"Magmo\" className={styles.brandLogo} />\n            <div>\n              <div className={styles.brandName}>Magmo</div>\n              <div className={styles.brandSub}>Client Detail</div>\n            </div>\n          </div>\n          <Button\n            variant=\"outline-secondary\"\n            className={styles.backButton}\n            onClick={() => router.back()}\n          >\n            Back\n          </Button>\n        </header>\n\n        <section className={styles.card}>\n          <div className={styles.cardHeader}>\n            <div>\n              <div className={styles.cardTitle}>Client Machines</div>\n              <div className={styles.cardSubtitle}>\n                Manage machines linked to this client.\n              </div>\n            </div>\n            <div className={styles.cardMeta}>\n              {machineOptions.length} machines\n            </div>\n          </div>\n\n          <div className={styles.cardBody}>\n            {error && <Alert variant=\"danger\">{error}</Alert>}\n            {isLoading && (\n              <div className={styles.loadingWrap}>\n                <Spinner animation=\"border\" role=\"status\">\n                  <span className=\"sr-only\">Loading...</span>\n                </Spinner>\n              </div>\n            )}\n\n            {!isLoading && selectedClient && (\n              <>\n                <div className={styles.clientSummary}>\n                  <div className={styles.clientName}>{selectedClient.name}</div>\n                  <div className={styles.clientMetaRow}>\n                    <span>\n                      Location: {selectedClient.local || \"Unknown\"}\n                    </span>\n                    <span>Client ID: {selectedClient.id}</span>\n                  </div>\n                </div>\n\n                <div className={styles.actionRow}>\n                  <Button variant=\"primary\" onClick={openAddMachineModal}>\n                    Add Existing Machine\n                  </Button>\n                  <Button\n                    variant=\"outline-secondary\"\n                    onClick={() => setShowCreateMachineModal(true)}\n                  >\n                    Create New Machine\n                  </Button>\n                </div>\n\n                <div className={styles.tableCard}>\n                  <div className={styles.tableHeader}>\n                    <span>Machines</span>\n                    <span className={styles.tableHint}>\n                      Select a machine to view details.\n                    </span>\n                  </div>\n                  <div className={styles.tableWrap}>\n                    <Table striped bordered hover size=\"sm\" className={styles.table}>\n                      <thead>\n                        <tr>\n                          <th>Name</th>\n                          <th>Location</th>\n                          <th>OEM</th>\n                          <th>Modality</th>\n                          <th>Select</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {machineOptions.length === 0 ? (\n                          <tr>\n                            <td colSpan={5} className={styles.emptyState}>\n                              No machines assigned yet.\n                            </td>\n                          </tr>\n                        ) : (\n                          machineOptions.map((machine) => (\n                            <tr key={machine.id}>\n                              <td>{machine.name}</td>\n                              <td>{machine.local}</td>\n                              <td>{machine.OEM}</td>\n                              <td>{machine.Modality}</td>\n                              <td>\n                                <Button\n                                  variant=\"primary\"\n                                  size=\"sm\"\n                                  onClick={() =>\n                                    handleSelectMachine(machine.id, machine.name)\n                                  }\n                                >\n                                  Select\n                                </Button>\n                              </td>\n                            </tr>\n                          ))\n                        )}\n                      </tbody>\n                    </Table>\n                  </div>\n                </div>\n              </>\n            )}\n          </div>\n        </section>\n      </div>\n\n      {/* Modal to add an existing machine to the client */}\n      <ClientInfoModal\n        show={showAddMachineModal}\n        handleClose={() => setShowAddMachineModal(false)}\n        machineOptions={availableMachines}\n        setSelectedMachine={handleAddMachine}\n      />\n\n      {/* Modal to create a new machine and attach it to the client */}\n      <MachineCreationModal\n        show={showCreateMachineModal}\n        handleClose={() => setShowCreateMachineModal(false)}\n        onCreateMachine={handleCreateMachine}\n      />\n    </div>\n  );\n};\n\nexport default Client;\n\n// Server-side rendering function\nexport async function getServerSideProps(context) {\n  const { id } = context.params;\n\n  try {\n    // Fetch client data from Firestore using Admin SDK\n    const clientDoc = await adminDb.collection(\"Client\").doc(id).get();\n\n    if (!clientDoc.exists) {\n      return {\n        notFound: true, // This will show a 404 page\n      };\n    }\n\n    const clientData = clientDoc.data();\n\n    // Fetch machine documents referenced in the client's machines array\n    let machines = [];\n    if (clientData.machines && Array.isArray(clientData.machines)) {\n      try {\n        const machinePromises = clientData.machines\n          .map((machineRef) => {\n            if (machineRef.path) {\n              return adminDb.doc(machineRef.path).get();\n            }\n            return null;\n          })\n          .filter(Boolean);\n\n        const machineDocs = await Promise.all(machinePromises);\n        machines = machineDocs.map((machineDoc) => {\n          const machineData = machineDoc.data();\n          // Extract only serializable data, remove any Firestore references\n          const serializedMachine = {\n            id: machineDoc.id,\n            name: machineData.name || \"\",\n            local: machineData.local || \"\",\n            OEM: machineData.OEM || \"\",\n            Modality: machineData.Modality || \"\",\n            Model: machineData.Model || \"\",\n            // Add other fields as needed, but ensure they're serializable\n          };\n\n          // If there's a client reference, extract just the client name\n          if (machineData.client && machineData.client.path) {\n            try {\n              const clientDoc = adminDb.doc(machineData.client.path).get();\n              if (clientDoc.exists) {\n                serializedMachine.clientName = clientDoc.data().name || \"\";\n              }\n            } catch (error) {\n              console.error(\"Error fetching client name:\", error);\n            }\n          }\n\n          return serializedMachine;\n        });\n      } catch (error) {\n        console.error(\"Error fetching machine data:\", error);\n      }\n    }\n\n    // Serialize the client data, removing any non-serializable fields\n    const serializedClient = {\n      id,\n      name: clientData.name || \"\",\n      local: clientData.local || \"\",\n      // Add other client fields as needed, but ensure they're serializable\n    };\n\n    return {\n      props: {\n        initialClient: serializedClient,\n        initialMachines: machines,\n      },\n    };\n  } catch (error) {\n    console.error(\"Error in getServerSideProps:\", error);\n    return {\n      props: {\n        error: \"Failed to load client data\",\n      },\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"module"}