{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n// pages/index.js\nimport Head from \"next/head\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Card, Container, Alert } from \"react-bootstrap\";\nimport styles from \"../styles/Home.module.css\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../context/Firebase\"; // compat default export ONLY\n\nexport default function Home() {\n  var router = useRouter();\n\n  var _useState = useState(\"\"),\n      error = _useState[0],\n      setError = _useState[1];\n\n  var _useState2 = useState(false),\n      hasMounted = _useState2[0],\n      setHasMounted = _useState2[1];\n\n  var _useState3 = useState(false),\n      authReady = _useState3[0],\n      setAuthReady = _useState3[1];\n\n  var unsubRef = useRef(null);\n\n  var getDestination = function getDestination() {\n    var _router$query;\n\n    var q = router === null || router === void 0 ? void 0 : (_router$query = router.query) === null || _router$query === void 0 ? void 0 : _router$query.redirect;\n    return Array.isArray(q) ? q[0] || \"/NewSearch/mainSearch\" : q || \"/NewSearch/mainSearch\";\n  };\n\n  var isIosSafari = function isIosSafari() {\n    if (typeof navigator === \"undefined\") return false;\n    var ua = navigator.userAgent;\n    var isIOS = /iP(hone|ad|od)/i.test(ua);\n    var isSafari = /Safari/i.test(ua) && !/Chrome|CriOS|FxiOS|EdgiOS/i.test(ua);\n    return isIOS && isSafari;\n  };\n\n  useEffect(function () {\n    return setHasMounted(true);\n  }, []); // One-time auth listener\n\n  useEffect(function () {\n    if (!hasMounted) return;\n\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);\n\n            case 3:\n              // simple storage probe to detect hostile environments\n              try {\n                localStorage.setItem(\"__magmo_probe\", \"1\");\n              } catch (e) {\n                console.warn(\"[auth] localStorage not available; redirects may fail\");\n              }\n\n              unsubRef.current = firebase.auth().onAuthStateChanged(function (user) {\n                console.log(\"[auth] onAuthStateChanged:\", user);\n                setAuthReady(true);\n\n                if (user) {\n                  var dest = getDestination();\n                  router.replace(dest);\n                }\n              });\n              _context.next = 11;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(\"[auth] persistence setup error:\", _context.t0);\n              setError(\"Authentication init failed.\");\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 7]]);\n    }))();\n\n    return function () {\n      if (unsubRef.current) unsubRef.current();\n    };\n  }, [hasMounted, router]);\n  if (!hasMounted) return null;\n\n  var handleGoogleSignIn = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var provider, result, dest;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setError(\"\");\n              _context2.prev = 1;\n              _context2.next = 4;\n              return firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);\n\n            case 4:\n              provider = new firebase.auth.GoogleAuthProvider();\n              provider.addScope(\"email\");\n              provider.addScope(\"profile\");\n              provider.setCustomParameters({\n                prompt: \"select_account\"\n              }); // prefer popup (no redirect state), fallback to redirect only where needed\n\n              if (!isIosSafari()) {\n                _context2.next = 15;\n                break;\n              }\n\n              console.log(\"[auth] Using redirect (iOS Safari)\"); // mark that we attempted sign-in (to detect storage loss)\n\n              try {\n                localStorage.setItem(\"__magmo_signin_attempt\", Date.now().toString());\n              } catch (_) {}\n\n              _context2.next = 13;\n              return firebase.auth().signInWithRedirect(provider);\n\n            case 13:\n              _context2.next = 21;\n              break;\n\n            case 15:\n              console.log(\"[auth] Using popup\");\n              _context2.next = 18;\n              return firebase.auth().signInWithPopup(provider);\n\n            case 18:\n              result = _context2.sent;\n              console.log(\"[auth] popup result:\", result && result.user); // onAuthStateChanged will route; but we can route immediately too:\n\n              if (result && result.user) {\n                dest = getDestination();\n                router.replace(dest);\n              }\n\n            case 21:\n              _context2.next = 27;\n              break;\n\n            case 23:\n              _context2.prev = 23;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.error(\"[auth] sign-in error:\", _context2.t0);\n              setError(\"Failed to log in with Google: \" + (_context2.t0 && _context2.t0.message ? _context2.t0.message : String(_context2.t0)));\n\n            case 27:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 23]]);\n    }));\n\n    return function handleGoogleSignIn() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleTestLogin = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var password;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setError(\"\");\n              password = prompt(\"Enter password:\");\n\n              if (password) {\n                _context3.next = 4;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 4:\n              _context3.prev = 4;\n              _context3.next = 7;\n              return firebase.auth().signInWithEmailAndPassword(\"test@test.com\", password);\n\n            case 7:\n              router.replace(\"/NewSearch/searchTest\");\n              _context3.next = 13;\n              break;\n\n            case 10:\n              _context3.prev = 10;\n              _context3.t0 = _context3[\"catch\"](4);\n              setError(\"Test login failed: \" + (_context3.t0 && _context3.t0.message ? _context3.t0.message : String(_context3.t0)));\n\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[4, 10]]);\n    }));\n\n    return function handleTestLogin() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(\"div\", {\n    className: styles.container\n  }, __jsx(Head, null, __jsx(\"title\", null, \"magmo\"), __jsx(\"link\", {\n    rel: \"icon\",\n    href: \"/favicon.ico\"\n  }), __jsx(\"meta\", {\n    name: \"viewport\",\n    content: \"width=device-width, initial-scale=1.0\"\n  })), __jsx(Container, {\n    className: \"d-flex align-items-center justify-content-center\",\n    style: {\n      minHeight: \"100vh\"\n    }\n  }, __jsx(\"div\", {\n    className: \"w-100\",\n    style: {\n      maxWidth: \"400px\"\n    }\n  }, __jsx(Card, null, __jsx(Card.Body, null, __jsx(\"div\", {\n    className: \"text-center mb-4\",\n    style: {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      width: \"100%\"\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo.png\",\n    alt: \"Magmo Logo\",\n    style: {\n      width: \"100%\",\n      maxWidth: \"400px\",\n      // adjust this if needed\n      height: \"auto\",\n      objectFit: \"contain\"\n    }\n  })), !authReady && __jsx(\"div\", {\n    className: \"mb-2 small text-muted\"\n  }, \"Initializing\\u2026\"), error && __jsx(Alert, {\n    variant: \"danger\"\n  }, error), __jsx(Button, {\n    variant: \"light\",\n    className: \"w-100 d-flex align-items-center justify-content-center\",\n    onClick: handleGoogleSignIn,\n    style: {\n      border: \"1px solid #dadce0\",\n      borderRadius: \"0.375rem\",\n      color: \"#757575\",\n      padding: \"0.5rem 1rem\"\n    }\n  }, __jsx(\"img\", {\n    src: \"https://www.svgrepo.com/show/355037/google.svg\",\n    alt: \"Google logo\",\n    width: \"20\",\n    height: \"20\",\n    className: \"me-2\"\n  }), \"Sign in with Google\"), __jsx(Button, {\n    variant: \"secondary\",\n    className: \"w-100 mt-3\",\n    onClick: handleTestLogin\n  }, \"Test Login\"))))));\n}","map":null,"metadata":{},"sourceType":"module"}