{"ast":null,"code":"import fs from \"fs\";\nimport { initializeApp, getApps, cert } from \"firebase-admin/app\";\nimport { getFirestore } from \"firebase-admin/firestore\"; // Import Firebase Functions for config access\n\nlet functions;\n\ntry {\n  functions = require(\"firebase-functions\");\n} catch (error) {\n  // Not running in Firebase Functions environment\n  functions = null;\n} // Initialize Firebase Admin if it hasn't been initialized\n\n\nif (!getApps().length) {\n  var _serviceAccount, _functions$config$adm, _functions$config$ssr, _serviceAccount2, _functions$config$adm2, _functions$config$ssr2, _serviceAccount3;\n\n  const serviceAccountPath = process.env.FIREBASE_ADMIN_SERVICE_ACCOUNT_PATH || process.env.FIREBASE_SERVICE_ACCOUNT_PATH;\n  let serviceAccount = null;\n\n  if (serviceAccountPath) {\n    try {\n      const raw = fs.readFileSync(serviceAccountPath, \"utf8\");\n      serviceAccount = JSON.parse(raw);\n    } catch (error) {\n      console.warn(\"Firebase Admin service account file could not be loaded:\", error.message);\n    }\n  }\n\n  const clientEmail = process.env.FIREBASE_CLIENT_EMAIL || process.env.FIREBASE_FUNCTIONS_CLIENT_EMAIL || process.env.FIREBASE_ADMIN_CLIENT_EMAIL || ((_serviceAccount = serviceAccount) === null || _serviceAccount === void 0 ? void 0 : _serviceAccount.client_email) || (functions ? ((_functions$config$adm = functions.config().admin) === null || _functions$config$adm === void 0 ? void 0 : _functions$config$adm.client_email) || ((_functions$config$ssr = functions.config().ssr) === null || _functions$config$ssr === void 0 ? void 0 : _functions$config$ssr.firebase_client_email) : undefined);\n  const privateKey = process.env.FIREBASE_PRIVATE_KEY || process.env.FIREBASE_FUNCTIONS_PRIVATE_KEY || process.env.FIREBASE_ADMIN_PRIVATE_KEY || ((_serviceAccount2 = serviceAccount) === null || _serviceAccount2 === void 0 ? void 0 : _serviceAccount2.private_key) || (functions ? ((_functions$config$adm2 = functions.config().admin) === null || _functions$config$adm2 === void 0 ? void 0 : _functions$config$adm2.private_key) || ((_functions$config$ssr2 = functions.config().ssr) === null || _functions$config$ssr2 === void 0 ? void 0 : _functions$config$ssr2.firebase_private_key) : undefined);\n  const projectId = process.env.FIREBASE_ADMIN_PROJECT_ID || process.env.FIREBASE_PROJECT_ID || ((_serviceAccount3 = serviceAccount) === null || _serviceAccount3 === void 0 ? void 0 : _serviceAccount3.project_id) || \"magmo-ac10c\";\n  const hasExplicitAdminCreds = Boolean(clientEmail && privateKey);\n  const isGoogleRuntime = Boolean(process.env.K_SERVICE || process.env.FUNCTION_TARGET || process.env.GAE_ENV || process.env.GOOGLE_CLOUD_PROJECT);\n  const canUseAdc = isGoogleRuntime || Boolean(process.env.GOOGLE_APPLICATION_CREDENTIALS);\n\n  try {\n    if (hasExplicitAdminCreds) {\n      initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail: clientEmail,\n          privateKey: privateKey.replace(/\\\\n/g, \"\\n\")\n        }),\n        databaseURL: \"https://magmo-ac10c.firebaseio.com\"\n      });\n    } else if (canUseAdc) {\n      // Fall back to Application Default Credentials (e.g. Cloud Functions/Run)\n      initializeApp({\n        projectId,\n        databaseURL: \"https://magmo-ac10c.firebaseio.com\"\n      });\n    } else {\n      console.warn(\"Firebase Admin not initialized: missing service account credentials in local environment.\");\n    }\n  } catch (error) {\n    console.warn(\"Firebase Admin initialization failed:\", error.message); // Don't throw error during build process\n  }\n} // Only export Firestore if Firebase Admin is properly initialized\n\n\nlet adminDb = null;\n\ntry {\n  if (getApps().length > 0) {\n    adminDb = getFirestore();\n  }\n} catch (error) {\n  console.warn(\"Firebase Admin not available:\", error.message);\n}\n\nexport { adminDb };\nexport default adminDb;","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/context/FirebaseAdmin.js"],"names":["fs","initializeApp","getApps","cert","getFirestore","functions","require","error","length","serviceAccountPath","process","env","FIREBASE_ADMIN_SERVICE_ACCOUNT_PATH","FIREBASE_SERVICE_ACCOUNT_PATH","serviceAccount","raw","readFileSync","JSON","parse","console","warn","message","clientEmail","FIREBASE_CLIENT_EMAIL","FIREBASE_FUNCTIONS_CLIENT_EMAIL","FIREBASE_ADMIN_CLIENT_EMAIL","client_email","config","admin","ssr","firebase_client_email","undefined","privateKey","FIREBASE_PRIVATE_KEY","FIREBASE_FUNCTIONS_PRIVATE_KEY","FIREBASE_ADMIN_PRIVATE_KEY","private_key","firebase_private_key","projectId","FIREBASE_ADMIN_PROJECT_ID","FIREBASE_PROJECT_ID","project_id","hasExplicitAdminCreds","Boolean","isGoogleRuntime","K_SERVICE","FUNCTION_TARGET","GAE_ENV","GOOGLE_CLOUD_PROJECT","canUseAdc","GOOGLE_APPLICATION_CREDENTIALS","credential","replace","databaseURL","adminDb"],"mappings":"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","sourcesContent":["import fs from \"fs\";\nimport { initializeApp, getApps, cert } from \"firebase-admin/app\";\nimport { getFirestore } from \"firebase-admin/firestore\";\n\r\n// Import Firebase Functions for config access\r\nlet functions;\r\ntry {\r\n  functions = require(\"firebase-functions\");\r\n} catch (error) {\r\n  // Not running in Firebase Functions environment\r\n  functions = null;\r\n}\r\n\r\n// Initialize Firebase Admin if it hasn't been initialized\nif (!getApps().length) {\n  const serviceAccountPath =\n    process.env.FIREBASE_ADMIN_SERVICE_ACCOUNT_PATH ||\n    process.env.FIREBASE_SERVICE_ACCOUNT_PATH;\n  let serviceAccount = null;\n  if (serviceAccountPath) {\n    try {\n      const raw = fs.readFileSync(serviceAccountPath, \"utf8\");\n      serviceAccount = JSON.parse(raw);\n    } catch (error) {\n      console.warn(\n        \"Firebase Admin service account file could not be loaded:\",\n        error.message\n      );\n    }\n  }\n\n  const clientEmail =\n    process.env.FIREBASE_CLIENT_EMAIL ||\n    process.env.FIREBASE_FUNCTIONS_CLIENT_EMAIL ||\n    process.env.FIREBASE_ADMIN_CLIENT_EMAIL ||\n    serviceAccount?.client_email ||\n    (functions\n      ? functions.config().admin?.client_email ||\n        functions.config().ssr?.firebase_client_email\n      : undefined);\n\r\n  const privateKey =\n    process.env.FIREBASE_PRIVATE_KEY ||\n    process.env.FIREBASE_FUNCTIONS_PRIVATE_KEY ||\n    process.env.FIREBASE_ADMIN_PRIVATE_KEY ||\n    serviceAccount?.private_key ||\n    (functions\n      ? functions.config().admin?.private_key ||\n        functions.config().ssr?.firebase_private_key\n      : undefined);\n\n  const projectId =\n    process.env.FIREBASE_ADMIN_PROJECT_ID ||\n    process.env.FIREBASE_PROJECT_ID ||\n    serviceAccount?.project_id ||\n    \"magmo-ac10c\";\n  const hasExplicitAdminCreds = Boolean(clientEmail && privateKey);\r\n  const isGoogleRuntime = Boolean(\r\n    process.env.K_SERVICE ||\r\n      process.env.FUNCTION_TARGET ||\r\n      process.env.GAE_ENV ||\r\n      process.env.GOOGLE_CLOUD_PROJECT\r\n  );\r\n  const canUseAdc =\r\n    isGoogleRuntime || Boolean(process.env.GOOGLE_APPLICATION_CREDENTIALS);\r\n\r\n  try {\r\n    if (hasExplicitAdminCreds) {\n      initializeApp({\n        credential: cert({\n          projectId,\n          clientEmail: clientEmail,\n          privateKey: privateKey.replace(/\\\\n/g, \"\\n\"),\n        }),\n        databaseURL: \"https://magmo-ac10c.firebaseio.com\",\n      });\n    } else if (canUseAdc) {\n      // Fall back to Application Default Credentials (e.g. Cloud Functions/Run)\n      initializeApp({\n        projectId,\n        databaseURL: \"https://magmo-ac10c.firebaseio.com\",\n      });\n    } else {\r\n      console.warn(\r\n        \"Firebase Admin not initialized: missing service account credentials in local environment.\"\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.warn(\"Firebase Admin initialization failed:\", error.message);\r\n    // Don't throw error during build process\r\n  }\r\n}\r\n\r\n// Only export Firestore if Firebase Admin is properly initialized\r\nlet adminDb = null;\r\ntry {\r\n  if (getApps().length > 0) {\r\n    adminDb = getFirestore();\r\n  }\r\n} catch (error) {\r\n  console.warn(\"Firebase Admin not available:\", error.message);\r\n}\r\n\r\nexport { adminDb };\r\nexport default adminDb;\r\n"]},"metadata":{},"sourceType":"module"}