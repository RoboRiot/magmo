{"ast":null,"code":"import _slicedToArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\machine\\\\[id]\\\\index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { Table, Button, Alert } from \"react-bootstrap\";\nimport firebase from \"../../../../context/Firebase\";\nimport styles from \"../Machine.module.css\"; // Import for SSR\n\nvar Machine = function Machine(_ref) {\n  _s();\n\n  var initialMachine = _ref.initialMachine,\n      initialAssociatedParts = _ref.initialAssociatedParts,\n      initialError = _ref.error;\n  var router = useRouter();\n\n  var _useState = useState(initialMachine || null),\n      selectedMachine = _useState[0],\n      setSelectedMachine = _useState[1];\n\n  var _useState2 = useState(Array.isArray(initialAssociatedParts) ? initialAssociatedParts : []),\n      associatedParts = _useState2[0],\n      setAssociatedParts = _useState2[1];\n\n  var _useState3 = useState(initialError || null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(null),\n      dragIndex = _useState4[0],\n      setDragIndex = _useState4[1];\n\n  var _useState5 = useState(null),\n      dragOverIndex = _useState5[0],\n      setDragOverIndex = _useState5[1];\n\n  useEffect(function () {\n    if (router.isReady) {\n      var id = router.query.id;\n\n      if (!id) {\n        var pathSegments = router.asPath.split(\"/\");\n        var machineIdFromPath = pathSegments[pathSegments.length - 1];\n        console.log(\"Machine ID extracted from URL path: \".concat(machineIdFromPath));\n        fetchMachineData(machineIdFromPath);\n      } else {\n        console.log(\"Machine ID from router query: \".concat(id)); // If SSR already hydrated, avoid re-fetching unless we truly need to.\n\n        if (!selectedMachine) {\n          fetchMachineData(id);\n        }\n      }\n    }\n  }, [router.isReady, selectedMachine]);\n\n  var fetchMachineData = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(machineId) {\n      var db, machineDoc, machineData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              console.log(\"Attempting to fetch machine data for ID: \".concat(machineId));\n              db = firebase.firestore();\n              _context.next = 5;\n              return db.collection(\"Machine\").doc(machineId).get();\n\n            case 5:\n              machineDoc = _context.sent;\n\n              if (machineDoc.exists) {\n                machineData = machineDoc.data();\n                setSelectedMachine(machineData);\n                setError(null);\n                console.log(\"Machine data:\", machineData); // Fetch associated parts\n\n                if (machineData.associatedParts) {\n                  fetchAssociatedParts(machineData.associatedParts);\n                }\n              } else {\n                console.error(\"Machine not found\");\n                setError(\"Machine not found\");\n              }\n\n              _context.next = 13;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(\"Error fetching machine data:\", _context.t0);\n              setError(\"Error fetching machine data\");\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 9]]);\n    }));\n\n    return function fetchMachineData(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var fetchAssociatedParts = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(associatedPartsRefs) {\n      var db, partsDocs, partsData;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              db = firebase.firestore();\n              _context3.next = 4;\n              return Promise.all(associatedPartsRefs.map(function (ref) {\n                return ref.get();\n              }));\n\n            case 4:\n              partsDocs = _context3.sent;\n              _context3.next = 7;\n              return Promise.all(partsDocs.map( /*#__PURE__*/function () {\n                var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(doc) {\n                  var _data$ClientFrom;\n\n                  var data, clientName, clientDoc;\n                  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                    while (1) {\n                      switch (_context2.prev = _context2.next) {\n                        case 0:\n                          if (doc.exists) {\n                            _context2.next = 2;\n                            break;\n                          }\n\n                          return _context2.abrupt(\"return\", null);\n\n                        case 2:\n                          data = doc.data() || {};\n                          clientName = \"\";\n\n                          if (!((_data$ClientFrom = data.ClientFrom) !== null && _data$ClientFrom !== void 0 && _data$ClientFrom.get)) {\n                            _context2.next = 9;\n                            break;\n                          }\n\n                          _context2.next = 7;\n                          return data.ClientFrom.get();\n\n                        case 7:\n                          clientDoc = _context2.sent;\n                          clientName = clientDoc.exists ? clientDoc.data().name : \"\";\n\n                        case 9:\n                          return _context2.abrupt(\"return\", _objectSpread(_objectSpread({\n                            id: doc.id\n                          }, data), {}, {\n                            clientName: clientName\n                          }));\n\n                        case 10:\n                        case \"end\":\n                          return _context2.stop();\n                      }\n                    }\n                  }, _callee2);\n                }));\n\n                return function (_x3) {\n                  return _ref4.apply(this, arguments);\n                };\n              }()));\n\n            case 7:\n              partsData = _context3.sent;\n              setAssociatedParts(partsData.filter(function (p) {\n                return p;\n              }));\n              setError(null);\n              console.log(\"Associated parts data:\", partsData);\n              _context3.next = 17;\n              break;\n\n            case 13:\n              _context3.prev = 13;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(\"Error fetching associated parts:\", _context3.t0);\n              setError(\"Error fetching associated parts\");\n\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 13]]);\n    }));\n\n    return function fetchAssociatedParts(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handlePrintMulti = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var payload, response, result;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              // Create your payload with the mapped items.\n              // Replace 'associatedParts' with your actual variable containing the list.\n              payload = {\n                items: associatedParts.map(function (part) {\n                  return {\n                    name: part.name,\n                    arrival_date: part.arrival_date,\n                    // Ensure your part has a 'date' field.\n                    poNumber: part.poNumber || \"\",\n                    OEM: part.TheMachine ? part.TheMachine.oem || \"\" : \"\",\n                    modality: part.TheMachine ? part.TheMachine.modality || \"\" : \"\",\n                    model: part.TheMachine ? part.TheMachine.model || \"\" : \"\",\n                    local_sn: part.id,\n                    // Using document id as the local serial number.\n                    client: part.clientName || \"\",\n                    description: part.description || (part.descriptions && part.descriptions.length > 0 ? part.descriptions[0].description : \"\")\n                  };\n                }),\n                test_print: true,\n                // Hard-coded here if you want to test printing one item\n                index: 1 // Hard-coded index (1-based)\n\n              };\n              _context4.prev = 1;\n              _context4.next = 4;\n              return fetch(\"https://9d70-174-76-22-138.ngrok-free.app/print_multi\", {\n                method: \"POST\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(payload)\n              });\n\n            case 4:\n              response = _context4.sent;\n              _context4.next = 7;\n              return response.json();\n\n            case 7:\n              result = _context4.sent;\n              console.log(\"Print multi result:\", result.status);\n              _context4.next = 14;\n              break;\n\n            case 11:\n              _context4.prev = 11;\n              _context4.t0 = _context4[\"catch\"](1);\n              console.error(\"Error printing multiple labels:\", _context4.t0);\n\n            case 14:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[1, 11]]);\n    }));\n\n    return function handlePrintMulti() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var handleSelectPart = function handleSelectPart(id, name) {\n    console.log(\"Selected part ID: \".concat(id, \", Name: \").concat(name));\n    router.push(\"../item/\" + id);\n  };\n\n  var handleDragStart = function handleDragStart(index) {\n    return function (event) {\n      var _associatedParts$inde;\n\n      if (event.target.closest(\"button\")) {\n        event.preventDefault();\n        return;\n      }\n\n      setDragIndex(index);\n      event.dataTransfer.effectAllowed = \"move\";\n      event.dataTransfer.setData(\"text/plain\", ((_associatedParts$inde = associatedParts[index]) === null || _associatedParts$inde === void 0 ? void 0 : _associatedParts$inde.id) || String(index));\n    };\n  };\n\n  var handleDragOver = function handleDragOver(index) {\n    return function (event) {\n      event.preventDefault();\n      if (dragOverIndex !== index) setDragOverIndex(index);\n      event.dataTransfer.dropEffect = \"move\";\n    };\n  };\n\n  var handleDrop = function handleDrop(index) {\n    return function (event) {\n      event.preventDefault();\n\n      if (dragIndex == null || dragIndex === index) {\n        setDragIndex(null);\n        setDragOverIndex(null);\n        return;\n      }\n\n      setAssociatedParts(function (prev) {\n        var next = _toConsumableArray(prev);\n\n        var _next$splice = next.splice(dragIndex, 1),\n            _next$splice2 = _slicedToArray(_next$splice, 1),\n            moved = _next$splice2[0];\n\n        next.splice(index, 0, moved);\n        return next;\n      });\n      setDragIndex(null);\n      setDragOverIndex(null);\n    };\n  };\n\n  var handleDragEnd = function handleDragEnd() {\n    setDragIndex(null);\n    setDragOverIndex(null);\n  };\n\n  var formatDate = function formatDate(input) {\n    var date;\n\n    if (input && input.seconds) {\n      // Handle timestamp object with 'seconds' property\n      date = new Date(input.seconds * 1000);\n    } else if (typeof input === \"string\") {\n      // Handle date string\n      date = new Date(input);\n    } else {\n      return \"N/A\";\n    }\n\n    if (isNaN(date.getTime())) {\n      // Invalid date string\n      return \"Invalid Date\";\n    }\n\n    return date.toLocaleDateString();\n  };\n\n  return __jsx(\"div\", {\n    className: styles.page,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: styles.shell,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }\n  }, __jsx(\"header\", {\n    className: styles.header,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.brand,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 11\n    }\n  }, __jsx(\"img\", {\n    src: \"/magmo-logo.png\",\n    alt: \"Magmo\",\n    className: styles.brandLogo,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.brandName,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 15\n    }\n  }, \"Magmo\"), __jsx(\"div\", {\n    className: styles.brandSub,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 15\n    }\n  }, \"Machine Detail\"))), __jsx(Button, {\n    variant: \"outline-secondary\",\n    className: styles.backButton,\n    onClick: function onClick() {\n      return router.back();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 11\n    }\n  }, \"Back\")), __jsx(\"div\", {\n    className: styles.card,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: styles.cardHeader,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.cardTitle,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 15\n    }\n  }, \"Machine Details\"), __jsx(\"div\", {\n    className: styles.cardSubtitle,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 15\n    }\n  }, \"Drag and drop parts to reorder this list.\")), __jsx(\"div\", {\n    className: styles.cardMeta,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }\n  }, associatedParts.length, \" parts\")), __jsx(\"div\", {\n    className: styles.cardBody,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 11\n    }\n  }, error && __jsx(Alert, {\n    variant: \"danger\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 23\n    }\n  }, error), selectedMachine ? __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: styles.machineGrid,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.machineInfo,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    className: styles.machineName,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 21\n    }\n  }, selectedMachine.name || \"Unnamed Machine\"), __jsx(\"div\", {\n    className: styles.machineMetaRow,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 21\n    }\n  }, __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 23\n    }\n  }, \"OEM: \", selectedMachine.OEM || \"N/A\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 23\n    }\n  }, \"Modality: \", selectedMachine.Modality || \"N/A\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 23\n    }\n  }, \"Model: \", selectedMachine.Model || \"N/A\"))), __jsx(\"div\", {\n    className: styles.machineDates,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 19\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 21\n    }\n  }, __jsx(\"span\", {\n    className: styles.dateLabel,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 23\n    }\n  }, \"Last PM\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 23\n    }\n  }, formatDate(selectedMachine.lastPM))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 21\n    }\n  }, __jsx(\"span\", {\n    className: styles.dateLabel,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 23\n    }\n  }, \"Next PM\"), __jsx(\"span\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 23\n    }\n  }, formatDate(selectedMachine.nextPM))))), __jsx(\"div\", {\n    className: styles.tableCard,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 17\n    }\n  }, __jsx(\"div\", {\n    className: styles.tableHeader,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 19\n    }\n  }, \"Associated Parts\", __jsx(\"span\", {\n    className: styles.tableHint,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 21\n    }\n  }, \"Click + hold to move\")), __jsx(\"div\", {\n    className: styles.tableWrap,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 19\n    }\n  }, __jsx(Table, {\n    striped: true,\n    bordered: true,\n    hover: true,\n    size: \"sm\",\n    className: styles.table,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 21\n    }\n  }, __jsx(\"thead\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 23\n    }\n  }, __jsx(\"tr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 25\n    }\n  }, __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 27\n    }\n  }, \"Name\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 27\n    }\n  }, \"ID\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 27\n    }\n  }, \"Part Number\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 27\n    }\n  }, \"Serial Number\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 27\n    }\n  }, \"Date\"), __jsx(\"th\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 27\n    }\n  }, \"Select\"))), __jsx(\"tbody\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 23\n    }\n  }, associatedParts.length === 0 && __jsx(\"tr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 27\n    }\n  }, __jsx(\"td\", {\n    colSpan: 6,\n    className: styles.emptyState,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 294,\n      columnNumber: 29\n    }\n  }, \"No associated parts found.\")), associatedParts.map(function (part, index) {\n    return __jsx(\"tr\", {\n      key: part.id,\n      draggable: true,\n      onDragStart: handleDragStart(index),\n      onDragOver: handleDragOver(index),\n      onDrop: handleDrop(index),\n      onDragEnd: handleDragEnd,\n      className: \"\".concat(styles.draggableRow, \" \").concat(dragIndex === index ? styles.dragging : \"\", \" \").concat(dragOverIndex === index && dragIndex !== index ? styles.dropTarget : \"\"),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 27\n      }\n    }, __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 29\n      }\n    }, part.name), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 29\n      }\n    }, part.id), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 29\n      }\n    }, part.pn), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 29\n      }\n    }, part.sn), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 29\n      }\n    }, formatDate(part.date || part.arrival_date)), __jsx(\"td\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 29\n      }\n    }, __jsx(Button, {\n      variant: \"primary\",\n      size: \"sm\",\n      onClick: function onClick() {\n        return handleSelectPart(part.id, part.name);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 31\n      }\n    }, \"Select\")));\n  })))), __jsx(\"div\", {\n    className: styles.tableActions,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 19\n    }\n  }, __jsx(Button, {\n    variant: \"secondary\",\n    className: styles.actionButton,\n    onClick: handlePrintMulti,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 21\n    }\n  }, \"Print All Items\")))) : !error && __jsx(\"p\", {\n    className: styles.loadingText,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 25\n    }\n  }, \"Loading machine data...\")))));\n};\n\n_s(Machine, \"tefOoioLXddFRGvrRqXEPHU3VCs=\", false, function () {\n  return [useRouter];\n});\n\n_c = Machine;\nexport var __N_SSP = true;\nexport default Machine; // Server-side rendering function\n\nvar _c;\n\n$RefreshReg$(_c, \"Machine\");","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/machine/[id]/index.js"],"names":["React","useEffect","useState","useRouter","Table","Button","Alert","firebase","styles","Machine","initialMachine","initialAssociatedParts","initialError","error","router","selectedMachine","setSelectedMachine","Array","isArray","associatedParts","setAssociatedParts","setError","dragIndex","setDragIndex","dragOverIndex","setDragOverIndex","isReady","id","query","pathSegments","asPath","split","machineIdFromPath","length","console","log","fetchMachineData","machineId","db","firestore","collection","doc","get","machineDoc","exists","machineData","data","fetchAssociatedParts","associatedPartsRefs","Promise","all","map","ref","partsDocs","clientName","ClientFrom","clientDoc","name","partsData","filter","p","handlePrintMulti","payload","items","part","arrival_date","poNumber","OEM","TheMachine","oem","modality","model","local_sn","client","description","descriptions","test_print","index","fetch","method","headers","body","JSON","stringify","response","json","result","status","handleSelectPart","push","handleDragStart","event","target","closest","preventDefault","dataTransfer","effectAllowed","setData","String","handleDragOver","dropEffect","handleDrop","prev","next","splice","moved","handleDragEnd","formatDate","input","date","seconds","Date","isNaN","getTime","toLocaleDateString","page","shell","header","brand","brandLogo","brandName","brandSub","backButton","back","card","cardHeader","cardTitle","cardSubtitle","cardMeta","cardBody","machineGrid","machineInfo","machineName","machineMetaRow","Modality","Model","machineDates","dateLabel","lastPM","nextPM","tableCard","tableHeader","tableHint","tableWrap","table","emptyState","draggableRow","dragging","dropTarget","pn","sn","tableActions","actionButton","loadingText"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport {\n  Table,\n  Button,\n  Alert,\n} from \"react-bootstrap\";\nimport firebase from \"../../../../context/Firebase\";\nimport styles from \"../Machine.module.css\";\n\n// Import for SSR\nimport { adminDb } from \"../../../../context/FirebaseAdmin\";\n\nconst Machine = ({ initialMachine, initialAssociatedParts, error: initialError }) => {\n  const router = useRouter();\n  const [selectedMachine, setSelectedMachine] = useState(\n    initialMachine || null\n  );\n  const [associatedParts, setAssociatedParts] = useState(\n    Array.isArray(initialAssociatedParts) ? initialAssociatedParts : []\n  );\n  const [error, setError] = useState(initialError || null);\n  const [dragIndex, setDragIndex] = useState(null);\n  const [dragOverIndex, setDragOverIndex] = useState(null);\n\n  useEffect(() => {\n    if (router.isReady) {\n      const { id } = router.query;\n      if (!id) {\n        const pathSegments = router.asPath.split(\"/\");\n        const machineIdFromPath = pathSegments[pathSegments.length - 1];\n        console.log(`Machine ID extracted from URL path: ${machineIdFromPath}`);\n        fetchMachineData(machineIdFromPath);\n      } else {\n        console.log(`Machine ID from router query: ${id}`);\n        // If SSR already hydrated, avoid re-fetching unless we truly need to.\n        if (!selectedMachine) {\n          fetchMachineData(id);\n        }\n      }\n    }\n  }, [router.isReady, selectedMachine]);\n\n  const fetchMachineData = async (machineId) => {\n    try {\n      console.log(`Attempting to fetch machine data for ID: ${machineId}`);\n      const db = firebase.firestore();\n      const machineDoc = await db.collection(\"Machine\").doc(machineId).get();\n      if (machineDoc.exists) {\n        const machineData = machineDoc.data();\n        setSelectedMachine(machineData);\n        setError(null);\n        console.log(\"Machine data:\", machineData);\n\n        // Fetch associated parts\n        if (machineData.associatedParts) {\n          fetchAssociatedParts(machineData.associatedParts);\n        }\n      } else {\n        console.error(\"Machine not found\");\n        setError(\"Machine not found\");\n      }\n    } catch (error) {\n      console.error(\"Error fetching machine data:\", error);\n      setError(\"Error fetching machine data\");\n    }\n  };\n\n  const fetchAssociatedParts = async (associatedPartsRefs) => {\n    try {\n      const db = firebase.firestore();\n      const partsDocs = await Promise.all(\n        associatedPartsRefs.map((ref) => ref.get())\n      );\n\n      const partsData = await Promise.all(\n        partsDocs.map(async (doc) => {\n          if (!doc.exists) {\n            // skip or return an empty object\n            return null;\n          }\n          const data = doc.data() || {};\n          let clientName = \"\";\n          if (data.ClientFrom?.get) {\n            const clientDoc = await data.ClientFrom.get();\n            clientName = clientDoc.exists ? clientDoc.data().name : \"\";\n          }\n          return { id: doc.id, ...data, clientName };\n        })\n      );\n\n      setAssociatedParts(partsData.filter((p) => p));\n      setError(null);\n      console.log(\"Associated parts data:\", partsData);\n    } catch (error) {\n      console.error(\"Error fetching associated parts:\", error);\n      setError(\"Error fetching associated parts\");\n    }\n  };\n\n  const handlePrintMulti = async () => {\n    // Create your payload with the mapped items.\n    // Replace 'associatedParts' with your actual variable containing the list.\n    const payload = {\n      items: associatedParts.map((part) => ({\n        name: part.name,\n        arrival_date: part.arrival_date, // Ensure your part has a 'date' field.\n        poNumber: part.poNumber || \"\",\n        OEM: part.TheMachine ? part.TheMachine.oem || \"\" : \"\",\n        modality: part.TheMachine ? part.TheMachine.modality || \"\" : \"\",\n        model: part.TheMachine ? part.TheMachine.model || \"\" : \"\",\n        local_sn: part.id, // Using document id as the local serial number.\n        client: part.clientName || \"\",\n        description:\n          part.description ||\n          (part.descriptions && part.descriptions.length > 0\n            ? part.descriptions[0].description\n            : \"\"),\n      })),\n      test_print: true, // Hard-coded here if you want to test printing one item\n      index: 1, // Hard-coded index (1-based)\n    };\n\n    try {\n      const response = await fetch(\n        \"https://9d70-174-76-22-138.ngrok-free.app/print_multi\",\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(payload),\n        }\n      );\n      const result = await response.json();\n      console.log(\"Print multi result:\", result.status);\n    } catch (error) {\n      console.error(\"Error printing multiple labels:\", error);\n    }\n  };\n\n  const handleSelectPart = (id, name) => {\n    console.log(`Selected part ID: ${id}, Name: ${name}`);\n    router.push(\"../item/\" + id);\n  };\n\n  const handleDragStart = (index) => (event) => {\n    if (event.target.closest(\"button\")) {\n      event.preventDefault();\n      return;\n    }\n    setDragIndex(index);\n    event.dataTransfer.effectAllowed = \"move\";\n    event.dataTransfer.setData(\n      \"text/plain\",\n      associatedParts[index]?.id || String(index)\n    );\n  };\n\n  const handleDragOver = (index) => (event) => {\n    event.preventDefault();\n    if (dragOverIndex !== index) setDragOverIndex(index);\n    event.dataTransfer.dropEffect = \"move\";\n  };\n\n  const handleDrop = (index) => (event) => {\n    event.preventDefault();\n    if (dragIndex == null || dragIndex === index) {\n      setDragIndex(null);\n      setDragOverIndex(null);\n      return;\n    }\n    setAssociatedParts((prev) => {\n      const next = [...prev];\n      const [moved] = next.splice(dragIndex, 1);\n      next.splice(index, 0, moved);\n      return next;\n    });\n    setDragIndex(null);\n    setDragOverIndex(null);\n  };\n\n  const handleDragEnd = () => {\n    setDragIndex(null);\n    setDragOverIndex(null);\n  };\n\n  const formatDate = (input) => {\n    let date;\n\n    if (input && input.seconds) {\n      // Handle timestamp object with 'seconds' property\n      date = new Date(input.seconds * 1000);\n    } else if (typeof input === \"string\") {\n      // Handle date string\n      date = new Date(input);\n    } else {\n      return \"N/A\";\n    }\n\n    if (isNaN(date.getTime())) {\n      // Invalid date string\n      return \"Invalid Date\";\n    }\n\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <div className={styles.page}>\n      <div className={styles.shell}>\n        <header className={styles.header}>\n          <div className={styles.brand}>\n            <img src=\"/magmo-logo.png\" alt=\"Magmo\" className={styles.brandLogo} />\n            <div>\n              <div className={styles.brandName}>Magmo</div>\n              <div className={styles.brandSub}>Machine Detail</div>\n            </div>\n          </div>\n          <Button\n            variant=\"outline-secondary\"\n            className={styles.backButton}\n            onClick={() => router.back()}\n          >\n            Back\n          </Button>\n        </header>\n\n        <div className={styles.card}>\n          <div className={styles.cardHeader}>\n            <div>\n              <div className={styles.cardTitle}>Machine Details</div>\n              <div className={styles.cardSubtitle}>\n                Drag and drop parts to reorder this list.\n              </div>\n            </div>\n            <div className={styles.cardMeta}>\n              {associatedParts.length} parts\n            </div>\n          </div>\n          <div className={styles.cardBody}>\n            {error && <Alert variant=\"danger\">{error}</Alert>}\n            {selectedMachine ? (\n              <>\n                <div className={styles.machineGrid}>\n                  <div className={styles.machineInfo}>\n                    <div className={styles.machineName}>\n                      {selectedMachine.name || \"Unnamed Machine\"}\n                    </div>\n                    <div className={styles.machineMetaRow}>\n                      <span>OEM: {selectedMachine.OEM || \"N/A\"}</span>\n                      <span>Modality: {selectedMachine.Modality || \"N/A\"}</span>\n                      <span>Model: {selectedMachine.Model || \"N/A\"}</span>\n                    </div>\n                  </div>\n                  <div className={styles.machineDates}>\n                    <div>\n                      <span className={styles.dateLabel}>Last PM</span>\n                      <span>{formatDate(selectedMachine.lastPM)}</span>\n                    </div>\n                    <div>\n                      <span className={styles.dateLabel}>Next PM</span>\n                      <span>{formatDate(selectedMachine.nextPM)}</span>\n                    </div>\n                  </div>\n                </div>\n\n                <div className={styles.tableCard}>\n                  <div className={styles.tableHeader}>\n                    Associated Parts\n                    <span className={styles.tableHint}>\n                      Click + hold to move\n                    </span>\n                  </div>\n                  <div className={styles.tableWrap}>\n                    <Table\n                      striped\n                      bordered\n                      hover\n                      size=\"sm\"\n                      className={styles.table}\n                    >\n                      <thead>\n                        <tr>\n                          <th>Name</th>\n                          <th>ID</th>\n                          <th>Part Number</th>\n                          <th>Serial Number</th>\n                          <th>Date</th>\n                          <th>Select</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        {associatedParts.length === 0 && (\n                          <tr>\n                            <td colSpan={6} className={styles.emptyState}>\n                              No associated parts found.\n                            </td>\n                          </tr>\n                        )}\n                        {associatedParts.map((part, index) => (\n                          <tr\n                            key={part.id}\n                            draggable\n                            onDragStart={handleDragStart(index)}\n                            onDragOver={handleDragOver(index)}\n                            onDrop={handleDrop(index)}\n                            onDragEnd={handleDragEnd}\n                            className={`${styles.draggableRow} ${\n                              dragIndex === index ? styles.dragging : \"\"\n                            } ${\n                              dragOverIndex === index && dragIndex !== index\n                                ? styles.dropTarget\n                                : \"\"\n                            }`}\n                          >\n                            <td>{part.name}</td>\n                            <td>{part.id}</td>\n                            <td>{part.pn}</td>\n                            <td>{part.sn}</td>\n                            <td>{formatDate(part.date || part.arrival_date)}</td>\n                            <td>\n                              <Button\n                                variant=\"primary\"\n                                size=\"sm\"\n                                onClick={() =>\n                                  handleSelectPart(part.id, part.name)\n                                }\n                              >\n                                Select\n                              </Button>\n                            </td>\n                          </tr>\n                        ))}\n                      </tbody>\n                    </Table>\n                  </div>\n                  <div className={styles.tableActions}>\n                    <Button\n                      variant=\"secondary\"\n                      className={styles.actionButton}\n                      onClick={handlePrintMulti}\n                    >\n                      Print All Items\n                    </Button>\n                  </div>\n                </div>\n              </>\n            ) : (\n              !error && <p className={styles.loadingText}>Loading machine data...</p>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Machine;\n\n// Server-side rendering function\nexport async function getServerSideProps(context) {\n  const { id } = context.params;\n\n  try {\n    // Fetch machine data from Firestore using Admin SDK\n    const machineDoc = await adminDb.collection(\"Machine\").doc(id).get();\n\n    if (!machineDoc.exists) {\n      return {\n        notFound: true, // This will show a 404 page\n      };\n    }\n\n    const machineData = machineDoc.data();\n\n    // Fetch associated parts if they exist\n    let associatedParts = [];\n    if (\n      machineData.associatedParts &&\n      Array.isArray(machineData.associatedParts)\n    ) {\n      try {\n        const partsPromises = machineData.associatedParts\n          .map((partRef) => {\n            if (partRef.path) {\n              return adminDb.doc(partRef.path).get();\n            }\n            return null;\n          })\n          .filter(Boolean);\n\n        const partsDocs = await Promise.all(partsPromises);\n        associatedParts = await Promise.all(\n          partsDocs.map(async (doc) => {\n            if (!doc.exists) {\n              return null;\n            }\n            const data = doc.data() || {};\n            let clientName = \"\";\n\n            // Fetch client name if ClientFrom reference exists\n            if (data.ClientFrom && data.ClientFrom.path) {\n              try {\n                const clientDoc = await adminDb.doc(data.ClientFrom.path).get();\n                clientName = clientDoc.exists ? clientDoc.data().name : \"\";\n              } catch (error) {\n                console.error(\"Error fetching client data:\", error);\n              }\n            }\n\n            return {\n              id: doc.id,\n              ...data,\n              clientName,\n            };\n          })\n        );\n\n        // Filter out null values\n        associatedParts = associatedParts.filter((part) => part !== null);\n      } catch (error) {\n        console.error(\"Error fetching associated parts:\", error);\n      }\n    }\n\n    // Serialize the machine data, removing any non-serializable fields\n    const serializedMachine = {\n      id,\n      name: machineData.name || \"\",\n      Model: machineData.Model || \"\",\n      OEM: machineData.OEM || \"\",\n      Modality: machineData.Modality || \"\",\n      lastPM: machineData.lastPM || null,\n      nextPM: machineData.nextPM || null,\n      // Add other machine fields as needed, but ensure they're serializable\n    };\n\n    return {\n      props: {\n        initialMachine: serializedMachine,\n        initialAssociatedParts: associatedParts,\n      },\n    };\n  } catch (error) {\n    console.error(\"Error in getServerSideProps:\", error);\n    return {\n      props: {\n        error: \"Failed to load machine data\",\n      },\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"module"}