{"ast":null,"code":"import _slicedToArray from \"C:/Users/isavc/OneDrive/Documents/AIS/Apps/magmo/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"C:/Users/isavc/OneDrive/Documents/AIS/Apps/magmo/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/isavc/OneDrive/Documents/AIS/Apps/magmo/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\isavc\\\\OneDrive\\\\Documents\\\\AIS\\\\Apps\\\\magmo\\\\components\\\\WarehouseMapModal.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\nimport firebase from \"../context/Firebase\";\nimport styles from \"./WarehouseMapModal.module.css\";\nvar REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\nvar NO_PALLET = \"NoPallet\";\nvar LETTERS = Array.from({\n  length: 26\n}, function (_, i) {\n  return String.fromCharCode(65 + i);\n});\nvar NUMBERS = Array.from({\n  length: 50\n}, function (_, i) {\n  return i + 1;\n});\nexport default function WarehouseMapModal(_ref) {\n  _s();\n\n  var _this = this;\n\n  var _ref$show = _ref.show,\n      show = _ref$show === void 0 ? false : _ref$show,\n      _ref$onHide = _ref.onHide,\n      onHide = _ref$onHide === void 0 ? function () {} : _ref$onHide,\n      onView = _ref.onView,\n      onSelectionChange = _ref.onSelectionChange,\n      _ref$initialSelection = _ref.initialSelection,\n      initialSelection = _ref$initialSelection === void 0 ? {} : _ref$initialSelection;\n\n  var _useState = useState([]),\n      regionOptions = _useState[0],\n      setRegionOptions = _useState[1];\n\n  var _useState2 = useState({}),\n      sectionMap = _useState2[0],\n      setSectionMap = _useState2[1];\n\n  var _useState3 = useState(\"regions\"),\n      mapStep = _useState3[0],\n      setMapStep = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      mapRegion = _useState4[0],\n      setMapRegion = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      mapRow = _useState5[0],\n      setMapRow = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      mapCol = _useState6[0],\n      setMapCol = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      mapPallet = _useState7[0],\n      setMapPallet = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      mapBin = _useState8[0],\n      setMapBin = _useState8[1];\n\n  var _useState9 = useState({}),\n      mapCellPallets = _useState9[0],\n      setMapCellPallets = _useState9[1];\n\n  var _useState10 = useState({}),\n      mapPalletBins = _useState10[0],\n      setMapPalletBins = _useState10[1];\n\n  var _useState11 = useState(false),\n      mapLoading = _useState11[0],\n      setMapLoading = _useState11[1];\n\n  var _useState12 = useState(\"\"),\n      mapError = _useState12[0],\n      setMapError = _useState12[1];\n\n  var _useState13 = useState(false),\n      directoryLoaded = _useState13[0],\n      setDirectoryLoaded = _useState13[1];\n\n  var lastShowRef = useRef(false);\n  var notifySelectionChange = useCallback(function (selection) {\n    if (typeof onSelectionChange === \"function\") {\n      onSelectionChange(selection);\n    }\n  }, [onSelectionChange]);\n  var loadDirectory = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var doc, data;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!directoryLoaded) {\n              _context.next = 2;\n              break;\n            }\n\n            return _context.abrupt(\"return\");\n\n          case 2:\n            _context.prev = 2;\n            _context.next = 5;\n            return firebase.firestore().collection(\"Warehouse\").doc(\"directory\").get();\n\n          case 5:\n            doc = _context.sent;\n            data = doc.data() || {};\n            setRegionOptions(data.Region || []);\n            setSectionMap(data.Section || {});\n            setDirectoryLoaded(true);\n            _context.next = 16;\n            break;\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](2);\n            console.error(\"Failed to load map directory\", _context.t0);\n            setMapError(\"Failed to load warehouse directory.\");\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[2, 12]]);\n  })), [directoryLoaded]);\n  var loadRegionInventory = useCallback( /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(regionId) {\n      var snap, cellPallets, palletBins, cellObj, palletObj;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (regionId) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              setMapLoading(true);\n              setMapError(\"\");\n              _context2.prev = 4;\n              _context2.next = 7;\n              return firebase.firestore().collection(\"Test\").where(\"newLocalCurrent.region\", \"==\", regionId).get();\n\n            case 7:\n              snap = _context2.sent;\n              cellPallets = {};\n              palletBins = {};\n              snap.forEach(function (doc) {\n                var _doc$data, _loc$section, _loc$section2;\n\n                var loc = ((_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.newLocalCurrent) || {};\n                var row = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.letter;\n                var col = (_loc$section2 = loc.section) === null || _loc$section2 === void 0 ? void 0 : _loc$section2.number;\n\n                if ((!row || !col) && typeof loc.section === \"string\") {\n                  var trimmed = loc.section.trim();\n                  row = trimmed.slice(0, 1);\n                  col = trimmed.slice(1);\n                }\n\n                if (col !== undefined && col !== null) {\n                  col = String(col);\n                }\n\n                var pallet = loc.pallet;\n                var bin = loc.bin;\n                if (!row || !col) return;\n                var cellKey = \"\".concat(row, \"-\").concat(col);\n                var hasBin = bin !== undefined && bin !== null && \"\".concat(bin) !== \"\";\n                var hasPallet = pallet !== undefined && pallet !== null && \"\".concat(pallet) !== \"\";\n                if (!hasPallet && !hasBin) return;\n                var palletId = hasPallet ? String(pallet) : NO_PALLET;\n                if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n                cellPallets[cellKey].add(palletId);\n\n                if (hasBin) {\n                  var palletKey = \"\".concat(cellKey, \"-P\").concat(palletId);\n                  if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n                  palletBins[palletKey].add(String(bin));\n                }\n              });\n              cellObj = {};\n              Object.keys(cellPallets).forEach(function (key) {\n                cellObj[key] = Array.from(cellPallets[key]).sort(function (a, b) {\n                  if (a === NO_PALLET) return 1;\n                  if (b === NO_PALLET) return -1;\n                  var na = Number(a);\n                  var nb = Number(b);\n                  if (Number.isFinite(na) && Number.isFinite(nb)) return na - nb;\n                  return String(a).localeCompare(String(b));\n                });\n              });\n              palletObj = {};\n              Object.keys(palletBins).forEach(function (key) {\n                palletObj[key] = Array.from(palletBins[key]).sort(function (a, b) {\n                  return Number(a) - Number(b);\n                });\n              });\n              setMapCellPallets(cellObj);\n              setMapPalletBins(palletObj);\n              _context2.next = 23;\n              break;\n\n            case 19:\n              _context2.prev = 19;\n              _context2.t0 = _context2[\"catch\"](4);\n              console.error(\"Failed to load map inventory\", _context2.t0);\n              setMapError(\"Failed to load map inventory.\");\n\n            case 23:\n              _context2.prev = 23;\n              setMapLoading(false);\n              return _context2.finish(23);\n\n            case 26:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[4, 19, 23, 26]]);\n    }));\n\n    return function (_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), []);\n  var getRegionDimensions = useCallback(function (regionId) {\n    var entry = sectionMap === null || sectionMap === void 0 ? void 0 : sectionMap[regionId];\n\n    if (Array.isArray(entry) && entry.length >= 2) {\n      var cols = parseInt(entry[0], 10);\n      var rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0\n      };\n    }\n\n    return {\n      cols: 0,\n      rows: 0\n    };\n  }, [sectionMap]);\n  useEffect(function () {\n    var wasOpen = lastShowRef.current;\n    lastShowRef.current = show;\n    if (!show || wasOpen) return;\n    loadDirectory();\n    setMapError(\"\");\n\n    var _ref4 = initialSelection || {},\n        region = _ref4.region,\n        sectionLetter = _ref4.sectionLetter,\n        sectionNumber = _ref4.sectionNumber,\n        pallet = _ref4.pallet,\n        bin = _ref4.bin;\n\n    setMapRegion(region || \"\");\n    setMapRow(sectionLetter || \"\");\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\n    setMapPallet(pallet ? String(pallet) : \"\");\n    setMapBin(bin ? String(bin) : \"\");\n    setMapStep(region ? \"grid\" : \"regions\");\n    if (region) loadRegionInventory(region);\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\n\n  var handleSelectRegion = function handleSelectRegion(regionId) {\n    var selection = {\n      region: regionId,\n      sectionLetter: \"\",\n      sectionNumber: \"\",\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"grid\");\n    notifySelectionChange(selection);\n    loadRegionInventory(regionId);\n  };\n\n  var handleSelectCell = function handleSelectCell(rowLetter, colNumber) {\n    var colValue = String(colNumber);\n    var selection = {\n      region: mapRegion,\n      sectionLetter: rowLetter,\n      sectionNumber: colValue,\n      pallet: \"\",\n      bin: \"\"\n    };\n    setMapRow(rowLetter);\n    setMapCol(colValue);\n    setMapPallet(\"\");\n    setMapBin(\"\");\n    setMapStep(\"pallets\");\n    notifySelectionChange(selection);\n  };\n\n  var handleSelectPallet = function handleSelectPallet(palletId) {\n    var palletValue = String(palletId);\n    var normalizedPallet = palletValue === NO_PALLET ? \"\" : palletValue;\n    var selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: normalizedPallet,\n      bin: \"\"\n    };\n    setMapPallet(palletValue);\n    setMapBin(\"\");\n    setMapStep(\"bins\");\n    notifySelectionChange(selection);\n  };\n\n  var handleSelectBin = function handleSelectBin(binId) {\n    var binValue = String(binId);\n    var normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\n    var selection = {\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: normalizedPallet,\n      bin: binValue\n    };\n    setMapBin(binValue);\n    notifySelectionChange(selection);\n  };\n\n  var handleBack = function handleBack() {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");else if (mapStep === \"pallets\") setMapStep(\"grid\");else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  var handleView = function handleView() {\n    if (typeof onView !== \"function\") return;\n    var normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\n    onView({\n      region: mapRegion,\n      sectionLetter: mapRow,\n      sectionNumber: mapCol,\n      pallet: normalizedPallet,\n      bin: mapBin\n    });\n  };\n\n  return __jsx(Modal, {\n    show: show,\n    onHide: onHide,\n    centered: true,\n    size: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 5\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }, \"Warehouse Map\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 7\n    }\n  }, mapLoading && __jsx(\"div\", {\n    className: styles.mapLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 11\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 13\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 13\n    }\n  }, \"Loading map data...\")), mapError && __jsx(\"div\", {\n    className: styles.mapError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 22\n    }\n  }, mapError), !mapLoading && mapStep === \"regions\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 13\n    }\n  }, \"Select a region\"), __jsx(\"div\", {\n    className: styles.mapCanvas,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 13\n    }\n  }, REGION_ORDER.map(function (regionId) {\n    return __jsx(\"button\", {\n      key: regionId,\n      type: \"button\",\n      className: \"\".concat(styles.regionBlock, \" \").concat(styles[\"region\".concat(regionId)]),\n      onClick: function onClick() {\n        return handleSelectRegion(regionId);\n      },\n      disabled: Array.isArray(regionOptions) && regionOptions.length > 0 && !regionOptions.includes(regionId),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 17\n      }\n    }, regionId);\n  }))), !mapLoading && mapStep === \"grid\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \": choose a row and column\"), function () {\n    var dims = getRegionDimensions(mapRegion);\n    var rows = LETTERS.slice(0, dims.rows || 0).reverse();\n    var cols = NUMBERS.slice(0, dims.cols || 0);\n\n    if (!rows.length || !cols.length) {\n      var sectionKeys = Object.keys(mapCellPallets || {}).filter(Boolean).map(function (key) {\n        var _key$split = key.split(\"-\"),\n            _key$split2 = _slicedToArray(_key$split, 2),\n            row = _key$split2[0],\n            col = _key$split2[1];\n\n        return {\n          key: key,\n          row: row,\n          col: col\n        };\n      }).sort(function (a, b) {\n        if (a.row === b.row) {\n          return Number(a.col) - Number(b.col);\n        }\n\n        return b.row.localeCompare(a.row);\n      });\n\n      if (!sectionKeys.length) {\n        return __jsx(\"div\", {\n          className: styles.mapEmpty,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 321,\n            columnNumber: 21\n          }\n        }, \"No grid data for this region.\");\n      }\n\n      return __jsx(\"div\", {\n        className: styles.gridWrapper,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 19\n        }\n      }, __jsx(\"div\", {\n        className: styles.mapHint,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 21\n        }\n      }, \"Grid not available. Select an available section below.\"), __jsx(\"div\", {\n        className: styles.palletGrid,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 21\n        }\n      }, sectionKeys.map(function (_ref5) {\n        var key = _ref5.key,\n            row = _ref5.row,\n            col = _ref5.col;\n        return __jsx(\"button\", {\n          key: key,\n          type: \"button\",\n          className: styles.palletButton,\n          onClick: function onClick() {\n            return handleSelectCell(row, col);\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 25\n          }\n        }, row, col);\n      })));\n    }\n\n    return __jsx(\"div\", {\n      className: styles.gridWrapper,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 17\n      }\n    }, __jsx(\"div\", {\n      className: styles.grid,\n      style: {\n        \"--grid-cols\": cols.length\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 19\n      }\n    }, rows.map(function (row) {\n      return cols.map(function (col) {\n        var _mapCellPallets$cellK;\n\n        var cellKey = \"\".concat(row, \"-\").concat(col);\n        var hasPallets = Boolean((_mapCellPallets$cellK = mapCellPallets[cellKey]) === null || _mapCellPallets$cellK === void 0 ? void 0 : _mapCellPallets$cellK.length);\n        return __jsx(\"button\", {\n          key: cellKey,\n          type: \"button\",\n          className: \"\".concat(styles.gridCell, \" \").concat(hasPallets ? \"\" : styles.gridCellDisabled),\n          onClick: function onClick() {\n            return hasPallets && handleSelectCell(row, col);\n          },\n          disabled: !hasPallets,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 27\n          }\n        }, __jsx(\"span\", {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 29\n          }\n        }, row, col));\n      });\n    })));\n  }()), !mapLoading && mapStep === \"pallets\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \": select a pallet\"), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 13\n    }\n  }, (mapCellPallets[\"\".concat(mapRow, \"-\").concat(mapCol)] || []).map(function (pallet) {\n    var palletKey = \"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(pallet);\n    var bins = mapPalletBins[palletKey] || [];\n    return __jsx(\"button\", {\n      key: pallet,\n      type: \"button\",\n      className: styles.palletButton,\n      onClick: function onClick() {\n        if (bins.length === 0 && typeof onView === \"function\") {\n          var selection = {\n            region: mapRegion,\n            sectionLetter: mapRow,\n            sectionNumber: mapCol,\n            pallet: pallet === NO_PALLET ? \"\" : String(pallet),\n            bin: \"\"\n          };\n          notifySelectionChange(selection);\n          onView(selection);\n          return;\n        }\n\n        handleSelectPallet(pallet);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 19\n      }\n    }, pallet === NO_PALLET ? \"No Pallet\" : \"Pallet \".concat(pallet));\n  }), !(mapCellPallets[\"\".concat(mapRow, \"-\").concat(mapCol)] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 17\n    }\n  }, \"No pallets available here.\"))), !mapLoading && mapStep === \"bins\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 433,\n      columnNumber: 13\n    }\n  }, \"Region \", mapRegion, \" - Section \", mapRow, mapCol, \" - Pallet \", mapPallet), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 13\n    }\n  }, (mapPalletBins[\"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(mapPallet)] || []).map(function (bin) {\n    return __jsx(\"button\", {\n      key: bin,\n      type: \"button\",\n      className: \"\".concat(styles.palletButton, \" \").concat(styles.binButton),\n      onClick: function onClick() {\n        return handleSelectBin(bin);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 19\n      }\n    }, \"Bin \", bin);\n  }), !(mapPalletBins[\"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(mapPallet)] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 452,\n      columnNumber: 17\n    }\n  }, \"No bins available on this pallet.\")))), __jsx(Modal.Footer, {\n    className: styles.mapFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 460,\n      columnNumber: 7\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleBack,\n    disabled: mapStep === \"regions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 461,\n      columnNumber: 9\n    }\n  }, \"Back\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: handleView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 9\n    }\n  }, \"View\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: onHide,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 471,\n      columnNumber: 9\n    }\n  }, \"Close\")));\n}\n\n_s(WarehouseMapModal, \"K3jZUBqumdfQwS4G3Gpw4/L1+uc=\");\n\n_c = WarehouseMapModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"WarehouseMapModal\");","map":{"version":3,"sources":["C:/Users/isavc/OneDrive/Documents/AIS/Apps/magmo/components/WarehouseMapModal.js"],"names":["React","useCallback","useEffect","useRef","useState","Modal","Button","Spinner","firebase","styles","REGION_ORDER","NO_PALLET","LETTERS","Array","from","length","_","i","String","fromCharCode","NUMBERS","WarehouseMapModal","show","onHide","onView","onSelectionChange","initialSelection","regionOptions","setRegionOptions","sectionMap","setSectionMap","mapStep","setMapStep","mapRegion","setMapRegion","mapRow","setMapRow","mapCol","setMapCol","mapPallet","setMapPallet","mapBin","setMapBin","mapCellPallets","setMapCellPallets","mapPalletBins","setMapPalletBins","mapLoading","setMapLoading","mapError","setMapError","directoryLoaded","setDirectoryLoaded","lastShowRef","notifySelectionChange","selection","loadDirectory","firestore","collection","doc","get","data","Region","Section","console","error","loadRegionInventory","regionId","where","snap","cellPallets","palletBins","forEach","loc","newLocalCurrent","row","section","letter","col","number","trimmed","trim","slice","undefined","pallet","bin","cellKey","hasBin","hasPallet","palletId","Set","add","palletKey","cellObj","Object","keys","key","sort","a","b","na","Number","nb","isFinite","localeCompare","palletObj","getRegionDimensions","entry","isArray","cols","parseInt","rows","wasOpen","current","region","sectionLetter","sectionNumber","handleSelectRegion","handleSelectCell","rowLetter","colNumber","colValue","handleSelectPallet","palletValue","normalizedPallet","handleSelectBin","binId","binValue","handleBack","handleView","mapStage","mapHint","mapCanvas","map","regionBlock","includes","dims","reverse","sectionKeys","filter","Boolean","split","mapEmpty","gridWrapper","palletGrid","palletButton","grid","hasPallets","gridCell","gridCellDisabled","bins","binButton","mapFooter"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { Modal, Button, Spinner } from \"react-bootstrap\";\r\nimport firebase from \"../context/Firebase\";\r\nimport styles from \"./WarehouseMapModal.module.css\";\r\n\r\nconst REGION_ORDER = [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"];\r\nconst NO_PALLET = \"NoPallet\";\r\nconst LETTERS = Array.from({ length: 26 }, (_, i) =>\r\n  String.fromCharCode(65 + i)\r\n);\r\nconst NUMBERS = Array.from({ length: 50 }, (_, i) => i + 1);\r\n\r\nexport default function WarehouseMapModal({\r\n  show = false,\r\n  onHide = () => {},\r\n  onView,\r\n  onSelectionChange,\r\n  initialSelection = {},\r\n}) {\r\n  const [regionOptions, setRegionOptions] = useState([]);\r\n  const [sectionMap, setSectionMap] = useState({});\r\n  const [mapStep, setMapStep] = useState(\"regions\");\r\n  const [mapRegion, setMapRegion] = useState(\"\");\r\n  const [mapRow, setMapRow] = useState(\"\");\r\n  const [mapCol, setMapCol] = useState(\"\");\r\n  const [mapPallet, setMapPallet] = useState(\"\");\r\n  const [mapBin, setMapBin] = useState(\"\");\r\n  const [mapCellPallets, setMapCellPallets] = useState({});\r\n  const [mapPalletBins, setMapPalletBins] = useState({});\r\n  const [mapLoading, setMapLoading] = useState(false);\r\n  const [mapError, setMapError] = useState(\"\");\r\n  const [directoryLoaded, setDirectoryLoaded] = useState(false);\r\n  const lastShowRef = useRef(false);\r\n\r\n  const notifySelectionChange = useCallback(\r\n    (selection) => {\r\n      if (typeof onSelectionChange === \"function\") {\r\n        onSelectionChange(selection);\r\n      }\r\n    },\r\n    [onSelectionChange]\r\n  );\r\n\r\n  const loadDirectory = useCallback(async () => {\r\n    if (directoryLoaded) return;\r\n    try {\r\n      const doc = await firebase\r\n        .firestore()\r\n        .collection(\"Warehouse\")\r\n        .doc(\"directory\")\r\n        .get();\r\n      const data = doc.data() || {};\r\n      setRegionOptions(data.Region || []);\r\n      setSectionMap(data.Section || {});\r\n      setDirectoryLoaded(true);\r\n    } catch (error) {\r\n      console.error(\"Failed to load map directory\", error);\r\n      setMapError(\"Failed to load warehouse directory.\");\r\n    }\r\n  }, [directoryLoaded]);\r\n\r\n  const loadRegionInventory = useCallback(async (regionId) => {\r\n    if (!regionId) return;\r\n    setMapLoading(true);\r\n    setMapError(\"\");\r\n    try {\r\n      const snap = await firebase\r\n        .firestore()\r\n        .collection(\"Test\")\r\n        .where(\"newLocalCurrent.region\", \"==\", regionId)\r\n        .get();\r\n\r\n      const cellPallets = {};\r\n      const palletBins = {};\r\n      snap.forEach((doc) => {\r\n        const loc = doc.data()?.newLocalCurrent || {};\r\n        let row = loc.section?.letter;\r\n        let col = loc.section?.number;\r\n        if ((!row || !col) && typeof loc.section === \"string\") {\r\n          const trimmed = loc.section.trim();\r\n          row = trimmed.slice(0, 1);\r\n          col = trimmed.slice(1);\r\n        }\r\n        if (col !== undefined && col !== null) {\r\n          col = String(col);\r\n        }\r\n        const pallet = loc.pallet;\r\n        const bin = loc.bin;\r\n        if (!row || !col) return;\r\n        const cellKey = `${row}-${col}`;\r\n        const hasBin = bin !== undefined && bin !== null && `${bin}` !== \"\";\r\n        const hasPallet =\r\n          pallet !== undefined && pallet !== null && `${pallet}` !== \"\";\r\n        if (!hasPallet && !hasBin) return;\r\n\r\n        const palletId = hasPallet ? String(pallet) : NO_PALLET;\r\n        if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\r\n        cellPallets[cellKey].add(palletId);\r\n\r\n        if (hasBin) {\r\n          const palletKey = `${cellKey}-P${palletId}`;\r\n          if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\r\n          palletBins[palletKey].add(String(bin));\r\n        }\r\n      });\r\n\r\n      const cellObj = {};\r\n      Object.keys(cellPallets).forEach((key) => {\r\n        cellObj[key] = Array.from(cellPallets[key]).sort((a, b) => {\r\n          if (a === NO_PALLET) return 1;\r\n          if (b === NO_PALLET) return -1;\r\n          const na = Number(a);\r\n          const nb = Number(b);\r\n          if (Number.isFinite(na) && Number.isFinite(nb)) return na - nb;\r\n          return String(a).localeCompare(String(b));\r\n        });\r\n      });\r\n\r\n      const palletObj = {};\r\n      Object.keys(palletBins).forEach((key) => {\r\n        palletObj[key] = Array.from(palletBins[key]).sort(\r\n          (a, b) => Number(a) - Number(b)\r\n        );\r\n      });\r\n\r\n      setMapCellPallets(cellObj);\r\n      setMapPalletBins(palletObj);\r\n    } catch (error) {\r\n      console.error(\"Failed to load map inventory\", error);\r\n      setMapError(\"Failed to load map inventory.\");\r\n    } finally {\r\n      setMapLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const getRegionDimensions = useCallback(\r\n    (regionId) => {\r\n      const entry = sectionMap?.[regionId];\r\n      if (Array.isArray(entry) && entry.length >= 2) {\r\n        const cols = parseInt(entry[0], 10);\r\n        const rows = parseInt(entry[1], 10);\r\n        return {\r\n          cols: Number.isFinite(cols) ? cols : 0,\r\n          rows: Number.isFinite(rows) ? rows : 0,\r\n        };\r\n      }\r\n      return { cols: 0, rows: 0 };\r\n    },\r\n    [sectionMap]\r\n  );\r\n\r\n  useEffect(() => {\r\n    const wasOpen = lastShowRef.current;\r\n    lastShowRef.current = show;\r\n    if (!show || wasOpen) return;\r\n\r\n    loadDirectory();\r\n    setMapError(\"\");\r\n    const {\r\n      region,\r\n      sectionLetter,\r\n      sectionNumber,\r\n      pallet,\r\n      bin,\r\n    } = initialSelection || {};\r\n\r\n    setMapRegion(region || \"\");\r\n    setMapRow(sectionLetter || \"\");\r\n    setMapCol(sectionNumber ? String(sectionNumber) : \"\");\r\n    setMapPallet(pallet ? String(pallet) : \"\");\r\n    setMapBin(bin ? String(bin) : \"\");\r\n    setMapStep(region ? \"grid\" : \"regions\");\r\n    if (region) loadRegionInventory(region);\r\n  }, [show, initialSelection, loadDirectory, loadRegionInventory]);\r\n\r\n  const handleSelectRegion = (regionId) => {\r\n    const selection = {\r\n      region: regionId,\r\n      sectionLetter: \"\",\r\n      sectionNumber: \"\",\r\n      pallet: \"\",\r\n      bin: \"\",\r\n    };\r\n    setMapRegion(regionId);\r\n    setMapRow(\"\");\r\n    setMapCol(\"\");\r\n    setMapPallet(\"\");\r\n    setMapBin(\"\");\r\n    setMapStep(\"grid\");\r\n    notifySelectionChange(selection);\r\n    loadRegionInventory(regionId);\r\n  };\r\n\r\n  const handleSelectCell = (rowLetter, colNumber) => {\r\n    const colValue = String(colNumber);\r\n    const selection = {\r\n      region: mapRegion,\r\n      sectionLetter: rowLetter,\r\n      sectionNumber: colValue,\r\n      pallet: \"\",\r\n      bin: \"\",\r\n    };\r\n    setMapRow(rowLetter);\r\n    setMapCol(colValue);\r\n    setMapPallet(\"\");\r\n    setMapBin(\"\");\r\n    setMapStep(\"pallets\");\r\n    notifySelectionChange(selection);\r\n  };\r\n\r\n  const handleSelectPallet = (palletId) => {\r\n    const palletValue = String(palletId);\r\n    const normalizedPallet = palletValue === NO_PALLET ? \"\" : palletValue;\r\n    const selection = {\r\n      region: mapRegion,\r\n      sectionLetter: mapRow,\r\n      sectionNumber: mapCol,\r\n      pallet: normalizedPallet,\r\n      bin: \"\",\r\n    };\r\n    setMapPallet(palletValue);\r\n    setMapBin(\"\");\r\n    setMapStep(\"bins\");\r\n    notifySelectionChange(selection);\r\n  };\r\n\r\n  const handleSelectBin = (binId) => {\r\n    const binValue = String(binId);\r\n    const normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\r\n    const selection = {\r\n      region: mapRegion,\r\n      sectionLetter: mapRow,\r\n      sectionNumber: mapCol,\r\n      pallet: normalizedPallet,\r\n      bin: binValue,\r\n    };\r\n    setMapBin(binValue);\r\n    notifySelectionChange(selection);\r\n  };\r\n\r\n  const handleBack = () => {\r\n    if (mapStep === \"bins\") setMapStep(\"pallets\");\r\n    else if (mapStep === \"pallets\") setMapStep(\"grid\");\r\n    else if (mapStep === \"grid\") setMapStep(\"regions\");\r\n  };\r\n\r\n  const handleView = () => {\r\n    if (typeof onView !== \"function\") return;\r\n    const normalizedPallet = mapPallet === NO_PALLET ? \"\" : mapPallet;\r\n    onView({\r\n      region: mapRegion,\r\n      sectionLetter: mapRow,\r\n      sectionNumber: mapCol,\r\n      pallet: normalizedPallet,\r\n      bin: mapBin,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <Modal show={show} onHide={onHide} centered size=\"lg\">\r\n      <Modal.Header closeButton>\r\n        <Modal.Title>Warehouse Map</Modal.Title>\r\n      </Modal.Header>\r\n      <Modal.Body>\r\n        {mapLoading && (\r\n          <div className={styles.mapLoading}>\r\n            <Spinner animation=\"border\" />\r\n            <span>Loading map data...</span>\r\n          </div>\r\n        )}\r\n        {mapError && <div className={styles.mapError}>{mapError}</div>}\r\n\r\n        {!mapLoading && mapStep === \"regions\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>Select a region</div>\r\n            <div className={styles.mapCanvas}>\r\n              {REGION_ORDER.map((regionId) => (\r\n                <button\r\n                  key={regionId}\r\n                  type=\"button\"\r\n                  className={`${styles.regionBlock} ${styles[`region${regionId}`]}`}\r\n                  onClick={() => handleSelectRegion(regionId)}\r\n                  disabled={\r\n                    Array.isArray(regionOptions) &&\r\n                    regionOptions.length > 0 &&\r\n                    !regionOptions.includes(regionId)\r\n                  }\r\n                >\r\n                  {regionId}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!mapLoading && mapStep === \"grid\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>\r\n              Region {mapRegion}: choose a row and column\r\n            </div>\r\n            {(() => {\r\n              const dims = getRegionDimensions(mapRegion);\r\n              const rows = LETTERS.slice(0, dims.rows || 0).reverse();\r\n              const cols = NUMBERS.slice(0, dims.cols || 0);\r\n              if (!rows.length || !cols.length) {\r\n                const sectionKeys = Object.keys(mapCellPallets || {})\r\n                  .filter(Boolean)\r\n                  .map((key) => {\r\n                    const [row, col] = key.split(\"-\");\r\n                    return { key, row, col };\r\n                  })\r\n                  .sort((a, b) => {\r\n                    if (a.row === b.row) {\r\n                      return Number(a.col) - Number(b.col);\r\n                    }\r\n                    return b.row.localeCompare(a.row);\r\n                  });\r\n\r\n                if (!sectionKeys.length) {\r\n                  return (\r\n                    <div className={styles.mapEmpty}>\r\n                      No grid data for this region.\r\n                    </div>\r\n                  );\r\n                }\r\n\r\n                return (\r\n                  <div className={styles.gridWrapper}>\r\n                    <div className={styles.mapHint}>\r\n                      Grid not available. Select an available section below.\r\n                    </div>\r\n                    <div className={styles.palletGrid}>\r\n                      {sectionKeys.map(({ key, row, col }) => (\r\n                        <button\r\n                          key={key}\r\n                          type=\"button\"\r\n                          className={styles.palletButton}\r\n                          onClick={() => handleSelectCell(row, col)}\r\n                        >\r\n                          {row}\r\n                          {col}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              }\r\n              return (\r\n                <div className={styles.gridWrapper}>\r\n                  <div\r\n                    className={styles.grid}\r\n                    style={{ \"--grid-cols\": cols.length }}\r\n                  >\r\n                    {rows.map((row) =>\r\n                      cols.map((col) => {\r\n                        const cellKey = `${row}-${col}`;\r\n                        const hasPallets = Boolean(\r\n                          mapCellPallets[cellKey]?.length\r\n                        );\r\n                        return (\r\n                          <button\r\n                            key={cellKey}\r\n                            type=\"button\"\r\n                            className={`${styles.gridCell} ${\r\n                              hasPallets ? \"\" : styles.gridCellDisabled\r\n                            }`}\r\n                            onClick={() =>\r\n                              hasPallets && handleSelectCell(row, col)\r\n                            }\r\n                            disabled={!hasPallets}\r\n                          >\r\n                            <span>\r\n                              {row}\r\n                              {col}\r\n                            </span>\r\n                          </button>\r\n                        );\r\n                      })\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })()}\r\n          </div>\r\n        )}\r\n\r\n        {!mapLoading && mapStep === \"pallets\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>\r\n              Region {mapRegion} - Section {mapRow}\r\n              {mapCol}: select a pallet\r\n            </div>\r\n            <div className={styles.palletGrid}>\r\n              {(mapCellPallets[`${mapRow}-${mapCol}`] || []).map((pallet) => {\r\n                const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\r\n                const bins = mapPalletBins[palletKey] || [];\r\n                return (\r\n                  <button\r\n                    key={pallet}\r\n                    type=\"button\"\r\n                    className={styles.palletButton}\r\n                    onClick={() => {\r\n                      if (bins.length === 0 && typeof onView === \"function\") {\r\n                        const selection = {\r\n                          region: mapRegion,\r\n                          sectionLetter: mapRow,\r\n                          sectionNumber: mapCol,\r\n                          pallet: pallet === NO_PALLET ? \"\" : String(pallet),\r\n                          bin: \"\",\r\n                        };\r\n                        notifySelectionChange(selection);\r\n                        onView(selection);\r\n                        return;\r\n                      }\r\n                      handleSelectPallet(pallet);\r\n                    }}\r\n                  >\r\n                    {pallet === NO_PALLET ? \"No Pallet\" : `Pallet ${pallet}`}\r\n                  </button>\r\n                );\r\n              })}\r\n              {!(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && (\r\n                <div className={styles.mapEmpty}>\r\n                  No pallets available here.\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!mapLoading && mapStep === \"bins\" && (\r\n          <div className={styles.mapStage}>\r\n            <div className={styles.mapHint}>\r\n              Region {mapRegion} - Section {mapRow}\r\n              {mapCol} - Pallet {mapPallet}\r\n            </div>\r\n            <div className={styles.palletGrid}>\r\n              {(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(\r\n                (bin) => (\r\n                  <button\r\n                    key={bin}\r\n                    type=\"button\"\r\n                    className={`${styles.palletButton} ${styles.binButton}`}\r\n                    onClick={() => handleSelectBin(bin)}\r\n                  >\r\n                    Bin {bin}\r\n                  </button>\r\n                )\r\n              )}\r\n              {!(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || [])\r\n                .length && (\r\n                <div className={styles.mapEmpty}>\r\n                  No bins available on this pallet.\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </Modal.Body>\r\n      <Modal.Footer className={styles.mapFooter}>\r\n        <Button\r\n          variant=\"outline-secondary\"\r\n          onClick={handleBack}\r\n          disabled={mapStep === \"regions\"}\r\n        >\r\n          Back\r\n        </Button>\r\n        <Button variant=\"outline-primary\" onClick={handleView}>\r\n          View\r\n        </Button>\r\n        <Button variant=\"secondary\" onClick={onHide}>\r\n          Close\r\n        </Button>\r\n      </Modal.Footer>\r\n    </Modal>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}