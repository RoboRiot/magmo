{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport firebase from \"../context/Firebase\";\nconst OEM_FIELD_CANDIDATES = [\"oems\", \"OEMs\", \"oem\", \"OEM\"];\nconst MODEL_FIELD_CANDIDATES = [\"models\", \"Models\", \"model\", \"Model\", \"list\", \"items\"];\nconst DEFAULT_OEM_FIELD = \"oems\";\n\nconst isPlainObject = value => value != null && typeof value === \"object\" && !Array.isArray(value) && !(value instanceof Date);\n\nconst normalizeKey = value => {\n  if (value == null) return \"\";\n  return String(value).trim().toLowerCase();\n};\n\nconst hasUpper = value => /[A-Z]/.test(String(value || \"\"));\n\nconst pickPreferredCase = (current, incoming) => {\n  if (!current) return incoming;\n  if (!incoming) return current;\n  const currentUpper = hasUpper(current);\n  const incomingUpper = hasUpper(incoming);\n  if (incomingUpper && !currentUpper) return incoming;\n  if (currentUpper && !incomingUpper) return current;\n  return current;\n};\n\nconst normalizeArray = value => {\n  if (Array.isArray(value)) return value;\n  if (value == null || value === \"\") return [];\n  return [value];\n};\n\nconst normalizeList = values => {\n  const out = [];\n  (values || []).forEach(value => {\n    if (value == null) return;\n    const normalized = String(value).trim();\n    if (!normalized) return;\n    if (normalizeKey(normalized) === \"nan\") return;\n    out.push(normalized);\n  });\n  return Array.from(new Set(out));\n};\n\nconst normalizeListCaseInsensitive = values => {\n  const map = new Map();\n  (values || []).forEach(value => {\n    if (value == null) return;\n    const normalized = String(value).trim();\n    if (!normalized) return;\n    const key = normalizeKey(normalized);\n    if (!key || key === \"nan\") return;\n    const current = map.get(key);\n    map.set(key, pickPreferredCase(current, normalized));\n  });\n  return Array.from(map.values());\n};\n\nconst pickModelField = obj => {\n  if (!isPlainObject(obj)) return null;\n\n  for (const key of MODEL_FIELD_CANDIDATES) {\n    if (Array.isArray(obj[key])) return key;\n  }\n\n  const arrayKey = Object.keys(obj).find(key => Array.isArray(obj[key]));\n  return arrayKey || null;\n};\n\nconst extractModels = value => {\n  if (Array.isArray(value)) {\n    return {\n      models: normalizeList(value),\n      modelField: null\n    };\n  }\n\n  if (isPlainObject(value)) {\n    const modelField = pickModelField(value);\n    const models = modelField ? normalizeList(value[modelField]) : [];\n    return {\n      models,\n      modelField\n    };\n  }\n\n  if (value != null && value !== \"\") {\n    return {\n      models: normalizeList([value]),\n      modelField: null\n    };\n  }\n\n  return {\n    models: [],\n    modelField: null\n  };\n};\n\nconst extractOemMap = data => {\n  const oemMap = {};\n  const modelFieldByOem = {};\n  let oemField = null;\n\n  for (const key of OEM_FIELD_CANDIDATES) {\n    if (Array.isArray(data === null || data === void 0 ? void 0 : data[key])) {\n      oemField = key;\n      data[key].forEach(entry => {\n        if (entry == null) return;\n\n        if (isPlainObject(entry)) {\n          const name = entry.name || entry.oem || entry.OEM || entry.label || entry.value;\n          if (!name) return;\n          const normalizedName = String(name).trim();\n          if (!normalizedName) return;\n          const {\n            models\n          } = extractModels(entry.models || entry.list || entry.items);\n          oemMap[normalizedName] = normalizeList([...(oemMap[normalizedName] || []), ...models]);\n          return;\n        }\n\n        const normalized = String(entry || \"\").trim();\n        if (!normalized) return;\n        oemMap[normalized] = normalizeList([...(oemMap[normalized] || [])]);\n      });\n    } else if (isPlainObject(data === null || data === void 0 ? void 0 : data[key])) {\n      oemField = key;\n      Object.entries(data[key]).forEach(([oem, value]) => {\n        const {\n          models,\n          modelField\n        } = extractModels(value);\n        oemMap[oem] = normalizeList([...(oemMap[oem] || []), ...models]);\n\n        if (modelField) {\n          modelFieldByOem[oem] = modelField;\n        }\n      });\n    }\n  }\n\n  if (!oemField) {\n    Object.entries(data || {}).forEach(([key, value]) => {\n      if (!value) return;\n      if (key.startsWith(\"_\")) return;\n\n      if (isPlainObject(value) || Array.isArray(value)) {\n        const {\n          models,\n          modelField\n        } = extractModels(value);\n\n        if (models.length || modelField) {\n          oemMap[key] = normalizeList([...(oemMap[key] || []), ...models]);\n\n          if (modelField) {\n            modelFieldByOem[key] = modelField;\n          }\n        }\n      }\n    });\n  }\n\n  return {\n    oemMap,\n    oemField,\n    modelFieldByOem\n  };\n};\n\nconst buildCatalogFromMachines = async () => {\n  const db = firebase.firestore();\n  const snap = await db.collection(\"Machine\").get();\n  const modalityMap = new Map();\n  const oemMapByModality = new Map();\n  const modelMapByModalityOem = new Map();\n\n  const ensureDisplay = (map, value) => {\n    const key = normalizeKey(value);\n    if (!key) return null;\n    const current = map.get(key);\n    const display = pickPreferredCase(current, String(value).trim());\n    map.set(key, display);\n    return display;\n  };\n\n  snap.forEach(doc => {\n    const data = doc.data() || {};\n    const modalityRaw = data.Modality || data.modality;\n    const oemRaw = data.OEM || data.oem;\n    if (!modalityRaw || !oemRaw) return;\n    const modality = ensureDisplay(modalityMap, modalityRaw);\n    if (!modality) return;\n    const modalityLower = normalizeKey(modality);\n    const oemKeyMap = oemMapByModality.get(modalityLower) || new Map();\n    oemMapByModality.set(modalityLower, oemKeyMap);\n    const oem = ensureDisplay(oemKeyMap, oemRaw);\n    if (!oem) return;\n    const modelRaw = data.Model || data.model;\n    if (!modelRaw) return;\n    const modelKey = modelMapByModalityOem.get(modalityLower) || new Map();\n    modelMapByModalityOem.set(modalityLower, modelKey);\n    const oemLower = normalizeKey(oem);\n    const modelMap = modelKey.get(oemLower) || new Map();\n    modelKey.set(oemLower, modelMap);\n    ensureDisplay(modelMap, modelRaw);\n  });\n  const modalities = Array.from(modalityMap.values());\n  const oemsByModality = {};\n  const modelsByModalityOem = {};\n  modalities.forEach(modality => {\n    const modalityLower = normalizeKey(modality);\n    const oemMap = oemMapByModality.get(modalityLower) || new Map();\n    const oems = Array.from(oemMap.values());\n    oemsByModality[modality] = oems;\n    const modelMap = modelMapByModalityOem.get(modalityLower) || new Map();\n    const modelByOem = {};\n    oems.forEach(oem => {\n      const oemLower = normalizeKey(oem);\n      const models = Array.from((modelMap.get(oemLower) || new Map()).values());\n      if (models.length) modelByOem[oem] = models;\n    });\n    modelsByModalityOem[modality] = modelByOem;\n  });\n  return buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: false,\n    source: \"machine\"\n  });\n};\n\nconst buildCatalogFromTestItems = async () => {\n  const db = firebase.firestore();\n  const snap = await db.collection(\"Test\").get();\n  const modalityMap = new Map();\n  const oemMapByModality = new Map();\n  const modelMapByModalityOem = new Map();\n\n  const ensureDisplay = (map, value) => {\n    const key = normalizeKey(value);\n    if (!key) return null;\n    const current = map.get(key);\n    const display = pickPreferredCase(current, String(value).trim());\n    map.set(key, display);\n    return display;\n  };\n\n  snap.forEach(doc => {\n    const data = doc.data() || {};\n    const machine = data.TheMachine || {};\n    const modalityRaw = machine.Modality || machine.modality || data.Modality || data.modality;\n    const oemRaw = machine.OEM || machine.oem || data.OEM || data.oem;\n    if (!modalityRaw || !oemRaw) return;\n    const modality = ensureDisplay(modalityMap, modalityRaw);\n    if (!modality) return;\n    const modalityLower = normalizeKey(modality);\n    const oemKeyMap = oemMapByModality.get(modalityLower) || new Map();\n    oemMapByModality.set(modalityLower, oemKeyMap);\n    const oem = ensureDisplay(oemKeyMap, oemRaw);\n    if (!oem) return;\n    const modelRaw = machine.Model || machine.model || data.Model || data.model;\n    if (!modelRaw) return;\n    const modelKey = modelMapByModalityOem.get(modalityLower) || new Map();\n    modelMapByModalityOem.set(modalityLower, modelKey);\n    const oemLower = normalizeKey(oem);\n    const modelMap = modelKey.get(oemLower) || new Map();\n    modelKey.set(oemLower, modelMap);\n    ensureDisplay(modelMap, modelRaw);\n  });\n  const modalities = Array.from(modalityMap.values());\n  const oemsByModality = {};\n  const modelsByModalityOem = {};\n  modalities.forEach(modality => {\n    const modalityLower = normalizeKey(modality);\n    const oemMap = oemMapByModality.get(modalityLower) || new Map();\n    const oems = Array.from(oemMap.values());\n    oemsByModality[modality] = oems;\n    const modelMap = modelMapByModalityOem.get(modalityLower) || new Map();\n    const modelByOem = {};\n    oems.forEach(oem => {\n      const oemLower = normalizeKey(oem);\n      const models = Array.from((modelMap.get(oemLower) || new Map()).values());\n      if (models.length) modelByOem[oem] = models;\n    });\n    modelsByModalityOem[modality] = modelByOem;\n  });\n  return buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: false,\n    source: \"test\"\n  });\n};\n\nconst resolveModalitiesInTracker = async (db, candidates = []) => {\n  const confirmed = [];\n  const seen = new Set();\n\n  for (const candidate of candidates) {\n    const raw = String(candidate || \"\").trim();\n    if (!raw) continue;\n    const lower = normalizeKey(raw);\n    const upper = raw.toUpperCase();\n    const ids = Array.from(new Set([raw, lower, upper].filter(value => value)));\n    let found = null;\n\n    for (const id of ids) {\n      if (seen.has(id)) continue;\n\n      try {\n        const doc = await db.collection(\"Tracker\").doc(id).get();\n\n        if (doc.exists) {\n          found = doc.id;\n          break;\n        }\n      } catch (error) {// ignore permission/other errors\n      }\n    }\n\n    if (found) {\n      const key = normalizeKey(found);\n\n      if (!seen.has(key)) {\n        seen.add(key);\n        confirmed.push(found);\n      }\n    }\n  }\n\n  return normalizeListCaseInsensitive(confirmed);\n};\n\nconst mergeCatalogs = (baseCatalog, extraCatalog, source) => {\n  const baseModalities = (baseCatalog === null || baseCatalog === void 0 ? void 0 : baseCatalog.modalities) || [];\n  const baseMeta = (baseCatalog === null || baseCatalog === void 0 ? void 0 : baseCatalog.meta) || {};\n  const allowedSet = baseModalities.length ? new Set(baseModalities.map(value => normalizeKey(value))) : null;\n  const modalities = allowedSet ? baseModalities : normalizeListCaseInsensitive([...baseModalities, ...((extraCatalog === null || extraCatalog === void 0 ? void 0 : extraCatalog.modalities) || [])]);\n\n  const oemsByModality = _objectSpread({}, (baseCatalog === null || baseCatalog === void 0 ? void 0 : baseCatalog.oemsByModality) || {});\n\n  const modelsByModalityOem = _objectSpread({}, (baseCatalog === null || baseCatalog === void 0 ? void 0 : baseCatalog.modelsByModalityOem) || {});\n\n  Object.entries((extraCatalog === null || extraCatalog === void 0 ? void 0 : extraCatalog.oemsByModality) || {}).forEach(([modality, oems]) => {\n    var _baseMeta$modalityKey, _extraCatalog$modelsB;\n\n    const modalityKey = normalizeKey(modality);\n    if (allowedSet && !allowedSet.has(modalityKey)) return;\n    const canonicalModality = (baseMeta === null || baseMeta === void 0 ? void 0 : (_baseMeta$modalityKey = baseMeta.modalityKeyByLower) === null || _baseMeta$modalityKey === void 0 ? void 0 : _baseMeta$modalityKey[modalityKey]) || modalities.find(value => normalizeKey(value) === modalityKey) || modality;\n    const mergedOems = normalizeListCaseInsensitive([...(oemsByModality[canonicalModality] || []), ...(oems || [])]);\n    oemsByModality[canonicalModality] = mergedOems;\n    const extraModels = (extraCatalog === null || extraCatalog === void 0 ? void 0 : (_extraCatalog$modelsB = extraCatalog.modelsByModalityOem) === null || _extraCatalog$modelsB === void 0 ? void 0 : _extraCatalog$modelsB[modality]) || {};\n    const destModels = modelsByModalityOem[canonicalModality] || {};\n    Object.entries(extraModels).forEach(([oem, models]) => {\n      destModels[oem] = normalizeListCaseInsensitive([...(destModels[oem] || []), ...(models || [])]);\n    });\n    modelsByModalityOem[canonicalModality] = destModels;\n  });\n  return buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: false,\n    source\n  });\n};\n\nconst buildCatalogMetaFromMaps = ({\n  modalities = [],\n  oemsByModality = {},\n  modelsByModalityOem = {},\n  usesSubcollections = false,\n  syncDisabled = false,\n  source = \"client\"\n}) => {\n  const meta = {\n    oemFieldByModality: {},\n    modelFieldByModalityOem: {},\n    modalityKeyByLower: {},\n    oemKeyByModalityLower: {},\n    modelKeyByModalityOemLower: {},\n    usesSubcollections,\n    syncDisabled,\n    source\n  };\n  const normalizedModalities = normalizeListCaseInsensitive(modalities);\n  normalizedModalities.forEach(modality => {\n    const modalityLower = normalizeKey(modality);\n    meta.modalityKeyByLower[modalityLower] = pickPreferredCase(meta.modalityKeyByLower[modalityLower], modality);\n    const oems = (oemsByModality === null || oemsByModality === void 0 ? void 0 : oemsByModality[modality]) || [];\n    const oemLowerMap = meta.oemKeyByModalityLower[modalityLower] || {};\n    meta.oemKeyByModalityLower[modalityLower] = oemLowerMap;\n    const modelLowerMap = meta.modelKeyByModalityOemLower[modalityLower] || {};\n    meta.modelKeyByModalityOemLower[modalityLower] = modelLowerMap;\n    oems.forEach(oem => {\n      var _modelsByModalityOem$;\n\n      const oemLower = normalizeKey(oem);\n      oemLowerMap[oemLower] = pickPreferredCase(oemLowerMap[oemLower], oem);\n      const models = (modelsByModalityOem === null || modelsByModalityOem === void 0 ? void 0 : (_modelsByModalityOem$ = modelsByModalityOem[modality]) === null || _modelsByModalityOem$ === void 0 ? void 0 : _modelsByModalityOem$[oem]) || [];\n      modelLowerMap[oemLower] = modelLowerMap[oemLower] || {};\n      models.forEach(model => {\n        const modelLower = normalizeKey(model);\n        if (!modelLower) return;\n        modelLowerMap[oemLower][modelLower] = pickPreferredCase(modelLowerMap[oemLower][modelLower], model);\n      });\n    });\n  });\n  return {\n    modalities: normalizedModalities,\n    oemsByModality,\n    modelsByModalityOem,\n    meta\n  };\n};\n\nexport async function fetchTrackerCatalog() {\n  var _builtFromTracker$met3, _builtFromTracker$met4, _builtFromTracker$met5;\n\n  if (false) {\n    const cached = readCatalogCache();\n\n    if (cached !== null && cached !== void 0 && cached.modalities) {\n      const builtCached = buildCatalogMetaFromMaps({\n        modalities: cached.modalities || [],\n        oemsByModality: cached.oemsByModality || {},\n        modelsByModalityOem: cached.modelsByModalityOem || {},\n        usesSubcollections: Boolean(cached.usesSubcollections),\n        syncDisabled: Boolean(cached.syncDisabled),\n        source: cached.source || \"cache\"\n      });\n      const cachedOems = buildAllOems(builtCached);\n\n      if (builtCached.modalities.length >= MIN_MODALITIES_FOR_CACHE && cachedOems.length >= MIN_OEMS_FOR_CACHE) {\n        return builtCached;\n      }\n\n      try {\n        window.localStorage.removeItem(CATALOG_CACHE_KEY);\n      } catch (error) {// ignore\n      }\n    }\n  }\n\n  if (false && !shouldSkipApi()) {\n    try {\n      const response = await fetch(\"/api/tracker/catalog\");\n\n      if (response.ok) {\n        const payload = await response.json();\n\n        if (payload !== null && payload !== void 0 && payload.modalities) {\n          var _built$meta, _built$meta2, _built$meta3;\n\n          const built = buildCatalogMetaFromMaps({\n            modalities: payload.modalities || [],\n            oemsByModality: payload.oemsByModality || {},\n            modelsByModalityOem: payload.modelsByModalityOem || {},\n            usesSubcollections: Boolean(payload.usesSubcollections),\n            syncDisabled: false,\n            source: \"server\"\n          });\n          writeCatalogCache({\n            modalities: built.modalities,\n            oemsByModality: built.oemsByModality,\n            modelsByModalityOem: built.modelsByModalityOem,\n            usesSubcollections: (_built$meta = built.meta) === null || _built$meta === void 0 ? void 0 : _built$meta.usesSubcollections,\n            syncDisabled: (_built$meta2 = built.meta) === null || _built$meta2 === void 0 ? void 0 : _built$meta2.syncDisabled,\n            source: (_built$meta3 = built.meta) === null || _built$meta3 === void 0 ? void 0 : _built$meta3.source\n          });\n          return built;\n        }\n      } else {\n        noteApiFailure();\n      }\n    } catch (error) {\n      console.warn(\"Tracker catalog API fallback:\", error);\n      noteApiFailure();\n    }\n  } else if (false) {\n    noteApiFailure();\n  }\n\n  const db = firebase.firestore();\n  const snap = await db.collection(\"Tracker\").get();\n  const modalities = [];\n  const oemsByModality = {};\n  const modelsByModalityOem = {};\n  const meta = {\n    oemFieldByModality: {},\n    modelFieldByModalityOem: {},\n    modalityKeyByLower: {},\n    oemKeyByModalityLower: {},\n    modelKeyByModalityOemLower: {}\n  };\n  snap.forEach(doc => {\n    const modality = doc.id;\n    const modalityLower = normalizeKey(modality);\n    const existingModality = meta.modalityKeyByLower[modalityLower];\n    const canonicalModality = pickPreferredCase(existingModality, modality);\n    meta.modalityKeyByLower[modalityLower] = canonicalModality;\n    const data = doc.data() || {};\n    const {\n      oemMap,\n      oemField,\n      modelFieldByOem\n    } = extractOemMap(data);\n\n    if (existingModality && existingModality !== canonicalModality) {\n      oemsByModality[canonicalModality] = normalizeListCaseInsensitive([...(oemsByModality[existingModality] || []), ...(oemsByModality[canonicalModality] || [])]);\n      modelsByModalityOem[canonicalModality] = _objectSpread(_objectSpread({}, modelsByModalityOem[existingModality] || {}), modelsByModalityOem[canonicalModality] || {});\n      meta.modelFieldByModalityOem[canonicalModality] = _objectSpread(_objectSpread({}, meta.modelFieldByModalityOem[existingModality] || {}), meta.modelFieldByModalityOem[canonicalModality] || {});\n\n      if (!meta.oemFieldByModality[canonicalModality]) {\n        meta.oemFieldByModality[canonicalModality] = meta.oemFieldByModality[existingModality] || oemField;\n      }\n\n      delete oemsByModality[existingModality];\n      delete modelsByModalityOem[existingModality];\n      delete meta.oemFieldByModality[existingModality];\n      delete meta.modelFieldByModalityOem[existingModality];\n    }\n\n    modalities.push(canonicalModality);\n\n    if (!meta.oemFieldByModality[canonicalModality]) {\n      meta.oemFieldByModality[canonicalModality] = oemField;\n    }\n\n    meta.modelFieldByModalityOem[canonicalModality] = _objectSpread(_objectSpread({}, meta.modelFieldByModalityOem[canonicalModality] || {}), modelFieldByOem || {});\n    const oems = Object.keys(oemMap);\n    const mergedOems = normalizeListCaseInsensitive([...(oemsByModality[canonicalModality] || []), ...oems]);\n    oemsByModality[canonicalModality] = mergedOems;\n    modelsByModalityOem[canonicalModality] = modelsByModalityOem[canonicalModality] || {};\n    const oemLowerMap = meta.oemKeyByModalityLower[modalityLower] || {};\n    meta.oemKeyByModalityLower[modalityLower] = oemLowerMap;\n    const modelLowerMap = meta.modelKeyByModalityOemLower[modalityLower] || {};\n    meta.modelKeyByModalityOemLower[modalityLower] = modelLowerMap;\n    oems.forEach(oem => {\n      const oemLower = normalizeKey(oem);\n      const existingOem = oemLowerMap[oemLower];\n      const canonicalOem = pickPreferredCase(existingOem, oem);\n      oemLowerMap[oemLower] = canonicalOem;\n\n      if (existingOem && existingOem !== canonicalOem) {\n        modelsByModalityOem[canonicalModality][canonicalOem] = normalizeListCaseInsensitive([...(modelsByModalityOem[canonicalModality][existingOem] || []), ...(modelsByModalityOem[canonicalModality][canonicalOem] || [])]);\n        delete modelsByModalityOem[canonicalModality][existingOem];\n      }\n\n      const existingModels = modelsByModalityOem[canonicalModality][canonicalOem] || [];\n      const mergedModels = normalizeListCaseInsensitive([...existingModels, ...(oemMap[oem] || [])]);\n      modelsByModalityOem[canonicalModality][canonicalOem] = mergedModels;\n      modelLowerMap[oemLower] = modelLowerMap[oemLower] || {};\n      mergedModels.forEach(model => {\n        modelLowerMap[oemLower][normalizeKey(model)] = model;\n      });\n    });\n  });\n  const builtFromTracker = buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: true,\n    source: \"client\"\n  });\n  const allOems = buildAllOems(builtFromTracker);\n\n  if (builtFromTracker.modalities.length < MIN_MODALITIES_FOR_CACHE || allOems.length < MIN_OEMS_FOR_CACHE) {\n    var _builtFromMachines, _builtFromTest, _merged, _merged$modalities;\n\n    let builtFromMachines = null;\n    let builtFromTest = null;\n\n    try {\n      builtFromMachines = await buildCatalogFromMachines();\n    } catch (error) {\n      console.warn(\"Tracker catalog machine fallback failed:\", error);\n    }\n\n    try {\n      builtFromTest = await buildCatalogFromTestItems();\n    } catch (error) {\n      console.warn(\"Tracker catalog test fallback failed:\", error);\n    }\n\n    const candidateModalities = normalizeListCaseInsensitive([...(((_builtFromMachines = builtFromMachines) === null || _builtFromMachines === void 0 ? void 0 : _builtFromMachines.modalities) || []), ...(((_builtFromTest = builtFromTest) === null || _builtFromTest === void 0 ? void 0 : _builtFromTest.modalities) || [])]);\n    let expandedBase = builtFromTracker;\n\n    if (candidateModalities.length) {\n      try {\n        const confirmed = await resolveModalitiesInTracker(db, candidateModalities);\n\n        if (confirmed.length) {\n          var _builtFromTracker$met, _builtFromTracker$met2;\n\n          expandedBase = buildCatalogMetaFromMaps({\n            modalities: normalizeListCaseInsensitive([...builtFromTracker.modalities, ...confirmed]),\n            oemsByModality: builtFromTracker.oemsByModality,\n            modelsByModalityOem: builtFromTracker.modelsByModalityOem,\n            usesSubcollections: true,\n            syncDisabled: (_builtFromTracker$met = builtFromTracker.meta) === null || _builtFromTracker$met === void 0 ? void 0 : _builtFromTracker$met.syncDisabled,\n            source: (_builtFromTracker$met2 = builtFromTracker.meta) === null || _builtFromTracker$met2 === void 0 ? void 0 : _builtFromTracker$met2.source\n          });\n        }\n      } catch (error) {// ignore\n      }\n    }\n\n    let merged = expandedBase;\n\n    if (builtFromMachines) {\n      merged = mergeCatalogs(merged, builtFromMachines, \"machine+tracker\");\n    }\n\n    if (builtFromTest) {\n      merged = mergeCatalogs(merged, builtFromTest, \"test+tracker\");\n    }\n\n    if ((_merged = merged) !== null && _merged !== void 0 && (_merged$modalities = _merged.modalities) !== null && _merged$modalities !== void 0 && _merged$modalities.length) {\n      var _merged$meta, _merged$meta2, _merged$meta3;\n\n      writeCatalogCache({\n        modalities: merged.modalities,\n        oemsByModality: merged.oemsByModality,\n        modelsByModalityOem: merged.modelsByModalityOem,\n        usesSubcollections: (_merged$meta = merged.meta) === null || _merged$meta === void 0 ? void 0 : _merged$meta.usesSubcollections,\n        syncDisabled: (_merged$meta2 = merged.meta) === null || _merged$meta2 === void 0 ? void 0 : _merged$meta2.syncDisabled,\n        source: (_merged$meta3 = merged.meta) === null || _merged$meta3 === void 0 ? void 0 : _merged$meta3.source\n      });\n      return merged;\n    }\n  }\n\n  writeCatalogCache({\n    modalities: builtFromTracker.modalities,\n    oemsByModality: builtFromTracker.oemsByModality,\n    modelsByModalityOem: builtFromTracker.modelsByModalityOem,\n    usesSubcollections: (_builtFromTracker$met3 = builtFromTracker.meta) === null || _builtFromTracker$met3 === void 0 ? void 0 : _builtFromTracker$met3.usesSubcollections,\n    syncDisabled: (_builtFromTracker$met4 = builtFromTracker.meta) === null || _builtFromTracker$met4 === void 0 ? void 0 : _builtFromTracker$met4.syncDisabled,\n    source: (_builtFromTracker$met5 = builtFromTracker.meta) === null || _builtFromTracker$met5 === void 0 ? void 0 : _builtFromTracker$met5.source\n  });\n  return builtFromTracker;\n}\nexport function buildAllOems(catalog) {\n  const map = new Map();\n  Object.values((catalog === null || catalog === void 0 ? void 0 : catalog.oemsByModality) || {}).forEach(oems => {\n    (oems || []).forEach(oem => {\n      const key = normalizeKey(oem);\n      if (!key) return;\n      const current = map.get(key);\n      map.set(key, pickPreferredCase(current, oem));\n    });\n  });\n  return Array.from(map.values());\n}\nexport function buildModelsForSelection(catalog, modalities = [], oems = []) {\n  const modelSet = new Set();\n  const modals = normalizeList(modalities);\n  const oemList = normalizeList(oems);\n  modals.forEach(modality => {\n    var _catalog$meta, _catalog$meta$modalit, _catalog$modelsByModa;\n\n    const modalityLower = normalizeKey(modality);\n    const canonicalModality = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta = catalog.meta) === null || _catalog$meta === void 0 ? void 0 : (_catalog$meta$modalit = _catalog$meta.modalityKeyByLower) === null || _catalog$meta$modalit === void 0 ? void 0 : _catalog$meta$modalit[modalityLower]) || modality;\n    const oemMap = (catalog === null || catalog === void 0 ? void 0 : (_catalog$modelsByModa = catalog.modelsByModalityOem) === null || _catalog$modelsByModa === void 0 ? void 0 : _catalog$modelsByModa[canonicalModality]) || {};\n    oemList.forEach(oem => {\n      var _catalog$meta2, _catalog$meta2$oemKey, _catalog$meta2$oemKey2;\n\n      const oemLower = normalizeKey(oem);\n      const canonicalOem = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta2 = catalog.meta) === null || _catalog$meta2 === void 0 ? void 0 : (_catalog$meta2$oemKey = _catalog$meta2.oemKeyByModalityLower) === null || _catalog$meta2$oemKey === void 0 ? void 0 : (_catalog$meta2$oemKey2 = _catalog$meta2$oemKey[modalityLower]) === null || _catalog$meta2$oemKey2 === void 0 ? void 0 : _catalog$meta2$oemKey2[oemLower]) || oem;\n      const models = (oemMap === null || oemMap === void 0 ? void 0 : oemMap[canonicalOem]) || [];\n      models.forEach(model => modelSet.add(model));\n    });\n  });\n  return Array.from(modelSet);\n}\nexport async function syncTrackerFromSelections({\n  selections,\n  catalog\n}) {\n  var _catalog$meta3, _catalog$meta4;\n\n  const db = firebase.firestore();\n  const trackerRef = db.collection(\"Tracker\");\n  const selectedModalities = normalizeList((selections === null || selections === void 0 ? void 0 : selections.modalities) || []);\n  const selectedOems = normalizeList((selections === null || selections === void 0 ? void 0 : selections.oems) || []);\n  const selectedModels = normalizeList((selections === null || selections === void 0 ? void 0 : selections.models) || []);\n  if (!selectedModalities.length) return false;\n  if (catalog !== null && catalog !== void 0 && (_catalog$meta3 = catalog.meta) !== null && _catalog$meta3 !== void 0 && _catalog$meta3.syncDisabled) return false;\n  const ops = [];\n  const usesSubcollections = Boolean(catalog === null || catalog === void 0 ? void 0 : (_catalog$meta4 = catalog.meta) === null || _catalog$meta4 === void 0 ? void 0 : _catalog$meta4.usesSubcollections);\n\n  for (const modality of selectedModalities) {\n    var _catalog$meta5, _catalog$meta5$modali, _catalog$oemsByModali, _catalog$meta8, _catalog$meta8$oemFie, _catalog$modalities2;\n\n    const modalityLower = normalizeKey(modality);\n    const canonicalModality = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta5 = catalog.meta) === null || _catalog$meta5 === void 0 ? void 0 : (_catalog$meta5$modali = _catalog$meta5.modalityKeyByLower) === null || _catalog$meta5$modali === void 0 ? void 0 : _catalog$meta5$modali[modalityLower]) || modalityLower;\n    const docRef = trackerRef.doc(canonicalModality);\n    const existingOemsRaw = (catalog === null || catalog === void 0 ? void 0 : (_catalog$oemsByModali = catalog.oemsByModality) === null || _catalog$oemsByModali === void 0 ? void 0 : _catalog$oemsByModali[canonicalModality]) || [];\n    const existingOemsLower = new Set(existingOemsRaw.map(value => normalizeKey(value)));\n\n    if (usesSubcollections) {\n      var _catalog$modalities;\n\n      if (!(catalog !== null && catalog !== void 0 && (_catalog$modalities = catalog.modalities) !== null && _catalog$modalities !== void 0 && _catalog$modalities.some(existing => normalizeKey(existing) === modalityLower))) {\n        ops.push(docRef.set({\n          updatedAt: firebase.firestore.FieldValue.serverTimestamp()\n        }, {\n          merge: true\n        }));\n      }\n\n      for (const oem of selectedOems) {\n        var _catalog$meta6, _catalog$meta6$oemKey, _catalog$meta6$oemKey2, _catalog$modelsByModa2, _catalog$modelsByModa3, _catalog$meta7, _catalog$meta7$modelK, _catalog$meta7$modelK2;\n\n        const oemLower = normalizeKey(oem);\n        const canonicalOem = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta6 = catalog.meta) === null || _catalog$meta6 === void 0 ? void 0 : (_catalog$meta6$oemKey = _catalog$meta6.oemKeyByModalityLower) === null || _catalog$meta6$oemKey === void 0 ? void 0 : (_catalog$meta6$oemKey2 = _catalog$meta6$oemKey[modalityLower]) === null || _catalog$meta6$oemKey2 === void 0 ? void 0 : _catalog$meta6$oemKey2[oemLower]) || oemLower;\n        const oemRef = docRef.collection(canonicalOem);\n        if (!selectedModels.length) continue;\n        const knownModels = (catalog === null || catalog === void 0 ? void 0 : (_catalog$modelsByModa2 = catalog.modelsByModalityOem) === null || _catalog$modelsByModa2 === void 0 ? void 0 : (_catalog$modelsByModa3 = _catalog$modelsByModa2[canonicalModality]) === null || _catalog$modelsByModa3 === void 0 ? void 0 : _catalog$modelsByModa3[canonicalOem]) || [];\n        const knownLower = new Set(knownModels.map(value => normalizeKey(value)));\n        const modelCaseMap = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta7 = catalog.meta) === null || _catalog$meta7 === void 0 ? void 0 : (_catalog$meta7$modelK = _catalog$meta7.modelKeyByModalityOemLower) === null || _catalog$meta7$modelK === void 0 ? void 0 : (_catalog$meta7$modelK2 = _catalog$meta7$modelK[modalityLower]) === null || _catalog$meta7$modelK2 === void 0 ? void 0 : _catalog$meta7$modelK2[oemLower]) || {};\n\n        for (const model of selectedModels) {\n          const modelLower = normalizeKey(model);\n          if (!modelLower || knownLower.has(modelLower)) continue;\n          const canonicalModel = modelCaseMap[modelLower] || model;\n          ops.push(oemRef.doc(modelLower).set({\n            name: canonicalModel\n          }, {\n            merge: true\n          }));\n        }\n      }\n\n      continue;\n    }\n\n    const oemField = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta8 = catalog.meta) === null || _catalog$meta8 === void 0 ? void 0 : (_catalog$meta8$oemFie = _catalog$meta8.oemFieldByModality) === null || _catalog$meta8$oemFie === void 0 ? void 0 : _catalog$meta8$oemFie[canonicalModality]) || DEFAULT_OEM_FIELD;\n\n    if (!(catalog !== null && catalog !== void 0 && (_catalog$modalities2 = catalog.modalities) !== null && _catalog$modalities2 !== void 0 && _catalog$modalities2.some(existing => normalizeKey(existing) === modalityLower))) {\n      ops.push(docRef.set({\n        [DEFAULT_OEM_FIELD]: {}\n      }, {\n        merge: true\n      }));\n    }\n\n    for (const oem of selectedOems) {\n      var _catalog$meta9, _catalog$meta9$oemKey, _catalog$meta9$oemKey2;\n\n      const oemLower = normalizeKey(oem);\n      const canonicalOem = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta9 = catalog.meta) === null || _catalog$meta9 === void 0 ? void 0 : (_catalog$meta9$oemKey = _catalog$meta9.oemKeyByModalityLower) === null || _catalog$meta9$oemKey === void 0 ? void 0 : (_catalog$meta9$oemKey2 = _catalog$meta9$oemKey[modalityLower]) === null || _catalog$meta9$oemKey2 === void 0 ? void 0 : _catalog$meta9$oemKey2[oemLower]) || oemLower;\n\n      if (!existingOemsLower.has(oemLower)) {\n        ops.push(docRef.set({\n          [oemField]: {\n            [canonicalOem]: []\n          }\n        }, {\n          merge: true\n        }));\n      }\n    }\n\n    for (const oem of selectedOems) {\n      var _catalog$meta10, _catalog$meta10$oemKe, _catalog$meta10$oemKe2, _catalog$modelsByModa4, _catalog$modelsByModa5, _catalog$meta11, _catalog$meta11$model, _catalog$meta11$model2, _catalog$meta12, _catalog$meta12$model, _catalog$meta12$model2;\n\n      const oemLower = normalizeKey(oem);\n      const canonicalOem = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta10 = catalog.meta) === null || _catalog$meta10 === void 0 ? void 0 : (_catalog$meta10$oemKe = _catalog$meta10.oemKeyByModalityLower) === null || _catalog$meta10$oemKe === void 0 ? void 0 : (_catalog$meta10$oemKe2 = _catalog$meta10$oemKe[modalityLower]) === null || _catalog$meta10$oemKe2 === void 0 ? void 0 : _catalog$meta10$oemKe2[oemLower]) || oemLower;\n      const knownModels = (catalog === null || catalog === void 0 ? void 0 : (_catalog$modelsByModa4 = catalog.modelsByModalityOem) === null || _catalog$modelsByModa4 === void 0 ? void 0 : (_catalog$modelsByModa5 = _catalog$modelsByModa4[canonicalModality]) === null || _catalog$modelsByModa5 === void 0 ? void 0 : _catalog$modelsByModa5[canonicalOem]) || [];\n      const knownLower = new Set(knownModels.map(value => normalizeKey(value)));\n      const modelCaseMap = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta11 = catalog.meta) === null || _catalog$meta11 === void 0 ? void 0 : (_catalog$meta11$model = _catalog$meta11.modelKeyByModalityOemLower) === null || _catalog$meta11$model === void 0 ? void 0 : (_catalog$meta11$model2 = _catalog$meta11$model[modalityLower]) === null || _catalog$meta11$model2 === void 0 ? void 0 : _catalog$meta11$model2[oemLower]) || {};\n      const modelField = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta12 = catalog.meta) === null || _catalog$meta12 === void 0 ? void 0 : (_catalog$meta12$model = _catalog$meta12.modelFieldByModalityOem) === null || _catalog$meta12$model === void 0 ? void 0 : (_catalog$meta12$model2 = _catalog$meta12$model[canonicalModality]) === null || _catalog$meta12$model2 === void 0 ? void 0 : _catalog$meta12$model2[canonicalOem]) || null;\n\n      for (const model of selectedModels) {\n        const modelLower = normalizeKey(model);\n        if (!modelLower || knownLower.has(modelLower)) continue;\n        const canonicalModel = modelCaseMap[modelLower] || model;\n        const path = modelField ? `${oemField}.${canonicalOem}.${modelField}` : `${oemField}.${canonicalOem}`;\n        ops.push(docRef.update({\n          [path]: firebase.firestore.FieldValue.arrayUnion(canonicalModel)\n        }));\n      }\n    }\n  }\n\n  if (ops.length) {\n    await Promise.allSettled(ops);\n    return true;\n  }\n\n  return false;\n}\nexport async function deleteTrackerOem({\n  oem,\n  catalog\n}) {\n  var _catalog$meta13;\n\n  if (!oem) return;\n  const db = firebase.firestore();\n  const trackerRef = db.collection(\"Tracker\");\n  const modalities = (catalog === null || catalog === void 0 ? void 0 : catalog.modalities) || [];\n  const usesSubcollections = Boolean(catalog === null || catalog === void 0 ? void 0 : (_catalog$meta13 = catalog.meta) === null || _catalog$meta13 === void 0 ? void 0 : _catalog$meta13.usesSubcollections);\n  const ops = modalities.map(modality => {\n    var _catalog$meta14, _catalog$meta14$modal, _catalog$meta15, _catalog$meta15$oemKe, _catalog$meta15$oemKe2, _catalog$meta16, _catalog$meta16$oemFi, _catalog$meta17, _catalog$meta17$oemFi;\n\n    const modalityLower = normalizeKey(modality);\n    const canonicalModality = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta14 = catalog.meta) === null || _catalog$meta14 === void 0 ? void 0 : (_catalog$meta14$modal = _catalog$meta14.modalityKeyByLower) === null || _catalog$meta14$modal === void 0 ? void 0 : _catalog$meta14$modal[modalityLower]) || modality;\n    const docRef = trackerRef.doc(canonicalModality);\n    const canonicalOem = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta15 = catalog.meta) === null || _catalog$meta15 === void 0 ? void 0 : (_catalog$meta15$oemKe = _catalog$meta15.oemKeyByModalityLower) === null || _catalog$meta15$oemKe === void 0 ? void 0 : (_catalog$meta15$oemKe2 = _catalog$meta15$oemKe[modalityLower]) === null || _catalog$meta15$oemKe2 === void 0 ? void 0 : _catalog$meta15$oemKe2[normalizeKey(oem)]) || oem;\n\n    if (usesSubcollections) {\n      return docRef.collection(canonicalOem).get().then(snap => {\n        const deletions = [];\n        snap.forEach(doc => {\n          deletions.push(doc.ref.delete());\n        });\n        return Promise.allSettled(deletions);\n      }).catch(() => null);\n    }\n\n    const oemField = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta16 = catalog.meta) === null || _catalog$meta16 === void 0 ? void 0 : (_catalog$meta16$oemFi = _catalog$meta16.oemFieldByModality) === null || _catalog$meta16$oemFi === void 0 ? void 0 : _catalog$meta16$oemFi[canonicalModality]) || DEFAULT_OEM_FIELD;\n    const update = {\n      [`${oemField}.${canonicalOem}`]: firebase.firestore.FieldValue.delete()\n    };\n\n    if (!(catalog !== null && catalog !== void 0 && (_catalog$meta17 = catalog.meta) !== null && _catalog$meta17 !== void 0 && (_catalog$meta17$oemFi = _catalog$meta17.oemFieldByModality) !== null && _catalog$meta17$oemFi !== void 0 && _catalog$meta17$oemFi[canonicalModality])) {\n      update[canonicalOem] = firebase.firestore.FieldValue.delete();\n    }\n\n    return docRef.update(update).catch(() => null);\n  });\n  await Promise.allSettled(ops);\n}\nexport async function deleteTrackerModel({\n  modality,\n  oem,\n  model,\n  catalog\n}) {\n  var _catalog$meta18, _catalog$meta18$modal, _catalog$meta19, _catalog$meta19$oemKe, _catalog$meta19$oemKe2, _catalog$meta20, _catalog$meta21, _catalog$meta21$oemFi, _catalog$meta22, _catalog$meta22$model, _catalog$meta22$model2;\n\n  if (!modality || !oem || !model) return;\n  const db = firebase.firestore();\n  const modalityLower = normalizeKey(modality);\n  const canonicalModality = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta18 = catalog.meta) === null || _catalog$meta18 === void 0 ? void 0 : (_catalog$meta18$modal = _catalog$meta18.modalityKeyByLower) === null || _catalog$meta18$modal === void 0 ? void 0 : _catalog$meta18$modal[modalityLower]) || modality;\n  const docRef = db.collection(\"Tracker\").doc(canonicalModality);\n  const canonicalOem = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta19 = catalog.meta) === null || _catalog$meta19 === void 0 ? void 0 : (_catalog$meta19$oemKe = _catalog$meta19.oemKeyByModalityLower) === null || _catalog$meta19$oemKe === void 0 ? void 0 : (_catalog$meta19$oemKe2 = _catalog$meta19$oemKe[modalityLower]) === null || _catalog$meta19$oemKe2 === void 0 ? void 0 : _catalog$meta19$oemKe2[normalizeKey(oem)]) || oem;\n\n  if (catalog !== null && catalog !== void 0 && (_catalog$meta20 = catalog.meta) !== null && _catalog$meta20 !== void 0 && _catalog$meta20.usesSubcollections) {\n    const modelKey = normalizeKey(model);\n    await docRef.collection(canonicalOem).doc(modelKey).delete().catch(() => null);\n    return;\n  }\n\n  const oemField = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta21 = catalog.meta) === null || _catalog$meta21 === void 0 ? void 0 : (_catalog$meta21$oemFi = _catalog$meta21.oemFieldByModality) === null || _catalog$meta21$oemFi === void 0 ? void 0 : _catalog$meta21$oemFi[canonicalModality]) || DEFAULT_OEM_FIELD;\n  const modelField = (catalog === null || catalog === void 0 ? void 0 : (_catalog$meta22 = catalog.meta) === null || _catalog$meta22 === void 0 ? void 0 : (_catalog$meta22$model = _catalog$meta22.modelFieldByModalityOem) === null || _catalog$meta22$model === void 0 ? void 0 : (_catalog$meta22$model2 = _catalog$meta22$model[canonicalModality]) === null || _catalog$meta22$model2 === void 0 ? void 0 : _catalog$meta22$model2[canonicalOem]) || null;\n  const path = modelField ? `${oemField}.${canonicalOem}.${modelField}` : `${oemField}.${canonicalOem}`;\n  await docRef.update({\n    [path]: firebase.firestore.FieldValue.arrayRemove(model)\n  });\n}","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/utils/trackerCatalog.js"],"names":["firebase","OEM_FIELD_CANDIDATES","MODEL_FIELD_CANDIDATES","DEFAULT_OEM_FIELD","isPlainObject","value","Array","isArray","Date","normalizeKey","String","trim","toLowerCase","hasUpper","test","pickPreferredCase","current","incoming","currentUpper","incomingUpper","normalizeArray","normalizeList","values","out","forEach","normalized","push","from","Set","normalizeListCaseInsensitive","map","Map","key","get","set","pickModelField","obj","arrayKey","Object","keys","find","extractModels","models","modelField","extractOemMap","data","oemMap","modelFieldByOem","oemField","entry","name","oem","OEM","label","normalizedName","list","items","entries","startsWith","length","buildCatalogFromMachines","db","firestore","snap","collection","modalityMap","oemMapByModality","modelMapByModalityOem","ensureDisplay","display","doc","modalityRaw","Modality","modality","oemRaw","modalityLower","oemKeyMap","modelRaw","Model","model","modelKey","oemLower","modelMap","modalities","oemsByModality","modelsByModalityOem","oems","modelByOem","buildCatalogMetaFromMaps","usesSubcollections","syncDisabled","source","buildCatalogFromTestItems","machine","TheMachine","resolveModalitiesInTracker","candidates","confirmed","seen","candidate","raw","lower","upper","toUpperCase","ids","filter","found","id","has","exists","error","add","mergeCatalogs","baseCatalog","extraCatalog","baseModalities","baseMeta","meta","allowedSet","modalityKey","canonicalModality","modalityKeyByLower","mergedOems","extraModels","destModels","oemFieldByModality","modelFieldByModalityOem","oemKeyByModalityLower","modelKeyByModalityOemLower","normalizedModalities","oemLowerMap","modelLowerMap","modelLower","fetchTrackerCatalog","cached","readCatalogCache","builtCached","Boolean","cachedOems","buildAllOems","MIN_MODALITIES_FOR_CACHE","MIN_OEMS_FOR_CACHE","window","localStorage","removeItem","CATALOG_CACHE_KEY","shouldSkipApi","response","fetch","ok","payload","json","built","writeCatalogCache","noteApiFailure","console","warn","existingModality","existingOem","canonicalOem","existingModels","mergedModels","builtFromTracker","allOems","builtFromMachines","builtFromTest","candidateModalities","expandedBase","merged","catalog","buildModelsForSelection","modelSet","modals","oemList","syncTrackerFromSelections","selections","trackerRef","selectedModalities","selectedOems","selectedModels","ops","docRef","existingOemsRaw","existingOemsLower","some","existing","updatedAt","FieldValue","serverTimestamp","merge","oemRef","knownModels","knownLower","modelCaseMap","canonicalModel","path","update","arrayUnion","Promise","allSettled","deleteTrackerOem","then","deletions","ref","delete","catch","deleteTrackerModel","arrayRemove"],"mappings":"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","sourcesContent":["import firebase from \"../context/Firebase\";\n\nconst OEM_FIELD_CANDIDATES = [\"oems\", \"OEMs\", \"oem\", \"OEM\"];\nconst MODEL_FIELD_CANDIDATES = [\"models\", \"Models\", \"model\", \"Model\", \"list\", \"items\"];\nconst DEFAULT_OEM_FIELD = \"oems\";\n\nconst isPlainObject = (value) =>\n  value != null &&\n  typeof value === \"object\" &&\n  !Array.isArray(value) &&\n  !(value instanceof Date);\n\nconst normalizeKey = (value) => {\n  if (value == null) return \"\";\n  return String(value).trim().toLowerCase();\n};\n\nconst hasUpper = (value) => /[A-Z]/.test(String(value || \"\"));\n\nconst pickPreferredCase = (current, incoming) => {\n  if (!current) return incoming;\n  if (!incoming) return current;\n  const currentUpper = hasUpper(current);\n  const incomingUpper = hasUpper(incoming);\n  if (incomingUpper && !currentUpper) return incoming;\n  if (currentUpper && !incomingUpper) return current;\n  return current;\n};\n\nconst normalizeArray = (value) => {\n  if (Array.isArray(value)) return value;\n  if (value == null || value === \"\") return [];\n  return [value];\n};\n\nconst normalizeList = (values) => {\n  const out = [];\n  (values || []).forEach((value) => {\n    if (value == null) return;\n    const normalized = String(value).trim();\n    if (!normalized) return;\n    if (normalizeKey(normalized) === \"nan\") return;\n    out.push(normalized);\n  });\n  return Array.from(new Set(out));\n};\n\nconst normalizeListCaseInsensitive = (values) => {\n  const map = new Map();\n  (values || []).forEach((value) => {\n    if (value == null) return;\n    const normalized = String(value).trim();\n    if (!normalized) return;\n    const key = normalizeKey(normalized);\n    if (!key || key === \"nan\") return;\n    const current = map.get(key);\n    map.set(key, pickPreferredCase(current, normalized));\n  });\n  return Array.from(map.values());\n};\n\n\nconst pickModelField = (obj) => {\n  if (!isPlainObject(obj)) return null;\n  for (const key of MODEL_FIELD_CANDIDATES) {\n    if (Array.isArray(obj[key])) return key;\n  }\n  const arrayKey = Object.keys(obj).find((key) => Array.isArray(obj[key]));\n  return arrayKey || null;\n};\n\nconst extractModels = (value) => {\n  if (Array.isArray(value)) {\n    return { models: normalizeList(value), modelField: null };\n  }\n  if (isPlainObject(value)) {\n    const modelField = pickModelField(value);\n    const models = modelField ? normalizeList(value[modelField]) : [];\n    return { models, modelField };\n  }\n  if (value != null && value !== \"\") {\n    return { models: normalizeList([value]), modelField: null };\n  }\n  return { models: [], modelField: null };\n};\n\nconst extractOemMap = (data) => {\n  const oemMap = {};\n  const modelFieldByOem = {};\n  let oemField = null;\n\n  for (const key of OEM_FIELD_CANDIDATES) {\n    if (Array.isArray(data?.[key])) {\n      oemField = key;\n      data[key].forEach((entry) => {\n        if (entry == null) return;\n        if (isPlainObject(entry)) {\n          const name =\n            entry.name ||\n            entry.oem ||\n            entry.OEM ||\n            entry.label ||\n            entry.value;\n          if (!name) return;\n          const normalizedName = String(name).trim();\n          if (!normalizedName) return;\n          const { models } = extractModels(entry.models || entry.list || entry.items);\n          oemMap[normalizedName] = normalizeList([\n            ...(oemMap[normalizedName] || []),\n            ...models,\n          ]);\n          return;\n        }\n        const normalized = String(entry || \"\").trim();\n        if (!normalized) return;\n        oemMap[normalized] = normalizeList([...(oemMap[normalized] || [])]);\n      });\n    } else if (isPlainObject(data?.[key])) {\n      oemField = key;\n      Object.entries(data[key]).forEach(([oem, value]) => {\n        const { models, modelField } = extractModels(value);\n        oemMap[oem] = normalizeList([...(oemMap[oem] || []), ...models]);\n        if (modelField) {\n          modelFieldByOem[oem] = modelField;\n        }\n      });\n    }\n  }\n\n  if (!oemField) {\n    Object.entries(data || {}).forEach(([key, value]) => {\n      if (!value) return;\n      if (key.startsWith(\"_\")) return;\n      if (isPlainObject(value) || Array.isArray(value)) {\n        const { models, modelField } = extractModels(value);\n        if (models.length || modelField) {\n          oemMap[key] = normalizeList([...(oemMap[key] || []), ...models]);\n          if (modelField) {\n            modelFieldByOem[key] = modelField;\n          }\n        }\n      }\n    });\n  }\n\n  return { oemMap, oemField, modelFieldByOem };\n};\n\nconst buildCatalogFromMachines = async () => {\n  const db = firebase.firestore();\n  const snap = await db\n    .collection(\"Machine\")\n    .get();\n\n  const modalityMap = new Map();\n  const oemMapByModality = new Map();\n  const modelMapByModalityOem = new Map();\n\n  const ensureDisplay = (map, value) => {\n    const key = normalizeKey(value);\n    if (!key) return null;\n    const current = map.get(key);\n    const display = pickPreferredCase(current, String(value).trim());\n    map.set(key, display);\n    return display;\n  };\n\n  snap.forEach((doc) => {\n    const data = doc.data() || {};\n    const modalityRaw = data.Modality || data.modality;\n    const oemRaw = data.OEM || data.oem;\n    if (!modalityRaw || !oemRaw) return;\n    const modality = ensureDisplay(modalityMap, modalityRaw);\n    if (!modality) return;\n    const modalityLower = normalizeKey(modality);\n    const oemKeyMap =\n      oemMapByModality.get(modalityLower) || new Map();\n    oemMapByModality.set(modalityLower, oemKeyMap);\n    const oem = ensureDisplay(oemKeyMap, oemRaw);\n    if (!oem) return;\n    const modelRaw = data.Model || data.model;\n    if (!modelRaw) return;\n    const modelKey =\n      modelMapByModalityOem.get(modalityLower) || new Map();\n    modelMapByModalityOem.set(modalityLower, modelKey);\n    const oemLower = normalizeKey(oem);\n    const modelMap = modelKey.get(oemLower) || new Map();\n    modelKey.set(oemLower, modelMap);\n    ensureDisplay(modelMap, modelRaw);\n  });\n\n  const modalities = Array.from(modalityMap.values());\n  const oemsByModality = {};\n  const modelsByModalityOem = {};\n\n  modalities.forEach((modality) => {\n    const modalityLower = normalizeKey(modality);\n    const oemMap = oemMapByModality.get(modalityLower) || new Map();\n    const oems = Array.from(oemMap.values());\n    oemsByModality[modality] = oems;\n    const modelMap = modelMapByModalityOem.get(modalityLower) || new Map();\n    const modelByOem = {};\n    oems.forEach((oem) => {\n      const oemLower = normalizeKey(oem);\n      const models = Array.from(\n        (modelMap.get(oemLower) || new Map()).values()\n      );\n      if (models.length) modelByOem[oem] = models;\n    });\n    modelsByModalityOem[modality] = modelByOem;\n  });\n\n  return buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: false,\n    source: \"machine\",\n  });\n};\n\nconst buildCatalogFromTestItems = async () => {\n  const db = firebase.firestore();\n  const snap = await db\n    .collection(\"Test\")\n    .get();\n\n  const modalityMap = new Map();\n  const oemMapByModality = new Map();\n  const modelMapByModalityOem = new Map();\n\n  const ensureDisplay = (map, value) => {\n    const key = normalizeKey(value);\n    if (!key) return null;\n    const current = map.get(key);\n    const display = pickPreferredCase(current, String(value).trim());\n    map.set(key, display);\n    return display;\n  };\n\n  snap.forEach((doc) => {\n    const data = doc.data() || {};\n    const machine = data.TheMachine || {};\n    const modalityRaw =\n      machine.Modality || machine.modality || data.Modality || data.modality;\n    const oemRaw =\n      machine.OEM || machine.oem || data.OEM || data.oem;\n    if (!modalityRaw || !oemRaw) return;\n    const modality = ensureDisplay(modalityMap, modalityRaw);\n    if (!modality) return;\n    const modalityLower = normalizeKey(modality);\n    const oemKeyMap =\n      oemMapByModality.get(modalityLower) || new Map();\n    oemMapByModality.set(modalityLower, oemKeyMap);\n    const oem = ensureDisplay(oemKeyMap, oemRaw);\n    if (!oem) return;\n    const modelRaw =\n      machine.Model || machine.model || data.Model || data.model;\n    if (!modelRaw) return;\n    const modelKey =\n      modelMapByModalityOem.get(modalityLower) || new Map();\n    modelMapByModalityOem.set(modalityLower, modelKey);\n    const oemLower = normalizeKey(oem);\n    const modelMap = modelKey.get(oemLower) || new Map();\n    modelKey.set(oemLower, modelMap);\n    ensureDisplay(modelMap, modelRaw);\n  });\n\n  const modalities = Array.from(modalityMap.values());\n  const oemsByModality = {};\n  const modelsByModalityOem = {};\n\n  modalities.forEach((modality) => {\n    const modalityLower = normalizeKey(modality);\n    const oemMap = oemMapByModality.get(modalityLower) || new Map();\n    const oems = Array.from(oemMap.values());\n    oemsByModality[modality] = oems;\n    const modelMap = modelMapByModalityOem.get(modalityLower) || new Map();\n    const modelByOem = {};\n    oems.forEach((oem) => {\n      const oemLower = normalizeKey(oem);\n      const models = Array.from(\n        (modelMap.get(oemLower) || new Map()).values()\n      );\n      if (models.length) modelByOem[oem] = models;\n    });\n    modelsByModalityOem[modality] = modelByOem;\n  });\n\n  return buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: false,\n    source: \"test\",\n  });\n};\n\nconst resolveModalitiesInTracker = async (db, candidates = []) => {\n  const confirmed = [];\n  const seen = new Set();\n  for (const candidate of candidates) {\n    const raw = String(candidate || \"\").trim();\n    if (!raw) continue;\n    const lower = normalizeKey(raw);\n    const upper = raw.toUpperCase();\n    const ids = Array.from(\n      new Set([raw, lower, upper].filter((value) => value))\n    );\n    let found = null;\n    for (const id of ids) {\n      if (seen.has(id)) continue;\n      try {\n        const doc = await db.collection(\"Tracker\").doc(id).get();\n        if (doc.exists) {\n          found = doc.id;\n          break;\n        }\n      } catch (error) {\n        // ignore permission/other errors\n      }\n    }\n    if (found) {\n      const key = normalizeKey(found);\n      if (!seen.has(key)) {\n        seen.add(key);\n        confirmed.push(found);\n      }\n    }\n  }\n  return normalizeListCaseInsensitive(confirmed);\n};\n\nconst mergeCatalogs = (baseCatalog, extraCatalog, source) => {\n  const baseModalities = baseCatalog?.modalities || [];\n  const baseMeta = baseCatalog?.meta || {};\n  const allowedSet = baseModalities.length\n    ? new Set(baseModalities.map((value) => normalizeKey(value)))\n    : null;\n\n  const modalities = allowedSet\n    ? baseModalities\n    : normalizeListCaseInsensitive([\n        ...baseModalities,\n        ...(extraCatalog?.modalities || []),\n      ]);\n\n  const oemsByModality = { ...(baseCatalog?.oemsByModality || {}) };\n  const modelsByModalityOem = {\n    ...(baseCatalog?.modelsByModalityOem || {}),\n  };\n\n  Object.entries(extraCatalog?.oemsByModality || {}).forEach(\n    ([modality, oems]) => {\n      const modalityKey = normalizeKey(modality);\n      if (allowedSet && !allowedSet.has(modalityKey)) return;\n      const canonicalModality =\n        baseMeta?.modalityKeyByLower?.[modalityKey] ||\n        modalities.find((value) => normalizeKey(value) === modalityKey) ||\n        modality;\n      const mergedOems = normalizeListCaseInsensitive([\n        ...(oemsByModality[canonicalModality] || []),\n        ...(oems || []),\n      ]);\n      oemsByModality[canonicalModality] = mergedOems;\n\n      const extraModels =\n        extraCatalog?.modelsByModalityOem?.[modality] || {};\n      const destModels =\n        modelsByModalityOem[canonicalModality] || {};\n      Object.entries(extraModels).forEach(([oem, models]) => {\n        destModels[oem] = normalizeListCaseInsensitive([\n          ...(destModels[oem] || []),\n          ...(models || []),\n        ]);\n      });\n      modelsByModalityOem[canonicalModality] = destModels;\n    }\n  );\n\n  return buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: false,\n    source,\n  });\n};\n\nconst buildCatalogMetaFromMaps = ({\n  modalities = [],\n  oemsByModality = {},\n  modelsByModalityOem = {},\n  usesSubcollections = false,\n  syncDisabled = false,\n  source = \"client\",\n}) => {\n  const meta = {\n    oemFieldByModality: {},\n    modelFieldByModalityOem: {},\n    modalityKeyByLower: {},\n    oemKeyByModalityLower: {},\n    modelKeyByModalityOemLower: {},\n    usesSubcollections,\n    syncDisabled,\n    source,\n  };\n\n  const normalizedModalities = normalizeListCaseInsensitive(modalities);\n  normalizedModalities.forEach((modality) => {\n    const modalityLower = normalizeKey(modality);\n    meta.modalityKeyByLower[modalityLower] = pickPreferredCase(\n      meta.modalityKeyByLower[modalityLower],\n      modality\n    );\n    const oems = oemsByModality?.[modality] || [];\n    const oemLowerMap =\n      meta.oemKeyByModalityLower[modalityLower] || {};\n    meta.oemKeyByModalityLower[modalityLower] = oemLowerMap;\n    const modelLowerMap =\n      meta.modelKeyByModalityOemLower[modalityLower] || {};\n    meta.modelKeyByModalityOemLower[modalityLower] = modelLowerMap;\n\n    oems.forEach((oem) => {\n      const oemLower = normalizeKey(oem);\n      oemLowerMap[oemLower] = pickPreferredCase(oemLowerMap[oemLower], oem);\n      const models = modelsByModalityOem?.[modality]?.[oem] || [];\n      modelLowerMap[oemLower] = modelLowerMap[oemLower] || {};\n      models.forEach((model) => {\n        const modelLower = normalizeKey(model);\n        if (!modelLower) return;\n        modelLowerMap[oemLower][modelLower] = pickPreferredCase(\n          modelLowerMap[oemLower][modelLower],\n          model\n        );\n      });\n    });\n  });\n\n  return {\n    modalities: normalizedModalities,\n    oemsByModality,\n    modelsByModalityOem,\n    meta,\n  };\n};\n\nexport async function fetchTrackerCatalog() {\n  if (typeof window !== \"undefined\") {\n    const cached = readCatalogCache();\n    if (cached?.modalities) {\n      const builtCached = buildCatalogMetaFromMaps({\n        modalities: cached.modalities || [],\n        oemsByModality: cached.oemsByModality || {},\n        modelsByModalityOem: cached.modelsByModalityOem || {},\n        usesSubcollections: Boolean(cached.usesSubcollections),\n        syncDisabled: Boolean(cached.syncDisabled),\n        source: cached.source || \"cache\",\n      });\n      const cachedOems = buildAllOems(builtCached);\n      if (\n        builtCached.modalities.length >= MIN_MODALITIES_FOR_CACHE &&\n        cachedOems.length >= MIN_OEMS_FOR_CACHE\n      ) {\n        return builtCached;\n      }\n      try {\n        window.localStorage.removeItem(CATALOG_CACHE_KEY);\n      } catch (error) {\n        // ignore\n      }\n    }\n  }\n\n  if (typeof window !== \"undefined\" && !shouldSkipApi()) {\n    try {\n      const response = await fetch(\"/api/tracker/catalog\");\n      if (response.ok) {\n        const payload = await response.json();\n        if (payload?.modalities) {\n          const built = buildCatalogMetaFromMaps({\n            modalities: payload.modalities || [],\n            oemsByModality: payload.oemsByModality || {},\n            modelsByModalityOem: payload.modelsByModalityOem || {},\n            usesSubcollections: Boolean(payload.usesSubcollections),\n            syncDisabled: false,\n            source: \"server\",\n          });\n          writeCatalogCache({\n            modalities: built.modalities,\n            oemsByModality: built.oemsByModality,\n            modelsByModalityOem: built.modelsByModalityOem,\n            usesSubcollections: built.meta?.usesSubcollections,\n            syncDisabled: built.meta?.syncDisabled,\n            source: built.meta?.source,\n          });\n          return built;\n        }\n      } else {\n        noteApiFailure();\n      }\n    } catch (error) {\n      console.warn(\"Tracker catalog API fallback:\", error);\n      noteApiFailure();\n    }\n  } else if (typeof window !== \"undefined\") {\n    noteApiFailure();\n  }\n\n  const db = firebase.firestore();\n  const snap = await db.collection(\"Tracker\").get();\n\n  const modalities = [];\n  const oemsByModality = {};\n  const modelsByModalityOem = {};\n  const meta = {\n    oemFieldByModality: {},\n    modelFieldByModalityOem: {},\n    modalityKeyByLower: {},\n    oemKeyByModalityLower: {},\n    modelKeyByModalityOemLower: {},\n  };\n\n  snap.forEach((doc) => {\n    const modality = doc.id;\n    const modalityLower = normalizeKey(modality);\n    const existingModality = meta.modalityKeyByLower[modalityLower];\n    const canonicalModality = pickPreferredCase(existingModality, modality);\n    meta.modalityKeyByLower[modalityLower] = canonicalModality;\n    const data = doc.data() || {};\n    const { oemMap, oemField, modelFieldByOem } = extractOemMap(data);\n\n    if (existingModality && existingModality !== canonicalModality) {\n      oemsByModality[canonicalModality] = normalizeListCaseInsensitive([\n        ...(oemsByModality[existingModality] || []),\n        ...(oemsByModality[canonicalModality] || []),\n      ]);\n      modelsByModalityOem[canonicalModality] = {\n        ...(modelsByModalityOem[existingModality] || {}),\n        ...(modelsByModalityOem[canonicalModality] || {}),\n      };\n      meta.modelFieldByModalityOem[canonicalModality] = {\n        ...(meta.modelFieldByModalityOem[existingModality] || {}),\n        ...(meta.modelFieldByModalityOem[canonicalModality] || {}),\n      };\n      if (!meta.oemFieldByModality[canonicalModality]) {\n        meta.oemFieldByModality[canonicalModality] =\n          meta.oemFieldByModality[existingModality] || oemField;\n      }\n      delete oemsByModality[existingModality];\n      delete modelsByModalityOem[existingModality];\n      delete meta.oemFieldByModality[existingModality];\n      delete meta.modelFieldByModalityOem[existingModality];\n    }\n\n    modalities.push(canonicalModality);\n    if (!meta.oemFieldByModality[canonicalModality]) {\n      meta.oemFieldByModality[canonicalModality] = oemField;\n    }\n    meta.modelFieldByModalityOem[canonicalModality] = {\n      ...(meta.modelFieldByModalityOem[canonicalModality] || {}),\n      ...(modelFieldByOem || {}),\n    };\n\n    const oems = Object.keys(oemMap);\n    const mergedOems = normalizeListCaseInsensitive([\n      ...(oemsByModality[canonicalModality] || []),\n      ...oems,\n    ]);\n    oemsByModality[canonicalModality] = mergedOems;\n    modelsByModalityOem[canonicalModality] =\n      modelsByModalityOem[canonicalModality] || {};\n    const oemLowerMap =\n      meta.oemKeyByModalityLower[modalityLower] || {};\n    meta.oemKeyByModalityLower[modalityLower] = oemLowerMap;\n    const modelLowerMap =\n      meta.modelKeyByModalityOemLower[modalityLower] || {};\n    meta.modelKeyByModalityOemLower[modalityLower] = modelLowerMap;\n    oems.forEach((oem) => {\n      const oemLower = normalizeKey(oem);\n      const existingOem = oemLowerMap[oemLower];\n      const canonicalOem = pickPreferredCase(existingOem, oem);\n      oemLowerMap[oemLower] = canonicalOem;\n      if (existingOem && existingOem !== canonicalOem) {\n        modelsByModalityOem[canonicalModality][canonicalOem] = normalizeListCaseInsensitive([\n          ...(modelsByModalityOem[canonicalModality][existingOem] || []),\n          ...(modelsByModalityOem[canonicalModality][canonicalOem] || []),\n        ]);\n        delete modelsByModalityOem[canonicalModality][existingOem];\n      }\n      const existingModels =\n        modelsByModalityOem[canonicalModality][canonicalOem] || [];\n      const mergedModels = normalizeListCaseInsensitive([\n        ...existingModels,\n        ...(oemMap[oem] || []),\n      ]);\n      modelsByModalityOem[canonicalModality][canonicalOem] = mergedModels;\n      modelLowerMap[oemLower] = modelLowerMap[oemLower] || {};\n      mergedModels.forEach((model) => {\n        modelLowerMap[oemLower][normalizeKey(model)] = model;\n      });\n    });\n  });\n\n  const builtFromTracker = buildCatalogMetaFromMaps({\n    modalities,\n    oemsByModality,\n    modelsByModalityOem,\n    usesSubcollections: true,\n    syncDisabled: true,\n    source: \"client\",\n  });\n\n  const allOems = buildAllOems(builtFromTracker);\n  if (\n    builtFromTracker.modalities.length < MIN_MODALITIES_FOR_CACHE ||\n    allOems.length < MIN_OEMS_FOR_CACHE\n  ) {\n    let builtFromMachines = null;\n    let builtFromTest = null;\n\n    try {\n      builtFromMachines = await buildCatalogFromMachines();\n    } catch (error) {\n      console.warn(\"Tracker catalog machine fallback failed:\", error);\n    }\n\n    try {\n      builtFromTest = await buildCatalogFromTestItems();\n    } catch (error) {\n      console.warn(\"Tracker catalog test fallback failed:\", error);\n    }\n\n    const candidateModalities = normalizeListCaseInsensitive([\n      ...(builtFromMachines?.modalities || []),\n      ...(builtFromTest?.modalities || []),\n    ]);\n\n    let expandedBase = builtFromTracker;\n    if (candidateModalities.length) {\n      try {\n        const confirmed = await resolveModalitiesInTracker(\n          db,\n          candidateModalities\n        );\n        if (confirmed.length) {\n          expandedBase = buildCatalogMetaFromMaps({\n            modalities: normalizeListCaseInsensitive([\n              ...builtFromTracker.modalities,\n              ...confirmed,\n            ]),\n            oemsByModality: builtFromTracker.oemsByModality,\n            modelsByModalityOem: builtFromTracker.modelsByModalityOem,\n            usesSubcollections: true,\n            syncDisabled: builtFromTracker.meta?.syncDisabled,\n            source: builtFromTracker.meta?.source,\n          });\n        }\n      } catch (error) {\n        // ignore\n      }\n    }\n\n    let merged = expandedBase;\n    if (builtFromMachines) {\n      merged = mergeCatalogs(merged, builtFromMachines, \"machine+tracker\");\n    }\n    if (builtFromTest) {\n      merged = mergeCatalogs(merged, builtFromTest, \"test+tracker\");\n    }\n\n    if (merged?.modalities?.length) {\n      writeCatalogCache({\n        modalities: merged.modalities,\n        oemsByModality: merged.oemsByModality,\n        modelsByModalityOem: merged.modelsByModalityOem,\n        usesSubcollections: merged.meta?.usesSubcollections,\n        syncDisabled: merged.meta?.syncDisabled,\n        source: merged.meta?.source,\n      });\n      return merged;\n    }\n  }\n\n  writeCatalogCache({\n    modalities: builtFromTracker.modalities,\n    oemsByModality: builtFromTracker.oemsByModality,\n    modelsByModalityOem: builtFromTracker.modelsByModalityOem,\n    usesSubcollections: builtFromTracker.meta?.usesSubcollections,\n    syncDisabled: builtFromTracker.meta?.syncDisabled,\n    source: builtFromTracker.meta?.source,\n  });\n\n  return builtFromTracker;\n}\n\nexport function buildAllOems(catalog) {\n  const map = new Map();\n  Object.values(catalog?.oemsByModality || {}).forEach((oems) => {\n    (oems || []).forEach((oem) => {\n      const key = normalizeKey(oem);\n      if (!key) return;\n      const current = map.get(key);\n      map.set(key, pickPreferredCase(current, oem));\n    });\n  });\n  return Array.from(map.values());\n}\n\nexport function buildModelsForSelection(catalog, modalities = [], oems = []) {\n  const modelSet = new Set();\n  const modals = normalizeList(modalities);\n  const oemList = normalizeList(oems);\n  modals.forEach((modality) => {\n    const modalityLower = normalizeKey(modality);\n    const canonicalModality =\n      catalog?.meta?.modalityKeyByLower?.[modalityLower] || modality;\n    const oemMap = catalog?.modelsByModalityOem?.[canonicalModality] || {};\n    oemList.forEach((oem) => {\n      const oemLower = normalizeKey(oem);\n      const canonicalOem =\n        catalog?.meta?.oemKeyByModalityLower?.[modalityLower]?.[oemLower] || oem;\n      const models = oemMap?.[canonicalOem] || [];\n      models.forEach((model) => modelSet.add(model));\n    });\n  });\n  return Array.from(modelSet);\n}\n\nexport async function syncTrackerFromSelections({\n  selections,\n  catalog,\n}) {\n  const db = firebase.firestore();\n  const trackerRef = db.collection(\"Tracker\");\n  const selectedModalities = normalizeList(selections?.modalities || []);\n  const selectedOems = normalizeList(selections?.oems || []);\n  const selectedModels = normalizeList(selections?.models || []);\n\n  if (!selectedModalities.length) return false;\n  if (catalog?.meta?.syncDisabled) return false;\n\n  const ops = [];\n  const usesSubcollections = Boolean(catalog?.meta?.usesSubcollections);\n\n  for (const modality of selectedModalities) {\n    const modalityLower = normalizeKey(modality);\n    const canonicalModality =\n      catalog?.meta?.modalityKeyByLower?.[modalityLower] || modalityLower;\n    const docRef = trackerRef.doc(canonicalModality);\n    const existingOemsRaw = catalog?.oemsByModality?.[canonicalModality] || [];\n    const existingOemsLower = new Set(\n      existingOemsRaw.map((value) => normalizeKey(value))\n    );\n\n    if (usesSubcollections) {\n      if (\n        !catalog?.modalities?.some(\n          (existing) => normalizeKey(existing) === modalityLower\n        )\n      ) {\n        ops.push(docRef.set({ updatedAt: firebase.firestore.FieldValue.serverTimestamp() }, { merge: true }));\n      }\n\n      for (const oem of selectedOems) {\n        const oemLower = normalizeKey(oem);\n        const canonicalOem =\n          catalog?.meta?.oemKeyByModalityLower?.[modalityLower]?.[oemLower] ||\n          oemLower;\n        const oemRef = docRef.collection(canonicalOem);\n\n        if (!selectedModels.length) continue;\n        const knownModels =\n          catalog?.modelsByModalityOem?.[canonicalModality]?.[canonicalOem] || [];\n        const knownLower = new Set(\n          knownModels.map((value) => normalizeKey(value))\n        );\n        const modelCaseMap =\n          catalog?.meta?.modelKeyByModalityOemLower?.[modalityLower]?.[oemLower] ||\n          {};\n\n        for (const model of selectedModels) {\n          const modelLower = normalizeKey(model);\n          if (!modelLower || knownLower.has(modelLower)) continue;\n          const canonicalModel = modelCaseMap[modelLower] || model;\n          ops.push(\n            oemRef.doc(modelLower).set(\n              { name: canonicalModel },\n              { merge: true }\n            )\n          );\n        }\n      }\n      continue;\n    }\n\n    const oemField =\n      catalog?.meta?.oemFieldByModality?.[canonicalModality] ||\n      DEFAULT_OEM_FIELD;\n\n    if (\n      !catalog?.modalities?.some(\n        (existing) => normalizeKey(existing) === modalityLower\n      )\n    ) {\n      ops.push(docRef.set({ [DEFAULT_OEM_FIELD]: {} }, { merge: true }));\n    }\n\n    for (const oem of selectedOems) {\n      const oemLower = normalizeKey(oem);\n      const canonicalOem =\n        catalog?.meta?.oemKeyByModalityLower?.[modalityLower]?.[oemLower] ||\n        oemLower;\n      if (!existingOemsLower.has(oemLower)) {\n        ops.push(\n          docRef.set({ [oemField]: { [canonicalOem]: [] } }, { merge: true })\n        );\n      }\n    }\n\n    for (const oem of selectedOems) {\n      const oemLower = normalizeKey(oem);\n      const canonicalOem =\n        catalog?.meta?.oemKeyByModalityLower?.[modalityLower]?.[oemLower] ||\n        oemLower;\n      const knownModels =\n        catalog?.modelsByModalityOem?.[canonicalModality]?.[canonicalOem] || [];\n      const knownLower = new Set(\n        knownModels.map((value) => normalizeKey(value))\n      );\n      const modelCaseMap =\n        catalog?.meta?.modelKeyByModalityOemLower?.[modalityLower]?.[oemLower] ||\n        {};\n      const modelField =\n        catalog?.meta?.modelFieldByModalityOem?.[canonicalModality]?.[\n          canonicalOem\n        ] || null;\n      for (const model of selectedModels) {\n        const modelLower = normalizeKey(model);\n        if (!modelLower || knownLower.has(modelLower)) continue;\n        const canonicalModel = modelCaseMap[modelLower] || model;\n        const path = modelField\n          ? `${oemField}.${canonicalOem}.${modelField}`\n          : `${oemField}.${canonicalOem}`;\n        ops.push(\n          docRef.update({\n            [path]: firebase.firestore.FieldValue.arrayUnion(canonicalModel),\n          })\n        );\n      }\n    }\n  }\n\n  if (ops.length) {\n    await Promise.allSettled(ops);\n    return true;\n  }\n  return false;\n}\n\nexport async function deleteTrackerOem({ oem, catalog }) {\n  if (!oem) return;\n  const db = firebase.firestore();\n  const trackerRef = db.collection(\"Tracker\");\n  const modalities = catalog?.modalities || [];\n  const usesSubcollections = Boolean(catalog?.meta?.usesSubcollections);\n  const ops = modalities.map((modality) => {\n    const modalityLower = normalizeKey(modality);\n    const canonicalModality =\n      catalog?.meta?.modalityKeyByLower?.[modalityLower] || modality;\n    const docRef = trackerRef.doc(canonicalModality);\n    const canonicalOem =\n      catalog?.meta?.oemKeyByModalityLower?.[modalityLower]?.[\n        normalizeKey(oem)\n      ] || oem;\n    if (usesSubcollections) {\n      return docRef\n        .collection(canonicalOem)\n        .get()\n        .then((snap) => {\n          const deletions = [];\n          snap.forEach((doc) => {\n            deletions.push(doc.ref.delete());\n          });\n          return Promise.allSettled(deletions);\n        })\n        .catch(() => null);\n    }\n    const oemField =\n      catalog?.meta?.oemFieldByModality?.[canonicalModality] ||\n      DEFAULT_OEM_FIELD;\n    const update = {\n      [`${oemField}.${canonicalOem}`]: firebase.firestore.FieldValue.delete(),\n    };\n    if (!catalog?.meta?.oemFieldByModality?.[canonicalModality]) {\n      update[canonicalOem] = firebase.firestore.FieldValue.delete();\n    }\n    return docRef.update(update).catch(() => null);\n  });\n  await Promise.allSettled(ops);\n}\n\nexport async function deleteTrackerModel({\n  modality,\n  oem,\n  model,\n  catalog,\n}) {\n  if (!modality || !oem || !model) return;\n  const db = firebase.firestore();\n  const modalityLower = normalizeKey(modality);\n  const canonicalModality =\n    catalog?.meta?.modalityKeyByLower?.[modalityLower] || modality;\n  const docRef = db.collection(\"Tracker\").doc(canonicalModality);\n  const canonicalOem =\n    catalog?.meta?.oemKeyByModalityLower?.[modalityLower]?.[\n      normalizeKey(oem)\n    ] || oem;\n  if (catalog?.meta?.usesSubcollections) {\n    const modelKey = normalizeKey(model);\n    await docRef\n      .collection(canonicalOem)\n      .doc(modelKey)\n      .delete()\n      .catch(() => null);\n    return;\n  }\n  const oemField =\n    catalog?.meta?.oemFieldByModality?.[canonicalModality] ||\n    DEFAULT_OEM_FIELD;\n  const modelField =\n    catalog?.meta?.modelFieldByModalityOem?.[canonicalModality]?.[\n      canonicalOem\n    ] || null;\n  const path = modelField\n    ? `${oemField}.${canonicalOem}.${modelField}`\n    : `${oemField}.${canonicalOem}`;\n  await docRef.update({\n    [path]: firebase.firestore.FieldValue.arrayRemove(model),\n  });\n}\n"]},"metadata":{},"sourceType":"module"}