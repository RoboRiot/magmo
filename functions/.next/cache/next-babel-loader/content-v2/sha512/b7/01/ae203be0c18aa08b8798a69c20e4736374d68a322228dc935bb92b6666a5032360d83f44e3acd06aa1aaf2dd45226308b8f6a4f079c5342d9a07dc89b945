{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/mack2/Desktop/code/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\mack2\\\\Desktop\\\\code\\\\pages\\\\NewSearch\\\\item\\\\[id]\\\\NewLocal.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n// NewLocal.js\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { Form, Row, Col, Button, Stack, Modal, Spinner } from \"react-bootstrap\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../../../../context/Firebase\";\nimport styles from \"./NewLocal.module.css\";\nexport default function NewLocal(_ref) {\n  _s();\n\n  var _this = this;\n\n  var _ref$onSave = _ref.onSave,\n      onSave = _ref$onSave === void 0 ? function () {} : _ref$onSave,\n      _ref$onCancel = _ref.onCancel,\n      onCancel = _ref$onCancel === void 0 ? function () {} : _ref$onCancel,\n      selectedClient = _ref.selectedClient,\n      showLocalLoc = _ref.showLocalLoc,\n      _ref$value = _ref.value,\n      value = _ref$value === void 0 ? {} : _ref$value,\n      onChange = _ref.onChange;\n  var router = useRouter();\n\n  var _useState = useState([]),\n      regionOptions = _useState[0],\n      setRegionOptions = _useState[1];\n\n  var _useState2 = useState({}),\n      sectionMap = _useState2[0],\n      setSectionMap = _useState2[1];\n\n  var _useState3 = useState(0),\n      binCount = _useState3[0],\n      setBinCount = _useState3[1];\n\n  var _useState4 = useState(0),\n      palletCount = _useState4[0],\n      setPalletCount = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      region = _useState5[0],\n      setRegion = _useState5[1];\n\n  var _useState6 = useState(\"\"),\n      sectionLetter = _useState6[0],\n      setSectionLetter = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      sectionNumber = _useState7[0],\n      setSectionNumber = _useState7[1];\n\n  var _useState8 = useState(\"\"),\n      binSelected = _useState8[0],\n      setBinSelected = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      palletSelected = _useState9[0],\n      setPalletSelected = _useState9[1];\n\n  var _useState10 = useState(false),\n      showMap = _useState10[0],\n      setShowMap = _useState10[1];\n\n  var _useState11 = useState(\"regions\"),\n      mapStep = _useState11[0],\n      setMapStep = _useState11[1];\n\n  var _useState12 = useState(\"\"),\n      mapRegion = _useState12[0],\n      setMapRegion = _useState12[1];\n\n  var _useState13 = useState(\"\"),\n      mapRow = _useState13[0],\n      setMapRow = _useState13[1];\n\n  var _useState14 = useState(\"\"),\n      mapCol = _useState14[0],\n      setMapCol = _useState14[1];\n\n  var _useState15 = useState(\"\"),\n      mapPallet = _useState15[0],\n      setMapPallet = _useState15[1];\n\n  var _useState16 = useState({}),\n      mapCellPallets = _useState16[0],\n      setMapCellPallets = _useState16[1];\n\n  var _useState17 = useState({}),\n      mapPalletBins = _useState17[0],\n      setMapPalletBins = _useState17[1];\n\n  var _useState18 = useState(false),\n      mapLoading = _useState18[0],\n      setMapLoading = _useState18[1];\n\n  var _useState19 = useState(\"\"),\n      mapError = _useState19[0],\n      setMapError = _useState19[1]; // 1) load directory exactly as before\n\n\n  useEffect(function () {\n    if (!showLocalLoc) return;\n    var db = firebase.firestore();\n    db.collection(\"Warehouse\").doc(\"directory\").get().then(function (doc) {\n      var d = doc.data() || {};\n      setRegionOptions(d.Region || []);\n      setSectionMap(d.Section || {});\n      setBinCount(d.Bin || 0);\n      setPalletCount(d.Pallet || 0);\n    });\n  }, [showLocalLoc]); // 2) when we open the modal (or value changes), initialize from value\n\n  useEffect(function () {\n    var _value$section, _value$section2, _value$bin, _value$pallet;\n\n    if (!showLocalLoc) return;\n    setRegion(value.region || \"\");\n    setSectionLetter(((_value$section = value.section) === null || _value$section === void 0 ? void 0 : _value$section.letter) || \"\");\n    setSectionNumber(((_value$section2 = value.section) === null || _value$section2 === void 0 ? void 0 : _value$section2.number) || \"\");\n    setBinSelected(((_value$bin = value.bin) === null || _value$bin === void 0 ? void 0 : _value$bin.toString()) || \"\");\n    setPalletSelected(((_value$pallet = value.pallet) === null || _value$pallet === void 0 ? void 0 : _value$pallet.toString()) || \"\");\n  }, [showLocalLoc]); // 3) notify parent on any change\n\n  useEffect(function () {\n    var p = {};\n    if (region) p.region = region;\n    if (sectionLetter && sectionNumber) p.section = {\n      letter: sectionLetter,\n      number: sectionNumber\n    };\n    if (binSelected) p.bin = parseInt(binSelected, 10);\n    if (palletSelected) p.pallet = parseInt(palletSelected, 10);\n    onChange(p);\n  }, [region, sectionLetter, sectionNumber, binSelected, palletSelected]); // helpers:\n\n  var letters = Array.from({\n    length: 26\n  }, function (_, i) {\n    return String.fromCharCode(65 + i);\n  });\n  var numbers = Array.from({\n    length: 50\n  }, function (_, i) {\n    return i + 1;\n  });\n  var binOptions = Array.from({\n    length: binCount\n  }, function (_, i) {\n    return i + 1;\n  });\n  var palletOptions = Array.from({\n    length: palletCount\n  }, function (_, i) {\n    return i + 1;\n  });\n  var regionLetters = useMemo(function () {\n    return Array.isArray(regionOptions) && regionOptions.length ? regionOptions : [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\"];\n  }, [regionOptions]);\n\n  var getRegionDimensions = function getRegionDimensions(regionId) {\n    var entry = sectionMap === null || sectionMap === void 0 ? void 0 : sectionMap[regionId];\n\n    if (Array.isArray(entry) && entry.length >= 2) {\n      var cols = parseInt(entry[0], 10);\n      var rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0\n      };\n    }\n\n    return {\n      cols: 0,\n      rows: 0\n    };\n  };\n\n  var loadRegionInventory = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(regionId) {\n      var snap, cellPallets, palletBins, cellObj, palletObj;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (regionId) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              setMapLoading(true);\n              setMapError(\"\");\n              _context.prev = 4;\n              _context.next = 7;\n              return firebase.firestore().collection(\"Test\").where(\"newLocalCurrent.region\", \"==\", regionId).get();\n\n            case 7:\n              snap = _context.sent;\n              cellPallets = {};\n              palletBins = {};\n              snap.forEach(function (doc) {\n                var _doc$data, _loc$section, _loc$section2;\n\n                var loc = ((_doc$data = doc.data()) === null || _doc$data === void 0 ? void 0 : _doc$data.newLocalCurrent) || {};\n                var row = (_loc$section = loc.section) === null || _loc$section === void 0 ? void 0 : _loc$section.letter;\n                var col = (_loc$section2 = loc.section) === null || _loc$section2 === void 0 ? void 0 : _loc$section2.number;\n\n                if ((!row || !col) && typeof loc.section === \"string\") {\n                  var trimmed = loc.section.trim();\n                  row = trimmed.slice(0, 1);\n                  col = trimmed.slice(1);\n                }\n\n                if (col !== undefined && col !== null) {\n                  col = String(col);\n                }\n\n                var pallet = loc.pallet;\n                var bin = loc.bin;\n                if (!row || !col) return;\n                var cellKey = \"\".concat(row, \"-\").concat(col);\n\n                if (pallet !== undefined && pallet !== null && \"\".concat(pallet) !== \"\") {\n                  if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n                  cellPallets[cellKey].add(String(pallet));\n\n                  if (bin !== undefined && bin !== null && \"\".concat(bin) !== \"\") {\n                    var palletKey = \"\".concat(cellKey, \"-P\").concat(pallet);\n                    if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n                    palletBins[palletKey].add(String(bin));\n                  }\n                }\n              });\n              cellObj = {};\n              Object.keys(cellPallets).forEach(function (key) {\n                cellObj[key] = Array.from(cellPallets[key]).sort(function (a, b) {\n                  return Number(a) - Number(b);\n                });\n              });\n              palletObj = {};\n              Object.keys(palletBins).forEach(function (key) {\n                palletObj[key] = Array.from(palletBins[key]).sort(function (a, b) {\n                  return Number(a) - Number(b);\n                });\n              });\n              setMapCellPallets(cellObj);\n              setMapPalletBins(palletObj);\n              _context.next = 23;\n              break;\n\n            case 19:\n              _context.prev = 19;\n              _context.t0 = _context[\"catch\"](4);\n              console.error(\"Failed to load map inventory\", _context.t0);\n              setMapError(\"Failed to load map inventory.\");\n\n            case 23:\n              _context.prev = 23;\n              setMapLoading(false);\n              return _context.finish(23);\n\n            case 26:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 19, 23, 26]]);\n    }));\n\n    return function loadRegionInventory(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(); // bump and persist bin count\n\n\n  var handleAddBin = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var next;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              next = binCount + 1;\n              _context2.next = 3;\n              return firebase.firestore().collection(\"Warehouse\").doc(\"directory\").update({\n                Bin: next\n              });\n\n            case 3:\n              setBinCount(next);\n              setBinSelected(next.toString());\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleAddBin() {\n      return _ref3.apply(this, arguments);\n    };\n  }(); // bump and persist pallet count\n\n\n  var handleAddPallet = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var next;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              next = palletCount + 1;\n              _context3.next = 3;\n              return firebase.firestore().collection(\"Warehouse\").doc(\"directory\").update({\n                Pallet: next\n              });\n\n            case 3:\n              setPalletCount(next);\n              setPalletSelected(next.toString());\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleAddPallet() {\n      return _ref4.apply(this, arguments);\n    };\n  }(); // only fire parent when they click OK\n\n\n  var handleOk = function handleOk() {\n    var p = {};\n    if (region) p.region = region;\n    if (sectionLetter && sectionNumber) p.section = {\n      letter: sectionLetter,\n      number: sectionNumber\n    };\n    if (binSelected) p.bin = parseInt(binSelected, 10);\n    if (palletSelected) p.pallet = parseInt(palletSelected, 10);\n    onSave(p);\n  };\n\n  var openMap = function openMap() {\n    setMapError(\"\");\n\n    if (region) {\n      setMapRegion(region);\n      setMapStep(\"grid\");\n      loadRegionInventory(region);\n    } else {\n      setMapRegion(\"\");\n      setMapStep(\"regions\");\n    }\n\n    setShowMap(true);\n  };\n\n  var handleSelectRegion = function handleSelectRegion(regionId) {\n    setMapRegion(regionId);\n    setRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setPalletSelected(\"\");\n    setBinSelected(\"\");\n    setMapStep(\"grid\");\n    loadRegionInventory(regionId);\n  };\n\n  var handleSelectCell = function handleSelectCell(rowLetter, colNumber) {\n    setMapRow(rowLetter);\n    setMapCol(colNumber);\n    setSectionLetter(rowLetter);\n    setSectionNumber(String(colNumber));\n    setMapPallet(\"\");\n    setPalletSelected(\"\");\n    setBinSelected(\"\");\n    setMapStep(\"pallets\");\n  };\n\n  var handleSelectPallet = function handleSelectPallet(palletId) {\n    setMapPallet(palletId);\n    setPalletSelected(String(palletId));\n    setBinSelected(\"\");\n    setMapStep(\"bins\");\n  };\n\n  var handleSelectBin = function handleSelectBin(binId) {\n    setBinSelected(String(binId));\n  };\n\n  var handleMapBack = function handleMapBack() {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");else if (mapStep === \"pallets\") setMapStep(\"grid\");else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  var handleViewInventory = function handleViewInventory() {\n    var params = new URLSearchParams();\n    var regionValue = mapRegion || region;\n    var letterValue = mapRow || sectionLetter;\n    var numberValue = mapCol || sectionNumber;\n    var palletValue = mapPallet || palletSelected;\n    var binValue = binSelected;\n    if (regionValue) params.set(\"region\", regionValue);\n    if (letterValue) params.set(\"sectionLetter\", letterValue);\n    if (numberValue) params.set(\"sectionNumber\", numberValue);\n    if (palletValue) params.set(\"pallet\", palletValue);\n    if (binValue) params.set(\"bin\", binValue);\n    var query = params.toString();\n    router.push(\"/NewSearch/inventory/inventoryManage\".concat(query ? \"?\".concat(query) : \"\"));\n  };\n\n  return __jsx(\"div\", {\n    className: styles.wrapper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 5\n    }\n  }, __jsx(Row, {\n    className: styles.formRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 263,\n      columnNumber: 7\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Group, {\n    className: styles.formGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 13\n    }\n  }, \"Region\"), __jsx(Form.Select, {\n    value: region,\n    onChange: function onChange(e) {\n      return setRegion(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 13\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 15\n    }\n  }, \"Select region\"), regionOptions.map(function (r) {\n    return __jsx(\"option\", {\n      key: r,\n      value: r,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 38\n      }\n    }, r);\n  })))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Group, {\n    className: styles.formGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 277,\n      columnNumber: 13\n    }\n  }, \"Section Letter\"), __jsx(Form.Select, {\n    value: sectionLetter,\n    onChange: function onChange(e) {\n      return setSectionLetter(e.target.value);\n    } // disabled={!region}\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 13\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 283,\n      columnNumber: 15\n    }\n  }, \"Letter\"), letters.map(function (l) {\n    return __jsx(\"option\", {\n      key: l,\n      value: l,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 32\n      }\n    }, l);\n  })))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Group, {\n    className: styles.formGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 13\n    }\n  }, \"Section Number\"), __jsx(Form.Select, {\n    value: sectionNumber,\n    onChange: function onChange(e) {\n      return setSectionNumber(e.target.value);\n    } // disabled={!region}\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 13\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 15\n    }\n  }, \"Number\"), numbers.map(function (n) {\n    return __jsx(\"option\", {\n      key: n,\n      value: n,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 32\n      }\n    }, n);\n  }))))), __jsx(Row, {\n    className: \"mt-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 7\n    }\n  }, __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Group, {\n    className: styles.formGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 305,\n      columnNumber: 13\n    }\n  }, \"Bin\"), __jsx(Stack, {\n    direction: \"horizontal\",\n    gap: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 13\n    }\n  }, __jsx(Form.Select, {\n    value: binSelected,\n    onChange: function onChange(e) {\n      return setBinSelected(e.target.value);\n    } // disabled={!region}\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 307,\n      columnNumber: 15\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 17\n    }\n  }, \"Select bin\"), binOptions.map(function (b) {\n    return __jsx(\"option\", {\n      key: b,\n      value: b,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 38\n      }\n    }, b);\n  })), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleAddBin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 315,\n      columnNumber: 15\n    }\n  }, \"+ Bin\")))), __jsx(Col, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 321,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Group, {\n    className: styles.formGroup,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 11\n    }\n  }, \"Pallet\"), __jsx(Stack, {\n    direction: \"horizontal\",\n    gap: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 324,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Select, {\n    value: palletSelected,\n    onChange: function onChange(e) {\n      return setPalletSelected(e.target.value);\n    } // disabled={!region}\n    ,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 11\n    }\n  }, __jsx(\"option\", {\n    value: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 15\n    }\n  }, \"Select pallet\"), palletOptions.map(function (p) {\n    return __jsx(\"option\", {\n      key: p,\n      value: p,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 41\n      }\n    }, p);\n  })), __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleAddPallet,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 15\n    }\n  }, \"+ Pallet\"))))), __jsx(\"div\", {\n    className: styles.actionRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 7\n    }\n  }, __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: openMap,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 9\n    }\n  }, \"Map\"), __jsx(\"div\", {\n    className: styles.actionSpacer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 9\n    }\n  }), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: onCancel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 346,\n      columnNumber: 9\n    }\n  }, \"Cancel\"), __jsx(Button, {\n    variant: \"primary\",\n    onClick: handleOk,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 9\n    }\n  }, \"OK\")), __jsx(Modal, {\n    show: showMap,\n    onHide: function onHide() {\n      return setShowMap(false);\n    },\n    centered: true,\n    size: \"lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 7\n    }\n  }, __jsx(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 11\n    }\n  }, \"Warehouse Map\")), __jsx(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 9\n    }\n  }, mapLoading && __jsx(\"div\", {\n    className: styles.mapLoading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 13\n    }\n  }, __jsx(Spinner, {\n    animation: \"border\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 15\n    }\n  }), __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 15\n    }\n  }, \"Loading map data\\u2026\")), mapError && __jsx(\"div\", {\n    className: styles.mapError,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 24\n    }\n  }, mapError), !mapLoading && mapStep === \"regions\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 15\n    }\n  }, \"Select a region\"), __jsx(\"div\", {\n    className: styles.mapCanvas,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 15\n    }\n  }, [\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"].map(function (regionId) {\n    return __jsx(\"button\", {\n      key: regionId,\n      type: \"button\",\n      className: \"\".concat(styles.regionBlock, \" \").concat(styles[\"region\".concat(regionId)]),\n      onClick: function onClick() {\n        return handleSelectRegion(regionId);\n      },\n      disabled: !regionLetters.includes(regionId),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 19\n      }\n    }, regionId);\n  }))), !mapLoading && mapStep === \"grid\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 15\n    }\n  }, \"Region \", mapRegion, \": choose a row and column\"), function () {\n    var dims = getRegionDimensions(mapRegion);\n    var rows = letters.slice(0, dims.rows || 0);\n    var cols = numbers.slice(0, dims.cols || 0);\n\n    if (!rows.length || !cols.length) {\n      return __jsx(\"div\", {\n        className: styles.mapEmpty,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 402,\n          columnNumber: 21\n        }\n      }, \"No grid data for this region.\");\n    }\n\n    return __jsx(\"div\", {\n      className: styles.gridWrapper,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 19\n      }\n    }, __jsx(\"div\", {\n      className: styles.grid,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 21\n      }\n    }, rows.map(function (row) {\n      return cols.map(function (col) {\n        var _mapCellPallets$cellK;\n\n        var cellKey = \"\".concat(row, \"-\").concat(col);\n        var hasPallets = Boolean((_mapCellPallets$cellK = mapCellPallets[cellKey]) === null || _mapCellPallets$cellK === void 0 ? void 0 : _mapCellPallets$cellK.length);\n        return __jsx(\"button\", {\n          key: cellKey,\n          type: \"button\",\n          className: \"\".concat(styles.gridCell, \" \").concat(hasPallets ? \"\" : styles.gridCellDisabled),\n          onClick: function onClick() {\n            return hasPallets && handleSelectCell(row, col);\n          },\n          disabled: !hasPallets,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 29\n          }\n        }, __jsx(\"span\", {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 428,\n            columnNumber: 31\n          }\n        }, row, col));\n      });\n    })));\n  }()), !mapLoading && mapStep === \"pallets\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 442,\n      columnNumber: 15\n    }\n  }, \"Region \", mapRegion, \" \\xB7 Section \", mapRow, mapCol, \": select a pallet\"), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 445,\n      columnNumber: 15\n    }\n  }, (mapCellPallets[\"\".concat(mapRow, \"-\").concat(mapCol)] || []).map(function (pallet) {\n    var palletKey = \"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(pallet);\n    var bins = mapPalletBins[palletKey] || [];\n    var disabled = bins.length === 0;\n    return __jsx(\"button\", {\n      key: pallet,\n      type: \"button\",\n      className: \"\".concat(styles.palletButton, \" \").concat(disabled ? styles.gridCellDisabled : \"\"),\n      onClick: function onClick() {\n        return !disabled && handleSelectPallet(pallet);\n      },\n      disabled: disabled,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 21\n      }\n    }, \"Pallet \", pallet);\n  }), !(mapCellPallets[\"\".concat(mapRow, \"-\").concat(mapCol)] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 19\n    }\n  }, \"No pallets available here.\"))), !mapLoading && mapStep === \"bins\" && __jsx(\"div\", {\n    className: styles.mapStage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 474,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: styles.mapHint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 475,\n      columnNumber: 15\n    }\n  }, \"Region \", mapRegion, \" \\xB7 Section \", mapRow, mapCol, \" \\xB7 Pallet \", mapPallet), __jsx(\"div\", {\n    className: styles.palletGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 478,\n      columnNumber: 15\n    }\n  }, (mapPalletBins[\"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(mapPallet)] || []).map(function (bin) {\n    return __jsx(\"button\", {\n      key: bin,\n      type: \"button\",\n      className: \"\".concat(styles.palletButton, \" \").concat(styles.binButton),\n      onClick: function onClick() {\n        return handleSelectBin(bin);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 481,\n        columnNumber: 21\n      }\n    }, \"Bin \", bin);\n  }), !(mapPalletBins[\"\".concat(mapRow, \"-\").concat(mapCol, \"-P\").concat(mapPallet)] || []).length && __jsx(\"div\", {\n    className: styles.mapEmpty,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 493,\n      columnNumber: 19\n    }\n  }, \"No bins available on this pallet.\")))), __jsx(Modal.Footer, {\n    className: styles.mapFooter,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 501,\n      columnNumber: 9\n    }\n  }, __jsx(Button, {\n    variant: \"outline-secondary\",\n    onClick: handleMapBack,\n    disabled: mapStep === \"regions\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 502,\n      columnNumber: 11\n    }\n  }, \"Back\"), __jsx(Button, {\n    variant: \"outline-primary\",\n    onClick: handleViewInventory,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 509,\n      columnNumber: 11\n    }\n  }, \"View\"), __jsx(Button, {\n    variant: \"secondary\",\n    onClick: function onClick() {\n      return setShowMap(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 512,\n      columnNumber: 11\n    }\n  }, \"Close\"))));\n}\n\n_s(NewLocal, \"vKdC31NiYYU9cZY5vwtIqxoKNAY=\", false, function () {\n  return [useRouter];\n});\n\n_c = NewLocal;\n\nvar _c;\n\n$RefreshReg$(_c, \"NewLocal\");","map":{"version":3,"sources":["C:/Users/mack2/Desktop/code/pages/NewSearch/item/[id]/NewLocal.js"],"names":["React","useState","useEffect","useMemo","Form","Row","Col","Button","Stack","Modal","Spinner","useRouter","firebase","styles","NewLocal","onSave","onCancel","selectedClient","showLocalLoc","value","onChange","router","regionOptions","setRegionOptions","sectionMap","setSectionMap","binCount","setBinCount","palletCount","setPalletCount","region","setRegion","sectionLetter","setSectionLetter","sectionNumber","setSectionNumber","binSelected","setBinSelected","palletSelected","setPalletSelected","showMap","setShowMap","mapStep","setMapStep","mapRegion","setMapRegion","mapRow","setMapRow","mapCol","setMapCol","mapPallet","setMapPallet","mapCellPallets","setMapCellPallets","mapPalletBins","setMapPalletBins","mapLoading","setMapLoading","mapError","setMapError","db","firestore","collection","doc","get","then","d","data","Region","Section","Bin","Pallet","section","letter","number","bin","toString","pallet","p","parseInt","letters","Array","from","length","_","i","String","fromCharCode","numbers","binOptions","palletOptions","regionLetters","isArray","getRegionDimensions","regionId","entry","cols","rows","Number","isFinite","loadRegionInventory","where","snap","cellPallets","palletBins","forEach","loc","newLocalCurrent","row","col","trimmed","trim","slice","undefined","cellKey","Set","add","palletKey","cellObj","Object","keys","key","sort","a","b","palletObj","console","error","handleAddBin","next","update","handleAddPallet","handleOk","openMap","handleSelectRegion","handleSelectCell","rowLetter","colNumber","handleSelectPallet","palletId","handleSelectBin","binId","handleMapBack","handleViewInventory","params","URLSearchParams","regionValue","letterValue","numberValue","palletValue","binValue","set","query","push","wrapper","formRow","formGroup","e","target","map","r","l","n","actionRow","actionSpacer","mapStage","mapHint","mapCanvas","regionBlock","includes","dims","mapEmpty","gridWrapper","grid","hasPallets","Boolean","gridCell","gridCellDisabled","palletGrid","bins","disabled","palletButton","binButton","mapFooter"],"mappings":"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","sourcesContent":["// NewLocal.js\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { Form, Row, Col, Button, Stack, Modal, Spinner } from \"react-bootstrap\";\nimport { useRouter } from \"next/router\";\nimport firebase from \"../../../../context/Firebase\";\nimport styles from \"./NewLocal.module.css\";\n\nexport default function NewLocal({\n  onSave = () => {},\n  onCancel = () => {},\n  selectedClient,\n  showLocalLoc,\n  value = {},\n  onChange,\n}) {\n  const router = useRouter();\n  const [regionOptions, setRegionOptions] = useState([]);\n  const [sectionMap, setSectionMap]     = useState({});\n  const [binCount, setBinCount]         = useState(0);\n  const [palletCount, setPalletCount]   = useState(0);\n\n  const [region, setRegion] = useState(\"\");\n  const [sectionLetter, setSectionLetter] = useState(\"\");\n  const [sectionNumber, setSectionNumber] = useState(\"\");\n  const [binSelected, setBinSelected]     = useState(\"\");\n  const [palletSelected, setPalletSelected] = useState(\"\");\n  const [showMap, setShowMap] = useState(false);\n  const [mapStep, setMapStep] = useState(\"regions\");\n  const [mapRegion, setMapRegion] = useState(\"\");\n  const [mapRow, setMapRow] = useState(\"\");\n  const [mapCol, setMapCol] = useState(\"\");\n  const [mapPallet, setMapPallet] = useState(\"\");\n  const [mapCellPallets, setMapCellPallets] = useState({});\n  const [mapPalletBins, setMapPalletBins] = useState({});\n  const [mapLoading, setMapLoading] = useState(false);\n  const [mapError, setMapError] = useState(\"\");\n\n  // 1) load directory exactly as before\n  useEffect(() => {\n    if (!showLocalLoc) return;\n    const db = firebase.firestore();\n    db.collection(\"Warehouse\").doc(\"directory\").get().then(doc => {\n      const d = doc.data() || {};\n      setRegionOptions(d.Region   || []);\n      setSectionMap   (d.Section  || {});\n      setBinCount     (d.Bin      || 0);\n      setPalletCount  (d.Pallet   || 0);\n    });\n  }, [showLocalLoc]);\n\n  // 2) when we open the modal (or value changes), initialize from value\n  useEffect(() => {\n    if (!showLocalLoc) return;\n    setRegion        (value.region             || \"\");\n    setSectionLetter(value.section?.letter    || \"\");\n    setSectionNumber(value.section?.number    || \"\");\n    setBinSelected   (value.bin?.toString()    || \"\");\n    setPalletSelected(value.pallet?.toString()|| \"\");\n  }, [showLocalLoc]);\n\n  // 3) notify parent on any change\n  useEffect(() => {\n    const p = {};\n    if (region)         p.region  = region;\n    if (sectionLetter && sectionNumber) p.section = { letter: sectionLetter, number: sectionNumber };\n    if (binSelected)    p.bin     = parseInt(binSelected,10);\n    if (palletSelected) p.pallet  = parseInt(palletSelected,10);\n    onChange(p);\n  }, [region, sectionLetter, sectionNumber, binSelected, palletSelected]);\n\n  // helpers:\nconst letters = Array.from({ length: 26 }, (_, i) => String.fromCharCode(65 + i));\nconst numbers = Array.from({ length: 50 }, (_, i) => i + 1);\n  const binOptions = Array.from({ length: binCount }, (_, i) => i + 1);\n  const palletOptions = Array.from({ length: palletCount }, (_, i) => i + 1);\n  const regionLetters = useMemo(\n    () => (Array.isArray(regionOptions) && regionOptions.length ? regionOptions : [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\"]),\n    [regionOptions]\n  );\n  const getRegionDimensions = (regionId) => {\n    const entry = sectionMap?.[regionId];\n    if (Array.isArray(entry) && entry.length >= 2) {\n      const cols = parseInt(entry[0], 10);\n      const rows = parseInt(entry[1], 10);\n      return {\n        cols: Number.isFinite(cols) ? cols : 0,\n        rows: Number.isFinite(rows) ? rows : 0,\n      };\n    }\n    return { cols: 0, rows: 0 };\n  };\n\n  const loadRegionInventory = async (regionId) => {\n    if (!regionId) return;\n    setMapLoading(true);\n    setMapError(\"\");\n    try {\n      const snap = await firebase\n        .firestore()\n        .collection(\"Test\")\n        .where(\"newLocalCurrent.region\", \"==\", regionId)\n        .get();\n\n      const cellPallets = {};\n      const palletBins = {};\n      snap.forEach((doc) => {\n        const loc = doc.data()?.newLocalCurrent || {};\n        let row = loc.section?.letter;\n        let col = loc.section?.number;\n        if ((!row || !col) && typeof loc.section === \"string\") {\n          const trimmed = loc.section.trim();\n          row = trimmed.slice(0, 1);\n          col = trimmed.slice(1);\n        }\n        if (col !== undefined && col !== null) {\n          col = String(col);\n        }\n        const pallet = loc.pallet;\n        const bin = loc.bin;\n        if (!row || !col) return;\n        const cellKey = `${row}-${col}`;\n        if (pallet !== undefined && pallet !== null && `${pallet}` !== \"\") {\n          if (!cellPallets[cellKey]) cellPallets[cellKey] = new Set();\n          cellPallets[cellKey].add(String(pallet));\n          if (bin !== undefined && bin !== null && `${bin}` !== \"\") {\n            const palletKey = `${cellKey}-P${pallet}`;\n            if (!palletBins[palletKey]) palletBins[palletKey] = new Set();\n            palletBins[palletKey].add(String(bin));\n          }\n        }\n      });\n\n      const cellObj = {};\n      Object.keys(cellPallets).forEach((key) => {\n        cellObj[key] = Array.from(cellPallets[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      const palletObj = {};\n      Object.keys(palletBins).forEach((key) => {\n        palletObj[key] = Array.from(palletBins[key]).sort(\n          (a, b) => Number(a) - Number(b)\n        );\n      });\n\n      setMapCellPallets(cellObj);\n      setMapPalletBins(palletObj);\n    } catch (error) {\n      console.error(\"Failed to load map inventory\", error);\n      setMapError(\"Failed to load map inventory.\");\n    } finally {\n      setMapLoading(false);\n    }\n  };\n\n  // bump and persist bin count\n  const handleAddBin = async () => {\n    const next = binCount + 1;\n    await firebase.firestore()\n      .collection(\"Warehouse\").doc(\"directory\")\n      .update({ Bin: next });\n    setBinCount(next);\n    setBinSelected(next.toString());\n  };\n\n  // bump and persist pallet count\n  const handleAddPallet = async () => {\n    const next = palletCount + 1;\n    await firebase.firestore()\n      .collection(\"Warehouse\").doc(\"directory\")\n      .update({ Pallet: next });\n    setPalletCount(next);\n    setPalletSelected(next.toString());\n  };\n\n  // only fire parent when they click OK\n  const handleOk = () => {\n    const p = {};\n    if (region) p.region = region;\n    if (sectionLetter && sectionNumber)\n      p.section = { letter: sectionLetter, number: sectionNumber };\n    if (binSelected) p.bin = parseInt(binSelected, 10);\n    if (palletSelected) p.pallet = parseInt(palletSelected, 10);\n    onSave(p);\n  };\n\n  const openMap = () => {\n    setMapError(\"\");\n    if (region) {\n      setMapRegion(region);\n      setMapStep(\"grid\");\n      loadRegionInventory(region);\n    } else {\n      setMapRegion(\"\");\n      setMapStep(\"regions\");\n    }\n    setShowMap(true);\n  };\n\n  const handleSelectRegion = (regionId) => {\n    setMapRegion(regionId);\n    setRegion(regionId);\n    setMapRow(\"\");\n    setMapCol(\"\");\n    setMapPallet(\"\");\n    setPalletSelected(\"\");\n    setBinSelected(\"\");\n    setMapStep(\"grid\");\n    loadRegionInventory(regionId);\n  };\n\n  const handleSelectCell = (rowLetter, colNumber) => {\n    setMapRow(rowLetter);\n    setMapCol(colNumber);\n    setSectionLetter(rowLetter);\n    setSectionNumber(String(colNumber));\n    setMapPallet(\"\");\n    setPalletSelected(\"\");\n    setBinSelected(\"\");\n    setMapStep(\"pallets\");\n  };\n\n  const handleSelectPallet = (palletId) => {\n    setMapPallet(palletId);\n    setPalletSelected(String(palletId));\n    setBinSelected(\"\");\n    setMapStep(\"bins\");\n  };\n\n  const handleSelectBin = (binId) => {\n    setBinSelected(String(binId));\n  };\n\n  const handleMapBack = () => {\n    if (mapStep === \"bins\") setMapStep(\"pallets\");\n    else if (mapStep === \"pallets\") setMapStep(\"grid\");\n    else if (mapStep === \"grid\") setMapStep(\"regions\");\n  };\n\n  const handleViewInventory = () => {\n    const params = new URLSearchParams();\n    const regionValue = mapRegion || region;\n    const letterValue = mapRow || sectionLetter;\n    const numberValue = mapCol || sectionNumber;\n    const palletValue = mapPallet || palletSelected;\n    const binValue = binSelected;\n\n    if (regionValue) params.set(\"region\", regionValue);\n    if (letterValue) params.set(\"sectionLetter\", letterValue);\n    if (numberValue) params.set(\"sectionNumber\", numberValue);\n    if (palletValue) params.set(\"pallet\", palletValue);\n    if (binValue) params.set(\"bin\", binValue);\n\n    const query = params.toString();\n    router.push(\n      `/NewSearch/inventory/inventoryManage${query ? `?${query}` : \"\"}`\n    );\n  };\n\n  return (\n    <div className={styles.wrapper}>\n      <Row className={styles.formRow}>\n        <Col>\n          <Form.Group className={styles.formGroup}>\n            <Form.Label>Region</Form.Label>\n            <Form.Select\n              value={region} onChange={e=>setRegion(e.target.value)}\n            >\n              <option value=\"\">Select region</option>\n              {regionOptions.map(r=> <option key={r} value={r}>{r}</option>)}\n            </Form.Select>\n          </Form.Group>\n        </Col>\n        <Col>\n          <Form.Group className={styles.formGroup}>\n            <Form.Label>Section Letter</Form.Label>\n            <Form.Select\n              value={sectionLetter}\n              onChange={e=>setSectionLetter(e.target.value)}\n              // disabled={!region}\n            >\n              <option value=\"\">Letter</option>\n              {letters.map(l=> <option key={l} value={l}>{l}</option>)}\n            </Form.Select>\n          </Form.Group>\n        </Col>\n        <Col>\n          <Form.Group className={styles.formGroup}>\n            <Form.Label>Section Number</Form.Label>\n            <Form.Select\n              value={sectionNumber}\n              onChange={e=>setSectionNumber(e.target.value)}\n              // disabled={!region}\n            >\n              <option value=\"\">Number</option>\n              {numbers.map(n=> <option key={n} value={n}>{n}</option>)}\n            </Form.Select>\n          </Form.Group>\n        </Col>\n      </Row>\n      <Row className=\"mt-3\">\n        <Col>\n          <Form.Group className={styles.formGroup}>\n            <Form.Label>Bin</Form.Label>\n            <Stack direction=\"horizontal\" gap={2}>\n              <Form.Select\n                value={binSelected}\n                onChange={e => setBinSelected(e.target.value)}\n                // disabled={!region}\n              >\n                <option value=\"\">Select bin</option>\n                {binOptions.map(b => <option key={b} value={b}>{b}</option>)}\n              </Form.Select>\n              <Button variant=\"outline-secondary\" onClick={handleAddBin} >\n                + Bin\n              </Button>\n            </Stack>\n          </Form.Group>\n        </Col>\n        <Col>\n          <Form.Group className={styles.formGroup}>\n          <Form.Label>Pallet</Form.Label>\n          <Stack direction=\"horizontal\" gap={2}>\n          <Form.Select\n            value={palletSelected}\n            onChange={e =>setPalletSelected(e.target.value)}\n              // disabled={!region}\n            >\n              <option value=\"\">Select pallet</option>\n                {palletOptions.map(p => <option key={p} value={p}>{p}</option>)}\n              </Form.Select>\n              <Button variant=\"outline-secondary\" onClick={handleAddPallet} >\n                + Pallet\n              </Button>\n            </Stack>\n          </Form.Group>\n        </Col>\n      </Row>\n      {/* OK / Cancel footer */}\n      <div className={styles.actionRow}>\n        <Button variant=\"outline-primary\" onClick={openMap}>\n          Map\n        </Button>\n        <div className={styles.actionSpacer} />\n        <Button variant=\"secondary\" onClick={onCancel}>\n          Cancel\n        </Button>\n        <Button variant=\"primary\" onClick={handleOk}>\n          OK\n        </Button>\n      </div>\n\n      <Modal\n        show={showMap}\n        onHide={() => setShowMap(false)}\n        centered\n        size=\"lg\"\n      >\n        <Modal.Header closeButton>\n          <Modal.Title>Warehouse Map</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          {mapLoading && (\n            <div className={styles.mapLoading}>\n              <Spinner animation=\"border\" />\n              <span>Loading map data</span>\n            </div>\n          )}\n          {mapError && <div className={styles.mapError}>{mapError}</div>}\n\n          {!mapLoading && mapStep === \"regions\" && (\n            <div className={styles.mapStage}>\n              <div className={styles.mapHint}>Select a region</div>\n              <div className={styles.mapCanvas}>\n                {[\"E\", \"F\", \"G\", \"A\", \"D\", \"C\", \"B\"].map((regionId) => (\n                  <button\n                    key={regionId}\n                    type=\"button\"\n                    className={`${styles.regionBlock} ${styles[`region${regionId}`]}`}\n                    onClick={() => handleSelectRegion(regionId)}\n                    disabled={!regionLetters.includes(regionId)}\n                  >\n                    {regionId}\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {!mapLoading && mapStep === \"grid\" && (\n            <div className={styles.mapStage}>\n              <div className={styles.mapHint}>\n                Region {mapRegion}: choose a row and column\n              </div>\n              {(() => {\n                const dims = getRegionDimensions(mapRegion);\n                const rows = letters.slice(0, dims.rows || 0);\n                const cols = numbers.slice(0, dims.cols || 0);\n                if (!rows.length || !cols.length) {\n                  return (\n                    <div className={styles.mapEmpty}>\n                      No grid data for this region.\n                    </div>\n                  );\n                }\n                return (\n                  <div className={styles.gridWrapper}>\n                    <div className={styles.grid}>\n                      {rows.map((row) =>\n                        cols.map((col) => {\n                          const cellKey = `${row}-${col}`;\n                          const hasPallets = Boolean(\n                            mapCellPallets[cellKey]?.length\n                          );\n                          return (\n                            <button\n                              key={cellKey}\n                              type=\"button\"\n                              className={`${styles.gridCell} ${\n                                hasPallets ? \"\" : styles.gridCellDisabled\n                              }`}\n                              onClick={() =>\n                                hasPallets && handleSelectCell(row, col)\n                              }\n                              disabled={!hasPallets}\n                            >\n                              <span>{row}{col}</span>\n                            </button>\n                          );\n                        })\n                      )}\n                    </div>\n                  </div>\n                );\n              })()}\n            </div>\n          )}\n\n          {!mapLoading && mapStep === \"pallets\" && (\n            <div className={styles.mapStage}>\n              <div className={styles.mapHint}>\n                Region {mapRegion}  Section {mapRow}{mapCol}: select a pallet\n              </div>\n              <div className={styles.palletGrid}>\n                {(mapCellPallets[`${mapRow}-${mapCol}`] || []).map((pallet) => {\n                  const palletKey = `${mapRow}-${mapCol}-P${pallet}`;\n                  const bins = mapPalletBins[palletKey] || [];\n                  const disabled = bins.length === 0;\n                  return (\n                    <button\n                      key={pallet}\n                      type=\"button\"\n                      className={`${styles.palletButton} ${\n                        disabled ? styles.gridCellDisabled : \"\"\n                      }`}\n                      onClick={() => !disabled && handleSelectPallet(pallet)}\n                      disabled={disabled}\n                    >\n                      Pallet {pallet}\n                    </button>\n                  );\n                })}\n                {!(mapCellPallets[`${mapRow}-${mapCol}`] || []).length && (\n                  <div className={styles.mapEmpty}>\n                    No pallets available here.\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n\n          {!mapLoading && mapStep === \"bins\" && (\n            <div className={styles.mapStage}>\n              <div className={styles.mapHint}>\n                Region {mapRegion}  Section {mapRow}{mapCol}  Pallet {mapPallet}\n              </div>\n              <div className={styles.palletGrid}>\n                {(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || []).map(\n                  (bin) => (\n                    <button\n                      key={bin}\n                      type=\"button\"\n                      className={`${styles.palletButton} ${styles.binButton}`}\n                      onClick={() => handleSelectBin(bin)}\n                    >\n                      Bin {bin}\n                    </button>\n                  )\n                )}\n                {!(mapPalletBins[`${mapRow}-${mapCol}-P${mapPallet}`] || [])\n                  .length && (\n                  <div className={styles.mapEmpty}>\n                    No bins available on this pallet.\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </Modal.Body>\n        <Modal.Footer className={styles.mapFooter}>\n          <Button\n            variant=\"outline-secondary\"\n            onClick={handleMapBack}\n            disabled={mapStep === \"regions\"}\n          >\n            Back\n          </Button>\n          <Button variant=\"outline-primary\" onClick={handleViewInventory}>\n            View\n          </Button>\n          <Button variant=\"secondary\" onClick={() => setShowMap(false)}>\n            Close\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}